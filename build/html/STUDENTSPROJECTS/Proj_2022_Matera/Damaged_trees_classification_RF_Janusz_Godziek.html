<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.1. Damaged vs undamaged trees - Random Forest classification &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.2. Alonso Gonzalez: Stream Network Abstraction" href="Stream_Network_Abstraction_Alonso_Gonzalez.html" />
    <link rel="prev" title="1.12. Relationship between continental-scale patterns of fire activity and modes of climate variability" href="../Proj_2021_SW/Tatiana_Klisho_project.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Spatial Ecology's code documentation
            <img src="../../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Colab_for_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_for_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_curso_para_Ecologia_Espacial.html">Prepare OSGeoLive para el curso de ecología espacial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_introduction.html">Introdction to pyjeo: installation and raster visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_pktools.html">Performing raster and vector operations in Python using pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_02SVM_pred.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred.html">Estimation of tree height using GEDI dataset - Perceptron 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred_clean.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html">The real data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-Using-the-Window-Method">LSTM for Regression Using the Window Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-with-Time-Steps">LSTM for Regression with Time Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-with-Memory-Between-Batches">LSTM with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Stacked-LSTMs-with-Memory-Between-Batches">Stacked LSTMs with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Adding-Early-Stopping">Adding Early Stopping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Multivariate-Time-series---Data">Multivariate Time-series - Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#matera">2. 2022 MATERA</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.1. <strong>Damaged vs undamaged trees - Random Forest classification</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Janusz-Godziek">2.1.1. Janusz Godziek</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Project-description">2.1.1.1. Project description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Geocomputation-part">2.1.1.2. Geocomputation part</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Modelling-part">2.1.1.3. Modelling part</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Stream_Network_Abstraction_Alonso_Gonzalez.html">2.2. Alonso Gonzalez: Stream Network Abstraction</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">1. </span>2021 SWEDEN</a> &raquo;</li>
      <li><span class="section-number">2.1. </span><strong>Damaged vs undamaged trees - Random Forest classification</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/STUDENTSPROJECTS/Proj_2022_Matera/Damaged_trees_classification_RF_Janusz_Godziek.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Damaged-vs-undamaged-trees---Random-Forest-classification">
<h1><span class="section-number">2.1. </span><strong>Damaged vs undamaged trees - Random Forest classification</strong><a class="headerlink" href="#Damaged-vs-undamaged-trees---Random-Forest-classification" title="Permalink to this headline"></a></h1>
<section id="Janusz-Godziek">
<h2><span class="section-number">2.1.1. </span>Janusz Godziek<a class="headerlink" href="#Janusz-Godziek" title="Permalink to this headline"></a></h2>
<section id="Project-description">
<h3><span class="section-number">2.1.1.1. </span>Project description<a class="headerlink" href="#Project-description" title="Permalink to this headline"></a></h3>
<p>The aim of the project was to model tree damage using the random forest technique. The model is based on the data from tree inventories conducted in the Gorce National Park (Polish Carpathians). The dominant tree species in the study area include Norway spruce, European silver fir, and European beech. In the analyzed area the damages of trees are caused primarily by insects (mainly bark beetles) and by the wind. Trees censuses were conducted at 5-year intervals for more than 400 monitoring plots
(one plot is a circle with a radius = 12 m).</p>
</section>
<section id="Geocomputation-part">
<h3><span class="section-number">2.1.1.2. </span>Geocomputation part<a class="headerlink" href="#Geocomputation-part" title="Permalink to this headline"></a></h3>
<p><strong>Data cleaning and pre-processing</strong></p>
<p>Python was applied to compute the following variables: * minimal number of years, in which tree was growing - the number of censuses, in which tree was recorded multiplied by 5 (as censuses were conducted at 5-year intervals), * maximal diameter at breast height (D), measured in the field, * maximal tree volume (V), calculated based on diameter at breast height, * maximal area of breast height cross-section (G), calculated based on diameter at breast height.</p>
<p>For D, V and G maximal value from 6 censuses was selected.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#import packages</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#import gdal as gd</span>
<span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">rasterstats</span> <span class="kn">import</span> <span class="n">zonal_stats</span>
<span class="kn">import</span> <span class="nn">osmnx</span> <span class="k">as</span> <span class="nn">ox</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fnmatch</span> <span class="kn">import</span> <span class="n">fnmatch</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#read data</span>
<span class="n">gpn_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;forest_stand_database_GPN_20210114.txt&#39;</span><span class="p">)</span>


<span class="n">trees</span> <span class="o">=</span> <span class="n">gpn_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">gpn_data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">))]</span> <span class="c1">#select only columns starting with &#39;d&#39; (diameter at breast height)</span>
<span class="n">trees</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1992&#39;</span><span class="p">,</span> <span class="s1">&#39;1997&#39;</span><span class="p">,</span> <span class="s1">&#39;2002&#39;</span><span class="p">,</span> <span class="s1">&#39;2007&#39;</span><span class="p">,</span> <span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2017&#39;</span><span class="p">]</span> <span class="c1">#rename columns</span>

<span class="n">trees</span> <span class="o">=</span> <span class="n">trees</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#replace blank spaces to NaN</span>

<span class="n">dam_t</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;P/Z&#39;</span><span class="p">,</span> <span class="s1">&#39;Pk&#39;</span><span class="p">,</span> <span class="s1">&#39;Pk &#39;</span><span class="p">,</span> <span class="s1">&#39;PW&#39;</span><span class="p">,</span> <span class="s1">&#39;Pw&#39;</span><span class="p">,</span> <span class="s1">&#39;Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;Pzw&#39;</span><span class="p">,</span> <span class="s1">&#39;Ps&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;Up&#39;</span><span class="p">,</span> <span class="s1">&#39;Uzw&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;ZW&#39;</span><span class="p">]</span> <span class="c1">#list of strings (codes of damage)</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dam_t</span><span class="p">:</span>
    <span class="n">trees</span> <span class="o">=</span> <span class="n">trees</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="c1">#replace all code with 0 value</span>

<span class="n">trees</span> <span class="o">=</span> <span class="n">trees</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span> <span class="c1">#convert entire dataframe to numeric</span>
<span class="n">trees</span><span class="p">[</span><span class="n">trees</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#replace all values bigger than 0 to 1 (in entire dataframe)</span>

<span class="c1">#create column with categorical variable &#39;damage&#39; [1 = damaged tree, 0 = not-damaged tree]</span>
<span class="n">trees</span><span class="p">[</span><span class="s1">&#39;dam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trees</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#calculate minimal number of years, in which tree was growing (censuses in every 5 years)</span>
<span class="n">trees</span><span class="p">[</span><span class="s1">&#39;n_years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trees</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span>

<span class="n">gpn_data1</span> <span class="o">=</span> <span class="n">gpn_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;coerce&#39;</span><span class="p">)</span> <span class="c1">#change all df columns to numeric (remove strings)</span>
<span class="n">gpn_data1</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpn_data1</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">gpn_data1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#max G (area of breast height cross-section)</span>
<span class="n">gpn_data1</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpn_data1</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">gpn_data1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#max diameter</span>
<span class="n">gpn_data1</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpn_data1</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">gpn_data1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#max volume</span>
<span class="n">trees_data</span> <span class="o">=</span> <span class="n">gpn_data1</span><span class="p">[[</span><span class="s1">&#39;NrPow&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">]]</span>  <span class="c1">#select only columns with final values of G, D, V</span>

<span class="c1">#process species data</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">gpn_data</span><span class="p">[[</span><span class="s1">&#39;Gatunek&#39;</span><span class="p">]]</span> <span class="c1">#create new dF with species</span>
<span class="n">species</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span> <span class="c1">#rename column</span>
<span class="c1">#change spruce codes (Św = pol. świerk (spruce))</span>
<span class="n">species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Św(p)&#39;</span><span class="p">,</span> <span class="s1">&#39;Św&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Św(g)&#39;</span><span class="p">,</span> <span class="s1">&#39;Św&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Św(k)&#39;</span><span class="p">,</span> <span class="s1">&#39;Św&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Św(w)&#39;</span><span class="p">,</span> <span class="s1">&#39;Św&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Św&#39;</span><span class="p">,</span> <span class="s1">&#39;Sw&#39;</span><span class="p">)</span>
<span class="n">species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1">#remove whitespaces from data</span>
<span class="n">n_species</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="c1">#count the number of occurrence of particular species</span>
<span class="n">p100</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1">#count the number of all trees</span>

<span class="n">n_species</span><span class="p">[</span><span class="s1">&#39;perc_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_species</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">p100</span> <span class="c1">#calculate percentage share of species</span>
<span class="n">n_species3</span> <span class="o">=</span> <span class="n">n_species</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#select first three rows (with three dominant species)</span>
<span class="n">n_species3</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#reset index</span>
<span class="n">n_species3</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sp_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sp_number&#39;</span><span class="p">,</span> <span class="s1">&#39;perc_share&#39;</span><span class="p">]</span> <span class="c1">#rename columns</span>
<span class="n">n_species3</span><span class="p">[</span><span class="s1">&#39;sp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_species3</span><span class="p">[</span><span class="s1">&#39;sp_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Jd&#39;</span><span class="p">:</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span> <span class="s1">&#39;Sw&#39;</span><span class="p">:</span><span class="s1">&#39;spruce&#39;</span><span class="p">,</span> <span class="s1">&#39;Bk&#39;</span><span class="p">:</span><span class="s1">&#39;beech&#39;</span><span class="p">},</span> <span class="n">na_action</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1">#plot the share of dominant species (spruce, beech, fir)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">n_species3</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;sp_name&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;perc_share&#39;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1">#set axis labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;dominant species&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;percentage share [%]&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Miniconda\lib\site-packages\ipykernel_launcher.py:34: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
C:\Miniconda\lib\site-packages\ipykernel_launcher.py:35: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
C:\Miniconda\lib\site-packages\ipykernel_launcher.py:43: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;percentage share [%]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_9_2.png" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_9_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trees_data</span> <span class="o">=</span> <span class="n">trees</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trees_data</span><span class="p">)</span> <span class="c1">#join damages and n-years data</span>
<span class="n">trees_data</span> <span class="o">=</span> <span class="n">trees_data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>  <span class="c1">#join species data</span>
<span class="n">trees_data</span> <span class="o">=</span> <span class="n">trees_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1">#drop all rows with NaN</span>

<span class="c1">#change species codes from string to integer (for modelling purposes)</span>
<span class="n">trees_data</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trees_data</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Jd&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Sw&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Jw&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;Md&#39;</span><span class="p">:</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;Lesz&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Iwa&#39;</span><span class="p">:</span><span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;Jrz&#39;</span><span class="p">:</span><span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;Bk&#39;</span><span class="p">:</span><span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;Wis&#39;</span><span class="p">:</span><span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;Brzb&#39;</span><span class="p">:</span><span class="s1">&#39;10&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Olcz&#39;</span><span class="p">:</span><span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;Js&#39;</span><span class="p">:</span><span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;Os&#39;</span><span class="p">:</span><span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;Olsz&#39;</span><span class="p">:</span><span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;Gr&#39;</span><span class="p">:</span><span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Bst&#39;</span><span class="p">:</span><span class="s1">&#39;16&#39;</span><span class="p">},</span> <span class="n">na_action</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">trees_data</span> <span class="o">=</span> <span class="n">trees_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1">#replace nan with NaN</span>
<span class="n">trees_data</span> <span class="o">=</span> <span class="n">trees_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="c1">#change data types to float</span>
</pre></div>
</div>
</div>
<p><strong>Terrain analysis</strong></p>
<p>A Digital Terrain Model (DTM) and Digital Surface Model (DSM) were analyzed to check the impact of terrain properties on tree damage. DTM and DSM data were downloaded from the resources of the Polish Head Office of Geodesy and Cartography (geoportal website <a class="reference external" href="https://mapy.geoportal.gov.pl/imap/Imgp_2.html?gpmap=gp0&amp;locale=en">https://mapy.geoportal.gov.pl/imap/Imgp_2.html?gpmap=gp0&amp;locale=en</a>). These data were acquired in the LiDAR survey and have a spatial resolution of 1 m. The download was automated in R with the use of the rgugik package
(<a class="reference external" href="https://www.rdocumentation.org/packages/rgugik/versions/0.3.2">https://www.rdocumentation.org/packages/rgugik/versions/0.3.2</a>). Tiles were combined and clipped to the study area boundary with the use of GDAL. DTM derivatives were computed in R. Zonal statistics were performed in Python and calculated for the area of each monitoring plot (delineated as a 12 m buffer around the point location of each plot).</p>
<p>Download DTM and DSM data from Polish geoportal (GUGiK data) -&gt; run in R:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>#load packages
library(rgugik)
library(sf)

setwd(&#39;XXXXXXX&#39;)  #set working directory

#read shp with mask
area &lt;- read_sf(&#39;GPN_mask.shp&#39;)


#check available gugik data for study area
gugik_data &lt;- DEM_request(area)

#subset data by certain conditions (select DTM data, resolution 1 m)
gugik_DTM &lt;- gugik_data[(gugik_data$product == &quot;DTM&quot;)&amp;(gugik_data$resolution==&quot;1.0 m&quot;)
                        &amp;(gugik_data$VRS==&quot;PL-KRON86-NH&quot;)&amp;(gugik_data$format==&quot;ARC/INFO ASCII GRID&quot;), ]

sheetIDs &lt;- read.csv(&#39;GPN_mask_sheetIDs.csv&#39;) #read csv with sheet IDs
gugik_DTM &lt;- gugik_DTM[gugik_DTM$sheetID %in% sheetIDs$godlo, ] #subset gugik_DTM with the &#39;godlo&#39; column (select only sheets located within the study area)

dir.create(file.path(getwd(), &#39;DTM&#39;)) #create new folder for files
tile_download(gugik_DTM, file.path(getwd(), &#39;DTM&#39;), unzip = T) #download tiles


#subset data by certain conditions (select DSM data, resolution 1 m)
gugik_DSM &lt;- gugik_data[(gugik_data$product == &quot;DSM&quot;)&amp;(gugik_data$resolution==&quot;1.0 m&quot;)
                        &amp;(gugik_data$VRS==&quot;PL-KRON86-NH&quot;)&amp;(gugik_data$format==&quot;ARC/INFO ASCII GRID&quot;), ]

gugik_DSM &lt;- gugik_DSM[gugik_DSM$sheetID %in% sheetIDs$godlo, ] #subset gugik_DSM with the &#39;godlo&#39; column (select only sheets located within the study area)


dir.create(file.path(getwd(), &#39;DSM&#39;)) #create new folder for files
tile_download(gugik_DSM, file.path(getwd(), &#39;DSM&#39;), unzip = T) #download tiles
</pre></div>
</div>
</div>
<p>Mosaic DTM and DSM tiles, clip to the boundary of the study area, calculate VHM (bash &amp; GDAL):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
gdalbuildvrt TA/GPN_DTM.vrt DTM/*.asc  <span class="c1">#built mosaic in .vrt format</span>
gdal_translate -of GTiff -co <span class="s2">&quot;TILED=YES&quot;</span> -a_srs <span class="s2">&quot;epsg:2180&quot;</span> TA/GPN_DTM.vrt TA/GPN_DTM.tif <span class="c1">#convert from .vrt to .tif, set crs to epsg:2180</span>
gdalwarp -cutline GPN_mask.shp -crop_to_cutline TA/GPN_DTM.tif TA/GPN_mask_DTM.tif <span class="c1">#crop tif to the boundary of shp</span>

gdalbuildvrt TA/GPN_DSM.vrt DSM/*.asc  <span class="c1">#built mosaic in .vrt format</span>
gdal_translate -of GTiff -co <span class="s2">&quot;TILED=YES&quot;</span> -a_srs <span class="s2">&quot;epsg:2180&quot;</span> TA/GPN_DSM.vrt TA/GPN_DSM.tif <span class="c1">#convert from .vrt to .tif, set crs to epsg:2180</span>
gdalwarp -cutline GPN_mask.shp -crop_to_cutline TA/GPN_DSM.tif TA/GPN_mask_DSM.tif <span class="c1">#crop tif to the boundary of shp</span>

gdal_calc.py -A TA/GPN_mask_DSM.tif -B TA/GPN_mask_DTM.tif --outfile<span class="o">=</span>TA/GPN_mask_VHM.tif --calc<span class="o">=</span><span class="s2">&quot;A - B&quot;</span>  <span class="c1">#calculate vegetation height model (VHM)</span>
</pre></div>
</div>
</div>
<p>Visualize the topography of the study area</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;TA/DTM_mask.png&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_18_0.png" class="no-scaled-link" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_18_0.png" style="width: 400px; height: 400px;" />
</div>
</div>
<p>Compute DTM derivatives -&gt; run in R:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>library(Rsagacmd)
library(raster)
library(sp)

setwd(&#39;XXXXX&#39;)  #set working directory
DTM &lt;- &quot;TA/GPN_mask_DTM.tif&quot;  #read DTM data


aspect_DTM &lt;- terrain(raster(DTM), opt = &quot;aspect&quot;, unit = &quot;degrees&quot;) #compute aspect
slope_DTM &lt;- terrain(raster(DTM), opt = &quot;slope&quot;, unit = &quot;degrees&quot;) #compute slope
crs(aspect_DTM, slope_DTM) = &quot;EPSG:2180&quot; #set crs
writeRaster(aspect_DTM, file.path(pth, &quot;/&quot;, site_name, &quot;_Aspect.tif&quot;, fsep = &quot;&quot;))  #export to tif
writeRaster(slope_DTM, file.path(pth, &quot;/&quot;, site_name, &quot;_Slope.tif&quot;, fsep = &quot;&quot;)) #export to tif

saga = saga_gis() #read all SAGA GIS modules

BasicTA &lt;- saga$ta_compound$basic_terrain_analysis(DTM) #execute SAGA basic terrain analysis
writeRaster(BasicTA$wetness, file.path(pth, &quot;/&quot;, site_name, &quot;_TWI.tif&quot;, fsep = &quot;&quot;)) #export selected rasters to tif
writeRaster(BasicTA$hcurv, file.path(pth, &quot;/&quot;, site_name, &quot;_hcurv.tif&quot;, fsep = &quot;&quot;))
writeRaster(BasicTA$vcurv, file.path(pth, &quot;/&quot;, site_name, &quot;_vcurv.tif&quot;, fsep = &quot;&quot;))

#Wind Exposition
WindExp &lt;- saga$ta_morphometry$wind_exposition_index(DTM)
writeRaster(WindExp, file.path(pth, &quot;/&quot;, site_name, &quot;_WindExp.tif&quot;, fsep = &quot;&quot;))

#terrain rugedness index (TRI)
TRI &lt;- saga$ta_morphometry$terrain_ruggedness_index_tri(DTM)
writeRaster(TRI, file.path(pth, &quot;/&quot;, site_name, &quot;_TRI.tif&quot;, fsep = &quot;&quot;))

</pre></div>
</div>
</div>
<p>Zonal statistics - computation in Python</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gpn_plots</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;powierzchnie_monitoringowe_400.shp&#39;</span><span class="p">)</span> <span class="c1">#read shapefile</span>

<span class="n">gpn_plots_b12</span> <span class="o">=</span> <span class="n">gpn_plots</span> <span class="c1">#create buffers</span>
<span class="n">gpn_plots_b12</span> <span class="o">=</span> <span class="n">gpn_plots</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">2180</span><span class="p">)</span> <span class="c1">#set crs</span>
<span class="n">gpn_plots_b12</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpn_plots</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">distance</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">#generate buffer of 12 m around each point</span>
<span class="n">gpn_plots_b12</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">driver</span> <span class="o">=</span> <span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;gpn_plots_b12.shp&quot;</span><span class="p">)</span> <span class="c1">#save to shp</span>
<span class="n">gpn_plots_b12</span><span class="p">[</span><span class="s1">&#39;row_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gpn_plots_b12</span><span class="p">))</span> <span class="c1">#create column with row number</span>
<span class="n">gpn_plots_b12</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;row_num&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#set index</span>
<span class="n">gpn_plots_b12</span>

<span class="n">gpn_plots_ids</span> <span class="o">=</span> <span class="n">gpn_plots_b12</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="c1">#new dataframe with plot IDs</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#loop to compute zonal statistics</span>

<span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;TA/&#39;</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;GPN_mask_*.tif&quot;</span>
<span class="n">zs_output</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#empty list to append results</span>


<span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">raster</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fnmatch</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
            <span class="n">deriv</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">raster</span><span class="p">))</span>
            <span class="n">deriv_arr</span> <span class="o">=</span> <span class="n">deriv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">#convert raster to array</span>
            <span class="n">deriv_affine</span> <span class="o">=</span> <span class="n">deriv</span><span class="o">.</span><span class="n">transform</span>
            <span class="n">deriv_zs</span> <span class="o">=</span> <span class="n">zonal_stats</span><span class="p">(</span><span class="n">gpn_plots_b12</span><span class="p">,</span> <span class="n">deriv_arr</span><span class="p">,</span> <span class="n">affine</span> <span class="o">=</span> <span class="n">deriv_affine</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>
            <span class="n">deriv_zs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">deriv_zs</span><span class="p">)</span> <span class="c1">#convert to dataframe</span>
            <span class="n">deriv_zs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_min&#39;</span><span class="p">,</span> <span class="s1">&#39;_max&#39;</span><span class="p">,</span> <span class="s1">&#39;_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;_std&#39;</span><span class="p">]</span> <span class="c1">#rename columns</span>
            <span class="n">deriv_zs</span> <span class="o">=</span> <span class="n">deriv_zs</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;GPN_mask_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>  <span class="c1">#add prefix to each column name</span>
            <span class="n">zs_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deriv_zs</span><span class="p">)</span> <span class="c1">#append data to list</span>

<span class="n">zs_output</span>

<span class="n">zs_ta_gpn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">zs_output</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#concatenate data from list to single dF</span>
<span class="n">zs_ta_gpn</span><span class="p">[</span><span class="s1">&#39;row_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs_ta_gpn</span><span class="p">))</span> <span class="c1">#create column with row number</span>
<span class="n">zs_ta_gpn</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;row_num&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#set index</span>
<span class="n">zs_ta_gpn</span> <span class="o">=</span> <span class="n">gpn_plots_ids</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zs_ta_gpn</span><span class="p">)</span> <span class="c1">#join with plot ID data</span>
<span class="n">zs_ta_gpn</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#set plot ID data as index</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Miniconda\lib\site-packages\rasterstats\io.py:313: UserWarning: Setting nodata to -999; specify nodata explicitly
  warnings.warn(&#34;Setting nodata to -999; specify nodata explicitly&#34;)
C:\Miniconda\lib\site-packages\numpy\core\_methods.py:38: RuntimeWarning: overflow encountered in reduce
  return umr_sum(a, axis, dtype, out, keepdims, initial, where)
C:\Miniconda\lib\site-packages\rasterstats\main.py:235: UserWarning: Warning: converting a masked element to nan.
  feature_stats[&#39;std&#39;] = float(masked.std())
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Export data</span>

<span class="n">zs_ta_gpn</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;TA/zonal_statistics_TA_GPN.xlsx&#39;</span><span class="p">)</span> <span class="c1">#save to excel</span>

<span class="c1">#convert to shp, export</span>
<span class="n">zs_ta_gpn2</span> <span class="o">=</span> <span class="n">zs_ta_gpn</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gpn_plots</span><span class="p">)</span>
<span class="n">zs_ta_gpn2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">zs_ta_gpn2</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">zs_ta_gpn2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">zs_ta_gpn2</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                              <span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span> <span class="c1">#convert to geodataframe, set crs</span>
<span class="n">zs_ta_gpn2</span>  <span class="o">=</span> <span class="n">zs_ta_gpn2</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:2180&#39;</span><span class="p">})</span> <span class="c1">#convert coordinates to PWG92</span>
<span class="n">zs_ta_gpn2</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">driver</span> <span class="o">=</span> <span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;TA/zonal_statistics_TA_GPN.shp&quot;</span><span class="p">)</span> <span class="c1">#save to shp</span>
</pre></div>
</div>
</div>
</section>
<section id="Modelling-part">
<h3><span class="section-number">2.1.1.3. </span>Modelling part<a class="headerlink" href="#Modelling-part" title="Permalink to this headline"></a></h3>
<p><strong>Random Forest</strong></p>
<p>RandomForestClassifier from the sklearn package was applied to classify trees into ‘damaged’ and ‘undamaged’. The performance of the model was measured by applying two metrics: Accuracy and ROC AUC.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#import packages</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span><span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#prepair predictors</span>
<span class="n">ta_gpn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;TA/zonal_statistics_TA_GPN.xlsx&#39;</span><span class="p">)</span> <span class="c1">#read terrain analysis data</span>
<span class="n">sites_gpn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;sites_trees_var3.xlsx&#39;</span><span class="p">)</span> <span class="c1">#read sites data extracted from GPN database</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">sites_gpn</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ta_gpn</span><span class="p">)</span> <span class="c1">#join data</span>
<span class="n">variables</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;NrPow&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#set index</span>

<span class="c1">#reduce the number of variables</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;objectid&#39;</span><span class="p">,</span> <span class="s1">&#39;kod&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;TRI_min&#39;</span><span class="p">,</span> <span class="s1">&#39;TRI_max&#39;</span><span class="p">,</span> <span class="s1">&#39;TRI_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;TRI_std&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;DSM_min&#39;</span><span class="p">,</span> <span class="s1">&#39;DSM_max&#39;</span><span class="p">,</span> <span class="s1">&#39;DSM_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DSM_std&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;DTM_min&#39;</span><span class="p">,</span> <span class="s1">&#39;DTM_max&#39;</span><span class="p">,</span> <span class="s1">&#39;DTM_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;DTM_std&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;PlanCurv_min&#39;</span><span class="p">,</span> <span class="s1">&#39;PlanCurv_max&#39;</span><span class="p">,</span> <span class="s1">&#39;PlanCurv_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;PlanCurv_std&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ProfCurv_min&#39;</span><span class="p">,</span> <span class="s1">&#39;ProfCurv_max&#39;</span><span class="p">,</span> <span class="s1">&#39;ProfCurv_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;ProfCurv_std&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;WindExp_min&#39;</span><span class="p">,</span> <span class="s1">&#39;WindExp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;WindExp_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;WindExp_std&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">predictors</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">:]</span> <span class="c1">#select predictors</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#drop plots with not-unique number (5 plots)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">predictors</span><span class="p">[(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;NrPow&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11600</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;NrPow&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">21292</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1">#merge (with validation many_to_one)</span>
<span class="n">trees_data_predictors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">trees_data</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;NrPow&#39;</span><span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="s1">&#39;many_to_one&#39;</span><span class="p">)</span> <span class="c1">#merge</span>
<span class="n">trees_data_predictors</span> <span class="o">=</span> <span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="c1">#drop rows with NaN</span>
<span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;NrPow&#39;</span><span class="p">,</span> <span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;NrPow&#39;</span><span class="p">))</span> <span class="c1">#move the column &#39;NrPow&#39; to the first position</span>
<span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;trees_data_predictors_v2.xlsx&#39;</span><span class="p">)</span> <span class="c1">#save to excel</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1">#count number of rows of data frame</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number of trees taken into consideration in modelling is </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The number of trees taken into consideration in modelling is 17875.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Apply RANDOM FOREST CLASSIFIER</span>
<span class="c1">#https://www.datacamp.com/tutorial/random-forests-classifier-python</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>  <span class="c1">#predictors</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#response variable</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">trees_data_predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span> <span class="c1">#predictors names</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(17875, 36)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(17875,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feat</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;n_years&#39;, &#39;G&#39;, &#39;D&#39;, &#39;V&#39;, &#39;Species&#39;, &#39;n_tr&#39;, &#39;n_sp&#39;, &#39;dom_sp&#39;,
       &#39;perc_Jd&#39;, &#39;perc_Sw&#39;, &#39;perc_Bk&#39;, &#39;slope&#39;, &#39;exp&#39;, &#39;bedrock&#39;, &#39;soil&#39;,
       &#39;hab_type&#39;, &#39;phyto_cmp&#39;, &#39;x&#39;, &#39;y&#39;, &#39;h&#39;, &#39;Aspect_min&#39;, &#39;Aspect_max&#39;,
       &#39;Aspect_mean&#39;, &#39;Aspect_std&#39;, &#39;Slope_min&#39;, &#39;Slope_max&#39;,
       &#39;Slope_mean&#39;, &#39;Slope_std&#39;, &#39;TWI_min&#39;, &#39;TWI_max&#39;, &#39;TWI_mean&#39;,
       &#39;TWI_std&#39;, &#39;VHM_min&#39;, &#39;VHM_max&#39;, &#39;VHM_mean&#39;, &#39;VHM_std&#39;],
      dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Create 4 dataset for training and testing the algorithm</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>

<span class="c1">#Create a Gaussian Classifier</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1">#the number of trees</span>
                             <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">#minimum number of samples required to be at a leaf node</span>
                             <span class="n">max_features</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="c1">#the number of features to consider when looking for the best split;</span>
                                                    <span class="c1">#&#39;auto&#39; -&gt; max_features=sqrt(n_features)</span>

<span class="c1">#Train the model using the training sets y_pred=clf.predict(X_test)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span><span class="o">=</span><span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Model Accuracy and ROC AUC -&gt; how often is the classifier correct?</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy:&quot;</span><span class="p">,</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROC AUC:&quot;</span><span class="p">,</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy: 0.9025509062430074
ROC AUC: 0.8402930583063716
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#check feature importance</span>
<span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">clf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#plot the importance of predictors</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;limegreen&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">feat</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_35_0.png" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Damaged_trees_classification_RF_Janusz_Godziek_35_0.png" />
</div>
</div>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>Applied parameters of Random Forest allowed achieving high accuracy (above 0.9). However, different RF parameters may be tested to check model performance. The choice of predictors should also be reconsidered and different combinations of predictors can be tested.</p></li>
<li><p>The most important predictors are the minimal number of years, in which the tree was growing (n_years), species, and single tree parameters (V, D, G). This may prove, that older trees are much more prone to damage.</p></li>
<li><p>Terrain parameters seem to not exert significant influence on tree damages.</p></li>
<li><p>In the future other machine learning algorithms might be tested to model tree damage on this dataset.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Proj_2021_SW/Tatiana_Klisho_project.html" class="btn btn-neutral float-left" title="1.12. Relationship between continental-scale patterns of fire activity and modes of climate variability" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Stream_Network_Abstraction_Alonso_Gonzalez.html" class="btn btn-neutral float-right" title="2.2. Alonso Gonzalez: Stream Network Abstraction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>