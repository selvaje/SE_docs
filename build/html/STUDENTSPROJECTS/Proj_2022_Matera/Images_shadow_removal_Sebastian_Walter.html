<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.3. Sebastian Walter: Images shadow removal &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.4. Florian Ellsäßer: Using a LSTM network and SHAP to determine the impact of drought and season on winter wheat" href="Using_a_LSTM_network_and_SHAP_to_determine_the_impact_of_drought_Florian_Ells%C3%A4%C3%9Fer.html" />
    <link rel="prev" title="2.2. Alonso Gonzalez: Stream Network Abstraction" href="Stream_Network_Abstraction_Alonso_Gonzalez.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Spatial Ecology's code documentation
            <img src="../../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Colab_for_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_for_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_curso_para_Ecologia_Espacial.html">Prepare OSGeoLive para el curso de ecología espacial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_introduction.html">Introdction to pyjeo: installation and raster visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_pktools.html">Performing raster and vector operations in Python using pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_02SVM_pred.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred.html">Estimation of tree height using GEDI dataset - Perceptron 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred_clean.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html">The real data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-Using-the-Window-Method">LSTM for Regression Using the Window Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-with-Time-Steps">LSTM for Regression with Time Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-with-Memory-Between-Batches">LSTM with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Stacked-LSTMs-with-Memory-Between-Batches">Stacked LSTMs with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Adding-Early-Stopping">Adding Early Stopping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Multivariate-Time-series---Data">Multivariate Time-series - Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#matera">2. 2022 MATERA</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Damaged_trees_classification_RF_Janusz_Godziek.html">2.1. Janusz Godziek: Damaged vs undamaged trees - Random Forest classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Stream_Network_Abstraction_Alonso_Gonzalez.html">2.2. Alonso Gonzalez: Stream Network Abstraction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.3. Sebastian Walter: Images shadow removal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#IDEA">2.3.1. IDEA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#DATA">2.3.2. DATA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Using_a_LSTM_network_and_SHAP_to_determine_the_impact_of_drought_Florian_Ells%C3%A4%C3%9Fer.html">2.4. Florian Ellsäßer: Using a LSTM network and SHAP to determine the impact of drought and season on winter wheat</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">1. </span>2021 SWEDEN</a> &raquo;</li>
      <li><span class="section-number">2.3. </span>Sebastian Walter: Images shadow removal</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/STUDENTSPROJECTS/Proj_2022_Matera/Images_shadow_removal_Sebastian_Walter.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Sebastian-Walter:-Images-shadow-removal">
<h1><span class="section-number">2.3. </span>Sebastian Walter: Images shadow removal<a class="headerlink" href="#Sebastian-Walter:-Images-shadow-removal" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://youtu.be/3WWoGVIE5EI">Video recording</a></p>
<section id="IDEA">
<h2><span class="section-number">2.3.1. </span>IDEA<a class="headerlink" href="#IDEA" title="Permalink to this headline"></a></h2>
<p>The HRSC (High-Resolution Stereo Camera) around Mars has a very elliptic orbit, therefore the images often have different illumination conditions. This makes it hard to mosaic them together. The idea here is to train a network for shadow removal.</p>
<p><img alt="HRSC image" src="../../_images/hrsc-vm-example.png" />HRSC mosaic composed from differently illuminated single images</p>
</section>
<section id="DATA">
<h2><span class="section-number">2.3.2. </span>DATA<a class="headerlink" href="#DATA" title="Permalink to this headline"></a></h2>
<p>We use two HRSC images for training and testing. One image has a low Sun incidence, the other image has a high Sun incidence angle. Both the images overlap, so we can create a paired dataset.</p>
<p>The images are “top-of-atmosphere” reflectance stored as float32.</p>
<p>Author: Sebastian Walter, Freie Universtaet Berlin.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>find input
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
input
input/h2233_0009.nd4.14_toa
input/h4127_0000.nd4.07_toa
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#First load images, we use a class for this. The code was initially written to include additional data.</span>

<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">imageStack</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1">#self.band_type = None</span>
        <span class="c1">#self.bands = None</span>
        <span class="c1">#self.ct = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uly</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span>
        <span class="n">ds</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;toa&#39;</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsize</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterXSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ysize</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterYSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#print(self.ulx)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ulx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uly</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysize</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ysize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsize</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">imtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;toa&#39;</span><span class="p">,):</span>
            <span class="c1">#print(imtype)</span>
            <span class="c1">#print(os.path.exists(filename+&#39;_&#39;+imtype))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">imtype</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
            <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="c1">#Normalize 0-1</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">img1</span> <span class="o">=</span> <span class="n">imageStack</span><span class="p">(</span><span class="s1">&#39;modpreplev4/4127_0000/h4127_0000.nd4.07&#39;</span><span class="p">)</span>
<span class="n">img1</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">imageStack</span><span class="p">(</span><span class="s1">&#39;modpreplev4/2233_0009/h2233_0009.nd4.14&#39;</span><span class="p">)</span>
<span class="n">img2</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">projection</span> <span class="o">!=</span> <span class="n">img2</span><span class="o">.</span><span class="n">projection</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Projections do not match!&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pixel sizes do not match!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Now we find the overlapping area to build pairs.</span>

<span class="c1"># figure out intersection region</span>
<span class="n">ulx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">ulx</span><span class="p">,</span> <span class="n">img2</span><span class="o">.</span><span class="n">ulx</span><span class="p">)</span>
<span class="n">uly</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">uly</span><span class="p">,</span> <span class="n">img2</span><span class="o">.</span><span class="n">uly</span><span class="p">)</span>
<span class="n">lrx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">lrx</span><span class="p">,</span> <span class="n">img2</span><span class="o">.</span><span class="n">lrx</span><span class="p">)</span>
<span class="n">lry</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">lry</span><span class="p">,</span> <span class="n">img2</span><span class="o">.</span><span class="n">lry</span><span class="p">)</span>

<span class="c1"># Compute img1 window in pixel coordinates.</span>
<span class="n">img1_xoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ulx</span> <span class="o">-</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">img1_yoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">img1_xsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lrx</span> <span class="o">-</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="n">img1_xoff</span>
<span class="n">img1_ysize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lry</span> <span class="o">-</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">img1</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="n">img1_yoff</span>

<span class="c1"># compute img2 window in pixel coordinates.</span>
<span class="n">img2_xoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ulx</span> <span class="o">-</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">img2_yoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">uly</span> <span class="o">-</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">img2_xsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lrx</span> <span class="o">-</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="n">img2_xoff</span>
<span class="n">img2_ysize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lry</span> <span class="o">-</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">img2</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="n">img2_yoff</span>

<span class="nb">print</span><span class="p">(</span><span class="n">img1_xoff</span><span class="p">,</span><span class="n">img1_yoff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img2_xoff</span><span class="p">,</span><span class="n">img2_yoff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img1_xsize</span><span class="p">,</span><span class="n">img1_ysize</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img2_xsize</span><span class="p">,</span><span class="n">img2_ysize</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
680 45440
0 0
4716 10246
4716 10246
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#We build subsets with the dimension of the overlap</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">img1cut</span><span class="o">=</span><span class="n">img1</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">img1_yoff</span><span class="p">:</span><span class="n">img1_yoff</span><span class="o">+</span><span class="n">img1_ysize</span><span class="p">,</span><span class="n">img1_xoff</span><span class="p">:</span><span class="n">img1_xoff</span><span class="o">+</span><span class="n">img1_xsize</span><span class="p">]</span>
<span class="n">img2cut</span><span class="o">=</span><span class="n">img2</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">img2_yoff</span><span class="p">:</span><span class="n">img2_yoff</span><span class="o">+</span><span class="n">img2_ysize</span><span class="p">,</span><span class="n">img2_xoff</span><span class="p">:</span><span class="n">img2_xoff</span><span class="o">+</span><span class="n">img2_xsize</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img2cut</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img1cut</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img2cut</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2, 69521, 6685)
(2, 10246, 4716)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7fdad938d970&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_5_2.png" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_5_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now we create pathes with a defined patch size for our tensors.</span>
<span class="n">psize</span><span class="o">=</span><span class="mi">256</span>
<span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">projection</span> <span class="o">!=</span> <span class="n">img2</span><span class="o">.</span><span class="n">projection</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">npx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img1cut</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">psize</span><span class="p">)</span>
<span class="n">npy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img1cut</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">psize</span><span class="p">)</span>
<span class="n">patches1</span><span class="o">=</span><span class="p">[]</span>
<span class="n">patches2</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">npx</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">npy</span><span class="p">):</span>
        <span class="n">patch1</span> <span class="o">=</span> <span class="n">img1cut</span><span class="p">[:,</span><span class="n">y</span><span class="o">*</span><span class="n">psize</span><span class="p">:</span><span class="n">y</span><span class="o">*</span><span class="n">psize</span><span class="o">+</span><span class="p">(</span><span class="n">psize</span><span class="p">),</span><span class="n">x</span><span class="o">*</span><span class="n">psize</span><span class="p">:</span><span class="n">x</span><span class="o">*</span><span class="n">psize</span><span class="o">+</span><span class="p">(</span><span class="n">psize</span><span class="p">)]</span>
        <span class="c1">#patch1 = patch1/patch1.max()*255 # FALSCH</span>
        <span class="n">patch2</span> <span class="o">=</span> <span class="n">img2cut</span><span class="p">[:,</span><span class="n">y</span><span class="o">*</span><span class="n">psize</span><span class="p">:</span><span class="n">y</span><span class="o">*</span><span class="n">psize</span><span class="o">+</span><span class="p">(</span><span class="n">psize</span><span class="p">),</span><span class="n">x</span><span class="o">*</span><span class="n">psize</span><span class="p">:</span><span class="n">x</span><span class="o">*</span><span class="n">psize</span><span class="o">+</span><span class="p">(</span><span class="n">psize</span><span class="p">)]</span>
        <span class="c1">#patch2 = patch2/patch2.max()*255</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">patch1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">patch2</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">patches1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch1</span><span class="p">)</span>
        <span class="n">patches2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch2</span><span class="p">)</span>
<span class="n">patches1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">patches1</span><span class="p">)</span>
<span class="n">patches2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">patches2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Plot the first 10 patches</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">*</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">patches1</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">patches2</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_7_0.png" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_7_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Cuda made trouble without this on my machine</span>
<span class="o">!</span><span class="nb">export</span> <span class="nv">PYTORCH_CUDA_ALLOC_CONF</span><span class="o">=</span>max_split_size_mb:512
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># From http://spatial-ecology.net/docs/build/html/CASESTUDY/CNN_satelite.html</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.utils.data.sampler</span> <span class="kn">import</span> <span class="n">SubsetRandomSampler</span>
<span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">zoom</span>

<span class="k">class</span> <span class="nc">MyDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data.dtype: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target.dtype: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,:,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,:,:]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">x1</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">x2</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">)</span>

<span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span>
<span class="n">test_split</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">patches1</span><span class="p">,</span> <span class="n">patches2</span><span class="p">)</span>
<span class="c1">#del x_train, t_train</span>
<span class="n">dataset_size</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dataset_size: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataset_size</span><span class="p">))</span>
<span class="c1"># -- split dataset</span>
<span class="n">indices</span>       <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dataset_size</span><span class="p">))</span>
<span class="n">split</span>         <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">test_split</span><span class="o">*</span><span class="n">dataset_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;split: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">split</span><span class="p">))</span>
<span class="n">train_indices</span><span class="p">,</span> <span class="n">val_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">split</span><span class="p">:],</span> <span class="n">indices</span><span class="p">[:</span><span class="n">split</span><span class="p">]</span>

<span class="c1"># -- create dataloaders</span>
<span class="n">train_sampler</span> <span class="o">=</span> <span class="n">SubsetRandomSampler</span><span class="p">(</span><span class="n">train_indices</span><span class="p">)</span>
<span class="n">valid_sampler</span> <span class="o">=</span> <span class="n">SubsetRandomSampler</span><span class="p">(</span><span class="n">val_indices</span><span class="p">)</span>

<span class="n">dataloaders</span>   <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">train_sampler</span><span class="p">),</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">valid_sampler</span><span class="p">),</span>
    <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>  <span class="n">batch_size</span><span class="o">=</span><span class="n">patches1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data.dtype: float32
target.dtype: float32
dataset_size: 642
split: 128
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Some variables for the network</span>
<span class="n">cuda</span><span class="o">=</span><span class="kc">True</span>
<span class="n">epoch</span><span class="o">=</span><span class="mi">0</span>
<span class="n">n_epochs</span><span class="o">=</span><span class="mi">200</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">0.0002</span>
<span class="n">decay_epoch</span><span class="o">=</span><span class="mi">100</span>
<span class="n">size</span><span class="o">=</span><span class="mi">256</span>
<span class="n">input_nc</span><span class="o">=</span><span class="mi">1</span>
<span class="n">output_nc</span><span class="o">=</span><span class="mi">1</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now the definition of the network</span>
<span class="c1"># Code after this: https://github.com/aitorzip/PyTorch-CycleGAN</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Generator</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Discriminator</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">ReplayBuffer</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">LambdaLR</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">weights_init_normal</span>
<span class="c1">#from datasets import ImageDataset</span>

<span class="c1">###### Definition of variables ######</span>
<span class="c1"># Networks</span>
<span class="n">netG_A2B</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">input_nc</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">)</span>
<span class="n">netG_B2A</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">output_nc</span><span class="p">,</span> <span class="n">input_nc</span><span class="p">)</span>
<span class="n">netD_A</span> <span class="o">=</span> <span class="n">Discriminator</span><span class="p">(</span><span class="n">input_nc</span><span class="p">)</span>
<span class="n">netD_B</span> <span class="o">=</span> <span class="n">Discriminator</span><span class="p">(</span><span class="n">output_nc</span><span class="p">)</span>

<span class="k">if</span> <span class="n">cuda</span><span class="p">:</span>
    <span class="n">netG_A2B</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">netG_B2A</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">netD_A</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">netD_B</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="n">netG_A2B</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">weights_init_normal</span><span class="p">)</span>
<span class="n">netG_B2A</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">weights_init_normal</span><span class="p">)</span>
<span class="n">netD_A</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">weights_init_normal</span><span class="p">)</span>
<span class="n">netD_B</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">weights_init_normal</span><span class="p">)</span>

<span class="c1"># Lossess</span>
<span class="n">criterion_GAN</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
<span class="n">criterion_cycle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>
<span class="n">criterion_identity</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>

<span class="c1"># Optimizers &amp; LR schedulers</span>
<span class="n">optimizer_G</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">netG_A2B</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">netG_B2A</span><span class="o">.</span><span class="n">parameters</span><span class="p">()),</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">))</span>
<span class="n">optimizer_D_A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">netD_A</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">))</span>
<span class="n">optimizer_D_B</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">netD_B</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="n">lr_scheduler_G</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">optimizer_G</span><span class="p">,</span> <span class="n">lr_lambda</span><span class="o">=</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">decay_epoch</span><span class="p">)</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
<span class="n">lr_scheduler_D_A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">optimizer_D_A</span><span class="p">,</span> <span class="n">lr_lambda</span><span class="o">=</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">decay_epoch</span><span class="p">)</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
<span class="n">lr_scheduler_D_B</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">optimizer_D_B</span><span class="p">,</span> <span class="n">lr_lambda</span><span class="o">=</span><span class="n">LambdaLR</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">decay_epoch</span><span class="p">)</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>

<span class="c1"># Inputs &amp; targets memory allocation</span>
<span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">FloatTensor</span> <span class="k">if</span> <span class="n">cuda</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<span class="n">input_A</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">input_nc</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">input_B</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">target_real</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">target_fake</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fake_A_buffer</span> <span class="o">=</span> <span class="n">ReplayBuffer</span><span class="p">()</span>
<span class="n">fake_B_buffer</span> <span class="o">=</span> <span class="n">ReplayBuffer</span><span class="p">()</span>

<span class="c1"># Loss plot using Visdom</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloaders</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Setting up a new session...
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">###### Training ######</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloaders</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]):</span>
        <span class="c1">#print(input_A.copy_(batch[&#39;A&#39;]),input_B.copy_(batch[&#39;B&#39;]))</span>
        <span class="c1"># Set model input</span>
        <span class="n">real_A</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_A</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]))</span>
        <span class="n">real_B</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_B</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]))</span>
        <span class="c1">###### Generators A2B and B2A ######</span>
        <span class="n">optimizer_G</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="c1"># Identity loss</span>
        <span class="c1"># G_A2B(B) should equal B if real B is fed</span>
        <span class="n">same_B</span> <span class="o">=</span> <span class="n">netG_A2B</span><span class="p">(</span><span class="n">real_B</span><span class="p">)</span>
        <span class="n">loss_identity_B</span> <span class="o">=</span> <span class="n">criterion_identity</span><span class="p">(</span><span class="n">same_B</span><span class="p">,</span> <span class="n">real_B</span><span class="p">)</span><span class="o">*</span><span class="mf">5.0</span>
        <span class="c1"># G_B2A(A) should equal A if real A is fed</span>
        <span class="n">same_A</span> <span class="o">=</span> <span class="n">netG_B2A</span><span class="p">(</span><span class="n">real_A</span><span class="p">)</span>
        <span class="n">loss_identity_A</span> <span class="o">=</span> <span class="n">criterion_identity</span><span class="p">(</span><span class="n">same_A</span><span class="p">,</span> <span class="n">real_A</span><span class="p">)</span><span class="o">*</span><span class="mf">5.0</span>
        <span class="c1"># GAN loss</span>
        <span class="n">fake_B</span> <span class="o">=</span> <span class="n">netG_A2B</span><span class="p">(</span><span class="n">real_A</span><span class="p">)</span>
        <span class="n">pred_fake</span> <span class="o">=</span> <span class="n">netD_B</span><span class="p">(</span><span class="n">fake_B</span><span class="p">)</span>
        <span class="n">loss_GAN_A2B</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_fake</span><span class="p">,</span> <span class="n">target_real</span><span class="p">)</span>

        <span class="n">fake_A</span> <span class="o">=</span> <span class="n">netG_B2A</span><span class="p">(</span><span class="n">real_B</span><span class="p">)</span>
        <span class="n">pred_fake</span> <span class="o">=</span> <span class="n">netD_A</span><span class="p">(</span><span class="n">fake_A</span><span class="p">)</span>
        <span class="n">loss_GAN_B2A</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_fake</span><span class="p">,</span> <span class="n">target_real</span><span class="p">)</span>
        <span class="c1"># Cycle loss</span>
        <span class="n">recovered_A</span> <span class="o">=</span> <span class="n">netG_B2A</span><span class="p">(</span><span class="n">fake_B</span><span class="p">)</span>
        <span class="n">loss_cycle_ABA</span> <span class="o">=</span> <span class="n">criterion_cycle</span><span class="p">(</span><span class="n">recovered_A</span><span class="p">,</span> <span class="n">real_A</span><span class="p">)</span><span class="o">*</span><span class="mf">10.0</span>
        <span class="n">recovered_B</span> <span class="o">=</span> <span class="n">netG_A2B</span><span class="p">(</span><span class="n">fake_A</span><span class="p">)</span>
        <span class="n">loss_cycle_BAB</span> <span class="o">=</span> <span class="n">criterion_cycle</span><span class="p">(</span><span class="n">recovered_B</span><span class="p">,</span> <span class="n">real_B</span><span class="p">)</span><span class="o">*</span><span class="mf">10.0</span>
        <span class="c1"># Total loss</span>
        <span class="n">loss_G</span> <span class="o">=</span> <span class="n">loss_identity_A</span> <span class="o">+</span> <span class="n">loss_identity_B</span> <span class="o">+</span> <span class="n">loss_GAN_A2B</span> <span class="o">+</span> <span class="n">loss_GAN_B2A</span> <span class="o">+</span> <span class="n">loss_cycle_ABA</span> <span class="o">+</span> <span class="n">loss_cycle_BAB</span>
        <span class="n">loss_G</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="n">optimizer_G</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="c1">###################################</span>

        <span class="c1">###### Discriminator A ######</span>
        <span class="n">optimizer_D_A</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># Real loss</span>
        <span class="n">pred_real</span> <span class="o">=</span> <span class="n">netD_A</span><span class="p">(</span><span class="n">real_A</span><span class="p">)</span>
        <span class="n">loss_D_real</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_real</span><span class="p">,</span> <span class="n">target_real</span><span class="p">)</span>

        <span class="c1"># Fake loss</span>
        <span class="n">fake_A</span> <span class="o">=</span> <span class="n">fake_A_buffer</span><span class="o">.</span><span class="n">push_and_pop</span><span class="p">(</span><span class="n">fake_A</span><span class="p">)</span>
        <span class="n">pred_fake</span> <span class="o">=</span> <span class="n">netD_A</span><span class="p">(</span><span class="n">fake_A</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span>
        <span class="n">loss_D_fake</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_fake</span><span class="p">,</span> <span class="n">target_fake</span><span class="p">)</span>

        <span class="c1"># Total loss</span>
        <span class="n">loss_D_A</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_D_real</span> <span class="o">+</span> <span class="n">loss_D_fake</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">loss_D_A</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="n">optimizer_D_A</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="c1">###################################</span>

        <span class="c1">###### Discriminator B ######</span>
        <span class="n">optimizer_D_B</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># Real loss</span>
        <span class="n">pred_real</span> <span class="o">=</span> <span class="n">netD_B</span><span class="p">(</span><span class="n">real_B</span><span class="p">)</span>
        <span class="n">loss_D_real</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_real</span><span class="p">,</span> <span class="n">target_real</span><span class="p">)</span>

        <span class="c1"># Fake loss</span>
        <span class="n">fake_B</span> <span class="o">=</span> <span class="n">fake_B_buffer</span><span class="o">.</span><span class="n">push_and_pop</span><span class="p">(</span><span class="n">fake_B</span><span class="p">)</span>
        <span class="n">pred_fake</span> <span class="o">=</span> <span class="n">netD_B</span><span class="p">(</span><span class="n">fake_B</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span>
        <span class="n">loss_D_fake</span> <span class="o">=</span> <span class="n">criterion_GAN</span><span class="p">(</span><span class="n">pred_fake</span><span class="p">,</span> <span class="n">target_fake</span><span class="p">)</span>

        <span class="c1"># Total loss</span>
        <span class="n">loss_D_B</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_D_real</span> <span class="o">+</span> <span class="n">loss_D_fake</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">loss_D_B</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="n">optimizer_D_B</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="c1">###################################</span>
        <span class="c1">#print(epoch, loss_G.data)</span>
        <span class="c1">#print(real_A.shape)</span>
        <span class="c1"># Progress report (http://localhost:8097)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s1">&#39;loss_G&#39;</span><span class="p">:</span> <span class="n">loss_G</span><span class="p">,</span> <span class="s1">&#39;loss_G_identity&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">loss_identity_A</span> <span class="o">+</span> <span class="n">loss_identity_B</span><span class="p">),</span> <span class="s1">&#39;loss_G_GAN&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">loss_GAN_A2B</span> <span class="o">+</span> <span class="n">loss_GAN_B2A</span><span class="p">),</span>
                    <span class="s1">&#39;loss_G_cycle&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">loss_cycle_ABA</span> <span class="o">+</span> <span class="n">loss_cycle_BAB</span><span class="p">),</span> <span class="s1">&#39;loss_D&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">loss_D_A</span> <span class="o">+</span> <span class="n">loss_D_B</span><span class="p">)},</span>
                    <span class="n">images</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;real_A&#39;</span><span class="p">:</span> <span class="n">real_A</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:],</span> <span class="s1">&#39;real_B&#39;</span><span class="p">:</span> <span class="n">real_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:],</span> <span class="s1">&#39;fake_A&#39;</span><span class="p">:</span> <span class="n">fake_A</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:],</span> <span class="s1">&#39;fake_B&#39;</span><span class="p">:</span> <span class="n">fake_B</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:]})</span>

    <span class="c1"># Update learning rates</span>
    <span class="n">lr_scheduler_G</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">lr_scheduler_D_A</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">lr_scheduler_D_B</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="c1"># Save models checkpoints</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">netG_A2B</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;output/netG_A2B.pth&#39;</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">netG_B2A</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;output/netG_B2A.pth&#39;</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">netD_A</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;output/netD_A.pth&#39;</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">netD_B</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;output/netD_B.pth&#39;</span><span class="p">)</span>
<span class="c1">###################################</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/anaconda3/envs/geocomp-ml/lib/python3.8/site-packages/torch/nn/modules/loss.py:529: UserWarning: Using a target size (torch.Size([2])) that is different to the input size (torch.Size([2, 1])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  return F.mse_loss(input, target, reduction=self.reduction)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 001/200 [0257/0257] -- loss_G: 4.6604 | loss_G_identity: 0.9884 | loss_G_GAN: 1.8147 | loss_G_cycle: 1.8573 | loss_D: 0.0626 -- ETA: 14:54:47.8269198.597541
Epoch 002/200 [0257/0257] -- loss_G: 4.2055 | loss_G_identity: 0.7847 | loss_G_GAN: 1.9388 | loss_G_cycle: 1.4820 | loss_D: 0.0391 -- ETA: 14:56:28.908569
Epoch 003/200 [0257/0257] -- loss_G: 4.1517 | loss_G_identity: 0.7370 | loss_G_GAN: 1.9784 | loss_G_cycle: 1.4363 | loss_D: 0.0029 -- ETA: 14:52:56.067105
Epoch 004/200 [0257/0257] -- loss_G: 3.9929 | loss_G_identity: 0.6992 | loss_G_GAN: 1.9834 | loss_G_cycle: 1.3104 | loss_D: 0.0474 -- ETA: 14:48:46.573277
Epoch 005/200 [0257/0257] -- loss_G: 3.8834 | loss_G_identity: 0.6459 | loss_G_GAN: 1.9755 | loss_G_cycle: 1.2621 | loss_D: 0.0075 -- ETA: 14:44:29.436673
Epoch 006/200 [0257/0257] -- loss_G: 3.7566 | loss_G_identity: 0.5961 | loss_G_GAN: 1.9847 | loss_G_cycle: 1.1758 | loss_D: 0.0015 -- ETA: 14:40:08.874774
Epoch 007/200 [0257/0257] -- loss_G: 3.7276 | loss_G_identity: 0.6080 | loss_G_GAN: 1.9921 | loss_G_cycle: 1.1275 | loss_D: 0.0013 -- ETA: 14:35:40.746441
Epoch 008/200 [0257/0257] -- loss_G: 3.7243 | loss_G_identity: 0.5935 | loss_G_GAN: 1.9950 | loss_G_cycle: 1.1358 | loss_D: 0.0011 -- ETA: 14:31:13.924994
Epoch 009/200 [0257/0257] -- loss_G: 3.8616 | loss_G_identity: 0.6530 | loss_G_GAN: 1.9595 | loss_G_cycle: 1.2492 | loss_D: 0.0656 -- ETA: 14:26:35.430336
Epoch 010/200 [0257/0257] -- loss_G: 3.7906 | loss_G_identity: 0.6339 | loss_G_GAN: 1.9247 | loss_G_cycle: 1.2320 | loss_D: 0.0285 -- ETA: 14:21:47.764059
Epoch 011/200 [0257/0257] -- loss_G: 3.6130 | loss_G_identity: 0.6147 | loss_G_GAN: 1.8166 | loss_G_cycle: 1.1817 | loss_D: 0.0385 -- ETA: 14:17:18.062873
Epoch 012/200 [0257/0257] -- loss_G: 3.6523 | loss_G_identity: 0.5804 | loss_G_GAN: 1.9279 | loss_G_cycle: 1.1440 | loss_D: 0.0148 -- ETA: 14:12:52.417168
Epoch 013/200 [0257/0257] -- loss_G: 3.2617 | loss_G_identity: 0.5698 | loss_G_GAN: 1.5812 | loss_G_cycle: 1.1106 | loss_D: 0.1310 -- ETA: 14:08:25.295368
Epoch 014/200 [0257/0257] -- loss_G: 2.9444 | loss_G_identity: 0.5496 | loss_G_GAN: 1.2968 | loss_G_cycle: 1.0980 | loss_D: 0.1822 -- ETA: 14:03:59.346214
Epoch 015/200 [0257/0257] -- loss_G: 2.8999 | loss_G_identity: 0.5330 | loss_G_GAN: 1.3236 | loss_G_cycle: 1.0432 | loss_D: 0.1452 -- ETA: 13:59:33.709212
Epoch 016/200 [0257/0257] -- loss_G: 2.8257 | loss_G_identity: 0.5158 | loss_G_GAN: 1.2801 | loss_G_cycle: 1.0298 | loss_D: 0.1751 -- ETA: 13:55:07.303148
Epoch 017/200 [0257/0257] -- loss_G: 2.8345 | loss_G_identity: 0.5453 | loss_G_GAN: 1.2253 | loss_G_cycle: 1.0639 | loss_D: 0.2134 -- ETA: 13:50:42.912558
Epoch 018/200 [0257/0257] -- loss_G: 2.8850 | loss_G_identity: 0.5476 | loss_G_GAN: 1.2309 | loss_G_cycle: 1.1066 | loss_D: 0.1804 -- ETA: 13:46:19.524347
Epoch 019/200 [0257/0257] -- loss_G: 2.8826 | loss_G_identity: 0.5336 | loss_G_GAN: 1.3014 | loss_G_cycle: 1.0476 | loss_D: 0.1709 -- ETA: 13:41:52.656661
Epoch 020/200 [0257/0257] -- loss_G: 2.8002 | loss_G_identity: 0.5086 | loss_G_GAN: 1.2853 | loss_G_cycle: 1.0063 | loss_D: 0.1674 -- ETA: 13:37:24.231933
Epoch 021/200 [0257/0257] -- loss_G: 2.8498 | loss_G_identity: 0.5305 | loss_G_GAN: 1.2544 | loss_G_cycle: 1.0650 | loss_D: 0.1715 -- ETA: 13:32:56.781430
Epoch 022/200 [0257/0257] -- loss_G: 2.9861 | loss_G_identity: 0.5680 | loss_G_GAN: 1.2830 | loss_G_cycle: 1.1350 | loss_D: 0.1531 -- ETA: 13:28:28.782805
Epoch 023/200 [0257/0257] -- loss_G: 2.8635 | loss_G_identity: 0.5222 | loss_G_GAN: 1.3065 | loss_G_cycle: 1.0348 | loss_D: 0.1776 -- ETA: 13:23:59.576889
Epoch 024/200 [0257/0257] -- loss_G: 2.9217 | loss_G_identity: 0.5754 | loss_G_GAN: 1.2127 | loss_G_cycle: 1.1336 | loss_D: 0.1967 -- ETA: 13:19:31.374352
Epoch 025/200 [0257/0257] -- loss_G: 2.3584 | loss_G_identity: 0.5407 | loss_G_GAN: 0.7046 | loss_G_cycle: 1.1131 | loss_D: 0.2956 -- ETA: 13:15:04.043823
Epoch 026/200 [0257/0257] -- loss_G: 2.5320 | loss_G_identity: 0.5631 | loss_G_GAN: 0.8254 | loss_G_cycle: 1.1436 | loss_D: 0.2685 -- ETA: 13:10:35.954126
Epoch 027/200 [0257/0257] -- loss_G: 2.2572 | loss_G_identity: 0.5327 | loss_G_GAN: 0.6289 | loss_G_cycle: 1.0957 | loss_D: 0.3195 -- ETA: 13:06:07.048385
Epoch 028/200 [0257/0257] -- loss_G: 2.2473 | loss_G_identity: 0.5314 | loss_G_GAN: 0.6374 | loss_G_cycle: 1.0785 | loss_D: 0.3144 -- ETA: 13:01:39.190301
Epoch 029/200 [0257/0257] -- loss_G: 2.1509 | loss_G_identity: 0.5031 | loss_G_GAN: 0.6114 | loss_G_cycle: 1.0364 | loss_D: 0.3149 -- ETA: 12:57:11.929573
Epoch 030/200 [0257/0257] -- loss_G: 2.2338 | loss_G_identity: 0.5102 | loss_G_GAN: 0.6646 | loss_G_cycle: 1.0590 | loss_D: 0.2864 -- ETA: 12:52:44.434714
Epoch 031/200 [0257/0257] -- loss_G: 2.2897 | loss_G_identity: 0.5122 | loss_G_GAN: 0.7184 | loss_G_cycle: 1.0591 | loss_D: 0.2759 -- ETA: 12:48:16.708926
Epoch 032/200 [0257/0257] -- loss_G: 2.3301 | loss_G_identity: 0.5279 | loss_G_GAN: 0.7053 | loss_G_cycle: 1.0969 | loss_D: 0.2740 -- ETA: 12:43:49.245634
Epoch 033/200 [0257/0257] -- loss_G: 2.2829 | loss_G_identity: 0.5378 | loss_G_GAN: 0.6390 | loss_G_cycle: 1.1061 | loss_D: 0.2940 -- ETA: 12:39:21.248579
Epoch 034/200 [0257/0257] -- loss_G: 2.2596 | loss_G_identity: 0.5292 | loss_G_GAN: 0.6567 | loss_G_cycle: 1.0736 | loss_D: 0.2833 -- ETA: 12:34:52.644262
Epoch 035/200 [0257/0257] -- loss_G: 2.2436 | loss_G_identity: 0.5216 | loss_G_GAN: 0.6550 | loss_G_cycle: 1.0671 | loss_D: 0.4014 -- ETA: 12:30:23.647963
Epoch 036/200 [0257/0257] -- loss_G: 2.0988 | loss_G_identity: 0.5105 | loss_G_GAN: 0.5527 | loss_G_cycle: 1.0357 | loss_D: 0.4293 -- ETA: 12:25:53.703300
Epoch 037/200 [0257/0257] -- loss_G: 2.2110 | loss_G_identity: 0.5254 | loss_G_GAN: 0.5932 | loss_G_cycle: 1.0923 | loss_D: 0.4189 -- ETA: 12:21:24.536106
Epoch 038/200 [0257/0257] -- loss_G: 2.2562 | loss_G_identity: 0.5239 | loss_G_GAN: 0.6443 | loss_G_cycle: 1.0881 | loss_D: 0.4028 -- ETA: 12:16:55.025994
Epoch 039/200 [0257/0257] -- loss_G: 2.3027 | loss_G_identity: 0.5458 | loss_G_GAN: 0.6354 | loss_G_cycle: 1.1215 | loss_D: 0.3742 -- ETA: 12:12:25.121717
Epoch 040/200 [0257/0257] -- loss_G: 2.2881 | loss_G_identity: 0.5732 | loss_G_GAN: 0.6520 | loss_G_cycle: 1.0628 | loss_D: 0.3739 -- ETA: 12:07:55.175019
Epoch 041/200 [0257/0257] -- loss_G: 2.2673 | loss_G_identity: 0.5484 | loss_G_GAN: 0.6258 | loss_G_cycle: 1.0932 | loss_D: 0.3588 -- ETA: 12:03:25.837147
Epoch 042/200 [0257/0257] -- loss_G: 2.1515 | loss_G_identity: 0.5054 | loss_G_GAN: 0.6069 | loss_G_cycle: 1.0392 | loss_D: 0.3659 -- ETA: 11:58:56.883207
Epoch 043/200 [0257/0257] -- loss_G: 2.1567 | loss_G_identity: 0.5023 | loss_G_GAN: 0.6205 | loss_G_cycle: 1.0338 | loss_D: 0.3613 -- ETA: 11:54:27.036576
Epoch 044/200 [0257/0257] -- loss_G: 2.1793 | loss_G_identity: 0.5117 | loss_G_GAN: 0.6186 | loss_G_cycle: 1.0490 | loss_D: 0.3512 -- ETA: 11:49:57.923716
Epoch 045/200 [0257/0257] -- loss_G: 2.1190 | loss_G_identity: 0.5006 | loss_G_GAN: 0.5958 | loss_G_cycle: 1.0225 | loss_D: 0.3304 -- ETA: 11:45:28.471704
Epoch 046/200 [0257/0257] -- loss_G: 2.1380 | loss_G_identity: 0.4987 | loss_G_GAN: 0.6293 | loss_G_cycle: 1.0100 | loss_D: 0.3223 -- ETA: 11:40:57.936534
Epoch 047/200 [0257/0257] -- loss_G: 2.1042 | loss_G_identity: 0.4952 | loss_G_GAN: 0.6053 | loss_G_cycle: 1.0037 | loss_D: 0.3025 -- ETA: 11:36:27.424118
Epoch 048/200 [0257/0257] -- loss_G: 2.0810 | loss_G_identity: 0.4882 | loss_G_GAN: 0.5969 | loss_G_cycle: 0.9959 | loss_D: 0.2939 -- ETA: 11:31:56.918086
Epoch 049/200 [0257/0257] -- loss_G: 2.1306 | loss_G_identity: 0.4944 | loss_G_GAN: 0.6324 | loss_G_cycle: 1.0038 | loss_D: 0.2841 -- ETA: 11:27:26.181521
Epoch 050/200 [0257/0257] -- loss_G: 2.1390 | loss_G_identity: 0.4959 | loss_G_GAN: 0.6397 | loss_G_cycle: 1.0034 | loss_D: 0.2706 -- ETA: 11:22:55.958192
Epoch 051/200 [0257/0257] -- loss_G: 2.1734 | loss_G_identity: 0.4959 | loss_G_GAN: 0.6761 | loss_G_cycle: 1.0015 | loss_D: 0.2652 -- ETA: 11:18:25.168703
Epoch 052/200 [0257/0257] -- loss_G: 2.1827 | loss_G_identity: 0.4965 | loss_G_GAN: 0.6829 | loss_G_cycle: 1.0033 | loss_D: 0.2600 -- ETA: 11:13:54.134648
Epoch 053/200 [0257/0257] -- loss_G: 2.1241 | loss_G_identity: 0.4859 | loss_G_GAN: 0.6618 | loss_G_cycle: 0.9763 | loss_D: 0.2519 -- ETA: 11:09:22.936904
Epoch 054/200 [0257/0257] -- loss_G: 2.1365 | loss_G_identity: 0.4743 | loss_G_GAN: 0.6959 | loss_G_cycle: 0.9663 | loss_D: 0.2518 -- ETA: 11:04:51.897668
Epoch 055/200 [0257/0257] -- loss_G: 2.1918 | loss_G_identity: 0.4851 | loss_G_GAN: 0.7277 | loss_G_cycle: 0.9790 | loss_D: 0.2395 -- ETA: 11:00:20.456523
Epoch 056/200 [0257/0257] -- loss_G: 2.1678 | loss_G_identity: 0.4816 | loss_G_GAN: 0.7240 | loss_G_cycle: 0.9621 | loss_D: 0.2291 -- ETA: 10:55:49.241855
Epoch 057/200 [0257/0257] -- loss_G: 2.2254 | loss_G_identity: 0.4795 | loss_G_GAN: 0.7591 | loss_G_cycle: 0.9869 | loss_D: 0.2240 -- ETA: 10:51:17.811147
Epoch 058/200 [0257/0257] -- loss_G: 2.2188 | loss_G_identity: 0.4682 | loss_G_GAN: 0.7746 | loss_G_cycle: 0.9759 | loss_D: 0.2187 -- ETA: 10:46:46.221755
Epoch 059/200 [0257/0257] -- loss_G: 2.2228 | loss_G_identity: 0.4703 | loss_G_GAN: 0.7801 | loss_G_cycle: 0.9724 | loss_D: 0.2059 -- ETA: 10:42:15.725752
Epoch 060/200 [0257/0257] -- loss_G: 2.1975 | loss_G_identity: 0.4608 | loss_G_GAN: 0.7837 | loss_G_cycle: 0.9531 | loss_D: 0.2042 -- ETA: 10:37:44.701735
Epoch 061/200 [0257/0257] -- loss_G: 2.2060 | loss_G_identity: 0.4607 | loss_G_GAN: 0.7822 | loss_G_cycle: 0.9630 | loss_D: 0.1983 -- ETA: 10:33:13.234604
Epoch 062/200 [0257/0257] -- loss_G: 2.2520 | loss_G_identity: 0.4628 | loss_G_GAN: 0.8267 | loss_G_cycle: 0.9625 | loss_D: 0.2032 -- ETA: 10:28:41.643519
Epoch 063/200 [0257/0257] -- loss_G: 2.1852 | loss_G_identity: 0.4501 | loss_G_GAN: 0.8046 | loss_G_cycle: 0.9305 | loss_D: 0.1968 -- ETA: 10:24:09.796464
Epoch 064/200 [0257/0257] -- loss_G: 2.2021 | loss_G_identity: 0.4600 | loss_G_GAN: 0.8010 | loss_G_cycle: 0.9410 | loss_D: 0.1898 -- ETA: 10:19:38.671352
Epoch 065/200 [0257/0257] -- loss_G: 2.2078 | loss_G_identity: 0.4535 | loss_G_GAN: 0.8188 | loss_G_cycle: 0.9355 | loss_D: 0.1874 -- ETA: 10:15:07.008931
Epoch 066/200 [0257/0257] -- loss_G: 2.2046 | loss_G_identity: 0.4503 | loss_G_GAN: 0.8277 | loss_G_cycle: 0.9266 | loss_D: 0.1931 -- ETA: 10:10:35.082065
Epoch 067/200 [0257/0257] -- loss_G: 2.2189 | loss_G_identity: 0.4490 | loss_G_GAN: 0.8355 | loss_G_cycle: 0.9344 | loss_D: 0.1862 -- ETA: 10:06:03.143782
Epoch 068/200 [0257/0257] -- loss_G: 2.2324 | loss_G_identity: 0.4445 | loss_G_GAN: 0.8586 | loss_G_cycle: 0.9293 | loss_D: 0.1779 -- ETA: 10:01:31.747005
Epoch 069/200 [0257/0257] -- loss_G: 2.2615 | loss_G_identity: 0.4499 | loss_G_GAN: 0.8763 | loss_G_cycle: 0.9353 | loss_D: 0.1753 -- ETA: 9:56:59.7883744
Epoch 070/200 [0257/0257] -- loss_G: 2.2013 | loss_G_identity: 0.4360 | loss_G_GAN: 0.8546 | loss_G_cycle: 0.9107 | loss_D: 0.1721 -- ETA: 9:52:27.673122
Epoch 071/200 [0257/0257] -- loss_G: 2.2564 | loss_G_identity: 0.4485 | loss_G_GAN: 0.8834 | loss_G_cycle: 0.9245 | loss_D: 0.1715 -- ETA: 9:47:55.500131
Epoch 072/200 [0257/0257] -- loss_G: 2.2388 | loss_G_identity: 0.4353 | loss_G_GAN: 0.9021 | loss_G_cycle: 0.9014 | loss_D: 0.1601 -- ETA: 9:43:23.278123
Epoch 073/200 [0257/0257] -- loss_G: 2.2142 | loss_G_identity: 0.4280 | loss_G_GAN: 0.8946 | loss_G_cycle: 0.8916 | loss_D: 0.1604 -- ETA: 9:38:51.631999
Epoch 074/200 [0257/0257] -- loss_G: 2.2122 | loss_G_identity: 0.4282 | loss_G_GAN: 0.9129 | loss_G_cycle: 0.8711 | loss_D: 0.1509 -- ETA: 9:34:19.334916
Epoch 075/200 [0257/0257] -- loss_G: 2.2637 | loss_G_identity: 0.4288 | loss_G_GAN: 0.9510 | loss_G_cycle: 0.8839 | loss_D: 0.1936 -- ETA: 9:29:47.086132
Epoch 076/200 [0257/0257] -- loss_G: 2.2247 | loss_G_identity: 0.4152 | loss_G_GAN: 0.9537 | loss_G_cycle: 0.8558 | loss_D: 0.1575 -- ETA: 9:25:14.729254
Epoch 077/200 [0257/0257] -- loss_G: 2.2371 | loss_G_identity: 0.4187 | loss_G_GAN: 0.9796 | loss_G_cycle: 0.8388 | loss_D: 0.1491 -- ETA: 9:20:43.005840
Epoch 078/200 [0257/0257] -- loss_G: 2.1938 | loss_G_identity: 0.3997 | loss_G_GAN: 0.9670 | loss_G_cycle: 0.8272 | loss_D: 0.1508 -- ETA: 9:16:10.709667
Epoch 079/200 [0257/0257] -- loss_G: 2.1776 | loss_G_identity: 0.3972 | loss_G_GAN: 0.9798 | loss_G_cycle: 0.8006 | loss_D: 0.1420 -- ETA: 9:11:38.357124
Epoch 080/200 [0257/0257] -- loss_G: 2.1912 | loss_G_identity: 0.3926 | loss_G_GAN: 1.0098 | loss_G_cycle: 0.7887 | loss_D: 0.1484 -- ETA: 9:07:05.926115
Epoch 081/200 [0257/0257] -- loss_G: 2.1811 | loss_G_identity: 0.3902 | loss_G_GAN: 1.0105 | loss_G_cycle: 0.7804 | loss_D: 0.1320 -- ETA: 9:02:33.200119
Epoch 082/200 [0257/0257] -- loss_G: 2.1876 | loss_G_identity: 0.3748 | loss_G_GAN: 1.0396 | loss_G_cycle: 0.7732 | loss_D: 0.1354 -- ETA: 8:58:01.055040
Epoch 083/200 [0257/0257] -- loss_G: 2.2019 | loss_G_identity: 0.3783 | loss_G_GAN: 1.0666 | loss_G_cycle: 0.7570 | loss_D: 0.1284 -- ETA: 8:53:28.501031
Epoch 084/200 [0257/0257] -- loss_G: 2.1031 | loss_G_identity: 0.3773 | loss_G_GAN: 1.0199 | loss_G_cycle: 0.7058 | loss_D: 0.1363 -- ETA: 8:48:55.817809
Epoch 085/200 [0257/0257] -- loss_G: 2.1104 | loss_G_identity: 0.3730 | loss_G_GAN: 1.0347 | loss_G_cycle: 0.7028 | loss_D: 0.1392 -- ETA: 8:44:23.055600
Epoch 086/200 [0257/0257] -- loss_G: 2.1276 | loss_G_identity: 0.3640 | loss_G_GAN: 1.0609 | loss_G_cycle: 0.7027 | loss_D: 0.1230 -- ETA: 8:39:50.327474
Epoch 087/200 [0257/0257] -- loss_G: 2.1760 | loss_G_identity: 0.3624 | loss_G_GAN: 1.0799 | loss_G_cycle: 0.7337 | loss_D: 0.1288 -- ETA: 8:35:17.413702
Epoch 088/200 [0257/0257] -- loss_G: 2.0760 | loss_G_identity: 0.3542 | loss_G_GAN: 1.0501 | loss_G_cycle: 0.6716 | loss_D: 0.1291 -- ETA: 8:30:44.843595
Epoch 089/200 [0257/0257] -- loss_G: 2.1029 | loss_G_identity: 0.3558 | loss_G_GAN: 1.0663 | loss_G_cycle: 0.6809 | loss_D: 0.1299 -- ETA: 8:26:11.864045
Epoch 090/200 [0257/0257] -- loss_G: 2.0562 | loss_G_identity: 0.3433 | loss_G_GAN: 1.0597 | loss_G_cycle: 0.6533 | loss_D: 0.1295 -- ETA: 8:21:38.868206
Epoch 091/200 [0257/0257] -- loss_G: 2.0796 | loss_G_identity: 0.3584 | loss_G_GAN: 1.0701 | loss_G_cycle: 0.6511 | loss_D: 0.1246 -- ETA: 8:17:05.815358
Epoch 092/200 [0257/0257] -- loss_G: 2.0209 | loss_G_identity: 0.3357 | loss_G_GAN: 1.0594 | loss_G_cycle: 0.6258 | loss_D: 0.1148 -- ETA: 8:12:32.796663
Epoch 093/200 [0257/0257] -- loss_G: 2.0606 | loss_G_identity: 0.3419 | loss_G_GAN: 1.0830 | loss_G_cycle: 0.6357 | loss_D: 0.1387 -- ETA: 8:07:59.701934
Epoch 094/200 [0257/0257] -- loss_G: 1.9620 | loss_G_identity: 0.3285 | loss_G_GAN: 1.0369 | loss_G_cycle: 0.5966 | loss_D: 0.1290 -- ETA: 8:03:26.604196
Epoch 095/200 [0257/0257] -- loss_G: 2.0404 | loss_G_identity: 0.3209 | loss_G_GAN: 1.1107 | loss_G_cycle: 0.6087 | loss_D: 0.1239 -- ETA: 7:58:53.476718
Epoch 096/200 [0257/0257] -- loss_G: 2.0120 | loss_G_identity: 0.3207 | loss_G_GAN: 1.1025 | loss_G_cycle: 0.5887 | loss_D: 0.1125 -- ETA: 7:54:20.360523
Epoch 097/200 [0257/0257] -- loss_G: 2.0335 | loss_G_identity: 0.3260 | loss_G_GAN: 1.0972 | loss_G_cycle: 0.6103 | loss_D: 0.1258 -- ETA: 7:49:47.207693
Epoch 098/200 [0257/0257] -- loss_G: 2.0766 | loss_G_identity: 0.3265 | loss_G_GAN: 1.1429 | loss_G_cycle: 0.6072 | loss_D: 0.1300 -- ETA: 7:45:14.449766
Epoch 099/200 [0257/0257] -- loss_G: 2.0200 | loss_G_identity: 0.3165 | loss_G_GAN: 1.1272 | loss_G_cycle: 0.5763 | loss_D: 0.1226 -- ETA: 7:40:41.308497
Epoch 100/200 [0257/0257] -- loss_G: 1.9681 | loss_G_identity: 0.3087 | loss_G_GAN: 1.0895 | loss_G_cycle: 0.5699 | loss_D: 0.1245 -- ETA: 7:36:08.052463
Epoch 101/200 [0257/0257] -- loss_G: 2.0054 | loss_G_identity: 0.3187 | loss_G_GAN: 1.0921 | loss_G_cycle: 0.5947 | loss_D: 0.1196 -- ETA: 7:31:34.877067
Epoch 102/200 [0257/0257] -- loss_G: 1.9830 | loss_G_identity: 0.3072 | loss_G_GAN: 1.0903 | loss_G_cycle: 0.5854 | loss_D: 0.1217 -- ETA: 7:27:01.665675
Epoch 103/200 [0257/0257] -- loss_G: 1.9719 | loss_G_identity: 0.3020 | loss_G_GAN: 1.1108 | loss_G_cycle: 0.5591 | loss_D: 0.1230 -- ETA: 7:22:28.481867
Epoch 104/200 [0257/0257] -- loss_G: 1.9749 | loss_G_identity: 0.3023 | loss_G_GAN: 1.1065 | loss_G_cycle: 0.5661 | loss_D: 0.1129 -- ETA: 7:17:55.284815
Epoch 105/200 [0257/0257] -- loss_G: 1.9611 | loss_G_identity: 0.2948 | loss_G_GAN: 1.1212 | loss_G_cycle: 0.5451 | loss_D: 0.1237 -- ETA: 7:13:22.164065
Epoch 106/200 [0257/0257] -- loss_G: 1.9131 | loss_G_identity: 0.2884 | loss_G_GAN: 1.1071 | loss_G_cycle: 0.5177 | loss_D: 0.1158 -- ETA: 7:08:49.000410
Epoch 107/200 [0257/0257] -- loss_G: 1.8858 | loss_G_identity: 0.2799 | loss_G_GAN: 1.0965 | loss_G_cycle: 0.5093 | loss_D: 0.1169 -- ETA: 7:04:15.806926
Epoch 108/200 [0257/0257] -- loss_G: 1.9086 | loss_G_identity: 0.2828 | loss_G_GAN: 1.1134 | loss_G_cycle: 0.5123 | loss_D: 0.1118 -- ETA: 6:59:42.477474
Epoch 109/200 [0257/0257] -- loss_G: 1.9126 | loss_G_identity: 0.2756 | loss_G_GAN: 1.1319 | loss_G_cycle: 0.5051 | loss_D: 0.1053 -- ETA: 6:55:09.177413
Epoch 110/200 [0257/0257] -- loss_G: 1.9343 | loss_G_identity: 0.2738 | loss_G_GAN: 1.1619 | loss_G_cycle: 0.4986 | loss_D: 0.0957 -- ETA: 6:50:35.971447
Epoch 111/200 [0257/0257] -- loss_G: 1.9465 | loss_G_identity: 0.2746 | loss_G_GAN: 1.1715 | loss_G_cycle: 0.5004 | loss_D: 0.0899 -- ETA: 6:46:02.624985
Epoch 112/200 [0257/0257] -- loss_G: 1.9934 | loss_G_identity: 0.2739 | loss_G_GAN: 1.2093 | loss_G_cycle: 0.5103 | loss_D: 0.1064 -- ETA: 6:41:29.272276
Epoch 113/200 [0257/0257] -- loss_G: 1.9275 | loss_G_identity: 0.2648 | loss_G_GAN: 1.1692 | loss_G_cycle: 0.4935 | loss_D: 0.0971 -- ETA: 6:36:55.913914
Epoch 114/200 [0257/0257] -- loss_G: 1.9244 | loss_G_identity: 0.2598 | loss_G_GAN: 1.1760 | loss_G_cycle: 0.4886 | loss_D: 0.0905 -- ETA: 6:32:22.616908
Epoch 115/200 [0257/0257] -- loss_G: 1.8946 | loss_G_identity: 0.2578 | loss_G_GAN: 1.1638 | loss_G_cycle: 0.4730 | loss_D: 0.1040 -- ETA: 6:27:49.373334
Epoch 116/200 [0257/0257] -- loss_G: 1.9048 | loss_G_identity: 0.2518 | loss_G_GAN: 1.1845 | loss_G_cycle: 0.4684 | loss_D: 0.0951 -- ETA: 6:23:16.251287
Epoch 117/200 [0257/0257] -- loss_G: 1.9120 | loss_G_identity: 0.2550 | loss_G_GAN: 1.1850 | loss_G_cycle: 0.4720 | loss_D: 0.1017 -- ETA: 6:18:42.685790
Epoch 118/200 [0257/0257] -- loss_G: 1.9221 | loss_G_identity: 0.2629 | loss_G_GAN: 1.1789 | loss_G_cycle: 0.4803 | loss_D: 0.1694 -- ETA: 6:14:09.189389
Epoch 119/200 [0257/0257] -- loss_G: 1.8096 | loss_G_identity: 0.2479 | loss_G_GAN: 1.0966 | loss_G_cycle: 0.4651 | loss_D: 0.1063 -- ETA: 6:09:35.696082
Epoch 120/200 [0257/0257] -- loss_G: 1.8762 | loss_G_identity: 0.2443 | loss_G_GAN: 1.1781 | loss_G_cycle: 0.4538 | loss_D: 0.0935 -- ETA: 6:05:02.265919
Epoch 121/200 [0257/0257] -- loss_G: 1.8637 | loss_G_identity: 0.2443 | loss_G_GAN: 1.1662 | loss_G_cycle: 0.4532 | loss_D: 0.0874 -- ETA: 6:00:28.924962
Epoch 122/200 [0257/0257] -- loss_G: 1.8727 | loss_G_identity: 0.2431 | loss_G_GAN: 1.1747 | loss_G_cycle: 0.4549 | loss_D: 0.0920 -- ETA: 5:55:55.548595
Epoch 123/200 [0257/0257] -- loss_G: 1.8908 | loss_G_identity: 0.2431 | loss_G_GAN: 1.1994 | loss_G_cycle: 0.4484 | loss_D: 0.0987 -- ETA: 5:51:22.223631
Epoch 124/200 [0257/0257] -- loss_G: 1.8528 | loss_G_identity: 0.2376 | loss_G_GAN: 1.1789 | loss_G_cycle: 0.4363 | loss_D: 0.0938 -- ETA: 5:46:48.911163
Epoch 125/200 [0257/0257] -- loss_G: 1.8406 | loss_G_identity: 0.2384 | loss_G_GAN: 1.1596 | loss_G_cycle: 0.4426 | loss_D: 0.0923 -- ETA: 5:42:15.567900
Epoch 126/200 [0257/0257] -- loss_G: 1.8438 | loss_G_identity: 0.2359 | loss_G_GAN: 1.1733 | loss_G_cycle: 0.4346 | loss_D: 0.0961 -- ETA: 5:37:42.254412
Epoch 127/200 [0257/0257] -- loss_G: 1.8528 | loss_G_identity: 0.2322 | loss_G_GAN: 1.1863 | loss_G_cycle: 0.4343 | loss_D: 0.0920 -- ETA: 5:33:09.090676
Epoch 128/200 [0257/0257] -- loss_G: 1.8209 | loss_G_identity: 0.2327 | loss_G_GAN: 1.1679 | loss_G_cycle: 0.4202 | loss_D: 0.0985 -- ETA: 5:28:35.747767
Epoch 129/200 [0257/0257] -- loss_G: 1.7960 | loss_G_identity: 0.2255 | loss_G_GAN: 1.1541 | loss_G_cycle: 0.4164 | loss_D: 0.0990 -- ETA: 5:24:02.397976
Epoch 130/200 [0257/0257] -- loss_G: 1.8018 | loss_G_identity: 0.2238 | loss_G_GAN: 1.1642 | loss_G_cycle: 0.4138 | loss_D: 0.0937 -- ETA: 5:19:29.070979
Epoch 131/200 [0257/0257] -- loss_G: 1.7727 | loss_G_identity: 0.2248 | loss_G_GAN: 1.1369 | loss_G_cycle: 0.4109 | loss_D: 0.0980 -- ETA: 5:14:55.754414
Epoch 132/200 [0257/0257] -- loss_G: 1.7786 | loss_G_identity: 0.2230 | loss_G_GAN: 1.1428 | loss_G_cycle: 0.4127 | loss_D: 0.0988 -- ETA: 5:10:22.461968
Epoch 133/200 [0257/0257] -- loss_G: 1.7762 | loss_G_identity: 0.2222 | loss_G_GAN: 1.1458 | loss_G_cycle: 0.4082 | loss_D: 0.0964 -- ETA: 5:05:49.190572
Epoch 134/200 [0257/0257] -- loss_G: 1.7474 | loss_G_identity: 0.2169 | loss_G_GAN: 1.1263 | loss_G_cycle: 0.4042 | loss_D: 0.1008 -- ETA: 5:01:15.837558
Epoch 135/200 [0257/0257] -- loss_G: 1.7543 | loss_G_identity: 0.2144 | loss_G_GAN: 1.1398 | loss_G_cycle: 0.4001 | loss_D: 0.1070 -- ETA: 4:56:42.463761
Epoch 136/200 [0257/0257] -- loss_G: 1.7305 | loss_G_identity: 0.2131 | loss_G_GAN: 1.1180 | loss_G_cycle: 0.3994 | loss_D: 0.0986 -- ETA: 4:52:09.094074
Epoch 137/200 [0257/0257] -- loss_G: 1.7333 | loss_G_identity: 0.2086 | loss_G_GAN: 1.1340 | loss_G_cycle: 0.3908 | loss_D: 0.1063 -- ETA: 4:47:35.694247
Epoch 138/200 [0257/0257] -- loss_G: 1.7361 | loss_G_identity: 0.2106 | loss_G_GAN: 1.1298 | loss_G_cycle: 0.3956 | loss_D: 0.1009 -- ETA: 4:43:02.336745
Epoch 139/200 [0257/0257] -- loss_G: 1.7417 | loss_G_identity: 0.2106 | loss_G_GAN: 1.1409 | loss_G_cycle: 0.3902 | loss_D: 0.1015 -- ETA: 4:38:28.935789
Epoch 140/200 [0257/0257] -- loss_G: 1.7222 | loss_G_identity: 0.2083 | loss_G_GAN: 1.1255 | loss_G_cycle: 0.3884 | loss_D: 0.1068 -- ETA: 4:33:55.557369
Epoch 141/200 [0257/0257] -- loss_G: 1.7205 | loss_G_identity: 0.2046 | loss_G_GAN: 1.1278 | loss_G_cycle: 0.3881 | loss_D: 0.0974 -- ETA: 4:29:22.154370
Epoch 142/200 [0257/0257] -- loss_G: 1.7072 | loss_G_identity: 0.2058 | loss_G_GAN: 1.1127 | loss_G_cycle: 0.3886 | loss_D: 0.0990 -- ETA: 4:24:48.736554
Epoch 143/200 [0257/0257] -- loss_G: 1.7070 | loss_G_identity: 0.2020 | loss_G_GAN: 1.1258 | loss_G_cycle: 0.3792 | loss_D: 0.1043 -- ETA: 4:20:15.320459
Epoch 144/200 [0257/0257] -- loss_G: 1.7060 | loss_G_identity: 0.2022 | loss_G_GAN: 1.1227 | loss_G_cycle: 0.3811 | loss_D: 0.1011 -- ETA: 4:15:41.880677
Epoch 145/200 [0257/0257] -- loss_G: 1.6890 | loss_G_identity: 0.2014 | loss_G_GAN: 1.1107 | loss_G_cycle: 0.3769 | loss_D: 0.1020 -- ETA: 4:11:08.563710
Epoch 146/200 [0257/0257] -- loss_G: 1.6597 | loss_G_identity: 0.1987 | loss_G_GAN: 1.0826 | loss_G_cycle: 0.3784 | loss_D: 0.0999 -- ETA: 4:06:35.087407
Epoch 147/200 [0257/0257] -- loss_G: 1.6885 | loss_G_identity: 0.1985 | loss_G_GAN: 1.1153 | loss_G_cycle: 0.3746 | loss_D: 0.1053 -- ETA: 4:02:01.610535
Epoch 148/200 [0257/0257] -- loss_G: 1.6824 | loss_G_identity: 0.1945 | loss_G_GAN: 1.1155 | loss_G_cycle: 0.3725 | loss_D: 0.0982 -- ETA: 3:57:28.100174
Epoch 149/200 [0257/0257] -- loss_G: 1.6577 | loss_G_identity: 0.1945 | loss_G_GAN: 1.0904 | loss_G_cycle: 0.3727 | loss_D: 0.1001 -- ETA: 3:52:54.609591
Epoch 150/200 [0257/0257] -- loss_G: 1.6783 | loss_G_identity: 0.1932 | loss_G_GAN: 1.1134 | loss_G_cycle: 0.3717 | loss_D: 0.1026 -- ETA: 3:48:21.079362
Epoch 151/200 [0257/0257] -- loss_G: 1.6580 | loss_G_identity: 0.1932 | loss_G_GAN: 1.0938 | loss_G_cycle: 0.3710 | loss_D: 0.1024 -- ETA: 3:43:47.528049
Epoch 152/200 [0257/0257] -- loss_G: 1.6397 | loss_G_identity: 0.1922 | loss_G_GAN: 1.0810 | loss_G_cycle: 0.3664 | loss_D: 0.1022 -- ETA: 3:39:13.957410
Epoch 153/200 [0257/0257] -- loss_G: 1.6423 | loss_G_identity: 0.1897 | loss_G_GAN: 1.0868 | loss_G_cycle: 0.3658 | loss_D: 0.1039 -- ETA: 3:34:40.337076
Epoch 154/200 [0257/0257] -- loss_G: 1.6616 | loss_G_identity: 0.1882 | loss_G_GAN: 1.1066 | loss_G_cycle: 0.3669 | loss_D: 0.1029 -- ETA: 3:30:06.723452
Epoch 155/200 [0257/0257] -- loss_G: 1.6601 | loss_G_identity: 0.1885 | loss_G_GAN: 1.1023 | loss_G_cycle: 0.3693 | loss_D: 0.1042 -- ETA: 3:25:33.088278
Epoch 156/200 [0257/0257] -- loss_G: 1.6487 | loss_G_identity: 0.1876 | loss_G_GAN: 1.0958 | loss_G_cycle: 0.3653 | loss_D: 0.1080 -- ETA: 3:20:59.470855
Epoch 157/200 [0257/0257] -- loss_G: 1.6371 | loss_G_identity: 0.1860 | loss_G_GAN: 1.0878 | loss_G_cycle: 0.3632 | loss_D: 0.1036 -- ETA: 3:16:25.862970
Epoch 158/200 [0257/0257] -- loss_G: 1.6234 | loss_G_identity: 0.1854 | loss_G_GAN: 1.0792 | loss_G_cycle: 0.3588 | loss_D: 0.1106 -- ETA: 3:11:52.190730
Epoch 159/200 [0257/0257] -- loss_G: 1.6198 | loss_G_identity: 0.1833 | loss_G_GAN: 1.0793 | loss_G_cycle: 0.3572 | loss_D: 0.1065 -- ETA: 3:07:18.470662
Epoch 160/200 [0257/0257] -- loss_G: 1.6182 | loss_G_identity: 0.1824 | loss_G_GAN: 1.0775 | loss_G_cycle: 0.3584 | loss_D: 0.1013 -- ETA: 3:02:44.763253
Epoch 161/200 [0257/0257] -- loss_G: 1.6179 | loss_G_identity: 0.1819 | loss_G_GAN: 1.0777 | loss_G_cycle: 0.3583 | loss_D: 0.1057 -- ETA: 2:58:11.162069
Epoch 162/200 [0257/0257] -- loss_G: 1.6135 | loss_G_identity: 0.1810 | loss_G_GAN: 1.0765 | loss_G_cycle: 0.3561 | loss_D: 0.1003 -- ETA: 2:53:37.424388
Epoch 163/200 [0257/0257] -- loss_G: 1.5960 | loss_G_identity: 0.1793 | loss_G_GAN: 1.0613 | loss_G_cycle: 0.3555 | loss_D: 0.1092 -- ETA: 2:49:03.640945
Epoch 164/200 [0257/0257] -- loss_G: 1.6015 | loss_G_identity: 0.1783 | loss_G_GAN: 1.0685 | loss_G_cycle: 0.3547 | loss_D: 0.1080 -- ETA: 2:44:29.852518
Epoch 165/200 [0257/0257] -- loss_G: 1.5909 | loss_G_identity: 0.1786 | loss_G_GAN: 1.0602 | loss_G_cycle: 0.3521 | loss_D: 0.1046 -- ETA: 2:39:56.061134
Epoch 166/200 [0257/0257] -- loss_G: 1.6017 | loss_G_identity: 0.1774 | loss_G_GAN: 1.0679 | loss_G_cycle: 0.3564 | loss_D: 0.1076 -- ETA: 2:35:22.237574
Epoch 167/200 [0257/0257] -- loss_G: 1.5724 | loss_G_identity: 0.1752 | loss_G_GAN: 1.0455 | loss_G_cycle: 0.3518 | loss_D: 0.1125 -- ETA: 2:30:48.375638
Epoch 168/200 [0257/0257] -- loss_G: 1.5808 | loss_G_identity: 0.1752 | loss_G_GAN: 1.0558 | loss_G_cycle: 0.3498 | loss_D: 0.1066 -- ETA: 2:26:14.501806
Epoch 169/200 [0257/0257] -- loss_G: 1.5882 | loss_G_identity: 0.1751 | loss_G_GAN: 1.0659 | loss_G_cycle: 0.3472 | loss_D: 0.1099 -- ETA: 2:21:40.592358
Epoch 170/200 [0257/0257] -- loss_G: 1.5814 | loss_G_identity: 0.1737 | loss_G_GAN: 1.0591 | loss_G_cycle: 0.3486 | loss_D: 0.1116 -- ETA: 2:17:06.717347
Epoch 171/200 [0257/0257] -- loss_G: 1.5877 | loss_G_identity: 0.1743 | loss_G_GAN: 1.0643 | loss_G_cycle: 0.3491 | loss_D: 0.1118 -- ETA: 2:12:32.771868
Epoch 172/200 [0257/0257] -- loss_G: 1.5872 | loss_G_identity: 0.1729 | loss_G_GAN: 1.0664 | loss_G_cycle: 0.3479 | loss_D: 0.1111 -- ETA: 2:07:58.787148
Epoch 173/200 [0257/0257] -- loss_G: 1.5532 | loss_G_identity: 0.1720 | loss_G_GAN: 1.0351 | loss_G_cycle: 0.3461 | loss_D: 0.1110 -- ETA: 2:03:24.806573
Epoch 174/200 [0257/0257] -- loss_G: 1.5556 | loss_G_identity: 0.1718 | loss_G_GAN: 1.0396 | loss_G_cycle: 0.3442 | loss_D: 0.1102 -- ETA: 1:58:50.773912
Epoch 175/200 [0257/0257] -- loss_G: 1.5536 | loss_G_identity: 0.1709 | loss_G_GAN: 1.0401 | loss_G_cycle: 0.3427 | loss_D: 0.1130 -- ETA: 1:54:16.763608
Epoch 176/200 [0257/0257] -- loss_G: 1.5705 | loss_G_identity: 0.1700 | loss_G_GAN: 1.0572 | loss_G_cycle: 0.3434 | loss_D: 0.1114 -- ETA: 1:49:42.684364
Epoch 177/200 [0257/0257] -- loss_G: 1.5526 | loss_G_identity: 0.1701 | loss_G_GAN: 1.0397 | loss_G_cycle: 0.3427 | loss_D: 0.1130 -- ETA: 1:45:08.599298
Epoch 178/200 [0257/0257] -- loss_G: 1.5582 | loss_G_identity: 0.1693 | loss_G_GAN: 1.0475 | loss_G_cycle: 0.3414 | loss_D: 0.1136 -- ETA: 1:40:34.486887
Epoch 179/200 [0257/0257] -- loss_G: 1.5681 | loss_G_identity: 0.1692 | loss_G_GAN: 1.0584 | loss_G_cycle: 0.3405 | loss_D: 0.1141 -- ETA: 1:36:00.358248
Epoch 180/200 [0257/0257] -- loss_G: 1.5578 | loss_G_identity: 0.1679 | loss_G_GAN: 1.0516 | loss_G_cycle: 0.3383 | loss_D: 0.1149 -- ETA: 1:31:26.222925
Epoch 181/200 [0257/0257] -- loss_G: 1.5645 | loss_G_identity: 0.1679 | loss_G_GAN: 1.0582 | loss_G_cycle: 0.3384 | loss_D: 0.1155 -- ETA: 1:26:52.048933
Epoch 182/200 [0257/0257] -- loss_G: 1.5460 | loss_G_identity: 0.1674 | loss_G_GAN: 1.0397 | loss_G_cycle: 0.3389 | loss_D: 0.1157 -- ETA: 1:22:17.860721
Epoch 183/200 [0257/0257] -- loss_G: 1.5540 | loss_G_identity: 0.1671 | loss_G_GAN: 1.0487 | loss_G_cycle: 0.3382 | loss_D: 0.1168 -- ETA: 1:17:43.661672
Epoch 184/200 [0257/0257] -- loss_G: 1.5565 | loss_G_identity: 0.1661 | loss_G_GAN: 1.0537 | loss_G_cycle: 0.3367 | loss_D: 0.1177 -- ETA: 1:13:09.452321
Epoch 185/200 [0257/0257] -- loss_G: 1.5560 | loss_G_identity: 0.1667 | loss_G_GAN: 1.0528 | loss_G_cycle: 0.3366 | loss_D: 0.1184 -- ETA: 1:08:35.223455
Epoch 186/200 [0257/0257] -- loss_G: 1.5530 | loss_G_identity: 0.1656 | loss_G_GAN: 1.0514 | loss_G_cycle: 0.3360 | loss_D: 0.1180 -- ETA: 1:04:00.980957
Epoch 187/200 [0257/0257] -- loss_G: 1.5629 | loss_G_identity: 0.1656 | loss_G_GAN: 1.0613 | loss_G_cycle: 0.3361 | loss_D: 0.1164 -- ETA: 0:59:26.718773
Epoch 188/200 [0257/0257] -- loss_G: 1.5482 | loss_G_identity: 0.1653 | loss_G_GAN: 1.0479 | loss_G_cycle: 0.3350 | loss_D: 0.1221 -- ETA: 0:54:52.440293
Epoch 189/200 [0257/0257] -- loss_G: 1.5468 | loss_G_identity: 0.1646 | loss_G_GAN: 1.0481 | loss_G_cycle: 0.3341 | loss_D: 0.1220 -- ETA: 0:50:18.143775
Epoch 190/200 [0257/0257] -- loss_G: 1.5481 | loss_G_identity: 0.1645 | loss_G_GAN: 1.0493 | loss_G_cycle: 0.3343 | loss_D: 0.1226 -- ETA: 0:45:43.849800
Epoch 191/200 [0257/0257] -- loss_G: 1.5454 | loss_G_identity: 0.1641 | loss_G_GAN: 1.0468 | loss_G_cycle: 0.3345 | loss_D: 0.1262 -- ETA: 0:41:09.530023
Epoch 192/200 [0257/0257] -- loss_G: 1.5483 | loss_G_identity: 0.1639 | loss_G_GAN: 1.0516 | loss_G_cycle: 0.3328 | loss_D: 0.1233 -- ETA: 0:36:35.191152
Epoch 193/200 [0257/0257] -- loss_G: 1.5566 | loss_G_identity: 0.1633 | loss_G_GAN: 1.0608 | loss_G_cycle: 0.3324 | loss_D: 0.1262 -- ETA: 0:32:00.841756
Epoch 194/200 [0257/0257] -- loss_G: 1.5454 | loss_G_identity: 0.1632 | loss_G_GAN: 1.0497 | loss_G_cycle: 0.3324 | loss_D: 0.1296 -- ETA: 0:27:26.475868
Epoch 195/200 [0257/0257] -- loss_G: 1.5534 | loss_G_identity: 0.1630 | loss_G_GAN: 1.0582 | loss_G_cycle: 0.3322 | loss_D: 0.1315 -- ETA: 0:22:52.105822
Epoch 196/200 [0257/0257] -- loss_G: 1.5605 | loss_G_identity: 0.1627 | loss_G_GAN: 1.0658 | loss_G_cycle: 0.3319 | loss_D: 0.1318 -- ETA: 0:18:17.710967
Epoch 197/200 [0257/0257] -- loss_G: 1.5725 | loss_G_identity: 0.1626 | loss_G_GAN: 1.0780 | loss_G_cycle: 0.3319 | loss_D: 0.1328 -- ETA: 0:13:43.302623
Epoch 198/200 [0257/0257] -- loss_G: 1.5752 | loss_G_identity: 0.1623 | loss_G_GAN: 1.0810 | loss_G_cycle: 0.3318 | loss_D: 0.1349 -- ETA: 0:09:08.880865
Epoch 199/200 [0257/0257] -- loss_G: 1.5759 | loss_G_identity: 0.1623 | loss_G_GAN: 1.0820 | loss_G_cycle: 0.3316 | loss_D: 0.1363 -- ETA: 0:04:34.446493
Epoch 200/200 [0257/0257] -- loss_G: 1.5737 | loss_G_identity: 0.1622 | loss_G_GAN: 1.0802 | loss_G_cycle: 0.3314 | loss_D: 0.1397 -- ETA: 0:00:00.067909
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##### TEST</span>
<span class="kn">from</span> <span class="nn">torchvision.utils</span> <span class="kn">import</span> <span class="n">save_image</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Load state dicts</span>
<span class="n">netG_A2B</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;output/netG_A2B.pth&#39;</span><span class="p">))</span>
<span class="n">netG_B2A</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;output/netG_B2A.pth&#39;</span><span class="p">))</span>

<span class="c1"># Set model&#39;s test mode</span>
<span class="n">netG_A2B</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">netG_B2A</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">dataloaders</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>

<span class="n">reala</span><span class="o">=</span><span class="p">[]</span>
<span class="n">realb</span><span class="o">=</span><span class="p">[]</span>
<span class="n">fakea</span><span class="o">=</span><span class="p">[]</span>
<span class="n">fakeb</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
    <span class="c1"># Set model input</span>
    <span class="n">real_A</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_A</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]))</span>
    <span class="n">real_B</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">input_B</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]))</span>
    <span class="n">reala</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real_A</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">realb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real_B</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

    <span class="c1"># Generate output</span>
    <span class="n">fake_B</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">netG_A2B</span><span class="p">(</span><span class="n">real_A</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">fake_A</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">netG_B2A</span><span class="p">(</span><span class="n">real_B</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">fakea</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_A</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">fakeb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_B</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">Generated images </span><span class="si">%04d</span><span class="s1"> of </span><span class="si">%04d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)))</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generated images 0064 of 0064
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#plt.imshow(reala[0][1,0,:,:],cmap=&#39;Greys&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">realb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2, 1, 256, 256)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now compare test samples with results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">columns</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">*</span><span class="n">rows</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
    <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reala</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">realb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fakeb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Real w shadow&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Real w/o shadow&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fake w/o shadow&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_16_0.png" src="../../_images/STUDENTSPROJECTS_Proj_2022_Matera_Images_shadow_removal_Sebastian_Walter_16_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Stream_Network_Abstraction_Alonso_Gonzalez.html" class="btn btn-neutral float-left" title="2.2. Alonso Gonzalez: Stream Network Abstraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Using_a_LSTM_network_and_SHAP_to_determine_the_impact_of_drought_Florian_Ells%C3%A4%C3%9Fer.html" class="btn btn-neutral float-right" title="2.4. Florian Ellsäßer: Using a LSTM network and SHAP to determine the impact of drought and season on winter wheat" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>