

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.7. Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css?v=572af1d6" />
      <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba" href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html" />
    <link rel="prev" title="2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest" href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Spatial Ecology's code documentation
              <img src="../../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_modelling_10-11_2022.html">GeoComp &amp; Modelling 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2023.html">GeoComp &amp; ML 2023 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2024.html">GeoComp &amp; ML 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_GEO-OPEN-HACK-2024_06_2024.html">GEO-OPEN-HACK-2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_11-12_2024.html">GeoComp 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_geoanlysis_04_2025.html">Geo Comp/Analysis 2025 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_09-11_2025.html">GeoComp &amp; ML 2025 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Ubuntu24.04_for_Spatial_Ecology_course.html">Prepare Ubuntu 24.04 for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Colab_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_introduction1.html">Introduction to pyjeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_introduction2.html">pyjeo: an open source image processing library in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_pktools.html">Performing raster and vector operations in Python using pyjeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_upscaling_surf.html">Scaling-up: batch processing on the cluster with pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/PythonEnvs.html">Python environments or how to survive to your journey in the geodata space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_data_analysis_SM.html">Python data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_geospatial_data_analysis_SM.html">Python geospatial data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/RasterIO_Intro.html">RasterIO for dummies: a brief intro to a <em>pythonic</em> raster library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/RasterIO_Intro.html#2.-Preparing-the-dataset-for-next-ML-exercises-via-rasterio">2. Preparing the dataset for next ML exercises via rasterio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/RasterIO_Intro.html#3.-Beyond-the-basics">3. Beyond the basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/OGCSQL.html">Generalities about OGC Geospatial extensions for SQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_newproject.html">Start a new GRASS project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro_colab.html">Using GRASS for stream-network extraction and basins delineation in Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HIGH PERFORMANCE COMPUTING</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HPC/hpc_setting.html">Geocomputation at High Performance Computing Cluster (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HPC/hpc_setting_grass.html">Use of GRASS in HPC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASSIGNMENTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASSIGNMENTS/assignment_fall2022_solutions.html">Assignments Fall 2022</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_02Predictors_extraction.html">Estimation of tree height using GEDI dataset - Predictors extraction at point location</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04SVM_pred_2022.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04SVM_pred_2023.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04SVM_pred_2024.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04SVM_pred_2024.html#Exercise:-explore-the-other-parameters-offered-by-the-SVM-library-and-try-to-make-the-model-better.-Some-suggestions:">Exercise: explore the other parameters offered by the SVM library and try to make the model better. Some suggestions:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05Perceptron_pred_2022.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05Perceptron_intro_2023.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05Perceptron_intro_2024.html">Estimation of tree height using GEDI dataset - Perceptron - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_06Perceptron_pred_2023.html">Estimation of tree height using GEDI dataset - Perceptron tree prediction - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_06Perceptron_complete_2024.html">Estimation of tree height using GEDI dataset - Perceptron complete - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05Perceptron_pred_clean_2022.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_06NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_07FeedForward_Networks_2024.html">Estimation of tree height using GEDI dataset - Neural Network 1 - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite_2022.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2022.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite_2023.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite_2023.html#Using-CNNs-for-a-image-dataset">Using CNNs for a image dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/foundation_model_IIASA2024.html">Prithvi 100M model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/foundation_model_IIASA2024.html#Proposed-exercises">Proposed exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN_Unsupervised_2024.html">Autoencoder (AE), Variational Autoencoder (VAE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN_Unsupervised_2024.html#Implementing-an-Autoencoder">Implementing an Autoencoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN_Unsupervised_2024.html#Autoencoding-MNIST">Autoencoding MNIST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN_Unsupervised_2024.html#Section-2">Section 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN_Unsupervised_2024.html#Section-3---Generative-Models">Section 3 - Generative Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html">Using LSTM for time-series predictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite_with_GPT_code_2023.html">Using GPT to implement a Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Classification_pyjeo_sklearn_2023.html">Classification in Python using pyjeo and sklearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/GEEviaPython_2023.html">Google Earth Engine use via Python, containers and other mythical beasts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#matera">2. 2022 MATERA</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Damaged_trees_classification_RF_Janusz_Godziek.html">2.1. Janusz Godziek: Damaged vs undamaged trees - Random Forest classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Stream_Network_Abstraction_Alonso_Gonzalez.html">2.2. Alonso Gonzalez: Stream Network Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Images_shadow_removal_Sebastian_Walter.html">2.3. Sebastian Walter: Images shadow removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modelling_freshwater_biodiversity_setting_the_scene_from_geo-data_to_text-data_Jaime_Garc%C3%ADa_M%C3%A1rquez.html">2.4. Jaime García: Modelling freshwater biodiversity: setting the scene, from geo-data to text-data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Spectral_clustering_of_freshwater_habitats_Maria_%C3%9Cblacker.html">2.5. Maria Üblacker: Spectral clustering of freshwater habitats</a></li>
<li class="toctree-l2"><a class="reference internal" href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html">2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.7. Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">2.7.1. Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#glad-ard-landsat-images">2.7.2. 1 GLAD ARD Landsat images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-download">2.7.2.1. Data download</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-vegetation-index">2.7.2.2. Calculate vegetation index</a></li>
<li class="toctree-l4"><a class="reference internal" href="#masking-and-statistics">2.7.2.3. Masking and statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generate-stacks-and-extract-statistics-in-pyjeo">2.7.3. Generate stacks and extract statistics in Pyjeo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-topographical-and-hydrological-layers-in-grass">2.7.4. 2 Creating topographical and hydrological layers in GRASS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#download-srtm">2.7.4.1. Download SRTM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-variables">2.7.4.2. Calculate variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extract-statistics-for-random-points">2.7.5. 3 Extract statistics for random points</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extract-values-for-response-and-predictor-variables">2.7.5.1. Extract values for response and predictor variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modelling-vegetation">2.7.6. 4 Modelling vegetation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prepare-table">2.7.6.1. Prepare table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-forest">2.7.6.2. Random forest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-forest-tuning">2.7.6.3. Random Forest tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#predict-on-the-raster-using-pyspatialml">2.7.6.4. Predict on the raster using pyspatialml</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#follow-up">2.7.7. 5 Follow up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html">2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modeling_debris_flow_source_areas_Txomin_Bornaetxea.html">2.9. Txomin Bornaetxea: Modeling debris flow source areas</a></li>
<li class="toctree-l2"><a class="reference internal" href="Prediction_of_AGB_using_RFR_SVR_FFNN_Ritwika_Mukhopadhyay.html">2.10. Ritwika Mukhopadhyay: Comparative Analysis of the prediction of AGB using Random Forest Regression, Support Vector Machine for Regression &amp; FeedForward Neural Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="Clustering_Electric_Vehicle_Charging_Pattern_with_DTW_and_EV_Charging_energy_demand_Prediction_with_LSTM_Hyeyoung_Sim.html">2.11. Hyeyoung Sim: Clustering Electric Vehicle Charging Pattern with DTW and EV Charging energy demand Prediction with LSTM</a></li>
<li class="toctree-l2"><a class="reference internal" href="Classification_of_different_tree_species_plantations_using_deep_learning_Hemalatha_Velappan.html">2.12. Hemalatha Velappan: Classification of different tree species plantations using deep learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ships_and_economic_activity_a_starter_Myriam_Marending.html">2.13. Myriam Marending: Ships and economic activity: a starter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using_a_LSTM_network_and_SHAP_to_determine_the_impact_of_drought_Florian_Ells%C3%A4%C3%9Fer.html">2.14. Florian Ellsäßer: Using a LSTM network and SHAP to determine the impact of drought and season on winter wheat</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_info.html">Shelter locations close to Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/bike_accomodation.html">Accomodation in Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/puglia_discover.html">Discover Puglia by bike!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">1. </span>2021 SWEDEN</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.7. </span>Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/STUDENTSPROJECTS/Proj_2022_Matera/Topographic_and_hydrological_influence_on_vegetation_in_an_arid_environment_Gidske_L_Andersen.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gidske-l-andersen-topographic-and-hydrological-influence-on-vegetation-in-an-arid-environment">
<h1><span class="section-number">2.7. </span>Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment<a class="headerlink" href="#gidske-l-andersen-topographic-and-hydrological-influence-on-vegetation-in-an-arid-environment" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://youtu.be/fM4FdKlbu1I">Video recording</a></p>
<section id="background">
<h2><span class="section-number">2.7.1. </span>Background<a class="headerlink" href="#background" title="Link to this heading"></a></h2>
<p>Arid lands are highly variable environments due to their water dependency and the high spatio-temporal variability of precipitation. But water is not only available to plants as run-off precipation, it is also availble as soil moisture (shallow and deep) and groundwater. These water resources are redistributed in and by the landscape. Vegetation has adapted to the variability of water resources in different ways and are found at places where water conditions are optimal, either in short term perspective (ephemeral species; where runoff is important) or in a long-term perspective (shrubs and trees; where soil moisture is stable). In this case study I will look into which topographical and hydrological parameters that influence vegetation patterns and to what degree they can model these patterns. Landsat data is used to extract vegetation indices (vegetation pattern) and SRTM is used for derivation of hydrological and topographical predictors.</p>
<p>The pictures below show the area for the case study in the Red Sea Hills of Sudan (an overview and a close-up to show how vegetation can grow in the wadis).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">rcParams</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># figure size in inches optional</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span> <span class="p">,</span><span class="mi">8</span>

<span class="c1"># read images</span>
<span class="n">img_A</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;area.jpg&quot;</span><span class="p">)</span>
<span class="n">img_B</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;area_detail.jpg&quot;</span><span class="p">)</span>

<span class="c1"># display images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_A</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_B</span><span class="p">)</span>

</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f371a7f10a0&gt;
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_2_1.png" /></p>
<p><strong>flow chart of processing</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">&quot;figure_flowchart.png&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_4_0.png" /></p>
</section>
<section id="glad-ard-landsat-images">
<h2><span class="section-number">2.7.2. </span>1 GLAD ARD Landsat images<a class="headerlink" href="#glad-ard-landsat-images" title="Link to this heading"></a></h2>
<p>The Landsat Analysis Ready Data (GLAD ARD) developed by the Global Land Analysis and Discovery (GLAD) provides spatially and temporally consistent inputs for land cover mapping and change detection. The GLAD ARD represent a 16-day time-series of tiled Landsat normalized surface reflectance from 1997 to present (source
https://glad.umd.edu/book/overview).</p>
<p>The GLAD ARD data can be download from https://glad.umd.edu/dataset/landsat_v1.1/ previous autentifcation.</p>
<p>In my project I’m using imagery from Red Sea Hills, Sudan, portion of TILE 037E_18N. Due to working on the virtual machine I only selected one year of data, i.e. <strong>2018</strong>.</p>
<p>The temporal series for each tile is labeled following this numerical nomenclature</p>
<ul class="simple">
<li><p>first column is year</p></li>
<li><p>remaining columns are name of 16day time series imagery</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span> <span class="n">head</span> <span class="o">-</span><span class="mi">43</span> <span class="n">geodata</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="mi">16</span><span class="n">d_intervals</span><span class="o">.</span><span class="n">csv</span>  <span class="o">|</span> <span class="n">tail</span> <span class="o">-</span><span class="mi">6</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2017 852 853 854 855 856 857 858 859 860 861 862 863 864 865 866 867 868 869 870 871 872 873 874         
2018 875 876 877 878 879 880 881 882 883 884 885 886 887 888 889 890 891 892 893 894 895 896 897         
2019 898 899 900 901 902 903 904 905 906 907 908 909 910 911 912 913 914 915 916 917 918 919 920         
2020 921 922 923 924 925 926 927 928 929 930 931 932 933 934 935 936 937 938 939 940 941 942 943         
2021 944 945 946 947 948 949 950 951 952 953 954 955 956 957 958 959 960 961 962 963 964 965 966         
2022 967 968 969 970 971 972 973 974 975 976 977 978 979 980 981 982 983 984 985 986 987 988 989         
</pre></div>
</div>
<section id="data-download">
<h3><span class="section-number">2.7.2.1. </span>Data download<a class="headerlink" href="#data-download" title="Link to this heading"></a></h3>
<p>Data for 2018 was downloaded with this code, where user:password should be replace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span><span class="w"> </span>INTER<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>grep<span class="w"> </span>-e<span class="w"> </span>^2018<span class="w"> </span>geodata/glad_ard//16d_intervals.csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ $1=&quot;&quot;; print $0}&#39;</span><span class="k">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w">  </span>
<span class="w">    </span>curl<span class="w"> </span>--connect-timeout<span class="w"> </span><span class="m">600</span><span class="w"> </span>-u<span class="w"> </span>user:passwd<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://glad.umd.edu/dataset/landsat_v1.1/18N/037E_18N/<span class="nv">$INTER</span>.tif<span class="w"> </span>-o<span class="w"> </span>project/glad_ard/<span class="nv">$INTER</span>.tif
<span class="w">    </span>gdal_translate<span class="w"> </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w">  </span>-projwin<span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">18</span>.86666<span class="w"> </span><span class="m">37</span>.4<span class="w"> </span><span class="m">18</span>.63333<span class="w"> </span>project/glad_ard/<span class="nv">$INTER</span>.tif<span class="w"> </span>project/glad_ard/<span class="si">${</span><span class="nv">INTER</span><span class="si">}</span>_crop.tif<span class="w">      </span>
<span class="k">done</span>
</pre></div>
</div>
<p>The images has 8 bands, where band 3 and 4 can be used to calculate vegetation indices. Band 8, BQA, is used for masking pixels with low quality (https://glad.umd.edu/ard/landsat-ard-methodology). In addition to clouds, there can also be low quality pixels seen as stripes (caused by sensor problems; see figure below).</p>
<p>Due the arid characteristics of the area, the Soil Adjusted Vegetation Index (SAVI) is used:</p>
<p>(NIR - Red)/(NIR + RED) + 0.5)) * 1.5</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="c1">#converting to png for display</span>
<span class="err">!</span><span class="n">gdal_translate</span> <span class="o">-</span><span class="n">b</span> <span class="mi">1</span> <span class="o">-</span><span class="n">b</span> <span class="mi">2</span> <span class="o">-</span><span class="n">b</span> <span class="mi">3</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="mi">875</span><span class="n">_crop</span><span class="o">.</span><span class="n">tif</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="mi">875</span><span class="n">_crop</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">show</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/875_crop_m.tif&quot;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_10_0.png" /></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f3719b14eb0&gt;
</pre></div>
</div>
</section>
<section id="calculate-vegetation-index">
<h3><span class="section-number">2.7.2.2. </span>Calculate vegetation index<a class="headerlink" href="#calculate-vegetation-index" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>project/glad_ard/*_crop.tif<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">  </span><span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>.tif<span class="w"> </span><span class="k">)</span>
<span class="w">  </span><span class="c1">#echo $file</span>
<span class="w">  </span><span class="c1">#VI</span>
<span class="w">  </span>gdal_calc.py<span class="w">  </span>--type<span class="o">=</span>Float32<span class="w"> </span>--overwrite<span class="w"> </span>-A<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--A_band<span class="o">=</span><span class="m">3</span><span class="w"> </span>-B<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--B_band<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>--co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>--calc<span class="o">=</span><span class="s2">&quot;(B.astype(float))/(A.astype(float))&quot;</span><span class="w"> </span>--outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_VI.tif<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--quiet

<span class="w">  </span><span class="c1">#NDVI</span>
<span class="w">  </span>gdal_calc.py<span class="w">  </span>--type<span class="o">=</span>Float32<span class="w"> </span>--overwrite<span class="w"> </span>-A<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--A_band<span class="o">=</span><span class="m">3</span><span class="w"> </span>-B<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--B_band<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>--co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>--calc<span class="o">=</span><span class="s2">&quot;(B.astype(float)- A.astype(float))/(B.astype(float) + A.astype(float))&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_NDVI.tif<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--quiet
<span class="w">    </span>
<span class="w">  </span><span class="c1">#SAVI</span>
<span class="w">  </span>gdal_calc.py<span class="w">  </span>--type<span class="o">=</span>Float32<span class="w"> </span>--overwrite<span class="w"> </span>-A<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--A_band<span class="o">=</span><span class="m">3</span><span class="w"> </span>-B<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>--B_band<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>--co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>--calc<span class="o">=</span><span class="s2">&quot;((B.astype(float)- A.astype(float))/(B.astype(float) + A.astype(float) + 0.5)) * 1.5&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_SAVI.tif<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--quiet

<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="masking-and-statistics">
<h3><span class="section-number">2.7.2.3. </span>Masking and statistics<a class="headerlink" href="#masking-and-statistics" title="Link to this heading"></a></h3>
<p>Only BQA pixels 1 and 2 are kept in the masking. Since counting starts from 0, BQA band is #7. Nodata value is set to  Uint16 max (65535) since using 0 will cause error when estimating SAVI. All images were masked in the same way after calculating SAVI (since input nulldata could not be set in this version of gdalcalc.py).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/*</span><span class="n">_crop</span><span class="o">.</span><span class="n">tif</span><span class="p">;</span> <span class="n">do</span> 
  <span class="n">filename</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">basename</span> <span class="err">$</span><span class="n">file</span> <span class="o">.</span><span class="n">tif</span> <span class="p">)</span>
  <span class="n">echo</span> <span class="err">$</span><span class="n">file</span>
  <span class="n">echo</span> <span class="err">$</span><span class="n">filename</span>  
  <span class="n">pkgetmask</span> <span class="o">--</span><span class="n">overwrite</span> <span class="o">-</span><span class="n">i</span> <span class="err">$</span><span class="n">file</span> <span class="o">-</span><span class="n">o</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">filename</span><span class="p">}</span><span class="n">_mask</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span><span class="nb">min</span> <span class="mi">1</span> <span class="o">-</span><span class="nb">max</span> <span class="mi">2</span> <span class="o">-</span><span class="n">b</span> <span class="mi">7</span>
  <span class="n">pksetmask</span> <span class="o">-</span><span class="n">i</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">filename</span><span class="p">}</span><span class="n">_SAVI</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span><span class="n">m</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">filename</span><span class="p">}</span><span class="n">_mask</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span><span class="n">msknodata</span> <span class="mi">0</span> <span class="o">-</span><span class="n">nodata</span> <span class="o">-</span><span class="mi">99</span> \
  <span class="o">-</span><span class="n">o</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">filename</span><span class="p">}</span><span class="n">_SAVI_m</span><span class="o">.</span><span class="n">tif</span>\
  <span class="o">--</span><span class="n">quiet</span>
<span class="n">done</span>
</pre></div>
</div>
<p><strong>Checking nodata and statistics for the VIs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
gdalinfo<span class="w"> </span>project/glad_ard/875_crop_SAVI_m.tif<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;NoData&#39;</span><span class="w"> </span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  NoData Value=-99
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>project/glad_ard/*crop_SAVI_m.tif<span class="p">;</span><span class="w"> </span><span class="k">do</span>
pkinfo<span class="w"> </span>-i<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>-stats<span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $0}&#39;</span>
<span class="k">done</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-min -0.211417 -max 0.611614 --mean 0.12386 --stdDev 0.0465675 
-min 0.0631748 -max 0.210848 --mean 0.134271 --stdDev 0.0229662 
-min -0.188215 -max 0.772617 --mean 0.126266 --stdDev 0.0579652 
-min -0.31516 -max 0.715421 --mean 0.126566 --stdDev 0.0513284 
-min -0.216388 -max 0.600698 --mean 0.124193 --stdDev 0.0397357 
-min -0.274006 -max 0.610294 --mean 0.124246 --stdDev 0.0368988 
-min -0.227176 -max 0.60059 --mean 0.124319 --stdDev 0.0350922 
-min -0.0308992 -max 0.572593 --mean 0.123665 --stdDev 0.0308838 
-min -0.197234 -max 0.620289 --mean 0.128406 --stdDev 0.0353955 
-min -0.0114275 -max 0.636907 --mean 0.125323 --stdDev 0.0319995 
-min 0.063293 -max 0.226574 --mean 0.11956 --stdDev 0.0187572 
-min 0.07592 -max 0.250311 --mean 0.122435 --stdDev 0.019505 
-min -0.00347078 -max 0.500646 --mean 0.127181 --stdDev 0.0314407 
-min 0.0270167 -max 0.394247 --mean 0.128143 --stdDev 0.0302831 
-min -0.0294599 -max 0.542999 --mean 0.125114 --stdDev 0.0315137 
-min 0.0247256 -max 0.229192 --mean 0.109571 --stdDev 0.0199349 
-min -0.234899 -max 0.79372 --mean 0.125687 --stdDev 0.0335479 
-min -0.526694 -max 0.911127 --mean 0.126048 --stdDev 0.0363183 
-min -0.105182 -max 0.686265 --mean 0.132825 --stdDev 0.030873 
-min -0.307845 -max 0.969288 --mean 0.132675 --stdDev 0.0423124 
-min -0.169741 -max 0.699102 --mean 0.135448 --stdDev 0.0472854 
-min -0.41313 -max 0.955517 --mean 0.168209 --stdDev 0.0908494 
-min -0.0180593 -max 0.620982 --mean 0.134354 --stdDev 0.0493728 
-min -0.186645 -max 0.349589 --mean 0.1139 --stdDev 0.037978 
</pre></div>
</div>
<p><strong>Extracting histograms for SAVI</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/*</span><span class="n">_SAVI_m</span><span class="o">.</span><span class="n">tif</span><span class="p">;</span> <span class="n">do</span>
<span class="n">filename</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">basename</span> <span class="err">$</span><span class="n">file</span> <span class="o">.</span><span class="n">tif</span> <span class="p">)</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">filename</span>
<span class="n">pkstat</span> <span class="o">-</span><span class="n">i</span> <span class="err">$</span><span class="n">file</span> <span class="o">-</span><span class="n">hist</span> <span class="o">-</span><span class="n">nbin</span> <span class="mi">20</span> <span class="o">-</span><span class="n">nodata</span> <span class="o">-</span><span class="mi">99</span> <span class="o">&gt;</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">filename</span><span class="p">}</span><span class="n">_h</span><span class="o">.</span><span class="n">txt</span> 
<span class="n">done</span>

</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">more</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="mi">897</span><span class="n">_crop_SAVI_m_h</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-0.002083286643 7
0.02986876667 154
0.06182081997 6017
0.09377287328 44899
0.1257249266 33275
0.1576769799 15828
0.1896290332 7138
0.2215810865 3958
0.2535331398 1774
0.2854851931 1003
0.3174372464 313
0.3493892998 218
0.3813413531 134
0.4132934064 86
0.4452454597 45
0.477197513 31
0.5091495663 20
0.5411016196 9
0.5730536729 5
0.6050057262 2
</pre></div>
</div>
</section>
</section>
<section id="generate-stacks-and-extract-statistics-in-pyjeo">
<h2><span class="section-number">2.7.3. </span>Generate stacks and extract statistics in Pyjeo<a class="headerlink" href="#generate-stacks-and-extract-statistics-in-pyjeo" title="Link to this heading"></a></h2>
<p>I wanted to try out Pyjeo after Dr. Pieter Kempeneers presentation (http://spatial-ecology.net/docs/build/html/PKTOOLS/pyjeo_introduction.html). I used it to calculate yearly mean, median, 90 percentil and standard deviation. Probably there are cleaner ways to do this with some more pyjeo-practice. One of workarounds I ended up using was creating a test* jim, and copied crs++ info from that to an “empty” jim that was “filled” with all my timesteps/planes. Later I used these layers when extracting information for random points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyjeo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/875_crop_SAVI_m.tif&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#del jim #delete if old jim exists</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">933</span><span class="p">,</span> <span class="n">otype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span> <span class="c1">#create jim object with one 1 empty plane</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copyGeoTransform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1">#get all crs from test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">())</span> <span class="c1">#show number of planes</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1600
[37.0, 18.86675, 37.4, 18.633499999999998]
{&#39;min&#39;: 0.0, &#39;max&#39;: 0.0, &#39;mean&#39;: 0.0}
1
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate over SAVI files in</span>
<span class="c1"># that directory</span>

<span class="c1">#check number of files/planes</span>
<span class="err">!</span><span class="n">ls</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="err">???</span><span class="n">_crop_SAVI_m</span><span class="o">.</span><span class="n">tif</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
<span class="c1">#sjekk denne sorteringen</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;???_crop_SAVI_m.tif&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">())</span> <span class="c1">#show number of planes</span>
<span class="c1">#remove first empty plane; probably better way to do this</span>
<span class="n">jim</span><span class="o">=</span><span class="n">jim</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">]]</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span> <span class="c1">#should be 23</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>23
24





23
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: -99.0, &#39;max&#39;: 0.9692878723144531, &#39;mean&#39;: -25.83536720275879}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate mean</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.0</span><span class="p">)</span> <span class="c1">#applied mask to all planes (more than 2D); &quot;reduce&quot; som i GEE</span>
<span class="n">mean</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: -0.02188333310186863,
 &#39;max&#39;: 0.5145996809005737,
 &#39;mean&#39;: 0.12636782228946686}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate median</span>
<span class="n">median</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
<span class="n">median</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: -0.006859873421490192,
 &#39;max&#39;: 0.5675770044326782,
 &#39;mean&#39;: 0.12463919818401337}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate stdev</span>
<span class="c1"># std.pixops.convert(&#39;GDT_Float32&#39;) #converts into float if needed</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="c1">#works as a placeholder for the std to be calculated</span>
<span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()</span><span class="o">==-</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#all 0 assign to nan</span>
<span class="n">stdnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#second data cube (1), starts at 0</span>
<span class="n">std</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">stdnp</span>
<span class="n">std</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: 0.001729343319311738,
 &#39;max&#39;: 0.2672453820705414,
 &#39;mean&#39;: 0.017469022423028946}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate quantiles</span>
<span class="n">per90</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()</span><span class="o">==-</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#all -99 assign to nan</span>
<span class="n">per90np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="mi">90</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">per90</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">per90np</span>
<span class="n">per90</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: 0.06932799518108368,
 &#39;max&#39;: 0.9273030161857605,
 &#39;mean&#39;: 0.14474131166934967}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">141</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">142</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">143</span><span class="p">)</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">std</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">per90</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">median</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_31_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#save to files</span>
<span class="n">mean</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/mean_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">median</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/median_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">std</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/std_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">per90</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/per90_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
</pre></div>
</div>
</section>
<section id="creating-topographical-and-hydrological-layers-in-grass">
<h2><span class="section-number">2.7.4. </span>2 Creating topographical and hydrological layers in GRASS<a class="headerlink" href="#creating-topographical-and-hydrological-layers-in-grass" title="Link to this heading"></a></h2>
<p>Requirements for GRASS to run</p>
<ul class="simple">
<li><p>make seperate folder under home/user/ to run GRASS</p></li>
<li><p>install addons for special algorithms, i.e. r.stream.order. Addons had to be downloaded from github to be installed due to changes in URL not implemented in current version of GRASS (7.8.5).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bash</span>  
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">grassdb</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">OSGeo</span><span class="o">/</span><span class="n">grass</span><span class="o">-</span><span class="n">addons</span><span class="o">.</span><span class="n">git</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span>
<span class="c1">#run GRASS to install extension  </span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">grass78</span> <span class="o">-</span><span class="n">text</span> <span class="n">grassdb</span><span class="o">/</span><span class="n">europe</span><span class="o">/</span><span class="n">PERMANENT</span><span class="o">/</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>  
<span class="n">g</span><span class="o">.</span><span class="n">extension</span> <span class="n">extension</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">basins</span>  <span class="n">url</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raster</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">basins</span><span class="o">/</span>  
<span class="n">g</span><span class="o">.</span><span class="n">extension</span> <span class="n">extension</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">distance</span>  <span class="n">url</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raster</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span>  
<span class="n">EOF</span> 
</pre></div>
</div>
<section id="download-srtm">
<h3><span class="section-number">2.7.4.1. </span>Download SRTM<a class="headerlink" href="#download-srtm" title="Link to this heading"></a></h3>
<p>SRTM data (version 3, 30m resolution) was downloaded from NASA earthdata.<br />
See https://wiki.earthdata.nasa.gov/display/EL/How+To+Access+Data+With+cURL+And+Wget<br />
Replace “user” and “password”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%%bash  
cd /home/user/  
touch .netrc  
echo &quot;machine urs.earthdata.nasa.gov login &lt;user&gt; password &lt;password&gt;&quot; &gt; .netrc  
chmod 0600 .netrc  
#### create cookie #### 
cd ~  
touch .urs_cookies  
##### download more files in one go and move to folder  ####
curl -O -b ~/.urs_cookies -c ~/.urs_cookies -L -n &quot;https://e4ftl01.cr.usgs.gov/MEASURES/SRTMGL1.003/2000.02.11/N18E0[36-37].SRTMGL1.hgt.zip&quot;  
mv N18* project/srtm/  
cd project/srtm/  
unzip &quot;*.zip&quot;  
##### to speed up convert to tiff ####  
for file in project/srtm/*.hgt; do  
  filename=$(basename $file .hgt)  
  gdal_translate -co COMPRESS=DEFLATE -co ZLEVEL=9 -co PREDICTOR=2 $file project/srtm/$filename.tif  
done  
</pre></div>
</div>
</section>
<section id="calculate-variables">
<h3><span class="section-number">2.7.4.2. </span>Calculate variables<a class="headerlink" href="#calculate-variables" title="Link to this heading"></a></h3>
<p>A number of topographic and hydrological explanatory variables are calculated in GRASS. Since some of the hydrological variables are depending on data for complete watersheds, region is readjusted to the smaller AOI (from landsat savi data) when the export is done (g.region). Distance from streams and stream junctions are also calculated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>
<span class="c1"># topidx don&#39;t work on lat lon data</span>
<span class="n">cp</span> <span class="n">project</span><span class="o">/</span><span class="n">srtm</span><span class="o">/</span><span class="n">N18E037</span><span class="o">.</span><span class="n">tif</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>
<span class="n">mkdir</span> <span class="n">grassout</span>

<span class="c1"># use the --tmp-location option to store a temporal location in the /tmp folder </span>
<span class="c1"># -f forces removal of gislock; --text - textbased GUI --tmp-location - temporary location deleted</span>
<span class="c1"># -c geofile - location based on that file</span>
<span class="c1"># opens a GRASS text interface where input is ended by EOF</span>
<span class="n">grass78</span>  <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">text</span> <span class="o">--</span><span class="n">tmp</span><span class="o">-</span><span class="n">location</span>  <span class="o">-</span><span class="n">c</span>  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">N18E037</span><span class="o">.</span><span class="n">tif</span>  <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> 

<span class="c1">#prints all env. settings</span>
<span class="c1">#debug 0 - silence</span>
<span class="n">g</span><span class="o">.</span><span class="n">gisenv</span> <span class="nb">set</span><span class="o">=</span><span class="s2">&quot;GRASS_VERBOSE=-1&quot;</span><span class="p">,</span><span class="s2">&quot;DEBUG=0&quot;</span>

<span class="n">echo</span>  <span class="s2">&quot;######## import the layers ########&quot;</span>
<span class="c1"># not imported, just registered as a grass dataset </span>
<span class="n">r</span><span class="o">.</span><span class="n">external</span> <span class="nb">input</span><span class="o">=</span><span class="n">N18E037</span><span class="o">.</span><span class="n">tif</span> <span class="n">output</span><span class="o">=</span><span class="n">elv</span> <span class="o">--</span><span class="n">o</span> <span class="o">--</span><span class="n">q</span> <span class="c1"># dem </span>
<span class="n">r</span><span class="o">.</span><span class="n">external</span> <span class="nb">input</span><span class="o">=</span><span class="n">landsat</span><span class="o">/</span><span class="n">SAVI</span><span class="o">.</span><span class="n">tif</span> <span class="n">output</span><span class="o">=</span><span class="n">savi</span> <span class="o">--</span><span class="n">o</span> <span class="o">--</span><span class="n">q</span>

<span class="n">echo</span>  <span class="s2">&quot;######## calculate topographic layers ########&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">slope</span><span class="o">.</span><span class="n">aspect</span> <span class="n">elevation</span><span class="o">=</span><span class="n">elv</span> <span class="n">slope</span><span class="o">=</span><span class="n">slope</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span> <span class="n">pcurvature</span><span class="o">=</span><span class="n">pcurv</span> <span class="n">tcurvature</span><span class="o">=</span><span class="n">tcurv</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span> <span class="n">dy</span><span class="o">=</span><span class="n">dy</span> <span class="n">dxx</span><span class="o">=</span><span class="n">dxx</span> <span class="n">dyy</span><span class="o">=</span><span class="n">dyy</span> <span class="n">dxy</span><span class="o">=</span><span class="n">dxy</span> <span class="o">--</span><span class="n">o</span>
<span class="c1">#r.topidx input=elv output=topidx --o</span>

<span class="n">echo</span> <span class="s2">&quot;######## estimating watershed ########&quot;</span>
<span class="c1">#threshold basinsize in number of pixels</span>
<span class="n">r</span><span class="o">.</span><span class="n">watershed</span> <span class="n">elevation</span><span class="o">=</span><span class="n">elv</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">2000</span> \
  <span class="n">accumulation</span><span class="o">=</span><span class="n">w_accum</span> \
  <span class="n">tci</span><span class="o">=</span><span class="n">w_tci</span> \
  <span class="n">spi</span><span class="o">=</span><span class="n">w_spi</span> \
  <span class="n">drainage</span><span class="o">=</span><span class="n">w_dr_dir</span> \
  <span class="n">basin</span><span class="o">=</span><span class="n">w_basin</span> \
  <span class="n">stream</span><span class="o">=</span><span class="n">w_stream_w2k</span> \
  <span class="n">length_slope</span><span class="o">=</span><span class="n">w_lSl</span> \
  <span class="n">slope_steepness</span><span class="o">=</span><span class="n">w_SlSt</span> \
  <span class="o">--</span><span class="n">o</span>

<span class="n">echo</span> <span class="s2">&quot;######## estimating distance from stream ########&quot;</span>
<span class="c1"># input should be from same function (r.watershed or r.stream..)</span>

<span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">distance</span> <span class="n">stream_rast</span><span class="o">=</span><span class="n">w_stream_w2k</span> \
  <span class="n">direction</span><span class="o">=</span><span class="n">w_dr_dir</span> \
  <span class="n">elevation</span><span class="o">=</span><span class="n">elv</span> \
  <span class="n">method</span><span class="o">=</span><span class="n">downstream</span> \
  <span class="n">distance</span><span class="o">=</span><span class="n">w_str_w2k_dist</span>

<span class="n">echo</span> <span class="s2">&quot;######## extract stream vector ########&quot;</span>
<span class="c1"># extract stream vector, including points for confluence</span>
<span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">extract</span> <span class="n">elevation</span><span class="o">=</span><span class="n">elv</span> \
  <span class="n">accumulation</span><span class="o">=</span><span class="n">w_accum</span> \
  <span class="n">threshold</span><span class="o">=</span><span class="mi">2000</span> \
  <span class="n">stream_vector</span><span class="o">=</span><span class="n">streamx_2kv</span> \
  <span class="o">--</span><span class="n">o</span>

<span class="n">echo</span> <span class="s2">&quot;######## info stream vector ########&quot;</span>
<span class="c1">#info about stream_v</span>
<span class="n">db</span><span class="o">.</span><span class="n">describe</span> <span class="o">-</span><span class="n">c</span> <span class="n">table</span><span class="o">=</span><span class="n">streamx_2kv</span>
<span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">rast</span> <span class="nb">input</span><span class="o">=</span><span class="n">streamx_2kv</span> <span class="nb">type</span><span class="o">=</span><span class="n">point</span> <span class="n">where</span><span class="o">=</span><span class="s2">&quot;type_code = 1&quot;</span> <span class="n">output</span><span class="o">=</span><span class="n">str_2kvj_r</span> <span class="n">use</span><span class="o">=</span><span class="n">attr</span> <span class="n">attribute_column</span><span class="o">=</span><span class="s2">&quot;type_code&quot;</span> 


<span class="n">echo</span> <span class="s2">&quot;######## estimating distance from junctions ########&quot;</span>
<span class="c1">#-m for meter</span>
<span class="n">r</span><span class="o">.</span><span class="n">grow</span><span class="o">.</span><span class="n">distance</span> <span class="o">-</span><span class="n">m</span> <span class="nb">input</span><span class="o">=</span><span class="n">str_2kvj_r</span> <span class="n">distance</span><span class="o">=</span><span class="n">str_2kvj_dist</span> <span class="n">metric</span><span class="o">=</span><span class="n">geodesic</span>


<span class="n">echo</span> <span class="s2">&quot;######## exporting products ########&quot;</span>
<span class="c1">#export multiple rasterfiles - exclude elv from the list</span>
<span class="n">g</span><span class="o">.</span><span class="n">region</span> <span class="n">raster</span><span class="o">=</span><span class="n">savi</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="err">$</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">list</span> <span class="nb">type</span><span class="o">=</span><span class="n">raster</span> <span class="p">);</span> <span class="n">do</span> 
   <span class="n">r</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">gdal</span> <span class="o">--</span><span class="n">o</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">createopt</span><span class="o">=</span><span class="s2">&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="n">Float64</span> <span class="n">nodata</span><span class="o">=</span><span class="mi">999999999</span> <span class="nb">format</span><span class="o">=</span><span class="n">GTiff</span> <span class="nb">input</span><span class="o">=</span><span class="err">$</span><span class="n">file</span>  <span class="n">output</span><span class="o">=</span><span class="n">grassout</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">file</span><span class="p">}</span><span class="o">.</span><span class="n">tif</span> 
<span class="n">done</span>
<span class="n">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="extract-statistics-for-random-points">
<h2><span class="section-number">2.7.5. </span>3 Extract statistics for random points<a class="headerlink" href="#extract-statistics-for-random-points" title="Link to this heading"></a></h2>
<p>Random points are created within classes of SAVI_mean to make sure the whole range of SAVI values are represented. The SAVI classes are based on the histogram with 20 bins. Classfication of SAVI is done in GRASS using a file with the recoding values. Awk is used to generate the recode.txt file, that should .
have the following format:</p>
<p>1:1:1.1:1.1 #from_start:from_end:to_start:to_end, where to_start=to_end for classes.</p>
<p>Random points are generated with pkextractimg.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#del jim</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/mean_pyjeo.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;min&#39;: -0.02188333310186863,
 &#39;max&#39;: 0.5159205794334412,
 &#39;mean&#39;: 0.1263299584388733}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">output</span><span class="o">.</span><span class="n">txt</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">(</span><span class="s1">&#39;histogram&#39;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">src_min</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">src_max</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1">#make recode rules from txt-file</span>

paste<span class="w"> </span>-d<span class="s2">&quot;:&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>output.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n19<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span>awk<span class="w"> </span><span class="s1">&#39;NR&gt;1{print $1}&#39;</span><span class="w"> </span>output.txt<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..19<span class="o">})</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..19<span class="o">})</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="w"> </span>rules.txt
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">wc</span> <span class="o">-</span><span class="n">l</span> <span class="n">rules</span><span class="o">.</span><span class="n">txt</span>
<span class="err">!</span><span class="n">more</span> <span class="n">rules</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>19 rules.txt
-0.08375:-0.05125:1:1
-0.05125:-0.01875:2:2
-0.01875:0.01375:3:3
0.01375:0.04625:4:4
0.04625:0.07875:5:5
0.07875:0.11125:6:6
0.11125:0.14375:7:7
0.14375:0.17625:8:8
0.17625:0.20875:9:9
0.20875:0.24125:10:10
0.24125:0.27375:11:11
0.27375:0.30625:12:12
0.30625:0.33875:13:13
0.33875:0.37125:14:14
0.37125:0.40375:15:15
0.40375:0.43625:16:16
0.43625:0.46875:17:17
0.46875:0.50125:18:18
0.50125:0.53375:19:19
</pre></div>
</div>
<p><strong>classify SAVI with GRASS</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>

<span class="n">cp</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>

<span class="n">grass78</span>  <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">text</span> <span class="o">--</span><span class="n">tmp</span><span class="o">-</span><span class="n">location</span>  <span class="o">-</span><span class="n">c</span>  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span>  <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> 
<span class="n">g</span><span class="o">.</span><span class="n">gisenv</span> <span class="nb">set</span><span class="o">=</span><span class="s2">&quot;GRASS_VERBOSE=-1&quot;</span><span class="p">,</span><span class="s2">&quot;DEBUG=0&quot;</span>

<span class="n">echo</span> <span class="s2">&quot;######## import the layers #############&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">external</span> <span class="nb">input</span><span class="o">=</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI</span> <span class="o">--</span><span class="n">o</span> <span class="o">--</span><span class="n">q</span> <span class="c1"># dem </span>

<span class="n">echo</span> <span class="s2">&quot;######## recode SAVI 30classes #############&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">recode</span> <span class="nb">input</span><span class="o">=</span><span class="n">SAVI</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI_c</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="o">.</span><span class="n">txt</span>

<span class="n">r</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">gdal</span> <span class="o">--</span><span class="n">o</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">createopt</span><span class="o">=</span><span class="s2">&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot;</span> <span class="nb">format</span><span class="o">=</span><span class="n">GTiff</span> <span class="nb">input</span><span class="o">=</span><span class="n">SAVI_c</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI_c</span><span class="o">.</span><span class="n">tif</span>

<span class="n">EOF</span>
</pre></div>
</div>
<p><strong>create random points</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pkextractimg</span> <span class="o">-</span><span class="n">i</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> \
    <span class="o">-</span><span class="n">s</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">SAVI_c</span><span class="o">.</span><span class="n">tif</span> \
    <span class="o">-</span><span class="n">o</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">random</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">-</span><span class="n">t</span> <span class="mi">5</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">ogrinfo</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">random</span><span class="o">.</span><span class="n">sqlite</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>	- &#39;VirtualXPath&#39;	[XML Path Language - XPath]
INFO: Open of `project/glad_ard/random.sqlite&#39;
      using driver `SQLite&#39; successful.
1: training data (Point)
</pre></div>
</div>
<section id="extract-values-for-response-and-predictor-variables">
<h3><span class="section-number">2.7.5.1. </span>Extract values for response and predictor variables<a class="headerlink" href="#extract-values-for-response-and-predictor-variables" title="Link to this heading"></a></h3>
<p>In this part values for predictors and response variables for all random points are extracted. I’m using pyjeo for this part. Since stacking requires the datasets to be same datatype as well as CRS, extraction is done separately for response and predictors.</p>
<p><strong>Repsonse variable</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">jim</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">933</span><span class="p">,</span> <span class="n">otype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span> <span class="c1">#create empty jim object</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copyGeoReference</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>

<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*pyjeo.tif&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span> <span class="c1">#show number of planes</span>
<span class="n">jim</span><span class="o">=</span><span class="n">jim</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="c1">#select last 4 planes</span>

</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1600
[37.0, 18.86675, 37.4, 18.633499999999998]
{&#39;min&#39;: 0.0, &#39;max&#39;: 0.0, &#39;mean&#39;: 0.0}
[PosixPath(&#39;project/glad_ard/mean_pyjeo.tif&#39;), PosixPath(&#39;project/glad_ard/median_pyjeo.tif&#39;), PosixPath(&#39;project/glad_ard/per90_pyjeo.tif&#39;), PosixPath(&#39;project/glad_ard/std_pyjeo.tif&#39;)]
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#check CRS for layers</span>
<span class="err">!</span><span class="n">ogrinfo</span> <span class="o">-</span><span class="n">so</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">random</span><span class="o">.</span><span class="n">sqlite</span> <span class="s1">&#39;training data&#39;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;EPSG&#39;</span>
<span class="err">!</span><span class="n">gdalinfo</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;EPSG&#39;</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getProjection</span><span class="p">()</span>
<span class="c1">#test.properties.getProjection()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    ID[&quot;EPSG&quot;,4326]]





&#39;GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]&#39;
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/random.sqlite&#39;</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/temp.sqlite&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted1</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
<span class="n">savi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted1</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<span class="n">savi</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/savi.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Predictor variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">jim</span> <span class="c1">#if old jim exists</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">()</span> <span class="c1">#show number of planes; i.e. timesteps</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no of planes, columns and rows:&#39;</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>no of planes, columns and rows: 1 1600 933
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[37.0, 18.86675, 37.4, 18.633499999999998]
{&#39;min&#39;: 6.0, &#39;max&#39;: 1530.0, &#39;mean&#39;: 576.3270136655949}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>
<span class="c1">#planes to be added</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">grassout</span><span class="o">/*.</span><span class="n">tif</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span> 
<span class="c1">#check that all rasters are same datatype</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">grassout</span><span class="o">/*.</span><span class="n">tif</span><span class="p">;</span> <span class="n">do</span>
  <span class="n">echo</span> <span class="err">$</span><span class="n">file</span>
  <span class="n">gdalinfo</span> <span class="err">$</span><span class="n">file</span> <span class="o">-</span><span class="n">stats</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;Type&#39;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print $4}&#39;</span>
<span class="n">done</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate over tif files in</span>
<span class="c1"># that directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.tif&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="n">planes</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">()</span> 
<span class="n">row</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no of files, no of planes, columns and rows:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">planes</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/aspect.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dx.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dxx.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dxy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dyy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/pcurv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/savi.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/slope.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_r.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/tcurv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_SlSt.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_accum.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_basin.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_dr_dir.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_lSl.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_spi.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_stream_w2k.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_tci.tif&#39;)]
no of files, no of planes, columns and rows: 22 23 1600 933
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">ogrinfo</span> <span class="o">-</span><span class="n">so</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">random</span><span class="o">.</span><span class="n">sqlite</span> <span class="s1">&#39;training data&#39;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;EPSG&#39;</span>
<span class="c1"># confirm that CRS is the same</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getProjection</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    ID[&quot;EPSG&quot;,4326]]





&#39;GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]&#39;
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/random.sqlite&#39;</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/temp1.sqlite&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted3</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="mi">999999999</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted3</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<span class="n">topo</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/predictors.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topo</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>b</th>
      <th>t0b0</th>
      <th>t1b0</th>
      <th>t2b0</th>
      <th>t3b0</th>
      <th>t4b0</th>
      <th>t5b0</th>
      <th>t6b0</th>
      <th>...</th>
      <th>t13b0</th>
      <th>t14b0</th>
      <th>t15b0</th>
      <th>t16b0</th>
      <th>t17b0</th>
      <th>t18b0</th>
      <th>t19b0</th>
      <th>t20b0</th>
      <th>t21b0</th>
      <th>t22b0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>0.097008</td>
      <td>760.0</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>...</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>1.000000e+09</td>
      <td>8.741459</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>0.082413</td>
      <td>793.0</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>...</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>1.000000e+09</td>
      <td>7.134220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>0.082921</td>
      <td>808.0</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>...</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>1.000000e+09</td>
      <td>6.180274</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>0.106816</td>
      <td>877.0</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>...</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>1.000000e+09</td>
      <td>5.899572</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>0.114286</td>
      <td>898.0</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>...</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>1.000000e+09</td>
      <td>5.373617</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div>
</section>
</section>
<section id="modelling-vegetation">
<h2><span class="section-number">2.7.6. </span>4 Modelling vegetation<a class="headerlink" href="#modelling-vegetation" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> <span class="c1">#raster processing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspatialml</span><span class="w"> </span><span class="kn">import</span> <span class="n">Raster</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span><span class="n">GridSearchCV</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">6.5</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</pre></div>
</div>
<section id="prepare-table">
<h3><span class="section-number">2.7.6.1. </span>Prepare table<a class="headerlink" href="#prepare-table" title="Link to this heading"></a></h3>
<p><strong>import table and rename predictor variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#read data using panda</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/predictors.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>  <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">columns</span>

</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;fid&#39;, &#39;label&#39;, &#39;b&#39;, &#39;t0b0&#39;, &#39;t1b0&#39;, &#39;t2b0&#39;, &#39;t3b0&#39;,
       &#39;t4b0&#39;, &#39;t5b0&#39;, &#39;t6b0&#39;, &#39;t7b0&#39;, &#39;t8b0&#39;, &#39;t9b0&#39;, &#39;t10b0&#39;, &#39;t11b0&#39;,
       &#39;t12b0&#39;, &#39;t13b0&#39;, &#39;t14b0&#39;, &#39;t15b0&#39;, &#39;t16b0&#39;, &#39;t17b0&#39;, &#39;t18b0&#39;, &#39;t19b0&#39;,
       &#39;t20b0&#39;, &#39;t21b0&#39;, &#39;t22b0&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">ls</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">grassout</span><span class="o">/*.</span><span class="n">tif</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">n1</span> <span class="n">basename</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aspect.tif
dx.tif
dxx.tif
dxy.tif
dy.tif
dyy.tif
elv.tif
pcurv.tif
savi.tif
slope.tif
str_2kvj_dist.tif
str_2kvj_r.tif
tcurv.tif
w_accum.tif
w_basin.tif
w_dr_dir.tif
w_lSl.tif
w_SlSt.tif
w_spi.tif
w_stream_w2k.tif
w_str_w2k_dist.tif
w_tci.tif
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/aspect.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dx.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dxx.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dxy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/dyy.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/pcurv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/savi.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/slope.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_r.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/tcurv.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_SlSt.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_accum.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_basin.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_dr_dir.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_lSl.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_spi.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_stream_w2k.tif&#39;), PosixPath(&#39;/home/user/my_SE_data/exercise/grassout/w_tci.tif&#39;)]





22
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#PS! sorting gave different results for jim object and in bash (capital letters?)</span>
<span class="n">names_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxy&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dyy&#39;</span><span class="p">,</span> <span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;pcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;savi&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_r&#39;</span><span class="p">,</span> <span class="s1">&#39;tcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_SlSt&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">,</span>
              <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;w_dr_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;w_lSl&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_stream_w2k&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">names_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
<span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;fid&#39;, &#39;label&#39;, &#39;b&#39;, &#39;t0b0&#39;, &#39;t1b0&#39;, &#39;t2b0&#39;, &#39;t3b0&#39;,
       &#39;t4b0&#39;, &#39;t5b0&#39;, &#39;t6b0&#39;, &#39;t7b0&#39;, &#39;t8b0&#39;, &#39;t9b0&#39;, &#39;t10b0&#39;, &#39;t11b0&#39;,
       &#39;t12b0&#39;, &#39;t13b0&#39;, &#39;t14b0&#39;, &#39;t15b0&#39;, &#39;t16b0&#39;, &#39;t17b0&#39;, &#39;t18b0&#39;, &#39;t19b0&#39;,
       &#39;t20b0&#39;, &#39;t21b0&#39;, &#39;t22b0&#39;],
      dtype=&#39;object&#39;)





27
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">names_list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;fid&#39;, &#39;label&#39;, &#39;b&#39;, &#39;t0b0&#39;, &#39;aspect&#39;, &#39;dx&#39;, &#39;dxx&#39;, &#39;dxy&#39;,
       &#39;dy&#39;, &#39;dyy&#39;, &#39;elv&#39;, &#39;pcurv&#39;, &#39;savi&#39;, &#39;slope&#39;, &#39;str_2kvj_dist&#39;,
       &#39;str_2kvj_r&#39;, &#39;tcurv&#39;, &#39;w_SlSt&#39;, &#39;w_accum&#39;, &#39;w_basin&#39;, &#39;w_dr_dir&#39;,
       &#39;w_lSl&#39;, &#39;w_spi&#39;, &#39;w_str_w2k_dist&#39;, &#39;w_stream_w2k&#39;, &#39;w_tci&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>74610
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>fid</th>
      <th>label</th>
      <th>b</th>
      <th>t0b0</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>savi</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>str_2kvj_r</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_stream_w2k</th>
      <th>w_tci</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>11</td>
      <td>0.097008</td>
      <td>760.0</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>0.086638</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>1.000000e+09</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>1.000000e+09</td>
      <td>8.741459</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>10</td>
      <td>0.082413</td>
      <td>793.0</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>0.083820</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>1.000000e+09</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>1.000000e+09</td>
      <td>7.134220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2</td>
      <td>10</td>
      <td>0.082921</td>
      <td>808.0</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>0.083765</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>1.000000e+09</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>1.000000e+09</td>
      <td>6.180274</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3</td>
      <td>11</td>
      <td>0.106816</td>
      <td>877.0</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>0.130181</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>1.000000e+09</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>1.000000e+09</td>
      <td>5.899572</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>4</td>
      <td>11</td>
      <td>0.114286</td>
      <td>898.0</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>0.139849</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>1.000000e+09</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>1.000000e+09</td>
      <td>5.373617</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>Cleaing up table and calculate some new variables</strong><br />
Columns that will not be used in the modelling is deleted from the table. Aspect is a circular variable and is linearised by calculating its sine and cosine. w_basin is a categorical value and to test whether it is treated correctly and meaningful its values are shuffled (basin_shuf).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;w_stream_w2k&#39;</span><span class="p">,</span> <span class="s1">&#39;savi&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_r&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;fid&#39;, &#39;label&#39;, &#39;aspect&#39;, &#39;dx&#39;, &#39;dxx&#39;, &#39;dxy&#39;, &#39;dy&#39;, &#39;dyy&#39;, &#39;elv&#39;,
       &#39;pcurv&#39;, &#39;slope&#39;, &#39;str_2kvj_dist&#39;, &#39;tcurv&#39;, &#39;w_SlSt&#39;, &#39;w_accum&#39;,
       &#39;w_basin&#39;, &#39;w_dr_dir&#39;, &#39;w_lSl&#39;, &#39;w_spi&#39;, &#39;w_str_w2k_dist&#39;, &#39;w_tci&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#linearise aspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;cos_asp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]))</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;sin_asp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#shuffle categorical basin-variable</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;basin_shuf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;w_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>cos_asp</th>
      <th>sin_asp</th>
      <th>basin_shuf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>8.741459</td>
      <td>-0.977232</td>
      <td>0.212176</td>
      <td>7490.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>7.134220</td>
      <td>-0.993378</td>
      <td>-0.114896</td>
      <td>1646.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>6.180274</td>
      <td>-0.990586</td>
      <td>-0.136890</td>
      <td>6642.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>5.899572</td>
      <td>-0.713425</td>
      <td>0.700731</td>
      <td>1154.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>5.373617</td>
      <td>-0.100492</td>
      <td>0.994938</td>
      <td>1172.0</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>import response variable and join to predictors</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#read response using panda</span>
<span class="n">savi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/savi.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>  <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">savi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">savi</span> <span class="o">=</span> <span class="n">savi</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;t0b0&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;t1b0&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;t2b0&#39;</span><span class="p">:</span><span class="s1">&#39;per90&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;t3b0&#39;</span><span class="p">:</span><span class="s1">&#39;std&#39;</span>
                    <span class="p">}</span> <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="n">savi</span> <span class="o">=</span> <span class="n">savi</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">savi</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">savi</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">savi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;fid&#39;, &#39;label&#39;, &#39;b&#39;, &#39;t0b0&#39;, &#39;t1b0&#39;, &#39;t2b0&#39;, &#39;t3b0&#39;], dtype=&#39;object&#39;)
74610
Index([&#39;fid&#39;, &#39;mean&#39;, &#39;median&#39;, &#39;per90&#39;, &#39;std&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">savi</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>74610
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>mean</th>
      <th>median</th>
      <th>per90</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>8.741459</td>
      <td>0.097008</td>
      <td>0.094664</td>
      <td>0.117911</td>
      <td>0.016844</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>7.134220</td>
      <td>0.082413</td>
      <td>0.082888</td>
      <td>0.101135</td>
      <td>0.020149</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>6.180274</td>
      <td>0.082921</td>
      <td>0.078278</td>
      <td>0.113270</td>
      <td>0.023337</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>5.899572</td>
      <td>0.106816</td>
      <td>0.104386</td>
      <td>0.123099</td>
      <td>0.014474</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>5.373617</td>
      <td>0.114286</td>
      <td>0.117651</td>
      <td>0.129462</td>
      <td>0.015016</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>cos_asp</th>
      <th>sin_asp</th>
      <th>basin_shuf</th>
      <th>mean</th>
      <th>median</th>
      <th>per90</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>37333.886986</td>
      <td>11.610481</td>
      <td>6.837265e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>575.752379</td>
      <td>6.835545e+05</td>
      <td>6.835639e+05</td>
      <td>1244.034957</td>
      <td>6.835545e+05</td>
      <td>6.898900</td>
      <td>156.125340</td>
      <td>1.102226e+07</td>
      <td>4.388795</td>
      <td>0.041021</td>
      <td>6.843058e+05</td>
      <td>1.101833e+07</td>
      <td>6.835616e+05</td>
      <td>0.149895</td>
      <td>0.070254</td>
      <td>1.102226e+07</td>
      <td>0.126390</td>
      <td>0.124655</td>
      <td>0.144773</td>
      <td>0.017460</td>
    </tr>
    <tr>
      <th>std</th>
      <td>21553.426532</td>
      <td>0.961089</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>419.481320</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>831.669605</td>
      <td>2.613611e+07</td>
      <td>8.035924</td>
      <td>11065.900632</td>
      <td>1.043836e+08</td>
      <td>2.454120</td>
      <td>0.024518</td>
      <td>2.613610e+07</td>
      <td>1.043841e+08</td>
      <td>2.613611e+07</td>
      <td>0.700993</td>
      <td>0.693699</td>
      <td>1.043836e+08</td>
      <td>0.033416</td>
      <td>0.031926</td>
      <td>0.045378</td>
      <td>0.013877</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>9.000000</td>
      <td>0.000000e+00</td>
      <td>-1.344040e+00</td>
      <td>-1.182164e-01</td>
      <td>-2.553215e-02</td>
      <td>-1.341612e+00</td>
      <td>-5.341714e-02</td>
      <td>8.000000</td>
      <td>-3.485471e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>-4.527013e-02</td>
      <td>0.030000</td>
      <td>-518632.187500</td>
      <td>2.980000e+02</td>
      <td>-4.000000</td>
      <td>0.025332</td>
      <td>1.446173e-01</td>
      <td>0.000000e+00</td>
      <td>1.318053e+00</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>2.980000e+02</td>
      <td>0.018881</td>
      <td>0.029393</td>
      <td>0.071009</td>
      <td>0.002483</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>18669.250000</td>
      <td>11.000000</td>
      <td>6.651141e+01</td>
      <td>-2.985837e-02</td>
      <td>-1.551966e-03</td>
      <td>-5.554170e-04</td>
      <td>-3.658877e-02</td>
      <td>-1.410363e-03</td>
      <td>171.000000</td>
      <td>-1.434810e-03</td>
      <td>1.847334e+00</td>
      <td>585.213623</td>
      <td>-1.201079e-03</td>
      <td>0.030000</td>
      <td>1.378385</td>
      <td>1.468000e+03</td>
      <td>2.000000</td>
      <td>0.030000</td>
      <td>2.121571e+00</td>
      <td>2.781997e+02</td>
      <td>5.179891e+00</td>
      <td>-0.532889</td>
      <td>-0.614763</td>
      <td>1.468000e+03</td>
      <td>0.106657</td>
      <td>0.105575</td>
      <td>0.119463</td>
      <td>0.009773</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>37334.500000</td>
      <td>11.000000</td>
      <td>1.623830e+02</td>
      <td>1.279920e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.065462e-03</td>
      <td>0.000000e+00</td>
      <td>452.000000</td>
      <td>-1.332938e-04</td>
      <td>4.606714e+00</td>
      <td>1060.480957</td>
      <td>1.762322e-19</td>
      <td>0.030000</td>
      <td>2.929744</td>
      <td>7.130000e+03</td>
      <td>5.000000</td>
      <td>0.030000</td>
      <td>9.361089e+00</td>
      <td>8.213889e+02</td>
      <td>6.182429e+00</td>
      <td>0.310322</td>
      <td>0.123289</td>
      <td>7.130000e+03</td>
      <td>0.119984</td>
      <td>0.119425</td>
      <td>0.133374</td>
      <td>0.012945</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>55997.750000</td>
      <td>12.000000</td>
      <td>2.785243e+02</td>
      <td>5.974620e-02</td>
      <td>1.359604e-03</td>
      <td>5.553937e-04</td>
      <td>4.878521e-02</td>
      <td>1.234086e-03</td>
      <td>1037.000000</td>
      <td>1.057664e-03</td>
      <td>1.578789e+01</td>
      <td>1755.921539</td>
      <td>1.408627e-03</td>
      <td>16.299999</td>
      <td>10.037903</td>
      <td>7.732000e+03</td>
      <td>7.000000</td>
      <td>0.040093</td>
      <td>3.752013e+01</td>
      <td>1.587121e+03</td>
      <td>8.189266e+00</td>
      <td>0.826665</td>
      <td>0.732041</td>
      <td>7.732000e+03</td>
      <td>0.139325</td>
      <td>0.138246</td>
      <td>0.155657</td>
      <td>0.019381</td>
    </tr>
    <tr>
      <th>max</th>
      <td>74664.000000</td>
      <td>19.000000</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1523.000000</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>4256.849121</td>
      <td>1.000000e+09</td>
      <td>16.299999</td>
      <td>207631.109375</td>
      <td>1.000000e+09</td>
      <td>8.000000</td>
      <td>0.409775</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000e+09</td>
      <td>0.404548</td>
      <td>0.414857</td>
      <td>0.674392</td>
      <td>0.238861</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>Check for and remove nan-values</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#predictors.describe()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>False





False
</pre></div>
</div>
<p><strong>checking covariance for some variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_sample</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;w_basin&quot;</span><span class="p">,</span> <span class="s2">&quot;elv&quot;</span><span class="p">,</span> <span class="s2">&quot;str_2kvj_dist&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">predictors_sample</span> <span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">plot_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">scatter_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_85_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">((</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="n">bins</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_86_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span> <span class="c1">#get names</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;fid&#39;, &#39;label&#39;, &#39;aspect&#39;, &#39;dx&#39;, &#39;dxx&#39;, &#39;dxy&#39;, &#39;dy&#39;, &#39;dyy&#39;, &#39;elv&#39;,
       &#39;pcurv&#39;, &#39;slope&#39;, &#39;str_2kvj_dist&#39;, &#39;tcurv&#39;, &#39;w_SlSt&#39;, &#39;w_accum&#39;,
       &#39;w_basin&#39;, &#39;w_dr_dir&#39;, &#39;w_lSl&#39;, &#39;w_spi&#39;, &#39;w_str_w2k_dist&#39;, &#39;w_tci&#39;,
       &#39;cos_asp&#39;, &#39;sin_asp&#39;, &#39;basin_shuf&#39;, &#39;mean&#39;, &#39;median&#39;, &#39;per90&#39;, &#39;std&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(74610, 28)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#remove savi related and stream_j_dist</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#response variable</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">24</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([&#39;mean&#39;], dtype=object)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;aspect&#39; &#39;dx&#39; &#39;dxx&#39; &#39;dxy&#39; &#39;dy&#39; &#39;dyy&#39; &#39;elv&#39; &#39;pcurv&#39; &#39;slope&#39;
 &#39;str_2kvj_dist&#39; &#39;tcurv&#39; &#39;w_accum&#39; &#39;w_basin&#39; &#39;w_lSl&#39; &#39;w_spi&#39;
 &#39;w_str_w2k_dist&#39; &#39;w_tci&#39; &#39;cos_asp&#39; &#39;sin_asp&#39; &#39;basin_shuf&#39;]
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(74610,)
(74610, 20)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([0.09700802, 0.08241346, 0.0829206 , ..., 0.13141605, 0.12182923,
       0.11685393])
</pre></div>
</div>
<p><strong>split data into test and training dataset</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="c1">#id. training and testing; split 50/50</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="random-forest">
<h3><span class="section-number">2.7.6.2. </span>Random forest<a class="headerlink" href="#random-forest" title="Link to this heading"></a></h3>
<p>Random forest is defined and then run with different settings to find the best model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="c1">#default parameters - should be tuned! - not needed in R</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;bootstrap&#39;: True,
 &#39;ccp_alpha&#39;: 0.0,
 &#39;criterion&#39;: &#39;mse&#39;,
 &#39;max_depth&#39;: None,
 &#39;max_features&#39;: &#39;auto&#39;,
 &#39;max_leaf_nodes&#39;: None,
 &#39;max_samples&#39;: None,
 &#39;min_impurity_decrease&#39;: 0.0,
 &#39;min_impurity_split&#39;: None,
 &#39;min_samples_leaf&#39;: 1,
 &#39;min_samples_split&#39;: 2,
 &#39;min_weight_fraction_leaf&#39;: 0.0,
 &#39;n_estimators&#39;: 100,
 &#39;n_jobs&#39;: None,
 &#39;oob_score&#39;: False,
 &#39;random_state&#39;: 42,
 &#39;verbose&#39;: 0,
 &#39;warm_start&#39;: False}
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first tried with this default setting rfReg = RandomForestRegressor(min_samples_leaf=50, oob_score=True)</span>
<span class="c1"># after running chunks below, these settings seems to better fit the data. </span>
<span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
<span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pearsonr_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1">#training vs pred R</span>
<span class="n">pearsonr_all</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[0.9151073853228917, 0.8930071550321135]
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the oob score</span>
<span class="n">rfReg</span><span class="o">.</span><span class="n">oob_score_</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.7825391349776363
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;training SAVI mean (all rows)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;training prediction&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f374ad840d0&gt;]
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_99_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> 
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([13,  5,  3, 19,  7, 10,  2, 18,  0, 17, 11, 14, 16,  4,  8,  1, 15,
        9,  6, 12])
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#feature importance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">impt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">feat</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_102_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">src1</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_basin.tif&quot;</span><span class="p">)</span>
<span class="n">src2</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/elv.tif&quot;</span><span class="p">)</span>
<span class="n">src3</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&quot;</span><span class="p">)</span>
<span class="n">src4</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/landsat/mean_pyjeo.tif&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">src1p</span><span class="p">,</span><span class="n">src2p</span><span class="p">,</span><span class="n">src3p</span><span class="p">,</span> <span class="n">src4p</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">show</span><span class="p">(</span><span class="n">src1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src1p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;basins&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src2p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;elevation&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src3p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;str_2kvj_dist&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src4p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;mean SAVI&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f374abeb910&gt;
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_103_1.png" /></p>
</section>
<section id="random-forest-tuning">
<h3><span class="section-number">2.7.6.3. </span>Random Forest tuning<a class="headerlink" href="#random-forest-tuning" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>“max_features”: number of features to consider when looking for the best split.</p></li>
<li><p>“max_samples”: number of samples to draw from X to train each base estimator.</p></li>
<li><p>“n_estimators”: identify the number of trees that must grow. It must be large enough so that the error is stabilized. Defoult 100.</p></li>
<li><p>“max_depth”: max number of levels in each decision tree.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of n_estimators for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Prediction Accuracy&#39;)
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_105_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of n_estimators for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Prediction Accuracy&#39;)
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_106_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of min_samples_leaf for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>

<span class="c1">#    rfReg = RandomForestRegressor(n_estimators=80, min_samples_leaf=80, max_features=0.33, max_depth=50, max_samples=0.7,n_jobs=-1,random_state=42 , oob_score = True)</span>

</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Prediction Accuracy&#39;)
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_107_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of max_features for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>

<span class="c1">#    rfReg = RandomForestRegressor(n_estimators=80, min_samples_leaf=80, max_features=0.33, max_depth=50, max_samples=0.7,n_jobs=-1,random_state=42 , oob_score = True)</span>

</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Prediction Accuracy&#39;)
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_108_1.png" /></p>
</section>
<section id="predict-on-the-raster-using-pyspatialml">
<h3><span class="section-number">2.7.6.4. </span>Predict on the raster using pyspatialml<a class="headerlink" href="#predict-on-the-raster-using-pyspatialml" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">Pyspatialml</span></code></p>
<p><strong>prediction with most important variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">]]</span> <span class="c1">#remove savi related and stream_j_dist</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]</span> <span class="c1">#response variable</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
<span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([&#39;mean&#39;], dtype=object)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="c1">#id. training and testing; split 50/50</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
<span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pearsonr_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1">#training vs pred R</span>
<span class="n">pearsonr_all</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[0.9133764136610967, 0.8939919955832134]
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the oob score</span>
<span class="n">rfReg</span><span class="o">.</span><span class="n">oob_score_</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.7855745474283174
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;training SAVI mean (all rows)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;training prediction&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f371abf8910&gt;]
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_115_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> 
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([8, 9, 7, 5, 6, 4, 3, 2, 0, 1])
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#feature importance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">impt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">feat</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_118_0.png" /></p>
<p><strong>import and stack datasets for prediction</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import datasets</span>
<span class="n">elv</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/elv.tif&quot;</span><span class="p">)</span>
<span class="n">w_basin</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_basin.tif&quot;</span><span class="p">)</span>
<span class="n">str_2kvj_dist</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&quot;</span><span class="p">)</span>
<span class="n">w_str_w2k_dist</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&quot;</span><span class="p">)</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/dx.tif&quot;</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/dy.tif&quot;</span><span class="p">)</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/slope.tif&quot;</span><span class="p">)</span>
<span class="n">w_tci</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_tci.tif&quot;</span><span class="p">)</span>
<span class="n">w_spi</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_spi.tif&quot;</span><span class="p">)</span>
<span class="n">w_accum</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_accum.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_rasters</span> <span class="o">=</span> <span class="p">[</span><span class="n">elv</span><span class="p">,</span> <span class="n">w_basin</span><span class="p">,</span> <span class="n">str_2kvj_dist</span><span class="p">,</span> <span class="n">w_str_w2k_dist</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">w_tci</span><span class="p">,</span> <span class="n">w_spi</span><span class="p">,</span> <span class="n">w_accum</span><span class="p">]</span>
<span class="n">stack</span> <span class="o">=</span> <span class="n">Raster</span><span class="p">(</span><span class="n">predictors_rasters</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">rfReg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot regression result</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;plasma&quot;</span>
<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_123_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/landsat/mean_pyjeo.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_124_0.png" /></p>
</section>
</section>
<section id="follow-up">
<h2><span class="section-number">2.7.7. </span>5 Follow up<a class="headerlink" href="#follow-up" title="Link to this heading"></a></h2>
<p>This case study was primarily for learning the tools and how bash, python, grass etc can be combined in one environment. Obviously there are many improvements that can be done for the case study itself. Some are listed below</p>
<ul class="simple">
<li><p>consider more explanatory variables and remove w_basin</p></li>
<li><p>test deep learning methods</p></li>
<li><p>look into other response variables that better catch the variability of the environment and try to distinguish among the long-lived and short-lived vegetation</p></li>
<li><p>expand the area to include larger environmental variability</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html" class="btn btn-neutral float-left" title="2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html" class="btn btn-neutral float-right" title="2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>