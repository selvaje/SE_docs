<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.7. Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba" href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html" />
    <link rel="prev" title="2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest" href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Spatial Ecology's code documentation
            <img src="../../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_geocomp_modelling_10-11_2022.html">GeoComp &amp; Modelling 2022 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Colab_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_curso_para_Ecologia_Espacial.html">Prepare OSGeoLive para el curso de ecología espacial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_introduction.html">Introdction to pyjeo: installation and raster visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pyjeo_pktools.html">Performing raster and vector operations in Python using pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_02SVM_pred.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred.html">Estimation of tree height using GEDI dataset - Perceptron 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_04Perceptron_pred_clean.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Tree_Height_05NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/CNN_satelite.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html">The real data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-Using-the-Window-Method">LSTM for Regression Using the Window Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-for-Regression-with-Time-Steps">LSTM for Regression with Time Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#LSTM-with-Memory-Between-Batches">LSTM with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Stacked-LSTMs-with-Memory-Between-Batches">Stacked LSTMs with Memory Between Batches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Adding-Early-Stopping">Adding Early Stopping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/LSTMs_tutorial.html#Multivariate-Time-series---Data">Multivariate Time-series - Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#matera">2. 2022 MATERA</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Damaged_trees_classification_RF_Janusz_Godziek.html">2.1. Janusz Godziek: Damaged vs undamaged trees - Random Forest classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Stream_Network_Abstraction_Alonso_Gonzalez.html">2.2. Alonso Gonzalez: Stream Network Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Images_shadow_removal_Sebastian_Walter.html">2.3. Sebastian Walter: Images shadow removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modelling_freshwater_biodiversity_setting_the_scene_from_geo-data_to_text-data_Jaime_Garc%C3%ADa_M%C3%A1rquez.html">2.4. Jaime García: Modelling freshwater biodiversity: setting the scene, from geo-data to text-data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Spectral_clustering_of_freshwater_habitats_Maria_%C3%9Cblacker.html">2.5. Maria Üblacker: Spectral clustering of freshwater habitats</a></li>
<li class="toctree-l2"><a class="reference internal" href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html">2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.7. Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">2.7.1. Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#glad-ard-landsat-images">2.7.2. 1 GLAD ARD Landsat images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-download">2.7.2.1. Data download</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-vegetation-index">2.7.2.2. Calculate vegetation index</a></li>
<li class="toctree-l4"><a class="reference internal" href="#masking-and-statistics">2.7.2.3. Masking and statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generate-stacks-and-extract-statistics-in-pyjeo">2.7.3. Generate stacks and extract statistics in Pyjeo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-topographical-and-hydrological-layers-in-grass">2.7.4. 2 Creating topographical and hydrological layers in GRASS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#download-srtm">2.7.4.1. Download SRTM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-variables">2.7.4.2. Calculate variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extract-statistics-for-random-points">2.7.5. 3 Extract statistics for random points</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extract-values-for-response-and-predictor-variables">2.7.5.1. Extract values for response and predictor variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modelling-vegetation">2.7.6. 4 Modelling vegetation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prepare-table">2.7.6.1. Prepare table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-forest">2.7.6.2. Random forest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-forest-tuning">2.7.6.3. Random Forest tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#predict-on-the-raster-using-pyspatialml">2.7.6.4. Predict on the raster using pyspatialml</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#follow-up">2.7.7. 5 Follow up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html">2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modeling_debris_flow_source_areas_Txomin_Bornaetxea.html">2.9. Txomin Bornaetxea: Modeling debris flow source areas</a></li>
<li class="toctree-l2"><a class="reference internal" href="Prediction_of_AGB_using_RFR_SVR_FFNN_Ritwika_Mukhopadhyay.html">2.10. Ritwika Mukhopadhyay: Comparative Analysis of the prediction of AGB using Random Forest Regression, Support Vector Machine for Regression &amp; FeedForward Neural Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="Clustering_Electric_Vehicle_Charging_Pattern_with_DTW_and_EV_Charging_energy_demand_Prediction_with_LSTM_Hyeyoung_Sim.html">2.11. Hyeyoung Sim: Clustering Electric Vehicle Charging Pattern with DTW and EV Charging energy demand Prediction with LSTM</a></li>
<li class="toctree-l2"><a class="reference internal" href="Classification_of_different_tree_species_plantations_using_deep_learning_Hemalatha_Velappan.html">2.12. Hemalatha Velappan: Classification of different tree species plantations using deep learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ships_and_economic_activity_a_starter_Myriam_Marending.html">2.13. Myriam Marending: Ships and economic activity: a starter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using_a_LSTM_network_and_SHAP_to_determine_the_impact_of_drought_Florian_Ells%C3%A4%C3%9Fer.html">2.14. Florian Ellsäßer: Using a LSTM network and SHAP to determine the impact of drought and season on winter wheat</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">1. </span>2021 SWEDEN</a> &raquo;</li>
      <li><span class="section-number">2.7. </span>Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/STUDENTSPROJECTS/Proj_2022_Matera/Topographic_and_hydrological_influence_on_vegetation_in_an_arid_environment_Gidske_L_Andersen.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="gidske-l-andersen-topographic-and-hydrological-influence-on-vegetation-in-an-arid-environment">
<h1><span class="section-number">2.7. </span>Gidske L. Andersen: Topographic and hydrological influence on vegetation in an arid environment<a class="headerlink" href="#gidske-l-andersen-topographic-and-hydrological-influence-on-vegetation-in-an-arid-environment" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://youtu.be/fM4FdKlbu1I">Video recording</a></p>
<section id="background">
<h2><span class="section-number">2.7.1. </span>Background<a class="headerlink" href="#background" title="Permalink to this headline"></a></h2>
<p>Arid lands are highly variable environments due to their water dependency and the high spatio-temporal variability of precipitation. But water is not only available to plants as run-off precipation, it is also availble as soil moisture (shallow and deep) and groundwater. These water resources are redistributed in and by the landscape. Vegetation has adapted to the variability of water resources in different ways and are found at places where water conditions are optimal, either in short term perspective (ephemeral species; where runoff is important) or in a long-term perspective (shrubs and trees; where soil moisture is stable). In this case study I will look into which topographical and hydrological parameters that influence vegetation patterns and to what degree they can model these patterns. Landsat data is used to extract vegetation indices (vegetation pattern) and SRTM is used for derivation of hydrological and topographical predictors.</p>
<p>The pictures below show the area for the case study in the Red Sea Hills of Sudan (an overview and a close-up to show how vegetation can grow in the wadis).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># figure size in inches optional</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span> <span class="p">,</span><span class="mi">8</span>

<span class="c1"># read images</span>
<span class="n">img_A</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;area.jpg&quot;</span><span class="p">)</span>
<span class="n">img_B</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;area_detail.jpg&quot;</span><span class="p">)</span>

<span class="c1"># display images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_A</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_B</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span> <span class="n">at</span> <span class="mh">0x7f371a7f10a0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_2_1.png" /></p>
<p><strong>flow chart of processing</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">&quot;figure_flowchart.png&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_4_0.png" /></p>
</section>
<section id="glad-ard-landsat-images">
<h2><span class="section-number">2.7.2. </span>1 GLAD ARD Landsat images<a class="headerlink" href="#glad-ard-landsat-images" title="Permalink to this headline"></a></h2>
<p>The Landsat Analysis Ready Data (GLAD ARD) developed by the Global Land Analysis and Discovery (GLAD) provides spatially and temporally consistent inputs for land cover mapping and change detection. The GLAD ARD represent a 16-day time-series of tiled Landsat normalized surface reflectance from 1997 to present (source
https://glad.umd.edu/book/overview).</p>
<p>The GLAD ARD data can be download from https://glad.umd.edu/dataset/landsat_v1.1/ previous autentifcation.</p>
<p>In my project I’m using imagery from Red Sea Hills, Sudan, portion of TILE 037E_18N. Due to working on the virtual machine I only selected one year of data, i.e. <strong>2018</strong>.</p>
<p>The temporal series for each tile is labeled following this numerical nomenclature</p>
<ul class="simple">
<li><p>first column is year</p></li>
<li><p>remaining columns are name of 16day time series imagery</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>! head -43 geodata/glad_ard/16d_intervals.csv  | tail -6
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2017</span> <span class="mi">852</span> <span class="mi">853</span> <span class="mi">854</span> <span class="mi">855</span> <span class="mi">856</span> <span class="mi">857</span> <span class="mi">858</span> <span class="mi">859</span> <span class="mi">860</span> <span class="mi">861</span> <span class="mi">862</span> <span class="mi">863</span> <span class="mi">864</span> <span class="mi">865</span> <span class="mi">866</span> <span class="mi">867</span> <span class="mi">868</span> <span class="mi">869</span> <span class="mi">870</span> <span class="mi">871</span> <span class="mi">872</span> <span class="mi">873</span> <span class="mi">874</span>         
<span class="mi">2018</span> <span class="mi">875</span> <span class="mi">876</span> <span class="mi">877</span> <span class="mi">878</span> <span class="mi">879</span> <span class="mi">880</span> <span class="mi">881</span> <span class="mi">882</span> <span class="mi">883</span> <span class="mi">884</span> <span class="mi">885</span> <span class="mi">886</span> <span class="mi">887</span> <span class="mi">888</span> <span class="mi">889</span> <span class="mi">890</span> <span class="mi">891</span> <span class="mi">892</span> <span class="mi">893</span> <span class="mi">894</span> <span class="mi">895</span> <span class="mi">896</span> <span class="mi">897</span>         
<span class="mi">2019</span> <span class="mi">898</span> <span class="mi">899</span> <span class="mi">900</span> <span class="mi">901</span> <span class="mi">902</span> <span class="mi">903</span> <span class="mi">904</span> <span class="mi">905</span> <span class="mi">906</span> <span class="mi">907</span> <span class="mi">908</span> <span class="mi">909</span> <span class="mi">910</span> <span class="mi">911</span> <span class="mi">912</span> <span class="mi">913</span> <span class="mi">914</span> <span class="mi">915</span> <span class="mi">916</span> <span class="mi">917</span> <span class="mi">918</span> <span class="mi">919</span> <span class="mi">920</span>         
<span class="mi">2020</span> <span class="mi">921</span> <span class="mi">922</span> <span class="mi">923</span> <span class="mi">924</span> <span class="mi">925</span> <span class="mi">926</span> <span class="mi">927</span> <span class="mi">928</span> <span class="mi">929</span> <span class="mi">930</span> <span class="mi">931</span> <span class="mi">932</span> <span class="mi">933</span> <span class="mi">934</span> <span class="mi">935</span> <span class="mi">936</span> <span class="mi">937</span> <span class="mi">938</span> <span class="mi">939</span> <span class="mi">940</span> <span class="mi">941</span> <span class="mi">942</span> <span class="mi">943</span>         
<span class="mi">2021</span> <span class="mi">944</span> <span class="mi">945</span> <span class="mi">946</span> <span class="mi">947</span> <span class="mi">948</span> <span class="mi">949</span> <span class="mi">950</span> <span class="mi">951</span> <span class="mi">952</span> <span class="mi">953</span> <span class="mi">954</span> <span class="mi">955</span> <span class="mi">956</span> <span class="mi">957</span> <span class="mi">958</span> <span class="mi">959</span> <span class="mi">960</span> <span class="mi">961</span> <span class="mi">962</span> <span class="mi">963</span> <span class="mi">964</span> <span class="mi">965</span> <span class="mi">966</span>         
<span class="mi">2022</span> <span class="mi">967</span> <span class="mi">968</span> <span class="mi">969</span> <span class="mi">970</span> <span class="mi">971</span> <span class="mi">972</span> <span class="mi">973</span> <span class="mi">974</span> <span class="mi">975</span> <span class="mi">976</span> <span class="mi">977</span> <span class="mi">978</span> <span class="mi">979</span> <span class="mi">980</span> <span class="mi">981</span> <span class="mi">982</span> <span class="mi">983</span> <span class="mi">984</span> <span class="mi">985</span> <span class="mi">986</span> <span class="mi">987</span> <span class="mi">988</span> <span class="mi">989</span>         
</pre></div>
</div>
<section id="data-download">
<h3><span class="section-number">2.7.2.1. </span>Data download<a class="headerlink" href="#data-download" title="Permalink to this headline"></a></h3>
<p>Data for 2018 was downloaded with this code, where user:password should be replace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span> INTER <span class="k">in</span> <span class="k">$(</span>grep -e ^2018 geodata/glad_ard//16d_intervals.csv <span class="p">|</span> awk <span class="s1">&#39;{ $1=&quot;&quot;; print $0}&#39;</span><span class="k">)</span> <span class="p">;</span> <span class="k">do</span>  
    curl --connect-timeout <span class="m">600</span> -u user:passwd -X GET https://glad.umd.edu/dataset/landsat_v1.1/18N/037E_18N/<span class="nv">$INTER</span>.tif -o project/glad_ard/<span class="nv">$INTER</span>.tif
    gdal_translate -co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE -co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span>  -projwin <span class="m">37</span> <span class="m">18</span>.86666 <span class="m">37</span>.4 <span class="m">18</span>.63333 project/glad_ard/<span class="nv">$INTER</span>.tif project/glad_ard/<span class="si">${</span><span class="nv">INTER</span><span class="si">}</span>_crop.tif      
<span class="k">done</span>
</pre></div>
</div>
<p>The images has 8 bands, where band 3 and 4 can be used to calculate vegetation indices. Band 8, BQA, is used for masking pixels with low quality (https://glad.umd.edu/ard/landsat-ard-methodology). In addition to clouds, there can also be low quality pixels seen as stripes (caused by sensor problems; see figure below).</p>
<p>Due the arid characteristics of the area, the Soil Adjusted Vegetation Index (SAVI) is used:</p>
<p>(NIR - Red)/(NIR + RED) + 0.5)) * 1.5</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%%capture
#converting to png for display
!gdal_translate -b 1 -b 2 -b 3 project/glad_ard/875_crop.tif project/glad_ard/875_crop.png
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/875_crop_m.tif&quot;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_10_0.png" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x7f3719b14eb0</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="calculate-vegetation-index">
<h3><span class="section-number">2.7.2.2. </span>Calculate vegetation index<a class="headerlink" href="#calculate-vegetation-index" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span> file <span class="k">in</span> project/glad_ard/*_crop.tif<span class="p">;</span> <span class="k">do</span> 
  <span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$file</span> .tif <span class="k">)</span>
  <span class="c1">#echo $file</span>
  <span class="c1">#VI</span>
  gdal_calc.py  --type<span class="o">=</span>Float32 --overwrite -A <span class="nv">$file</span> --A_band<span class="o">=</span><span class="m">3</span> -B <span class="nv">$file</span> --B_band<span class="o">=</span><span class="m">4</span> <span class="se">\</span>
  --co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE --co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span> --calc<span class="o">=</span><span class="s2">&quot;(B.astype(float))/(A.astype(float))&quot;</span> --outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_VI.tif <span class="se">\</span>
  --quiet

  <span class="c1">#NDVI</span>
  gdal_calc.py  --type<span class="o">=</span>Float32 --overwrite -A <span class="nv">$file</span> --A_band<span class="o">=</span><span class="m">3</span> -B <span class="nv">$file</span> --B_band<span class="o">=</span><span class="m">4</span> <span class="se">\</span>
  --co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE --co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span> --calc<span class="o">=</span><span class="s2">&quot;(B.astype(float)- A.astype(float))/(B.astype(float) + A.astype(float))&quot;</span> <span class="se">\</span>
  --outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_NDVI.tif <span class="se">\</span>
  --quiet
    
  <span class="c1">#SAVI</span>
  gdal_calc.py  --type<span class="o">=</span>Float32 --overwrite -A <span class="nv">$file</span> --A_band<span class="o">=</span><span class="m">3</span> -B <span class="nv">$file</span> --B_band<span class="o">=</span><span class="m">4</span> <span class="se">\</span>
  --co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE --co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span> --calc<span class="o">=</span><span class="s2">&quot;((B.astype(float)- A.astype(float))/(B.astype(float) + A.astype(float) + 0.5)) * 1.5&quot;</span> <span class="se">\</span>
  --outfile<span class="o">=</span>project/glad_ard/<span class="si">${</span><span class="nv">filename</span><span class="si">}</span>_SAVI.tif <span class="se">\</span>
  --quiet

<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="masking-and-statistics">
<h3><span class="section-number">2.7.2.3. </span>Masking and statistics<a class="headerlink" href="#masking-and-statistics" title="Permalink to this headline"></a></h3>
<p>Only BQA pixels 1 and 2 are kept in the masking. Since counting starts from 0, BQA band is #7. Nodata value is set to  Uint16 max (65535) since using 0 will cause error when estimating SAVI. All images were masked in the same way after calculating SAVI (since input nulldata could not be set in this version of gdalcalc.py).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%%capture
%%bash
for file in project/glad_ard/*_crop.tif; do 
  filename=$(basename $file .tif )
  echo $file
  echo $filename  
  pkgetmask --overwrite -i $file -o project/glad_ard/${filename}_mask.tif -min 1 -max 2 -b 7
  pksetmask -i project/glad_ard/${filename}_SAVI.tif -m project/glad_ard/${filename}_mask.tif -msknodata 0 -nodata -99 \
  -o project/glad_ard/${filename}_SAVI_m.tif\
  --quiet
done
</pre></div>
</div>
<p><strong>Checking nodata and statistics for the VIs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
gdalinfo project/glad_ard/875_crop_SAVI_m.tif <span class="p">|</span>grep -E <span class="s1">&#39;NoData&#39;</span> 
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">NoData</span> <span class="n">Value</span><span class="o">=-</span><span class="mi">99</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="k">for</span> file <span class="k">in</span> project/glad_ard/*crop_SAVI_m.tif<span class="p">;</span> <span class="k">do</span>
pkinfo -i <span class="nv">$file</span> -stats<span class="p">|</span>awk <span class="s1">&#39;{print $0}&#39;</span>
<span class="k">done</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.211417</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.611614</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.12386</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0465675</span> 
<span class="o">-</span><span class="nb">min</span> <span class="mf">0.0631748</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.210848</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.134271</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0229662</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.188215</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.772617</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.126266</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0579652</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.31516</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.715421</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.126566</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0513284</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.216388</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.600698</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.124193</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0397357</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.274006</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.610294</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.124246</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0368988</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.227176</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.60059</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.124319</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0350922</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.0308992</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.572593</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.123665</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0308838</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.197234</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.620289</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.128406</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0353955</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.0114275</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.636907</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.125323</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0319995</span> 
<span class="o">-</span><span class="nb">min</span> <span class="mf">0.063293</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.226574</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.11956</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0187572</span> 
<span class="o">-</span><span class="nb">min</span> <span class="mf">0.07592</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.250311</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.122435</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.019505</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.00347078</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.500646</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.127181</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0314407</span> 
<span class="o">-</span><span class="nb">min</span> <span class="mf">0.0270167</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.394247</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.128143</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0302831</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.0294599</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.542999</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.125114</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0315137</span> 
<span class="o">-</span><span class="nb">min</span> <span class="mf">0.0247256</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.229192</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.109571</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0199349</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.234899</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.79372</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.125687</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0335479</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.526694</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.911127</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.126048</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0363183</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.105182</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.686265</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.132825</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.030873</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.307845</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.969288</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.132675</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0423124</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.169741</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.699102</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.135448</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0472854</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.41313</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.955517</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.168209</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0908494</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.0180593</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.620982</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.134354</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.0493728</span> 
<span class="o">-</span><span class="nb">min</span> <span class="o">-</span><span class="mf">0.186645</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.349589</span> <span class="o">--</span><span class="n">mean</span> <span class="mf">0.1139</span> <span class="o">--</span><span class="n">stdDev</span> <span class="mf">0.037978</span> 
</pre></div>
</div>
<p><strong>Extracting histograms for SAVI</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%%capture
%%bash
for file in project/glad_ard/*_SAVI_m.tif; do
filename=$(basename $file .tif )
echo $filename
pkstat -i $file -hist -nbin 20 -nodata -99 &gt; project/glad_ard/${filename}_h.txt 
done
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!more project/glad_ard/897_crop_SAVI_m_h.txt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">0.002083286643</span> <span class="mi">7</span>
<span class="mf">0.02986876667</span> <span class="mi">154</span>
<span class="mf">0.06182081997</span> <span class="mi">6017</span>
<span class="mf">0.09377287328</span> <span class="mi">44899</span>
<span class="mf">0.1257249266</span> <span class="mi">33275</span>
<span class="mf">0.1576769799</span> <span class="mi">15828</span>
<span class="mf">0.1896290332</span> <span class="mi">7138</span>
<span class="mf">0.2215810865</span> <span class="mi">3958</span>
<span class="mf">0.2535331398</span> <span class="mi">1774</span>
<span class="mf">0.2854851931</span> <span class="mi">1003</span>
<span class="mf">0.3174372464</span> <span class="mi">313</span>
<span class="mf">0.3493892998</span> <span class="mi">218</span>
<span class="mf">0.3813413531</span> <span class="mi">134</span>
<span class="mf">0.4132934064</span> <span class="mi">86</span>
<span class="mf">0.4452454597</span> <span class="mi">45</span>
<span class="mf">0.477197513</span> <span class="mi">31</span>
<span class="mf">0.5091495663</span> <span class="mi">20</span>
<span class="mf">0.5411016196</span> <span class="mi">9</span>
<span class="mf">0.5730536729</span> <span class="mi">5</span>
<span class="mf">0.6050057262</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
</section>
<section id="generate-stacks-and-extract-statistics-in-pyjeo">
<h2><span class="section-number">2.7.3. </span>Generate stacks and extract statistics in Pyjeo<a class="headerlink" href="#generate-stacks-and-extract-statistics-in-pyjeo" title="Permalink to this headline"></a></h2>
<p>I wanted to try out Pyjeo after Dr. Pieter Kempeneers presentation (http://spatial-ecology.net/docs/build/html/PKTOOLS/pyjeo_introduction.html). I used it to calculate yearly mean, median, 90 percentil and standard deviation. Probably there are cleaner ways to do this with some more pyjeo-practice. One of workarounds I ended up using was creating a test* jim, and copied crs++ info from that to an “empty” jim that was “filled” with all my timesteps/planes. Later I used these layers when extracting information for random points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pyjeo</span> <span class="k">as</span> <span class="nn">pj</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/875_crop_SAVI_m.tif&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#del jim #delete if old jim exists</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">933</span><span class="p">,</span> <span class="n">otype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span> <span class="c1">#create jim object with one 1 empty plane</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copyGeoTransform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1">#get all crs from test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">())</span> <span class="c1">#show number of planes</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1600</span>
<span class="p">[</span><span class="mf">37.0</span><span class="p">,</span> <span class="mf">18.86675</span><span class="p">,</span> <span class="mf">37.4</span><span class="p">,</span> <span class="mf">18.633499999999998</span><span class="p">]</span>
<span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
<span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># iterate over SAVI files in
# that directory

#check number of files/planes
!ls project/glad_ard/???_crop_SAVI_m.tif | wc -l
#sjekk denne sorteringen
files = sorted(Path(&#39;project/glad_ard&#39;).glob(&#39;???_crop_SAVI_m.tif&#39;))

for file in files:
    jim.geometry.stackPlane(pj.Jim(file))

print(jim.properties.nrOfPlane()) #show number of planes
#remove first empty plane; probably better way to do this
jim=jim[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]]
jim.properties.nrOfPlane() #should be 23
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">23</span>
<span class="mi">24</span>





<span class="mi">23</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">99.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.9692878723144531</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">25.83536720275879</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate mean</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.0</span><span class="p">)</span> <span class="c1">#applied mask to all planes (more than 2D); &quot;reduce&quot; som i GEE</span>
<span class="n">mean</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.02188333310186863</span><span class="p">,</span>
 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5145996809005737</span><span class="p">,</span>
 <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.12636782228946686</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate median</span>
<span class="n">median</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
<span class="n">median</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.006859873421490192</span><span class="p">,</span>
 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5675770044326782</span><span class="p">,</span>
 <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.12463919818401337</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate stdev</span>
<span class="c1"># std.pixops.convert(&#39;GDT_Float32&#39;) #converts into float if needed</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="c1">#works as a placeholder for the std to be calculated</span>
<span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()</span><span class="o">==-</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#all 0 assign to nan</span>
<span class="n">stdnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#second data cube (1), starts at 0</span>
<span class="n">std</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">stdnp</span>
<span class="n">std</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.001729343319311738</span><span class="p">,</span>
 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.2672453820705414</span><span class="p">,</span>
 <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.017469022423028946</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculate quantiles</span>
<span class="n">per90</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()</span><span class="o">==-</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#all -99 assign to nan</span>
<span class="n">per90np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="mi">90</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">per90</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">per90np</span>
<span class="n">per90</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.06932799518108368</span><span class="p">,</span>
 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.9273030161857605</span><span class="p">,</span>
 <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.14474131166934967</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">141</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">142</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">143</span><span class="p">)</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">std</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">per90</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">median</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Figure</span> <span class="n">size</span> <span class="mi">432</span><span class="n">x288</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">Axes</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_31_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#save to files</span>
<span class="n">mean</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/mean_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">median</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/median_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">std</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/std_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
<span class="n">per90</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/per90_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span> <span class="c1">#io from io-module</span>
</pre></div>
</div>
</section>
<section id="creating-topographical-and-hydrological-layers-in-grass">
<h2><span class="section-number">2.7.4. </span>2 Creating topographical and hydrological layers in GRASS<a class="headerlink" href="#creating-topographical-and-hydrological-layers-in-grass" title="Permalink to this headline"></a></h2>
<p>Requirements for GRASS to run</p>
<ul class="simple">
<li><p>make seperate folder under home/user/ to run GRASS</p></li>
<li><p>install addons for special algorithms, i.e. r.stream.order. Addons had to be downloaded from github to be installed due to changes in URL not implemented in current version of GRASS (7.8.5).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bash</span>  
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">grassdb</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">OSGeo</span><span class="o">/</span><span class="n">grass</span><span class="o">-</span><span class="n">addons</span><span class="o">.</span><span class="n">git</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span>
<span class="c1">#run GRASS to install extension  </span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>  
<span class="n">grass78</span> <span class="o">-</span><span class="n">text</span> <span class="n">grassdb</span><span class="o">/</span><span class="n">europe</span><span class="o">/</span><span class="n">PERMANENT</span><span class="o">/</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>  
<span class="n">g</span><span class="o">.</span><span class="n">extension</span> <span class="n">extension</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">basins</span>  <span class="n">url</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raster</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">basins</span><span class="o">/</span>  
<span class="n">g</span><span class="o">.</span><span class="n">extension</span> <span class="n">extension</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">distance</span>  <span class="n">url</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grass_addons</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raster</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span>  
<span class="n">EOF</span> 
</pre></div>
</div>
<section id="download-srtm">
<h3><span class="section-number">2.7.4.1. </span>Download SRTM<a class="headerlink" href="#download-srtm" title="Permalink to this headline"></a></h3>
<p>SRTM data (version 3, 30m resolution) was downloaded from NASA earthdata.<br />See https://wiki.earthdata.nasa.gov/display/EL/How+To+Access+Data+With+cURL+And+Wget<br />Replace “user” and “password”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%%bash  
cd /home/user/  
touch .netrc  
echo &quot;machine urs.earthdata.nasa.gov login &lt;user&gt; password &lt;password&gt;&quot; &gt; .netrc  
chmod 0600 .netrc  
#### create cookie #### 
cd ~  
touch .urs_cookies  
##### download more files in one go and move to folder  ####
curl -O -b ~/.urs_cookies -c ~/.urs_cookies -L -n &quot;https://e4ftl01.cr.usgs.gov/MEASURES/SRTMGL1.003/2000.02.11/N18E0[36-37].SRTMGL1.hgt.zip&quot;  
mv N18* project/srtm/  
cd project/srtm/  
unzip &quot;*.zip&quot;  
##### to speed up convert to tiff ####  
for file in project/srtm/*.hgt; do  
  filename=$(basename $file .hgt)  
  gdal_translate -co COMPRESS=DEFLATE -co ZLEVEL=9 -co PREDICTOR=2 $file project/srtm/$filename.tif  
done  
</pre></div>
</div>
</section>
<section id="calculate-variables">
<h3><span class="section-number">2.7.4.2. </span>Calculate variables<a class="headerlink" href="#calculate-variables" title="Permalink to this headline"></a></h3>
<p>A number of topographic and hydrological explanatory variables are calculated in GRASS. Since some of the hydrological variables are depending on data for complete watersheds, region is readjusted to the smaller AOI (from landsat savi data) when the export is done (g.region). Distance from streams and stream junctions are also calculated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%%capture
%%bash
# topidx don&#39;t work on lat lon data
cp project/srtm/N18E037.tif /home/user/my_SE_data/exercise/
cd /home/user/my_SE_data/exercise
mkdir grassout

# use the --tmp-location option to store a temporal location in the /tmp folder 
# -f forces removal of gislock; --text - textbased GUI --tmp-location - temporary location deleted
# -c geofile - location based on that file
# opens a GRASS text interface where input is ended by EOF
grass78  -f -text --tmp-location  -c  /home/user/my_SE_data/exercise/N18E037.tif  &lt;&lt;&#39;EOF&#39; 

#prints all env. settings
#debug 0 - silence
g.gisenv set=&quot;GRASS_VERBOSE=-1&quot;,&quot;DEBUG=0&quot;

echo  &quot;######## import the layers ########&quot;
# not imported, just registered as a grass dataset 
r.external input=N18E037.tif output=elv --o --q # dem 
r.external input=landsat/SAVI.tif output=savi --o --q

echo  &quot;######## calculate topographic layers ########&quot;
r.slope.aspect elevation=elv slope=slope aspect=aspect pcurvature=pcurv tcurvature=tcurv dx=dx dy=dy dxx=dxx dyy=dyy dxy=dxy --o
#r.topidx input=elv output=topidx --o

echo &quot;######## estimating watershed ########&quot;
#threshold basinsize in number of pixels
r.watershed elevation=elv threshold=2000 \
  accumulation=w_accum \
  tci=w_tci \
  spi=w_spi \
  drainage=w_dr_dir \
  basin=w_basin \
  stream=w_stream_w2k \
  length_slope=w_lSl \
  slope_steepness=w_SlSt \
  --o

echo &quot;######## estimating distance from stream ########&quot;
# input should be from same function (r.watershed or r.stream..)

r.stream.distance stream_rast=w_stream_w2k \
  direction=w_dr_dir \
  elevation=elv \
  method=downstream \
  distance=w_str_w2k_dist

echo &quot;######## extract stream vector ########&quot;
# extract stream vector, including points for confluence
r.stream.extract elevation=elv \
  accumulation=w_accum \
  threshold=2000 \
  stream_vector=streamx_2kv \
  --o

echo &quot;######## info stream vector ########&quot;
#info about stream_v
db.describe -c table=streamx_2kv
v.to.rast input=streamx_2kv type=point where=&quot;type_code = 1&quot; output=str_2kvj_r use=attr attribute_column=&quot;type_code&quot; 


echo &quot;######## estimating distance from junctions ########&quot;
#-m for meter
r.grow.distance -m input=str_2kvj_r distance=str_2kvj_dist metric=geodesic


echo &quot;######## exporting products ########&quot;
#export multiple rasterfiles - exclude elv from the list
g.region raster=savi
for file in $(g.list type=raster ); do 
   r.out.gdal --o -f -c -m createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot; type=Float64 nodata=999999999 format=GTiff input=$file  output=grassout/${file}.tif 
done
EOF
</pre></div>
</div>
</section>
</section>
<section id="extract-statistics-for-random-points">
<h2><span class="section-number">2.7.5. </span>3 Extract statistics for random points<a class="headerlink" href="#extract-statistics-for-random-points" title="Permalink to this headline"></a></h2>
<p>Random points are created within classes of SAVI_mean to make sure the whole range of SAVI values are represented. The SAVI classes are based on the histogram with 20 bins. Classfication of SAVI is done in GRASS using a file with the recoding values. Awk is used to generate the recode.txt file, that should .
have the following format:</p>
<p>1:1:1.1:1.1 #from_start:from_end:to_start:to_end, where to_start=to_end for classes.</p>
<p>Random points are generated with pkextractimg.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#del jim</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/mean_pyjeo.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.02188333310186863</span><span class="p">,</span>
 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5159205794334412</span><span class="p">,</span>
 <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.1263299584388733</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!rm -r output.txt
stats = jim.stats.getStats(&#39;histogram&#39;, nbin=20, src_min=-0.1, src_max=0.55, nodata=-99)
with open(&quot;output.txt&quot;, &quot;a&quot;) as f:
  for index, bin in enumerate(stats[&#39;bin&#39;]):
    print(bin, stats[&#39;histogram&#39;][index], file=f)
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1">#make recode rules from txt-file</span>

paste -d<span class="s2">&quot;:&quot;</span> <span class="se">\</span>
    &lt;<span class="o">(</span>awk <span class="s1">&#39;{print $1}&#39;</span> output.txt <span class="p">|</span> head -n19<span class="o">)</span> <span class="se">\</span>
    &lt;<span class="o">(</span>awk <span class="s1">&#39;NR&gt;1{print $1}&#39;</span> output.txt<span class="o">)</span> <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="o">{</span><span class="m">1</span>..19<span class="o">})</span> <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="o">{</span><span class="m">1</span>..19<span class="o">})</span> <span class="se">\</span>
    &gt; rules.txt
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!wc -l rules.txt
!more rules.txt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">19</span> <span class="n">rules</span><span class="o">.</span><span class="n">txt</span>
<span class="o">-</span><span class="mf">0.08375</span><span class="p">:</span><span class="o">-</span><span class="mf">0.05125</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
<span class="o">-</span><span class="mf">0.05125</span><span class="p">:</span><span class="o">-</span><span class="mf">0.01875</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span>
<span class="o">-</span><span class="mf">0.01875</span><span class="p">:</span><span class="mf">0.01375</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span>
<span class="mf">0.01375</span><span class="p">:</span><span class="mf">0.04625</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span>
<span class="mf">0.04625</span><span class="p">:</span><span class="mf">0.07875</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span>
<span class="mf">0.07875</span><span class="p">:</span><span class="mf">0.11125</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">6</span>
<span class="mf">0.11125</span><span class="p">:</span><span class="mf">0.14375</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="mi">7</span>
<span class="mf">0.14375</span><span class="p">:</span><span class="mf">0.17625</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span>
<span class="mf">0.17625</span><span class="p">:</span><span class="mf">0.20875</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="mi">9</span>
<span class="mf">0.20875</span><span class="p">:</span><span class="mf">0.24125</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">10</span>
<span class="mf">0.24125</span><span class="p">:</span><span class="mf">0.27375</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">11</span>
<span class="mf">0.27375</span><span class="p">:</span><span class="mf">0.30625</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">12</span>
<span class="mf">0.30625</span><span class="p">:</span><span class="mf">0.33875</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">13</span>
<span class="mf">0.33875</span><span class="p">:</span><span class="mf">0.37125</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">14</span>
<span class="mf">0.37125</span><span class="p">:</span><span class="mf">0.40375</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">15</span>
<span class="mf">0.40375</span><span class="p">:</span><span class="mf">0.43625</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">16</span>
<span class="mf">0.43625</span><span class="p">:</span><span class="mf">0.46875</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">17</span>
<span class="mf">0.46875</span><span class="p">:</span><span class="mf">0.50125</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">18</span>
<span class="mf">0.50125</span><span class="p">:</span><span class="mf">0.53375</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">19</span>
</pre></div>
</div>
<p><strong>classify SAVI with GRASS</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="o">%%</span><span class="n">bash</span>

<span class="n">cp</span> <span class="n">project</span><span class="o">/</span><span class="n">glad_ard</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span>

<span class="n">grass78</span>  <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">text</span> <span class="o">--</span><span class="n">tmp</span><span class="o">-</span><span class="n">location</span>  <span class="o">-</span><span class="n">c</span>  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">my_SE_data</span><span class="o">/</span><span class="n">exercise</span><span class="o">/</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span>  <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> 
<span class="n">g</span><span class="o">.</span><span class="n">gisenv</span> <span class="nb">set</span><span class="o">=</span><span class="s2">&quot;GRASS_VERBOSE=-1&quot;</span><span class="p">,</span><span class="s2">&quot;DEBUG=0&quot;</span>

<span class="n">echo</span> <span class="s2">&quot;######## import the layers #############&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">external</span> <span class="nb">input</span><span class="o">=</span><span class="n">mean_pyjeo</span><span class="o">.</span><span class="n">tif</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI</span> <span class="o">--</span><span class="n">o</span> <span class="o">--</span><span class="n">q</span> <span class="c1"># dem </span>

<span class="n">echo</span> <span class="s2">&quot;######## recode SAVI 30classes #############&quot;</span>
<span class="n">r</span><span class="o">.</span><span class="n">recode</span> <span class="nb">input</span><span class="o">=</span><span class="n">SAVI</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI_c</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="o">.</span><span class="n">txt</span>

<span class="n">r</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">gdal</span> <span class="o">--</span><span class="n">o</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">createopt</span><span class="o">=</span><span class="s2">&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot;</span> <span class="nb">format</span><span class="o">=</span><span class="n">GTiff</span> <span class="nb">input</span><span class="o">=</span><span class="n">SAVI_c</span> <span class="n">output</span><span class="o">=</span><span class="n">SAVI_c</span><span class="o">.</span><span class="n">tif</span>

<span class="n">EOF</span>
</pre></div>
</div>
<p><strong>create random points</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pkextractimg -i project/glad_ard/mean_pyjeo.tif \
    -s project/glad_ard/SAVI_c.tif \
    -o project/glad_ard/random.sqlite -t 5
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ogrinfo project/glad_ard/random.sqlite
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	- &#39;VirtualXPath&#39;	[XML Path Language - XPath]
INFO: Open of `project/glad_ard/random.sqlite&#39;
      using driver `SQLite&#39; successful.
1: training data (Point)
</pre></div>
</div>
<section id="extract-values-for-response-and-predictor-variables">
<h3><span class="section-number">2.7.5.1. </span>Extract values for response and predictor variables<a class="headerlink" href="#extract-values-for-response-and-predictor-variables" title="Permalink to this headline"></a></h3>
<p>In this part values for predictors and response variables for all random points are extracted. I’m using pyjeo for this part. Since stacking requires the datasets to be same datatype as well as CRS, extraction is done separately for response and predictors.</p>
<p><strong>Repsonse variable</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">jim</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">933</span><span class="p">,</span> <span class="n">otype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span> <span class="c1">#create empty jim object</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copyGeoReference</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>

<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;project/glad_ard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*pyjeo.tif&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span> <span class="c1">#show number of planes</span>
<span class="n">jim</span><span class="o">=</span><span class="n">jim</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="c1">#select last 4 planes</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1600</span>
<span class="p">[</span><span class="mf">37.0</span><span class="p">,</span> <span class="mf">18.86675</span><span class="p">,</span> <span class="mf">37.4</span><span class="p">,</span> <span class="mf">18.633499999999998</span><span class="p">]</span>
<span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
<span class="p">[</span><span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/mean_pyjeo.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/median_pyjeo.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/per90_pyjeo.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/std_pyjeo.tif&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>#check CRS for layers
!ogrinfo -so project/glad_ard/random.sqlite &#39;training data&#39; | grep -E &#39;EPSG&#39;
!gdalinfo project/glad_ard/mean_pyjeo.tif | grep -E &#39;EPSG&#39;
jim.properties.getProjection()
#test.properties.getProjection()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">4326</span><span class="p">]]</span>





<span class="s1">&#39;GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]&#39;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/random.sqlite&#39;</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/temp.sqlite&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted1</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
<span class="n">savi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted1</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<span class="n">savi</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/savi.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Predictor variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">jim</span> <span class="c1">#if old jim exists</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">()</span> <span class="c1">#show number of planes; i.e. timesteps</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no of planes, columns and rows:&#39;</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">of</span> <span class="n">planes</span><span class="p">,</span> <span class="n">columns</span> <span class="ow">and</span> <span class="n">rows</span><span class="p">:</span> <span class="mi">1</span> <span class="mi">1600</span> <span class="mi">933</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getBBox</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">37.0</span><span class="p">,</span> <span class="mf">18.86675</span><span class="p">,</span> <span class="mf">37.4</span><span class="p">,</span> <span class="mf">18.633499999999998</span><span class="p">]</span>
<span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1530.0</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">576.3270136655949</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>%%capture
%%bash
#planes to be added
ls /home/user/my_SE_data/exercise/grassout/*.tif | wc -l 
#check that all rasters are same datatype
for file in /home/user/my_SE_data/exercise/grassout/*.tif; do
  echo $file
  gdalinfo $file -stats | grep -E &#39;Type&#39; | awk &#39;{print $4}&#39;
done
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate over tif files in</span>
<span class="c1"># that directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.tif&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="n">planes</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfPlane</span><span class="p">()</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">()</span> 
<span class="n">row</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no of files, no of planes, columns and rows:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">planes</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/aspect.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dx.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dxx.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dxy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dyy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/pcurv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/savi.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/slope.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_r.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/tcurv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_SlSt.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_accum.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_basin.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_dr_dir.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_lSl.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_spi.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_stream_w2k.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_tci.tif&#39;</span><span class="p">)]</span>
<span class="n">no</span> <span class="n">of</span> <span class="n">files</span><span class="p">,</span> <span class="n">no</span> <span class="n">of</span> <span class="n">planes</span><span class="p">,</span> <span class="n">columns</span> <span class="ow">and</span> <span class="n">rows</span><span class="p">:</span> <span class="mi">22</span> <span class="mi">23</span> <span class="mi">1600</span> <span class="mi">933</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ogrinfo -so project/glad_ard/random.sqlite &#39;training data&#39; | grep -E &#39;EPSG&#39;
# confirm that CRS is the same
jim.properties.getProjection()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">ID</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="mi">4326</span><span class="p">]]</span>





<span class="s1">&#39;GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]&#39;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/random.sqlite&#39;</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;project/glad_ard/temp1.sqlite&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted3</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="mi">999999999</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted3</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<span class="n">topo</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;project/glad_ard/predictors.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topo</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>b</th>
      <th>t0b0</th>
      <th>t1b0</th>
      <th>t2b0</th>
      <th>t3b0</th>
      <th>t4b0</th>
      <th>t5b0</th>
      <th>t6b0</th>
      <th>...</th>
      <th>t13b0</th>
      <th>t14b0</th>
      <th>t15b0</th>
      <th>t16b0</th>
      <th>t17b0</th>
      <th>t18b0</th>
      <th>t19b0</th>
      <th>t20b0</th>
      <th>t21b0</th>
      <th>t22b0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>0.097008</td>
      <td>760.0</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>...</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>1.000000e+09</td>
      <td>8.741459</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>0.082413</td>
      <td>793.0</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>...</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>1.000000e+09</td>
      <td>7.134220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>0.082921</td>
      <td>808.0</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>...</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>1.000000e+09</td>
      <td>6.180274</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>0.106816</td>
      <td>877.0</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>...</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>1.000000e+09</td>
      <td>5.899572</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>0.114286</td>
      <td>898.0</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>...</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>1.000000e+09</td>
      <td>5.373617</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div></section>
</section>
<section id="modelling-vegetation">
<h2><span class="section-number">2.7.6. </span>4 Modelling vegetation<a class="headerlink" href="#modelling-vegetation" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="o">*</span> <span class="c1">#raster processing</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">pyspatialml</span> <span class="kn">import</span> <span class="n">Raster</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span><span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">6.5</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
<section id="prepare-table">
<h3><span class="section-number">2.7.6.1. </span>Prepare table<a class="headerlink" href="#prepare-table" title="Permalink to this headline"></a></h3>
<p><strong>import table and rename predictor variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#read data using panda</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/predictors.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>  <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t1b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t2b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t3b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t4b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t5b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t6b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t7b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t8b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t9b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t10b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t11b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t12b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t13b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t14b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t15b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t16b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t17b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t18b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t19b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t20b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t21b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t22b0&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ls /home/user/my_SE_data/exercise/grassout/*.tif | xargs -n1 basename
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aspect</span><span class="o">.</span><span class="n">tif</span>
<span class="n">dx</span><span class="o">.</span><span class="n">tif</span>
<span class="n">dxx</span><span class="o">.</span><span class="n">tif</span>
<span class="n">dxy</span><span class="o">.</span><span class="n">tif</span>
<span class="n">dy</span><span class="o">.</span><span class="n">tif</span>
<span class="n">dyy</span><span class="o">.</span><span class="n">tif</span>
<span class="n">elv</span><span class="o">.</span><span class="n">tif</span>
<span class="n">pcurv</span><span class="o">.</span><span class="n">tif</span>
<span class="n">savi</span><span class="o">.</span><span class="n">tif</span>
<span class="n">slope</span><span class="o">.</span><span class="n">tif</span>
<span class="n">str_2kvj_dist</span><span class="o">.</span><span class="n">tif</span>
<span class="n">str_2kvj_r</span><span class="o">.</span><span class="n">tif</span>
<span class="n">tcurv</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_accum</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_basin</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_dr_dir</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_lSl</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_SlSt</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_spi</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_stream_w2k</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_str_w2k_dist</span><span class="o">.</span><span class="n">tif</span>
<span class="n">w_tci</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/aspect.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dx.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dxx.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dxy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/dyy.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/elv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/pcurv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/savi.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/slope.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/str_2kvj_r.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/tcurv.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_SlSt.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_accum.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_basin.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_dr_dir.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_lSl.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_spi.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_stream_w2k.tif&#39;</span><span class="p">),</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/home/user/my_SE_data/exercise/grassout/w_tci.tif&#39;</span><span class="p">)]</span>





<span class="mi">22</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#PS! sorting gave different results for jim object and in bash (capital letters?)</span>
<span class="n">names_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxy&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dyy&#39;</span><span class="p">,</span> <span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;pcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;savi&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_r&#39;</span><span class="p">,</span> <span class="s1">&#39;tcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_SlSt&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">,</span>
              <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;w_dr_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;w_lSl&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_stream_w2k&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">names_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
<span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t1b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t2b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t3b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t4b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t5b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t6b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t7b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t8b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t9b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t10b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t11b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t12b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t13b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t14b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t15b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t16b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t17b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t18b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t19b0&#39;</span><span class="p">,</span>
       <span class="s1">&#39;t20b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t21b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t22b0&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>





<span class="mi">27</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">names_list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxy&#39;</span><span class="p">,</span>
       <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dyy&#39;</span><span class="p">,</span> <span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;pcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;savi&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span>
       <span class="s1">&#39;str_2kvj_r&#39;</span><span class="p">,</span> <span class="s1">&#39;tcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_SlSt&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">,</span> <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;w_dr_dir&#39;</span><span class="p">,</span>
       <span class="s1">&#39;w_lSl&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_stream_w2k&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">74610</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>fid</th>
      <th>label</th>
      <th>b</th>
      <th>t0b0</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>savi</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>str_2kvj_r</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_stream_w2k</th>
      <th>w_tci</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>11</td>
      <td>0.097008</td>
      <td>760.0</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>0.086638</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>1.000000e+09</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>1.000000e+09</td>
      <td>8.741459</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>10</td>
      <td>0.082413</td>
      <td>793.0</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>0.083820</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>1.000000e+09</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>1.000000e+09</td>
      <td>7.134220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2</td>
      <td>10</td>
      <td>0.082921</td>
      <td>808.0</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>0.083765</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>1.000000e+09</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>1.000000e+09</td>
      <td>6.180274</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3</td>
      <td>11</td>
      <td>0.106816</td>
      <td>877.0</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>0.130181</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>1.000000e+09</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>1.000000e+09</td>
      <td>5.899572</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>4</td>
      <td>11</td>
      <td>0.114286</td>
      <td>898.0</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>0.139849</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>1.000000e+09</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>1.000000e+09</td>
      <td>5.373617</td>
    </tr>
  </tbody>
</table>
</div><p><strong>Cleaing up table and calculate some new variables</strong><br />Columns that will not be used in the modelling is deleted from the table. Aspect is a circular variable and is linearised by calculating its sine and cosine. w_basin is a categorical value and to test whether it is treated correctly and meaningful its values are shuffled (basin_shuf).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;w_stream_w2k&#39;</span><span class="p">,</span> <span class="s1">&#39;savi&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_r&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxy&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dyy&#39;</span><span class="p">,</span> <span class="s1">&#39;elv&#39;</span><span class="p">,</span>
       <span class="s1">&#39;pcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;tcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_SlSt&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">,</span>
       <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;w_dr_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;w_lSl&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#linearise aspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;cos_asp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]))</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;sin_asp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#shuffle categorical basin-variable</span>
<span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;basin_shuf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;w_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>cos_asp</th>
      <th>sin_asp</th>
      <th>basin_shuf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>8.741459</td>
      <td>-0.977232</td>
      <td>0.212176</td>
      <td>7490.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>7.134220</td>
      <td>-0.993378</td>
      <td>-0.114896</td>
      <td>1646.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>6.180274</td>
      <td>-0.990586</td>
      <td>-0.136890</td>
      <td>6642.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>5.899572</td>
      <td>-0.713425</td>
      <td>0.700731</td>
      <td>1154.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>5.373617</td>
      <td>-0.100492</td>
      <td>0.994938</td>
      <td>1172.0</td>
    </tr>
  </tbody>
</table>
</div><p><strong>import response variable and join to predictors</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#read response using panda</span>
<span class="n">savi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;project/glad_ard/savi.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>  <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">savi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">savi</span> <span class="o">=</span> <span class="n">savi</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;t0b0&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;t1b0&#39;</span><span class="p">:</span><span class="s1">&#39;median&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;t2b0&#39;</span><span class="p">:</span><span class="s1">&#39;per90&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;t3b0&#39;</span><span class="p">:</span><span class="s1">&#39;std&#39;</span>
                    <span class="p">}</span> <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="n">savi</span> <span class="o">=</span> <span class="n">savi</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">savi</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">savi</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">savi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">,</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;t0b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t1b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t2b0&#39;</span><span class="p">,</span> <span class="s1">&#39;t3b0&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="mi">74610</span>
<span class="n">Index</span><span class="p">([</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;per90&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">savi</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">74610</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>mean</th>
      <th>median</th>
      <th>per90</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>11</td>
      <td>167.750107</td>
      <td>-0.243415</td>
      <td>-0.006419</td>
      <td>-0.000278</td>
      <td>0.052850</td>
      <td>-0.003702</td>
      <td>760.0</td>
      <td>-0.005648</td>
      <td>13.986955</td>
      <td>1611.938110</td>
      <td>-0.003823</td>
      <td>16.299999</td>
      <td>57.580921</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.078407</td>
      <td>173.928513</td>
      <td>42.452179</td>
      <td>8.741459</td>
      <td>0.097008</td>
      <td>0.094664</td>
      <td>0.117911</td>
      <td>0.016844</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>10</td>
      <td>186.597610</td>
      <td>-0.456937</td>
      <td>-0.003307</td>
      <td>-0.001944</td>
      <td>-0.052850</td>
      <td>-0.005112</td>
      <td>793.0</td>
      <td>-0.002830</td>
      <td>24.701620</td>
      <td>1603.144653</td>
      <td>-0.004220</td>
      <td>16.299999</td>
      <td>18.216928</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.040093</td>
      <td>153.324326</td>
      <td>143.446518</td>
      <td>7.134220</td>
      <td>0.082413</td>
      <td>0.082888</td>
      <td>0.101135</td>
      <td>0.020149</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>10</td>
      <td>187.867950</td>
      <td>-0.529534</td>
      <td>-0.002334</td>
      <td>0.000556</td>
      <td>-0.073177</td>
      <td>-0.004231</td>
      <td>808.0</td>
      <td>-0.001522</td>
      <td>28.127462</td>
      <td>1601.273193</td>
      <td>-0.003833</td>
      <td>16.299999</td>
      <td>13.026308</td>
      <td>298.0</td>
      <td>5.0</td>
      <td>0.054766</td>
      <td>115.282860</td>
      <td>199.080109</td>
      <td>6.180274</td>
      <td>0.082921</td>
      <td>0.078278</td>
      <td>0.113270</td>
      <td>0.023337</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>11</td>
      <td>135.514297</td>
      <td>-0.269037</td>
      <td>-0.004474</td>
      <td>0.001944</td>
      <td>0.264250</td>
      <td>-0.000881</td>
      <td>877.0</td>
      <td>-0.003813</td>
      <td>20.661793</td>
      <td>1625.434448</td>
      <td>-0.000656</td>
      <td>0.030000</td>
      <td>5.122952</td>
      <td>298.0</td>
      <td>3.0</td>
      <td>0.030000</td>
      <td>23.608582</td>
      <td>824.232788</td>
      <td>5.899572</td>
      <td>0.106816</td>
      <td>0.104386</td>
      <td>0.123099</td>
      <td>0.014474</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>11</td>
      <td>95.767517</td>
      <td>-0.042704</td>
      <td>-0.003501</td>
      <td>0.001667</td>
      <td>0.422801</td>
      <td>-0.003173</td>
      <td>898.0</td>
      <td>-0.002736</td>
      <td>23.023153</td>
      <td>1658.049072</td>
      <td>-0.002913</td>
      <td>16.299999</td>
      <td>2.950633</td>
      <td>298.0</td>
      <td>2.0</td>
      <td>0.037655</td>
      <td>23.699802</td>
      <td>1175.459473</td>
      <td>5.373617</td>
      <td>0.114286</td>
      <td>0.117651</td>
      <td>0.129462</td>
      <td>0.015016</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>label</th>
      <th>aspect</th>
      <th>dx</th>
      <th>dxx</th>
      <th>dxy</th>
      <th>dy</th>
      <th>dyy</th>
      <th>elv</th>
      <th>pcurv</th>
      <th>slope</th>
      <th>str_2kvj_dist</th>
      <th>tcurv</th>
      <th>w_SlSt</th>
      <th>w_accum</th>
      <th>w_basin</th>
      <th>w_dr_dir</th>
      <th>w_lSl</th>
      <th>w_spi</th>
      <th>w_str_w2k_dist</th>
      <th>w_tci</th>
      <th>cos_asp</th>
      <th>sin_asp</th>
      <th>basin_shuf</th>
      <th>mean</th>
      <th>median</th>
      <th>per90</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>7.461000e+04</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
      <td>74610.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>37333.886986</td>
      <td>11.610481</td>
      <td>6.837265e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>6.835545e+05</td>
      <td>575.752379</td>
      <td>6.835545e+05</td>
      <td>6.835639e+05</td>
      <td>1244.034957</td>
      <td>6.835545e+05</td>
      <td>6.898900</td>
      <td>156.125340</td>
      <td>1.102226e+07</td>
      <td>4.388795</td>
      <td>0.041021</td>
      <td>6.843058e+05</td>
      <td>1.101833e+07</td>
      <td>6.835616e+05</td>
      <td>0.149895</td>
      <td>0.070254</td>
      <td>1.102226e+07</td>
      <td>0.126390</td>
      <td>0.124655</td>
      <td>0.144773</td>
      <td>0.017460</td>
    </tr>
    <tr>
      <th>std</th>
      <td>21553.426532</td>
      <td>0.961089</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>419.481320</td>
      <td>2.613611e+07</td>
      <td>2.613611e+07</td>
      <td>831.669605</td>
      <td>2.613611e+07</td>
      <td>8.035924</td>
      <td>11065.900632</td>
      <td>1.043836e+08</td>
      <td>2.454120</td>
      <td>0.024518</td>
      <td>2.613610e+07</td>
      <td>1.043841e+08</td>
      <td>2.613611e+07</td>
      <td>0.700993</td>
      <td>0.693699</td>
      <td>1.043836e+08</td>
      <td>0.033416</td>
      <td>0.031926</td>
      <td>0.045378</td>
      <td>0.013877</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>9.000000</td>
      <td>0.000000e+00</td>
      <td>-1.344040e+00</td>
      <td>-1.182164e-01</td>
      <td>-2.553215e-02</td>
      <td>-1.341612e+00</td>
      <td>-5.341714e-02</td>
      <td>8.000000</td>
      <td>-3.485471e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>-4.527013e-02</td>
      <td>0.030000</td>
      <td>-518632.187500</td>
      <td>2.980000e+02</td>
      <td>-4.000000</td>
      <td>0.025332</td>
      <td>1.446173e-01</td>
      <td>0.000000e+00</td>
      <td>1.318053e+00</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>2.980000e+02</td>
      <td>0.018881</td>
      <td>0.029393</td>
      <td>0.071009</td>
      <td>0.002483</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>18669.250000</td>
      <td>11.000000</td>
      <td>6.651141e+01</td>
      <td>-2.985837e-02</td>
      <td>-1.551966e-03</td>
      <td>-5.554170e-04</td>
      <td>-3.658877e-02</td>
      <td>-1.410363e-03</td>
      <td>171.000000</td>
      <td>-1.434810e-03</td>
      <td>1.847334e+00</td>
      <td>585.213623</td>
      <td>-1.201079e-03</td>
      <td>0.030000</td>
      <td>1.378385</td>
      <td>1.468000e+03</td>
      <td>2.000000</td>
      <td>0.030000</td>
      <td>2.121571e+00</td>
      <td>2.781997e+02</td>
      <td>5.179891e+00</td>
      <td>-0.532889</td>
      <td>-0.614763</td>
      <td>1.468000e+03</td>
      <td>0.106657</td>
      <td>0.105575</td>
      <td>0.119463</td>
      <td>0.009773</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>37334.500000</td>
      <td>11.000000</td>
      <td>1.623830e+02</td>
      <td>1.279920e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.065462e-03</td>
      <td>0.000000e+00</td>
      <td>452.000000</td>
      <td>-1.332938e-04</td>
      <td>4.606714e+00</td>
      <td>1060.480957</td>
      <td>1.762322e-19</td>
      <td>0.030000</td>
      <td>2.929744</td>
      <td>7.130000e+03</td>
      <td>5.000000</td>
      <td>0.030000</td>
      <td>9.361089e+00</td>
      <td>8.213889e+02</td>
      <td>6.182429e+00</td>
      <td>0.310322</td>
      <td>0.123289</td>
      <td>7.130000e+03</td>
      <td>0.119984</td>
      <td>0.119425</td>
      <td>0.133374</td>
      <td>0.012945</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>55997.750000</td>
      <td>12.000000</td>
      <td>2.785243e+02</td>
      <td>5.974620e-02</td>
      <td>1.359604e-03</td>
      <td>5.553937e-04</td>
      <td>4.878521e-02</td>
      <td>1.234086e-03</td>
      <td>1037.000000</td>
      <td>1.057664e-03</td>
      <td>1.578789e+01</td>
      <td>1755.921539</td>
      <td>1.408627e-03</td>
      <td>16.299999</td>
      <td>10.037903</td>
      <td>7.732000e+03</td>
      <td>7.000000</td>
      <td>0.040093</td>
      <td>3.752013e+01</td>
      <td>1.587121e+03</td>
      <td>8.189266e+00</td>
      <td>0.826665</td>
      <td>0.732041</td>
      <td>7.732000e+03</td>
      <td>0.139325</td>
      <td>0.138246</td>
      <td>0.155657</td>
      <td>0.019381</td>
    </tr>
    <tr>
      <th>max</th>
      <td>74664.000000</td>
      <td>19.000000</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1523.000000</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>4256.849121</td>
      <td>1.000000e+09</td>
      <td>16.299999</td>
      <td>207631.109375</td>
      <td>1.000000e+09</td>
      <td>8.000000</td>
      <td>0.409775</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000e+09</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000e+09</td>
      <td>0.404548</td>
      <td>0.414857</td>
      <td>0.674392</td>
      <td>0.238861</td>
    </tr>
  </tbody>
</table>
</div><p><strong>Check for and remove nan-values</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#predictors.describe()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictors</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">False</span>





<span class="kc">False</span>
</pre></div>
</div>
<p><strong>checking covariance for some variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_sample</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;w_basin&quot;</span><span class="p">,</span> <span class="s2">&quot;elv&quot;</span><span class="p">,</span> <span class="s2">&quot;str_2kvj_dist&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">predictors_sample</span> <span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">plot_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">scatter_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_85_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">((</span><span class="n">predictors</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]),</span><span class="n">bins</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_86_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span> <span class="c1">#get names</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxx&#39;</span><span class="p">,</span> <span class="s1">&#39;dxy&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;dyy&#39;</span><span class="p">,</span> <span class="s1">&#39;elv&#39;</span><span class="p">,</span>
       <span class="s1">&#39;pcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;tcurv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_SlSt&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">,</span>
       <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;w_dr_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;w_lSl&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">,</span>
       <span class="s1">&#39;cos_asp&#39;</span><span class="p">,</span> <span class="s1">&#39;sin_asp&#39;</span><span class="p">,</span> <span class="s1">&#39;basin_shuf&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;per90&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">74610</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#remove savi related and stream_j_dist</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#response variable</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
<span class="n">predictors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">24</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span> <span class="s1">&#39;dx&#39;</span> <span class="s1">&#39;dxx&#39;</span> <span class="s1">&#39;dxy&#39;</span> <span class="s1">&#39;dy&#39;</span> <span class="s1">&#39;dyy&#39;</span> <span class="s1">&#39;elv&#39;</span> <span class="s1">&#39;pcurv&#39;</span> <span class="s1">&#39;slope&#39;</span>
 <span class="s1">&#39;str_2kvj_dist&#39;</span> <span class="s1">&#39;tcurv&#39;</span> <span class="s1">&#39;w_accum&#39;</span> <span class="s1">&#39;w_basin&#39;</span> <span class="s1">&#39;w_lSl&#39;</span> <span class="s1">&#39;w_spi&#39;</span>
 <span class="s1">&#39;w_str_w2k_dist&#39;</span> <span class="s1">&#39;w_tci&#39;</span> <span class="s1">&#39;cos_asp&#39;</span> <span class="s1">&#39;sin_asp&#39;</span> <span class="s1">&#39;basin_shuf&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">74610</span><span class="p">,)</span>
<span class="p">(</span><span class="mi">74610</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mf">0.09700802</span><span class="p">,</span> <span class="mf">0.08241346</span><span class="p">,</span> <span class="mf">0.0829206</span> <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.13141605</span><span class="p">,</span> <span class="mf">0.12182923</span><span class="p">,</span>
       <span class="mf">0.11685393</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>split data into test and training dataset</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="c1">#id. training and testing; split 50/50</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="random-forest">
<h3><span class="section-number">2.7.6.2. </span>Random forest<a class="headerlink" href="#random-forest" title="Permalink to this headline"></a></h3>
<p>Random forest is defined and then run with different settings to find the best model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="c1">#default parameters - should be tuned! - not needed in R</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;mse&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;max_samples&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;min_impurity_decrease&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;min_impurity_split&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;oob_score&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
 <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;warm_start&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first tried with this default setting rfReg = RandomForestRegressor(min_samples_leaf=50, oob_score=True)</span>
<span class="c1"># after running chunks below, these settings seems to better fit the data. </span>
<span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
<span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pearsonr_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1">#training vs pred R</span>
<span class="n">pearsonr_all</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.9151073853228917</span><span class="p">,</span> <span class="mf">0.8930071550321135</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the oob score</span>
<span class="n">rfReg</span><span class="o">.</span><span class="n">oob_score_</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.7825391349776363</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;training SAVI mean (all rows)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;training prediction&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7f374ad840d0</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_99_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> 
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mi">13</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#feature importance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">impt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">feat</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_102_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">src1</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_basin.tif&quot;</span><span class="p">)</span>
<span class="n">src2</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/elv.tif&quot;</span><span class="p">)</span>
<span class="n">src3</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&quot;</span><span class="p">)</span>
<span class="n">src4</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/landsat/mean_pyjeo.tif&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">src1p</span><span class="p">,</span><span class="n">src2p</span><span class="p">,</span><span class="n">src3p</span><span class="p">,</span> <span class="n">src4p</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">show</span><span class="p">(</span><span class="n">src1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src1p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;basins&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src2p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;elevation&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src3p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;str_2kvj_dist&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">src4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">src4p</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;mean SAVI&#39;</span> <span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_rainbow&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x7f374abeb910</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_103_1.png" /></p>
</section>
<section id="random-forest-tuning">
<h3><span class="section-number">2.7.6.3. </span>Random Forest tuning<a class="headerlink" href="#random-forest-tuning" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>“max_features”: number of features to consider when looking for the best split.</p></li>
<li><p>“max_samples”: number of samples to draw from X to train each base estimator.</p></li>
<li><p>“n_estimators”: identify the number of trees that must grow. It must be large enough so that the error is stabilized. Defoult 100.</p></li>
<li><p>“max_depth”: max number of levels in each decision tree.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of n_estimators for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_105_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of n_estimators for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_106_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of min_samples_leaf for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>

<span class="c1">#    rfReg = RandomForestRegressor(n_estimators=80, min_samples_leaf=80, max_features=0.33, max_depth=50, max_samples=0.7,n_jobs=-1,random_state=42 , oob_score = True)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_107_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
    <span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
    <span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value of max_features for Random Forest Classifier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>

<span class="c1">#    rfReg = RandomForestRegressor(n_estimators=80, min_samples_leaf=80, max_features=0.33, max_depth=50, max_samples=0.7,n_jobs=-1,random_state=42 , oob_score = True)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Prediction Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_108_1.png" /></p>
</section>
<section id="predict-on-the-raster-using-pyspatialml">
<h3><span class="section-number">2.7.6.4. </span>Predict on the raster using pyspatialml<a class="headerlink" href="#predict-on-the-raster-using-pyspatialml" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">Pyspatialml</span></code></p>
<p><strong>prediction with most important variables</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">]]</span> <span class="c1">#remove savi related and stream_j_dist</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]</span> <span class="c1">#response variable</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;elv&#39;</span><span class="p">,</span> <span class="s1">&#39;w_basin&#39;</span><span class="p">,</span> <span class="s1">&#39;str_2kvj_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;w_str_w2k_dist&#39;</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;w_tci&#39;</span><span class="p">,</span> <span class="s1">&#39;w_spi&#39;</span><span class="p">,</span> <span class="s1">&#39;w_accum&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
<span class="n">predictors</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="c1">#id. training and testing; split 50/50</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rfReg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">,</span> <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
<span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pearsonr_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1">#training vs pred R</span>
<span class="n">pearsonr_all</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.9133764136610967</span><span class="p">,</span> <span class="mf">0.8939919955832134</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the oob score</span>
<span class="n">rfReg</span><span class="o">.</span><span class="n">oob_score_</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.7855745474283174</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;training SAVI mean (all rows)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;training prediction&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7f371abf8910</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_115_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> 
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#feature importance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">impt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feat</span><span class="p">)),</span><span class="n">feat</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_118_0.png" /></p>
<p><strong>import and stack datasets for prediction</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import datasets</span>
<span class="n">elv</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/elv.tif&quot;</span><span class="p">)</span>
<span class="n">w_basin</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_basin.tif&quot;</span><span class="p">)</span>
<span class="n">str_2kvj_dist</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/str_2kvj_dist.tif&quot;</span><span class="p">)</span>
<span class="n">w_str_w2k_dist</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_str_w2k_dist.tif&quot;</span><span class="p">)</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/dx.tif&quot;</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/dy.tif&quot;</span><span class="p">)</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/slope.tif&quot;</span><span class="p">)</span>
<span class="n">w_tci</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_tci.tif&quot;</span><span class="p">)</span>
<span class="n">w_spi</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_spi.tif&quot;</span><span class="p">)</span>
<span class="n">w_accum</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/grassout/w_accum.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_rasters</span> <span class="o">=</span> <span class="p">[</span><span class="n">elv</span><span class="p">,</span> <span class="n">w_basin</span><span class="p">,</span> <span class="n">str_2kvj_dist</span><span class="p">,</span> <span class="n">w_str_w2k_dist</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">w_tci</span><span class="p">,</span> <span class="n">w_spi</span><span class="p">,</span> <span class="n">w_accum</span><span class="p">]</span>
<span class="n">stack</span> <span class="o">=</span> <span class="n">Raster</span><span class="p">(</span><span class="n">predictors_rasters</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">rfReg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot regression result</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;plasma&quot;</span>
<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_123_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/user/my_SE_data/exercise/landsat/mean_pyjeo.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_124_0.png" /></p>
</section>
</section>
<section id="follow-up">
<h2><span class="section-number">2.7.7. </span>5 Follow up<a class="headerlink" href="#follow-up" title="Permalink to this headline"></a></h2>
<p>This case study was primarily for learning the tools and how bash, python, grass etc can be combined in one environment. Obviously there are many improvements that can be done for the case study itself. Some are listed below</p>
<ul class="simple">
<li><p>consider more explanatory variables and remove w_basin</p></li>
<li><p>test deep learning methods</p></li>
<li><p>look into other response variables that better catch the variability of the environment and try to distinguish among the long-lived and short-lived vegetation</p></li>
<li><p>expand the area to include larger environmental variability</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Species_Distribution_Model_with_Random_Forest_Afroditi_Grigoropoulou.html" class="btn btn-neutral float-left" title="2.6. Afroditi Grigoropoulou: Species Distribution Model with Random Forest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Distributionof_Fresh_water_Biodiversity_AcrossCuba_Yusdiel_Torres.html" class="btn btn-neutral float-right" title="2.8. Yusdiel Torres-Cambas: Distribution of freshwater biodiversity across Cuba" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>