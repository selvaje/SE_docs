

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Processing Elmer/Ice output &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Spatial Ecology's code documentation
          

          
            
            <img src="../../_static/SE_compact.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
</ul>
<p class="caption"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_Colab_for_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_for_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRTUALMACHINE/Setting_OSGeoLive_curso_para_Ecologia_Espacial.html">Prepare OSGeoLive para el curso de ecolog√≠a espacial</a></li>
</ul>
<p class="caption"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
</ul>
<p class="caption"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>
<p class="caption"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
</ul>
<p class="caption"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CASESTUDY/NN-day3.html">LSTM Network</a></li>
</ul>
<p class="caption"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
</ul>
<p class="caption"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spatial Ecology's code documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Processing Elmer/Ice output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/STUDENTSPROJECTS/SW2021/Felicity_Alice_Holmes_Geocomp_project.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Processing-Elmer/Ice-output">
<h1>Processing Elmer/Ice output<a class="headerlink" href="#Processing-Elmer/Ice-output" title="Permalink to this headline">¬∂</a></h1>
<div class="section" id="Felicity-Holmes">
<h2>Felicity Holmes<a class="headerlink" href="#Felicity-Holmes" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="General-Project-Description">
<h3>General Project Description<a class="headerlink" href="#General-Project-Description" title="Permalink to this headline">¬∂</a></h3>
<p>For my PhD project, I use an ice-sheet model called Elmer/Ice. Specifcally, I am simulating the glacier Kronebreen, Svalbard for the time period 2016 - 2017 and comparing the output to observational data in order to evaluate the applicability of Elmer/Ice in this location. The long-term goal is to use the tuned model to simulate the development of the glacier until 2100.</p>
<p>After each simulation, I have the following output:</p>
<ol class="arabic simple">
<li><p>A .csv file with point data for various variables (e.g.¬†velocity, pressure, elevation) at each timestep</p></li>
<li><p>A .dat file for each partition containing the mean velocity value after each timestep. Of particular interest is partition 0, which covers the front (and most dynamically exciting) part of the glacier.</p></li>
</ol>
<p>For the project, I want to explore this data and build up a processing chain that I can use to analyse the output. My current simulations in Elmer/Ice are not final as I am still tuning parameters etc, but I use my ‚Äòbest yet‚Äô output for this project. This means that any conclusions drawn from the analysis are only preliminary, but provide a framework for exploration and analysis of the output.</p>
<p>Specifically, my aims are: 1) To convert the point data into a raster than I can then compare to observations. This would allow me to identify whether the model is performing well and highlight any areas of particulary good or bad performance.</p>
<ol class="arabic simple" start="2">
<li><p>To look at the time series of mean velocities and understand how important surface mass balance (and its constituent components) are with regards to determining velocities. In order to do this, I want to explore the utility of a few techniques such as dynamic time warping and a random forest regressor.</p></li>
</ol>
<p>I will split up this report into parts 1 and 2; part 1 will deal with the point data (mainly geocomputation) and part 2 will deal with the data from the frontal partition (geocomputation and modelling).</p>
</div>
<div class="section" id="Part-1:-Point-data-exploration">
<h3>Part 1: Point data exploration<a class="headerlink" href="#Part-1:-Point-data-exploration" title="Permalink to this headline">¬∂</a></h3>
<p>Although it is possible to export a .csv file for every timestep, I have opted to focus on the final timestep for this project. The initial conditions for the glacier are derived from observations, so it is of interest to see if the modelled and observed development of the glacier are similar. Although it would be of interest to conduct this analysis at regular intervals (e.g.¬†once a month), the output that I am using for this project is preliminary and only spans 52 days. Therefore, this
project will only compare the final model output to the appropriate observational data but forms a basis for more comprehensive analysis in the future.</p>
<p>The .csv data is 3D with data being provided for the entire depth of the glacier. However, I am primarily interested in the surface values as the observational data only shows surface properties. The first steps are therefore to:</p>
<ol class="arabic simple">
<li><p>Extract all the data when ‚Äòdepth &lt; 5‚Äô. I am using depth &lt; 5 rather than depth == 0 as the surface nodes do not always lie precisely at 0m depth due to mesh evolution</p></li>
<li><p>Investigate the available variables and the number of data points</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># Extract surface data. Using depth &lt; 5 rather than depth == 0 as some surface nodes</span>
<span class="c1"># are not exactly 0</span>
awk <span class="s1">&#39;{if ($0&lt;5) print}&#39;</span> <span class="s2">&quot;./inputs/calving_elmer_output.txt&quot;</span> &gt; ./outputs/depth0_calvingVariables.txt

head -n <span class="m">1</span> ./outputs/depth0_calvingVariables.txt

wc -l ./outputs/depth0_calvingVariables.txt

tail -n <span class="m">1</span> ./outputs/depth0_calvingVariables.txt <span class="p">|</span> grep -o <span class="s2">&quot; &quot;</span> <span class="p">|</span> wc -l
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#34;depth&#34; &#34;temperature homologous&#34; &#34;smb&#34; &#34;velocity:0&#34; &#34;velocity:1&#34; &#34;velocity:2&#34; &#34;frontadvance:0&#34; &#34;frontadvance:1&#34; &#34;frontadvance:2&#34; &#34;calving:0&#34; &#34;calving:1&#34; &#34;calving:2&#34; &#34;Points:0&#34; &#34;Points:1&#34; &#34;Points:2&#34;
8330 ./outputs/depth0_calvingVariables.txt
14
</pre></div></div>
</div>
<p>It appears that the velocity variables are given in x, y, z but I would like to calculate the magnitude.</p>
<p>The next step is therefore to calculate the magnitude of velocity in 2D (just taking into account velocity in the x and y directions).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Get the header line and add &#39;velocity_magnitude&#39;, then save this as a file</span>

<span class="n">fp</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./outputs/depth0_calvingVariables.txt&#39;</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;velocity_magnitude&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;./outputs/calvingData_names.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the velocity magnitude and append to dataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;./outputs/depth0_calvingVariables.txt&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">temp</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">velocity_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">velocity_mag</span><span class="p">)</span>

<span class="n">temp_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8329</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Save the new datatset</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">temp_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;./outputs/calving_velocity_mag.csv&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In order to double check that the operation was successful, the number of columns will be counted and the first few lines of data will be printed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

tail -n <span class="m">1</span> ./outputs/depth0_calvingVariables.txt <span class="p">|</span> grep -o <span class="s2">&quot; &quot;</span> <span class="p">|</span> wc -l

tail -n <span class="m">1</span> ./outputs/calving_velocity_mag.csv <span class="p">|</span> grep -o <span class="s2">&quot;,&quot;</span> <span class="p">|</span> wc -l

head ./outputs/calving_velocity_mag.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14
15
129.01,0.0,0.0,0.0,0.0,0.0,5.3266e-11,-5.3521e-11,-1.2158e-12,0.0,0.0,0.0,448350.0,8758700.0,7.1788,0.0
192.91,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,449270.0,8758200.0,6.9542,0.0
177.27,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,448800.0,8758500.0,10.856,0.0
148.28,0.0,0.0,-781.79,782.08,20.19,-2.3741,2.3852,0.054103,0.0,0.0,0.0,448300.0,8758600.0,-1.6698e-09,1105.823100907193
151.78,0.0,0.0,-1938.0,1134.2,-8.5292e-08,-5.922,3.506,1.2153e-10,0.0,0.0,0.0,448200.0,8758100.0,4.1405e-11,2245.4963014888267
162.41,0.0,0.0,-1073.8,993.68,-4.7606e-08,-3.2781,3.0476,6.7156e-11,0.0,0.0,0.0,448270.0,8758400.0,-2.3167e-12,1463.0264462408054
161.58,0.0,0.0,-1258.8,1170.4,-5.7489e-08,-3.8313,3.5924,7.3778e-11,0.0,0.0,0.0,448200.0,8758400.0,-2.2002e-11,1718.840772148485
152.99,0.0,0.0,-1741.2,1127.1,-7.164e-08,-5.3043,3.4774,1.2594e-10,0.0,0.0,0.0,448210.0,8758200.0,2.8983e-10,2074.1581063168737
155.49,0.0,0.0,-936.15,881.14,-5.2037e-08,-2.8785,2.6741,7.6945e-11,0.0,0.0,0.0,448290.0,8758500.0,4.1447e-11,1285.606674725983
154.17,0.0,0.0,-1629.5,1150.1,-7.2964e-08,-4.9626,3.5429,9.8018e-11,0.0,0.0,0.0,448200.0,8758200.0,-2.6549e-12,1994.492481810849
</pre></div></div>
</div>
<p>To get a coherent view of what the velocities look like across the glacier, I want to convert the point data into a raster.</p>
<p>This can be done using gdal_grid but, in order to do this, a vrt header must be made for the data file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

cat ./inputs/calving_velocity_mag.vrt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;OGRVRTDataSource&gt;
    &lt;OGRVRTLayer name=&#34;calving_velocity_mag&#34;&gt;
        &lt;SrcDataSource&gt;CSV:./outputs/calving_velocity_mag.csv&lt;/SrcDataSource&gt;
        &lt;GeometryType&gt;wkbPoint&lt;/GeometryType&gt;
        &lt;GeometryField encoding=&#34;PointFromColumns&#34; x=&#34;field_13&#34; y=&#34;field_14&#34; z=&#34;field_16&#34;/&gt;
    &lt;/OGRVRTLayer&gt;
&lt;/OGRVRTDataSource&gt;
</pre></div></div>
</div>
<p>The raster can now be created using gdal_grid.</p>
<p>There are a number of different options available with regards to the interpolation algorithm. For this project, I have chosen to use the inverse distance to a power (‚Äòinvdist‚Äô) algorithm, which is a weighted average interpolator.</p>
<p>Both the weighting power ‚Äòp‚Äô and the smoothing parameter ‚Äòs‚Äô can be user defined. As velocities across a glacier do not vary abruptly, I have opted for a high smoothing paramater of 500.</p>
<p>The raster is then clipped by extent using a shapefile that covers the area of Kronebreen (via gdalwarp), before being visualised using openev.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

gdal_grid -a invdist:power<span class="o">=</span><span class="m">1</span>.0:smoothing<span class="o">=</span><span class="m">500</span>.0 -outsize <span class="m">400</span> <span class="m">400</span> -of GTiff -ot Float64 -l <span class="se">\</span>
        calving_velocity_mag ./inputs/calving_velocity_mag.vrt ./outputs/calving_velocity_mag.tiff

gdalwarp -overwrite -cutline ./inputs/Domain.shp -crop_to_cutline -s_srs EPSG:32633 -t_srs EPSG:32633 <span class="se">\</span>
        ./outputs/calving_velocity_mag.tiff ./outputs/cropped_calving_velocity_mag.tiff -dstnodata <span class="m">9999</span>

/usr/bin/openev/bin/openev ./outputs/cropped_calving_velocity_mag.tiff
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Grid data type is &#34;Float64&#34;
Grid size = (400 400).
Corner coordinates = (447926.775000 8764912.375000)-(466553.225000 8754987.625000).
Grid cell size = (46.450000 24.750000).
Source point count = 8329.
Algorithm name: &#34;invdist&#34;.
Options are &#34;power=1.000000:smoothing=500.000000:radius1=0.000000:radius2=0.000000:angle=0.000000:max_points=0:min_points=0:nodata=0.000000&#34;

0...10...20...30...40...50...60...70...80...90...100 - done.
Creating output file that is 522P x 279L.
Processing ./outputs/calving_velocity_mag.tiff [1/1] : 0...10...20...30...40...50...60...70...80...90...100 - done.
Default software rendering mode (use -h if accelerated video card installed).
Loading tools from /usr/bin/openev/tools/Tool_DriverList.py
Loading tools from /usr/bin/openev/tools/Tool_Export.py
Loading tools from /usr/bin/openev/tools/Tool_ShapesGrid.py
</pre></div></div>
</div>
<p>These modelled velocities are now ready to be compared to the observed velocities, which are also provided as a .tiff.</p>
<p>For this operation, I use gdal_calc to subtract one raster from the other and thus create a map of difference. I first use gdalwarp to make sure the two rasters have the same extent and resample the rasters so the pixel size is consistent.</p>
<p>The extents are still slightly different, but this can be worked around by using the ‚Äìextent flag in gdal_calc. It is notable that the two rasters have different units; observations are given in m/day whereas the modelled velocities are in m/year. The observed velocities are therefore multiplied by 365.25 within gdal_calc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

gdalwarp -overwrite -cutline ./inputs/Domain.shp -crop_to_cutline -s_srs EPSG:32633 -t_srs EPSG:32633 <span class="se">\</span>
./inputs/kroneVelo_Observed.tif ./outputs/kroneVelo_Observed_crop.tiff -dstnodata <span class="m">9999</span>

gdalwarp -tr <span class="m">10</span> -10 ./outputs/kroneVelo_Observed_crop.tiff ./outputs/kroneVelo_Observed_crop_resample.tiff
gdalwarp -tr <span class="m">10</span> -10 ./outputs/cropped_calving_velocity_mag.tiff ./outputs/cropped_calving_velocity_mag_resample.tiff

gdal_calc.py -A ./outputs/cropped_calving_velocity_mag_resample.tiff  -B ./outputs/kroneVelo_Observed_crop_resample.tiff  <span class="se">\</span>
--outfile<span class="o">=</span>./outputs/model_obs_comparison.tif --calc<span class="o">=</span><span class="s2">&quot;A-(B*365.25)&quot;</span> --extent<span class="o">=</span><span class="s2">&quot;intersect&quot;</span>

/usr/bin/openev/bin/openev ./outputs/model_obs_comparison.tif
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Creating output file that is 6309P x 3362L.
Processing ./inputs/kroneVelo_Observed.tif [1/1] : 0Using internal nodata values (e.g. 0) for image ./inputs/kroneVelo_Observed.tif.
...10...20...30...40...50...60...70...80...90...100 - done.
Creating output file that is 1863P x 993L.
Processing ./outputs/kroneVelo_Observed_crop.tiff [1/1] : 0Using internal nodata values (e.g. 9999) for image ./outputs/kroneVelo_Observed_crop.tiff.
Copying nodata values from source ./outputs/kroneVelo_Observed_crop.tiff to destination ./outputs/kroneVelo_Observed_crop_resample.tiff.
...10...20...30...40...50...60...70...80...90...100 - done.
Creating output file that is 1859P x 993L.
Processing ./outputs/cropped_calving_velocity_mag.tiff [1/1] : 0Using internal nodata values (e.g. 9999) for image ./outputs/cropped_calving_velocity_mag.tiff.
Copying nodata values from source ./outputs/cropped_calving_velocity_mag.tiff to destination ./outputs/cropped_calving_velocity_mag_resample.tiff.
...10...20...30...40...50...60...70...80...90...100 - done.
0.. 0.. 1.. 2.. 3.. 4.. 5.. 5.. 6.. 7.. 8.. 9.. 10.. 10.. 11.. 12.. 13.. 14.. 15.. 15.. 16.. 17.. 18.. 19.. 20.. 20.. 21.. 22.. 23.. 24.. 25.. 25.. 26.. 27.. 28.. 29.. 30.. 30.. 31.. 32.. 33.. 34.. 35.. 35.. 36.. 37.. 38.. 39.. 40.. 40.. 41.. 42.. 43.. 44.. 45.. 45.. 46.. 47.. 48.. 49.. 50.. 50.. 51.. 52.. 53.. 54.. 55.. 55.. 56.. 57.. 58.. 59.. 60.. 60.. 61.. 62.. 63.. 64.. 65.. 65.. 66.. 67.. 68.. 69.. 70.. 70.. 71.. 72.. 73.. 74.. 75.. 75.. 76.. 77.. 78.. 79.. 80.. 80.. 81.. 82.. 83.. 84.. 85.. 85.. 86.. 87.. 88.. 89.. 90.. 90.. 91.. 92.. 93.. 94.. 95.. 95.. 96.. 97.. 98.. 99.. 100 - Done
Default software rendering mode (use -h if accelerated video card installed).
Loading tools from /usr/bin/openev/tools/Tool_DriverList.py
Loading tools from /usr/bin/openev/tools/Tool_Export.py
Loading tools from /usr/bin/openev/tools/Tool_ShapesGrid.py
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;./outputs/model_obs_comparison.tif&quot;</span><span class="p">)</span>
<span class="n">modelled</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;./outputs/cropped_calving_velocity_mag_resample.tiff&quot;</span><span class="p">)</span>
<span class="n">observed</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;./outputs/kroneVelo_Observed_crop_resample.tiff&quot;</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>

<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Modelled - Observed velocities (m/yr)&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">modelled</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Modelled velocities (m/yr)&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">observed</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mf">365.25</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observed velocities (m/yr)&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_2.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_14_2.png" />
</div>
</div>
<p>The final results from Part 1 show that modelled velocities are systematically higher than the observed velocities. This suggests that there may be an issue with a parameter such as basal friction or ice viscosity. It should be noted that some of the differences are explainable:</p>
<ol class="arabic simple">
<li><p>The very front of the glacier shows very low velocities. This is due to the retreat of the glacier and so this area should be ignored</p></li>
<li><p>Observed velocities contain error (est. up to 150 m/yr). This is particlarly true for slow flowing regions where little change occurs being subsequent satellite images. Therefore, we expect greater error over the upper parts of the glacier and place less emphasis on getting perfect correspondaance here.</p></li>
</ol>
<p>Despite this, the above analysis is of great help in terms of tuning and evaluating my ice sheet model set-up and has identified that I need to look into why the glacier is flowing faster than expected.</p>
</div>
<div class="section" id="Part-2:-Time-series-of-Velocity-and-Surface-Mass-Balance">
<h3>Part 2: Time series of Velocity and Surface Mass Balance<a class="headerlink" href="#Part-2:-Time-series-of-Velocity-and-Surface-Mass-Balance" title="Permalink to this headline">¬∂</a></h3>
<p>I want to analyse a time series of frontal velocities from Kronebreen, Svalbard.</p>
<p>I have configured the Elmer/Ice model to output the average velocity for each partition, with partition 0 corresponding to the frontal section of the glacier. As this is the most dynamic and interesting part of the glacier, it is this area that will be focused on for this project.</p>
<p>I first want to explore the data files and then begin with a simple visualisation of how velocity varies throughout the simulation.</p>
<p>The data files do not have headers, but a separate file ‚Äòcalving_averages.dat.names‚Äô provides a list of the variables included.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># View the metadata - variable names, where the data comes from etc</span>

cat ./inputs/calving_averages/calving_averages.dat.names

<span class="c1"># Look at the first row of data</span>

head -n <span class="m">1</span> ./inputs/calving_averages/calving_averages.dat.0

<span class="c1"># Check the number of rows</span>

wc -l ./inputs/calving_averages/calving_averages.dat.0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Elmer version: 9.0
Elmer revision: ae1635a
Elmer compilation date: 2021-01-20
Solver input file: krone_calving.sif
File started at: 2021/05/19 17:31:54

Variables in columns of matrix: ./calving_averages.dat
   1: mean: velocity 1
   2: mean: velocity 2
   3: mean: velocity 3
   4: mean: smb
   5: res: solver cpu time distance
   6: res: solver real time distance
   7: res: solver cpu time navier-stokes
   8: res: solver real time navier-stokes
   9: res: solver cpu time stresssolver
  10: res: solver real time stresssolver
  11: res: solver cpu time longitudinal mesh update
  12: res: solver real time longitudinal mesh update
  13: res: solver cpu time free surface top
  14: res: solver real time free surface top
  15: res: solver cpu time free surface bottom
  16: res: solver real time free surface bottom
  17: res: solver cpu time vertical mesh update
  18: res: solver real time vertical mesh update
  19: res: solver cpu time 3d calving
  20: res: solver real time 3d calving
  21: res: solver cpu time remesh
  22: res: solver real time remesh
  23: mean: velocity magnitude
-1.06E+03,-1.30E+02,-2.49E+03,-3.12E+00,8.07E-03,1.58E-02,4.50E+01,4.63E+01,8.03E-01,8.27E-01,1.67E-01,1.81E-01,4.62E-01,5.49E-01,1.45E-01,1.76E-01,3.54E-01,3.89E-01,1.20E-01,4.07E-01,2.38E+00,3.08E+00,1064.157847
52 ./inputs/calving_averages/calving_averages.dat.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># Plot velocity magnitude</span>

R --vanilla -q

<span class="c1"># Prepare the data and create an array &#39;timesteps&#39;</span>
<span class="c1">#tseries = read.table(&quot;./inputs/longSpinUP_averages/longSpinUp_averages.dat.0&quot;, sep=&quot;,&quot; , header=FALSE)</span>
<span class="nv">tseries</span> <span class="o">=</span> read.table<span class="o">(</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span>, <span class="nv">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span> , <span class="nv">header</span><span class="o">=</span>FALSE<span class="o">)</span>
head<span class="o">(</span>tseries<span class="o">)</span>
<span class="nv">timesteps</span> <span class="o">=</span> t<span class="o">(</span><span class="m">1</span>:52<span class="o">)</span>

<span class="c1">#Create the plot</span>
png<span class="o">(</span><span class="s2">&quot;./images/explore_velocities.png&quot;</span><span class="o">)</span>
plot<span class="o">(</span><span class="nv">x</span><span class="o">=</span>timesteps, <span class="nv">y</span><span class="o">=</span>tseries<span class="nv">$V23</span>, <span class="nv">pch</span><span class="o">=</span><span class="m">4</span>, <span class="nv">cex</span><span class="o">=</span><span class="m">2</span>, <span class="nv">col</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>, <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;l&#39;</span>, <span class="nv">ylab</span><span class="o">=</span><span class="s2">&quot;Velocity magnitude (m/yr)&quot;</span>, <span class="nv">xlab</span><span class="o">=</span><span class="s2">&quot;Timestep&quot;</span><span class="o">)</span>
dev.off<span class="o">()</span>

<span class="c1">#Spare code to plot x and y velocities...</span>
<span class="c1">#plot(x=timesteps, y=tseries$V3, pch=4, cex=2, col=&quot;blue&quot;, xlab=(&quot;Timestep&quot;), ylab=(&quot;Y Velocity (blue) (m/yr)&quot;), type=&#39;l&#39;, ylim=c(-550,1000))</span>
<span class="c1">#par(new=T)</span>
<span class="c1">#plot(x=timesteps, y=tseries$V2, pch=4, cex=2, col=&quot;red&quot;, type=&#39;l&#39;, ylim=c(-3500,-600), axes=F, ylab=NA, xlab=NA)+axis(side=4)+mtext(&quot;X Velocity (red) (m/yr)&quot;, side=4,line=-1.0)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt;
&gt; # Prepare the data and create an array &#39;timesteps&#39;
&gt; #tseries = read.table(&#34;./inputs/longSpinUP_averages/longSpinUp_averages.dat.0&#34;, sep=&#34;,&#34; , header=FALSE)
&gt; tseries = read.table(&#34;./inputs/calving_averages/calving_averages.dat.0&#34;, sep=&#34;,&#34; , header=FALSE)
&gt; head(tseries)
     V1     V2      V3      V4      V5      V6    V7    V8    V9   V10   V11
1 -1060 -130.0 -2490.0  -3.120 0.00807 0.01580 45.00 46.30 0.803 0.827 0.167
2 -3510  402.0   -53.7   5.930 0.00561 0.00937  5.84  6.08 0.172 0.186 0.108
3 -2160   -6.7 -2490.0   0.955 0.00351 0.00887  4.69  4.99 0.171 0.193 0.102
4 -3680  988.0   -66.2 -16.600 0.00569 0.00635  4.72  4.93 0.175 0.189 0.110
5 -3640  969.0   -70.2 -23.400 0.00503 0.00979  8.45  8.91 0.170 0.187 0.111
6 -3400  926.0   -59.0 -13.000 0.00435 0.01050  7.22  7.69 0.173 0.192 0.122
    V12    V13    V14    V15    V16    V17    V18    V19   V20   V21  V22
1 0.181 0.4620 0.5490 0.1450 0.1760 0.3540 0.3890 0.1200 0.407 2.380 3.08
2 0.118 0.0349 0.0502 0.0201 0.0278 0.0675 0.0726 0.0868 0.216 0.713 1.04
3 0.114 0.0322 0.0507 0.0131 0.0186 0.0664 0.0720 0.0796 0.203 0.626 1.00
4 0.120 0.0383 0.0526 0.0272 0.0363 0.0660 0.0738 0.0764 0.206 0.720 1.76
5 0.122 0.0380 0.0544 0.0165 0.0279 0.0680 0.0738 0.0871 0.202 0.591 1.70
6 0.132 0.0423 0.0605 0.0157 0.0271 0.0702 0.0752 0.0876 0.221 0.781 1.09
       V23
1 1064.158
2 3529.869
3 2163.036
4 3814.982
5 3767.336
6 3523.405
&gt; timesteps = t(1:52)
&gt;
&gt; #Create the plot
&gt; png(&#34;./images/explore_velocities.png&#34;)
&gt; plot(x=timesteps, y=tseries$V23, pch=4, cex=2, col=&#34;red&#34;, type=&#39;l&#39;, ylab=&#34;Velocity magnitude (m/yr)&#34;, xlab=&#34;Timestep&#34;)
&gt; dev.off()
null device
          1
&gt;
&gt; #Spare code to plot x and y velocities...
&gt; #plot(x=timesteps, y=tseries$V3, pch=4, cex=2, col=&#34;blue&#34;, xlab=(&#34;Timestep&#34;), ylab=(&#34;Y Velocity (blue) (m/yr)&#34;), type=&#39;l&#39;, ylim=c(-550,1000))
&gt; #par(new=T)
&gt; #plot(x=timesteps, y=tseries$V2, pch=4, cex=2, col=&#34;red&#34;, type=&#39;l&#39;, ylim=c(-3500,-600), axes=F, ylab=NA, xlab=NA)+axis(side=4)+mtext(&#34;X Velocity (red) (m/yr)&#34;, side=4,line=-1.0)
&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">&quot;./images/explore_velocities.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_19_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_19_0.png" />
</div>
</div>
<p>It looks like velocity begins high (c.¬†3500 m/yr) at the beginning of the simulation - probably due to the initial conditions imposed by the simulation. After around 5 days, the velocity drops abd begins oscillating around 2000 m/yr.</p>
<p>The velocity varies considerably between timesteps, with lows of 500 m/yr and highs of around 3000 m/yr. This may be due to differences in surface mass balance (SMB) or in internal dynamics due to the impacts of, for example, calving events.</p>
<p>Each timestep is one day, and the above plot covers a 52 day period corresponding the the first 52 days of the calendar year in 2016.</p>
<p>The model is forced by a surface mass balance (SMB) dataset which is calculated as follows:</p>
<p>SMB = PR - RU - SU - ER</p>
<p>where</p>
<p>RU = ME + RA - RF</p>
<p>PR is total precipitation (including snowfall and rainfall), RU is meltwater runoff, SU is total sublimation and ER is erosion from drifting snow. Runoff is composed of liquid water from rain (RA) and melt (ME) that is not retained or refrozen in firn (RF).</p>
<p>I want to look into the relationship between velocity and SMB by comparing the time series of velocities with the time series of SMB. The first step in this analysis is to plot the time series against eachother and compare them qualitatively.</p>
<p>The SMB data is from No√´l et al.¬†(2020), with some pre-processing having occured before use during this course project.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># Plot X velocity alongside SMB</span>

R --vanilla -q

<span class="c1"># Prepare the velocity and SMB data and create an array &#39;timesteps&#39;</span>
<span class="nv">input_series</span> <span class="o">=</span> read.table<span class="o">(</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span>, <span class="nv">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span> , <span class="nv">header</span><span class="o">=</span>FALSE<span class="o">)</span>
<span class="nv">timesteps</span> <span class="o">=</span> t<span class="o">(</span><span class="m">1</span>:52<span class="o">)</span>

<span class="c1">#Create the plots</span>
png<span class="o">(</span><span class="s2">&quot;./images/velocities_SMB.png&quot;</span><span class="o">)</span>
plot<span class="o">(</span><span class="nv">x</span><span class="o">=</span>timesteps, <span class="nv">y</span><span class="o">=</span>input_series<span class="nv">$V23</span>, <span class="nv">pch</span><span class="o">=</span><span class="m">4</span>, <span class="nv">cex</span><span class="o">=</span><span class="m">2</span>, <span class="nv">col</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>, <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;l&#39;</span>, <span class="nv">ylim</span><span class="o">=</span>c<span class="o">(</span><span class="m">0</span>,4000<span class="o">)</span>, <span class="nv">ylab</span><span class="o">=</span><span class="s2">&quot;Velocity magnitude(red) (m/yr)&quot;</span>, <span class="nv">xlab</span><span class="o">=</span><span class="s2">&quot;Timestep&quot;</span><span class="o">)</span>
par<span class="o">(</span><span class="nv">new</span><span class="o">=</span>T<span class="o">)</span>
plot<span class="o">(</span><span class="nv">x</span><span class="o">=</span>timesteps, <span class="nv">y</span><span class="o">=</span>input_series<span class="nv">$V5</span>, <span class="nv">pch</span><span class="o">=</span><span class="m">4</span>, <span class="nv">cex</span><span class="o">=</span><span class="m">2</span>, <span class="nv">col</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>, <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;l&#39;</span>, <span class="nv">axes</span><span class="o">=</span>F, <span class="nv">ylab</span><span class="o">=</span>NA, <span class="nv">xlab</span><span class="o">=</span>NA<span class="o">)</span>+axis<span class="o">(</span><span class="nv">side</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>+mtext<span class="o">(</span><span class="s2">&quot;SMB (green) (mm w.e./yr)&quot;</span>, <span class="nv">side</span><span class="o">=</span><span class="m">4</span>,line<span class="o">=</span>-1.0<span class="o">)</span>
dev.off<span class="o">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt;
&gt; # Prepare the velocity and SMB data and create an array &#39;timesteps&#39;
&gt; input_series = read.table(&#34;./inputs/calving_averages/calving_averages.dat.0&#34;, sep=&#34;,&#34; , header=FALSE)
&gt; timesteps = t(1:52)
&gt;
&gt; #Create the plots
&gt; png(&#34;./images/velocities_SMB.png&#34;)
&gt; plot(x=timesteps, y=input_series$V23, pch=4, cex=2, col=&#34;red&#34;, type=&#39;l&#39;, ylim=c(0,4000), ylab=&#34;Velocity magnitude(red) (m/yr)&#34;, xlab=&#34;Timestep&#34;)
&gt; par(new=T)
&gt; plot(x=timesteps, y=input_series$V5, pch=4, cex=2, col=&#34;green&#34;, type=&#39;l&#39;, axes=F, ylab=NA, xlab=NA)+axis(side=4)+mtext(&#34;SMB (green) (mm w.e./yr)&#34;, side=4,line=-1.0)
numeric(0)
&gt; dev.off()
null device
          1
&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">&quot;./images/velocities_SMB.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_22_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_22_0.png" />
</div>
</div>
<p>I want to see if there is a correlation between these two time series, and will start with a simple linear regression:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># Regress SMB against X velocity</span>

R --vanilla -q

<span class="nv">input_series</span> <span class="o">=</span> read.table<span class="o">(</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span>, <span class="nv">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span> , <span class="nv">header</span><span class="o">=</span>FALSE<span class="o">)</span>

<span class="nv">regression</span> <span class="o">=</span> lm<span class="o">(</span>V23 ~ V5, <span class="nv">data</span> <span class="o">=</span> input_series<span class="o">)</span>

summary<span class="o">(</span>regression<span class="o">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt;
&gt; input_series = read.table(&#34;./inputs/calving_averages/calving_averages.dat.0&#34;, sep=&#34;,&#34; , header=FALSE)
&gt;
&gt; regression = lm(V23 ~ V5, data = input_series)
&gt;
&gt; summary(regression)

Call:
lm(formula = V23 ~ V5, data = input_series)

Residuals:
     Min       1Q   Median       3Q      Max
-1457.71  -497.13   -53.78   452.40  1772.44

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   2372.8      352.5   6.732 1.58e-08 ***
V5          -58044.9    67071.9  -0.865    0.391
---
Signif. codes:  0 ‚Äò***‚Äô 0.001 ‚Äò**‚Äô 0.01 ‚Äò*‚Äô 0.05 ‚Äò.‚Äô 0.1 ‚Äò ‚Äô 1

Residual standard error: 764.8 on 50 degrees of freedom
Multiple R-squared:  0.01476,   Adjusted R-squared:  -0.004947
F-statistic: 0.7489 on 1 and 50 DF,  p-value: 0.3909

&gt;
</pre></div></div>
</div>
<p>The p value is poor (0.39) and shows the result is not statistically significant. The R^2 value is low at 0.15 suggesting that there is little correlation between surface mass balance and velocity magnitude. However, this is a very simply done analysis and is conducted only as an initial data exploration.</p>
<p>I will now try dynamic time warping as an alternative method for comparing the two time series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dtw</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Get the data</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="c1"># Smb in mm w.e. per YEAR converted to ice equiv. (as used in Elmer/Ice)</span>
<span class="n">reference</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="mf">365.25</span><span class="o">/</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">/</span><span class="mf">910.0</span><span class="p">)</span>


<span class="c1"># Perform the analysis</span>

<span class="n">alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">keep_internals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Display the warping curve, i.e. the alignment curve</span>
<span class="n">alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;threeway&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">dtw</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">keep_internals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window_type</span><span class="o">=</span><span class="s2">&quot;sakoechiba&quot;</span><span class="p">,</span> <span class="n">window_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;window_size&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
    <span class="n">step_pattern</span><span class="o">=</span><span class="n">rabinerJuangStepPattern</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;twoway&quot;</span><span class="p">,</span><span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">alignment</span><span class="o">.</span><span class="n">normalizedDistance</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_26_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_26_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_26_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_26_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1374.9222062850727
</pre></div></div>
</div>
<p>The patterns of the two time series looked similar when plotted side by side but the distance between them is relatively large, which could be partially due to the very different units.</p>
<p>A very close correspondance is not expected as ice dynamics do not react to external changes immediately but are partly controlled by preceding conditions.</p>
<p>However, noise may still be impacting the result, and the warp path jumps (rather than being broadly diagonal) suggesting a less-than-optimal fit. In order to try and remove some noise, I will apply a wavelet transform to extract the key features of the two time series and then re-run the dynamic time warp.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pywt</span>
<span class="c1"># Try out wavelet feature extraction ...</span>

<span class="c1">#Velocity</span>

<span class="n">sLst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">wav_transform_velocity</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">pywt</span><span class="o">.</span><span class="n">cwt</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">sLst</span><span class="p">,</span> <span class="s1">&#39;mexh&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_transform_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#SMB</span>

<span class="n">wav_transform_smb</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">pywt</span><span class="o">.</span><span class="n">cwt</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sLst</span><span class="p">,</span> <span class="s1">&#39;mexh&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_transform_smb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_28_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_28_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_28_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_28_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dtw</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Run dynamic time warp again</span>

<span class="n">alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="p">(</span><span class="n">wav_transform_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wav_transform_smb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">keep_internals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Display the warping curve, i.e. the alignment curve</span>
<span class="n">alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;threeway&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">dtw</span><span class="p">(</span><span class="n">wav_transform_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wav_transform_smb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">keep_internals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window_type</span><span class="o">=</span><span class="s2">&quot;sakoechiba&quot;</span><span class="p">,</span> <span class="n">window_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;window_size&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
    <span class="n">step_pattern</span><span class="o">=</span><span class="n">rabinerJuangStepPattern</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;twoway&quot;</span><span class="p">,</span><span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">alignment</span><span class="o">.</span><span class="n">normalizedDistance</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_29_0.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_29_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_29_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_29_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
468.9828699904016
</pre></div></div>
</div>
<p>With the wavelet pre-processing, there is a much reduced distance between the two time series (1375 vs 469), suggesting that there may some connection between the two. However, the warp path still does‚Äônt take a consistent, diagonal path. This means that the analysis is not overly successful and other techniques may be required to investigate the relationship.</p>
<p>The lack of good correspondance points to the fact that other variables besides SMB are also influencing the velocity of the glacier. These could be indirect effects of SMB (for example through thinning and thickening of the glacier in different areas altering the gravitational driving stress), or unrelated variables such as bed geometry.</p>
<p>It is also notable that SMB variations are not expected to immediately cause large velocity variations, as mentioned before. However, understanding how quickly the glacier can respond to external perturbations is of interest with regards to reducing uncertainty regarding how they will behave in the future and so in improving sea level rise estimates.</p>
<p>The results of the qualitative and dynamic time warp analyses show that there may be a connection between the two, although nothing significant has been identified yet.</p>
<p>I next want to split up SMB into its underlying components, so I can use these time series in my analysis. This will be useful for understanding whether frontal velocities are more sensitive to certain parameters and is also useful in investigating whether a single/few parameter(s) could be used to predict dynamical changes.</p>
<p>The variables I will focus on are: 1) Precipitation (mm w.e.) 2) Air Temperature (K) 3) Snowfall (mm w.e.) 4) Snowmelt (mm w.e.</p>
<p>The variables are given in separate .tiff files which each contain 365 bands with the mean value for each day in the period 2000-2019. Data will be extracted from each file for relevant location(s) using gdallocationinfo.</p>
<p>Due to the poor results obtained by the dynamic time warp analysis, I want to instead move forward by using the Random Forest algorithm to try and fit a regression model on the data. In this way, I can understand the relative importance of the various factors for frontal velocity at Kronebreen.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">total</span><span class="o">=</span><span class="mf">0.0</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./outputs/smb_components.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">53</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="s1">&#39;precip&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;snowfall&#39;</span><span class="p">,</span> <span class="s1">&#39;snowmelt&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">448209</span><span class="p">,</span> <span class="mi">449110</span><span class="p">,</span> <span class="mi">110</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8755649</span><span class="p">,</span> <span class="mi">8758086</span><span class="p">,</span> <span class="mi">250</span><span class="p">):</span>
                    <span class="n">temp</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;gdallocationinfo -valonly -geoloc -b </span><span class="si">%s</span><span class="s1"> ./inputs/daily_</span><span class="si">%s</span><span class="s1">_means_2000to2019_CROPPED.tif </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">+</span><span class="n">total</span>
            <span class="n">average</span><span class="o">=</span><span class="n">total</span><span class="o">/</span><span class="mi">100</span>
            <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">average</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
            <span class="n">total</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span> <span class="k">as</span> <span class="n">RFReg</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span><span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vel_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./inputs/calving_averages/calving_averages.dat.0&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">smb_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./outputs/smb_components.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">vel_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">smb_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1">#SMB components</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">smb_dataset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># Velocity magnitude</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">vel_dataset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">22</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precip&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;snowfall&#39;</span><span class="p">,</span> <span class="s1">&#39;snowmelt&#39;</span><span class="p">]</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(52, 4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(52, 1)
</pre></div></div>
</div>
<p>The data is split into training and testing datasets (various splits). After this, a pipeline is defined. This allows many different parameter combinations and scorings to be tested out.</p>
<p>After initial tests (not shown here), I added lower values for max_features and max_depth as well as a higher number for n_estimators into my pipeline.</p>
<p>In addition, I played around with different proportions of data used for training (20%, 50%, 70%) and different ways of scoring the regressions (R^2, explained variance, and negative root mean square error). The results from these tests are shown below:</p>
<div class="line-block">
<div class="line">Test size | Scoring | Train score (pearson) | Test score (pearson)|</div>
<div class="line">‚Äî | ‚Äî | ‚Äî | |</div>
<div class="line">0.2 | R^2 | 0.820 | -0.043 |</div>
<div class="line">0.5 | R^2 | 0.916 | -0.094 |</div>
<div class="line">0.7 | R^2 | 0.919 | 0.052 |</div>
<div class="line">0.2 | Explained variance | 0.922 | -0.087 |</div>
<div class="line">0.5 | Explained variance | 0.918 | -0.017 |</div>
<div class="line">0.7 | Explained variance | 0.931 | 0.095 |</div>
<div class="line">0.2 | Neg root mean square error | 0.816 | -0.068 |</div>
<div class="line">0.5 | Neg root mean square error | 0.937 | -0.079 |</div>
<div class="line">0.7 | Neg root mean square error | 0.951 | 0.091 |</div>
</div>
<p>The parameter combination which gives the best fit will then be used for analysis. This corresponds to: 1) A test size of <strong>0.7</strong> 2) Scoring based on <strong>negative root mean square error</strong> 3) Max depth: <strong>25</strong> 4) Max features: <strong>0.33</strong> 5) Max samples: <strong>0.7</strong> 6) Number of estimators: <strong>500</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Split into testing and training data sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Determine a pipeline to test out different parameters and find the set of</span>
<span class="c1"># parameters with the best fit. Various parameters are used to score the different fits.</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span><span class="n">RFReg</span><span class="p">())])</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rf__max_features&#39;</span><span class="p">:(</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
        <span class="s1">&#39;rf__max_samples&#39;</span><span class="p">:(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span>
        <span class="s1">&#39;rf__n_estimators&#39;</span><span class="p">:(</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">3000</span><span class="p">),</span>
        <span class="s1">&#39;rf__max_depth&#39;</span><span class="p">:(</span><span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">)}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fitting 3 folds for each of 256 candidates, totalling 768 fits
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GridSearchCV(cv=3, estimator=Pipeline(steps=[(&#39;rf&#39;, RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;rf__max_depth&#39;: (25, 50, 100, 200),
                         &#39;rf__max_features&#39;: (&#39;log2&#39;, &#39;sqrt&#39;, 0.33, 0.2),
                         &#39;rf__max_samples&#39;: (0.3, 0.5, 0.6, 0.7),
                         &#39;rf__n_estimators&#39;: (500, 1000, 2000, 3000)},
             scoring=&#39;neg_root_mean_squared_error&#39;, verbose=1)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-859.084465363649
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The best parameters are printed, and these are then used for the regression</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Best Training score: </span><span class="si">%0.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Optimal parameters:&#39;</span><span class="p">)</span>
<span class="n">best_par</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">for</span> <span class="n">par_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par_name</span><span class="p">,</span> <span class="n">best_par</span><span class="p">[</span><span class="n">par_name</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best Training score: -859.084
Optimal parameters:
        rf__max_depth: 25
        rf__max_features: 0.33
        rf__max_samples: 0.7
        rf__n_estimators: 500
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rfReg</span> <span class="o">=</span> <span class="n">RFReg</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">max_samples</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">rfReg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
<span class="n">dic_pred</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">y_train</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">y_test</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.950879197769439, 0.09090151937598724]
</pre></div></div>
</div>
<p>Using Pearson‚Äôs R, it can be seen that there is agood fit for the testing data (0.951) but a very poor fit for the testing data (0.091).</p>
<p>This is likely due to overfitting and the following parameters could be altered to try and fix this:</p>
<ol class="arabic simple">
<li><p>max_features - Reducing this number will reduce the number of features each tree is randomly assigned</p></li>
<li><p>max_depth - Reducing this parameter lowers the complexity of the learned models, and thus minimises the risk of over fitting</p></li>
<li><p>n_estimators - Overfitting is less likely with more estimators</p></li>
</ol>
<p>However,despite adding more possible parameters into my pipeline, no solution could be found to improve the results and prevent overfitting. A key limitation for this model is the lack of input data. Although this is a dissapointing realisation, it does give me hope that when I move on to running longer simulations (with e.g.¬†over 1000 timesteps), I may see some progress.</p>
<p>Despite this, I still want to visualise the results and look into the relative importance of all the various predictors for the best fit regression that I have:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;orig&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pred&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7f0a5200e940&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_44_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_44_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">dic_pred</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;orig&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pred&#39;</span><span class="p">)</span>
<span class="n">ident</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span><span class="n">ident</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7f0a5202ec10&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_45_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_45_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get numerical feature importances</span>
<span class="n">importances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span>
<span class="c1"># List of tuples with variable and importance</span>
<span class="n">feature_importances</span> <span class="o">=</span> <span class="p">[(</span><span class="n">feature</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">importance</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">importance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">importances</span><span class="p">)]</span>
<span class="c1"># Sort the feature importances by most important first</span>
<span class="n">feature_importances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">feature_importances</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># Print out the feature and importances</span>
<span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Variable: </span><span class="si">{:20}</span><span class="s1"> Importance: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">))</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">feature_importances</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Variable: precip               Importance: 0.28
Variable: t2m                  Importance: 0.25
Variable: snowfall             Importance: 0.24
Variable: snowmelt             Importance: 0.23
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the importance of different predictors</span>
<span class="n">impt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rfReg</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfReg</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)),</span><span class="n">impt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">impt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;Snowfall&#39;</span><span class="p">,</span> <span class="s1">&#39;Snowmelt&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
([&lt;matplotlib.axis.YTick at 0x7f0a51e69220&gt;,
  &lt;matplotlib.axis.YTick at 0x7f0a51e78b80&gt;,
  &lt;matplotlib.axis.YTick at 0x7f0a51e67a30&gt;,
  &lt;matplotlib.axis.YTick at 0x7f0a51de0a00&gt;],
 [Text(0, 3, &#39;precipitation&#39;),
  Text(0, 2, &#39;temperature&#39;),
  Text(0, 1, &#39;Snowfall&#39;),
  Text(0, 0, &#39;Snowmelt&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_47_1.png" src="../../_images/STUDENTSPROJECTS_SW2021_Felicity_Alice_Holmes_Geocomp_project_47_1.png" />
</div>
</div>
<p>The final results show that the predictors used in this study are not sufficient to predict frontal velocity at Kronebreen (at least for this short time period). However, all the predictors did have some importance and so are not irrelevant parameters. The relative importance of the different parameters was similar, but snowmelt came out as being the most important predictor.</p>
<p>Full reference for SMB data:</p>
<p>No√´l, Brice P Y; Jakobs, Constantijn L; van Pelt, Ward; Lhermitte, Stef; Wouters, Bert; Kohler, Jack; Hagen, Jon Ove; Luks, Bart≈Çomiej; Reijmer, Carleen; van de Berg, Willem Jan; van den Broeke, Michiel R (2020): Annual surface mass balance (SMB) and components of Svalbard glaciers statistically downscaled to 500 m spatial resolution (1958-2018). PANGAEA, <a class="reference external" href="https://doi.org/10.1594/PANGAEA.920984">https://doi.org/10.1594/PANGAEA.920984</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Giuseppe Amatulli.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>