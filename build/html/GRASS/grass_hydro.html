

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using GRASS for stream-network extraction and basins delineation &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SDM1 : Montane woodcreper - Gecomputation" href="../CASESTUDY/101_SDM1_MWood_gecomp.html" />
    <link rel="prev" title="GRASS Introduction" href="grass_intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Spatial Ecology's code documentation
          

          
            
            <img src="../_static/SE_compact.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
</ul>
<p class="caption"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/00_Setting_Colab_for_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/00_Setting_OSGeoLive_for_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
</ul>
<p class="caption"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../BASH/03_bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/03_bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/03_bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AWK/30_awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/01_gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/01_gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/02_pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/02_pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
</ul>
<p class="caption"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../R/05_R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/01_Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/02_Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>
<p class="caption"><span class="caption-text">GRASS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using GRASS for stream-network extraction and basins delineation</a></li>
</ul>
<p class="caption"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/101_SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/101_SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/101_SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/110_manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/120_Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/121_temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/122_pred_NP.html"># NP Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/122_pred_NP.html#BackGround">BackGround</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/122_pred_NP.html#Code">Code</a></li>
</ul>
<p class="caption"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/video.html">Video tips</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spatial Ecology's code documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using GRASS for stream-network extraction and basins delineation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/GRASS/grass_hydro.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Using-GRASS-for-stream-network-extraction-and-basins-delineation">
<h1>Using GRASS for stream-network extraction and basins delineation<a class="headerlink" href="#Using-GRASS-for-stream-network-extraction-and-basins-delineation" title="Permalink to this headline">¶</a></h1>
<p>In this exercize we use GRASS to extract stream-network and delineate basins. We simulate a case that we can not run the full South America continent in one tile becasue we reach RAM limitation. Therefore we compute the analysis in 3 tiles and then we combine the results.</p>
<div class="line-block">
<div class="line">Considering that GRASS can not working properly under /media/sf_LVM_shared/my_SE_data/ therefore we create a working copy of the SE_data under</div>
<div class="line">/home/user/my_SE_data/</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

mkdir -p /home/user/my_SE_data/exercise
cp -r /home/user/SE_data/exercise/grassdb /home/user/my_SE_data/exercise
<span class="nb">cd</span> /home/user/my_SE_data/exercise

<span class="c1"># install the GRASS add-on r.stream.basins</span>

grass76 -text grassdb/europe/PERMANENT/ <span class="s">&lt;&lt;EOF</span>
<span class="s">g.extension extension=r.stream.basins</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Cleaning up temporary files...
Starting GRASS GIS...

          __________  ___   __________    _______________
         / ____/ __ \/   | / ___/ ___/   / ____/  _/ ___/
        / / __/ /_/ / /| | \__ \\_  \   / / __ / / \__ \
       / /_/ / _, _/ ___ |___/ /__/ /  / /_/ // / ___/ /
       \____/_/ |_/_/  |_/____/____/   \____/___//____/

Welcome to GRASS GIS 7.6.1
GRASS GIS homepage:                      https://grass.osgeo.org
This version running through:            Bash Shell (/bin/bash)
Help is available with the command:      g.manual -i
See the licence terms with:              g.version -c
See citation options with:               g.version -x
Start the GUI with:                      g.gui wxpython
When ready to quit enter:                exit

WARNING: Extension &lt;r.stream.basins&gt; already installed. Re-installing...
Fetching &lt;r.stream.basins&gt; from GRASS GIS Addons repository (be patient)...
Compiling...
Installing...
Updating addons metadata file...
Installation of &lt;r.stream.basins&gt; successfully finished
Cleaning up temporary files...
Done.

Goodbye from GRASS GIS

</pre></div></div>
</div>
<p><strong>Inputs dataset</strong></p>
<p>We are going to use the following dataset:</p>
<ul class="simple">
<li><p>DEM at 1km resolution</p></li>
<li><p>A raster grid-cell area. Each grid-cell reports the values in km^2</p></li>
<li><p>A raster land-sea mask labeled as 1-0</p></li>
<li><p>A raster depression labeles as 1-0</p></li>
<li><p>A shapefile reporting the 3 tiles</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># sea-land mask</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/mask/msk_1km.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_4_0.png" src="../_images/GRASS_grass_hydro_4_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># digital elevation model</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/SA_elevation_mn_GMTED2010_mn_msk.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4000</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_5_0.png" src="../_images/GRASS_grass_hydro_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># area grid-cell in km^2</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/SA_are_1km_msk.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_6_0.png" src="../_images/GRASS_grass_hydro_6_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># tiles</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;geodata/shp/tilesComp.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   id dimension Continent  CropW  CropS  CropE  CropN  \
0   1     30x49        SA    0.6    0.0    2.0    2.0
1   2     40x37        SA    2.8    2.8    0.0    2.8
2   3     40x37        SA    0.3    2.8    2.8    0.0

                                            geometry
0  POLYGON ((-76.40000000000001 -12, -43 -12, -43...
1  POLYGON ((-73.90000000000001 1, -34.6 1, -34.6...
2  POLYGON ((-81.7 12.7, -41.7 12.7, -41.7 -24.5,...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f7513bdb630&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_7_2.png" src="../_images/GRASS_grass_hydro_7_2.png" />
</div>
</div>
<p><strong>Compute MFD flow accumulation</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="nb">cd</span> /media/sf_LVM_shared/my_SE_data/exercise
grass76  -f -text --tmp-location  -c  geodata/dem/SA_elevation_mn_GMTED2010_mn_msk.tif  <span class="s">&lt;&lt;&#39;EOF&#39;</span>

<span class="s">## import the layers</span>
<span class="s">r.external input=geodata/dem/SA_elevation_mn_GMTED2010_mn_msk.tif output=elv --o # dem</span>
<span class="s">r.external input=geodata/dem/SA_all_dep_1km.tif                   output=dep --o # depression</span>
<span class="s">r.external input=geodata/dem/SA_are_1km_msk.tif                   output=are --o # area-pixel</span>
<span class="s">r.external input=geodata/mask/msk_1km.tif                         output=msk --o # land-ocean mask</span>

<span class="s">g.region  -m</span>

<span class="s">for tile in 1 2 3  ; do  # loop for each tile</span>
<span class="s">r.mask raster=msk --o --q # usefull to mask the flow accumulation</span>

<span class="s">wL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $2 }&#39;)</span>
<span class="s">nL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $3 }&#39;)</span>
<span class="s">eL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $4 }&#39;)</span>
<span class="s">sL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $7 }&#39;)</span>

<span class="s">g.region w=$wL  n=$nL  s=$sL  e=$eL  res=0:00:30   --o</span>
<span class="s">g.region -m</span>

<span class="s">### maximum ram 66571M  for 2^63 -1   (2 147 483 647 cell)  / 1 000 000  * 31 M</span>
<span class="s">####  -m  Enable disk swap memory option: Operation is slow</span>
<span class="s">####  -b Beautify flat areas</span>
<span class="s">####   threshold=1  = ~1 km2 = 0.9  m2</span>

<span class="s">echo &quot;############# compute the flow accumulation using MFD for tile $tile ##############&quot;</span>
<span class="s">r.watershed  -b  elevation=elv  depression=dep  accumulation=flow drainage=dir_rw flow=are   memory=2000 --o --q</span>

<span class="s">echo &quot;############# extract stream ##################&quot;</span>
<span class="s">r.stream.extract elevation=elv accumulation=flow depression=dep threshold=8 direction=dir_rs stream_raster=stream  memory=2000 --o --q</span>

<span class="s">echo &quot;############# delineate basin  ##################&quot;</span>
<span class="s">r.stream.basins -l  stream_rast=stream direction=dir_rs   basins=lbasin  memory=2000 --o  --q</span>
<span class="s">r.colors -r stream --q ; r.colors -r lbasin --q ; r.colors -r flow --q</span>

<span class="s">echo &quot;###### create a small zone flow binary for later use ###########&quot;</span>
<span class="s">r.mapcalc &quot; small_zone_flow =   if( !isnull(flow) &amp;&amp; isnull(lbasin) , 1 , null()) &quot; --o</span>

<span class="s">echo &quot;##### create a smaller box ########&quot;</span>
<span class="s">CropW=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropW&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropE=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropE&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropS=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropS&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropN=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropN&quot; | awk &#39;{  print $4 }&#39; )</span>

<span class="s">nS=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; -v CropN=$CropN  &#39;{ printf (&quot;%.14f\n&quot; , $2 - CropN ) }&#39; )</span>
<span class="s">sS=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; -v CropS=$CropS  &#39;{ printf (&quot;%.14f\n&quot; , $2 + CropS ) }&#39; )</span>
<span class="s">eS=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; -v CropE=$CropE  &#39;{ printf (&quot;%.14f\n&quot; , $2 - CropE ) }&#39; )</span>
<span class="s">wS=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; -v CropW=$CropW  &#39;{ printf (&quot;%.14f\n&quot; , $2 + CropW ) }&#39; )</span>

<span class="s">g.region w=$wS  n=$nS  s=$sS  e=$eS  res=0:00:30  save=smallext --o # smaller region</span>
<span class="s">g.region region=smallext --o --q</span>
<span class="s">g.region  -m</span>

<span class="s">echo &quot;######## left stripe ########&quot;</span>
<span class="s">eST=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; &#39;{ print $2 }&#39;)</span>
<span class="s">wST=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 - ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region n=$nS s=$sS     e=$eST w=$wST  res=0:00:30 --o</span>
<span class="s">r.mapcalc &quot; lbasin_wstripe = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext --o --q</span>

<span class="s">echo &quot;######## right stripe  ########&quot;</span>
<span class="s">wST=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">eST=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 + ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region n=$nS s=$sS  e=$eST w=$wST  res=0:00:30 --o</span>
<span class="s">r.mapcalc &quot; lbasin_estripe    = lbasin &quot; --o --q</span>

<span class="s">g.region region=smallext --o --q</span>
<span class="s">echo &quot;######## top stripe   ########&quot;</span>
<span class="s">nST=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">sST=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 - ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region e=$eS w=$wS n=$nST s=$sST res=0:00:30  --o</span>
<span class="s">r.mapcalc &quot; lbasin_nstripe    = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext --o --q</span>

<span class="s">echo &quot;######## bottom stripe ########&quot;</span>
<span class="s">sST=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">nST=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 + ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region   e=$eS  w=$wS  n=$nST  s=$sST  res=0:00:30 --o</span>
<span class="s">r.mapcalc &quot; lbasin_sstripe    = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext   --o --q</span>

<span class="s">echo &quot;######## remove incompleate basins  ########&quot;</span>
<span class="s">    cat &lt;(r.report -n -h units=c map=lbasin_estripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_wstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_sstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_nstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin         | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39; ) \</span>
<span class="s">      | sort  | uniq -c | awk &#39;{ if($1==1) {print $2&quot;=&quot;$2 } else { print $2&quot;=NULL&quot;}  }&#39; &gt;  /tmp/lbasin_${tile}_reclass.txt</span>

<span class="s">r.reclass input=lbasin  output=lbasin_rec   rules=/tmp/lbasin_${tile}_reclass.txt   --o --q</span>
<span class="s">rm -f /tmp/lbasin_${tile}_reclass.txt</span>

<span class="s">r.mapcalc  &quot; lbasin_clean = lbasin_rec&quot; --o --q</span>
<span class="s">g.remove -f  type=raster name=lbasin_rec,lbasin_estripe,lbasin_wstripe,lbasin_nstripe,lbasin_sstripe --q</span>

<span class="s">echo &quot;############  export basin  ############&quot;</span>

<span class="s">r.mask raster=lbasin_clean --o --q</span>
<span class="s">r.out.gdal --o -c -m  createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot; type=UInt32 format=GTiff nodata=0 input=lbasin_clean  output=geodata/dem/lbasinTmp_$tile.tif</span>

<span class="s">echo &quot;############ output the flow accumulation  ############&quot;</span>
<span class="s">r.mask raster=msk --o --q</span>

<span class="s">r.mapcalc  &quot; lbasin_flow_clean  = if ( !isnull(lbasin_clean ) || !isnull(small_zone_flow) , 1 , null()  ) &quot; --o</span>
<span class="s">r.grow  input=lbasin_flow_clean  output=lbasin_flow_clean_grow  radius=4  --o</span>
<span class="s">r.mask  raster=lbasin_flow_clean_grow   --o --q</span>

<span class="s">r.out.gdal --o -f -c -m createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot;  nodata=-9999999  type=Float32 format=GTiff input=flow  output=geodata/dem/flow_${tile}.tif</span>

<span class="s">gdal_edit.py -a_ullr  $wS $nS $eS $sS  geodata/dem/flow_${tile}.tif</span>
<span class="s">gdal_edit.py -tr 0.00833333333333333333333333333333333 -0.00833333333333333333333333333333333  geodata/dem/flow_${tile}.tif</span>

<span class="s">done</span>

<span class="s">EOF</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
projection=3
zone=0
n=14
s=-56
w=-83
e=-34
nsres=923.44150551
ewres=703.7149865
rows=8400
cols=5880
cells=49392000
projection=3
zone=0
n=-12
s=-56
w=-76.4
e=-43
nsres=924.52244935
ewres=710.89449752
rows=5280
cols=4008
cells=21162240
############# compute the flow accumulation using MFD for tile 1 ##############
############# extract stream ##################
############# delineate basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=-14
s=-56
w=-75.8
e=-45
nsres=924.64630106
ewres=707.62000721
rows=5040
cols=3696
cells=18627840
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin  ############
############ output the flow accumulation  ############
projection=3
zone=0
n=1
s=-38
w=-73.9
e=-34.6
nsres=922.66504302
ewres=826.93226998
rows=4680
cols=4716
cells=22070880
############# compute the flow accumulation using MFD for tile 2 ##############
############# extract stream ##################
############# delineate basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=-1.8
s=-35.2
w=-71.1
e=-34.6
nsres=922.59157279
ewres=840.84791606
rows=4008
cols=4380
cells=17555040
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin  ############
############ output the flow accumulation  ############
projection=3
zone=0
n=12.7
s=-24.5
w=-81.7
e=-41.7
nsres=921.8619211
ewres=872.86703289
rows=4464
cols=4800
cells=21427200
############# compute the flow accumulation using MFD for tile 3 ##############
############# extract stream ##################
############# delineate basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=12.7
s=-21.7
w=-81.4
e=-44.5
nsres=921.77907927
ewres=882.26518613
rows=4128
cols=4428
cells=18278784
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin  ############
############ output the flow accumulation  ############

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Cleaning up temporary files...
Starting GRASS GIS...
Creating new GRASS GIS location &lt;tmploc&gt;...

          __________  ___   __________    _______________
         / ____/ __ \/   | / ___/ ___/   / ____/  _/ ___/
        / / __/ /_/ / /| | \__ \\_  \   / / __ / / \__ \
       / /_/ / _, _/ ___ |___/ /__/ /  / /_/ // / ___/ /
       \____/_/ |_/_/  |_/____/____/   \____/___//____/

Welcome to GRASS GIS 7.6.1
GRASS GIS homepage:                      https://grass.osgeo.org
This version running through:            Bash Shell (/bin/bash)
Help is available with the command:      g.manual -i
See the licence terms with:              g.version -c
See citation options with:               g.version -x
Start the GUI with:                      g.gui wxpython
When ready to quit enter:                exit

Reading band 1 of 1...
Link to raster map &lt;elv&gt; created.
Reading band 1 of 1...
Link to raster map &lt;dep&gt; created.
Reading band 1 of 1...
Link to raster map &lt;are&gt; created.
Reading band 1 of 1...
Link to raster map &lt;msk&gt; created.
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Use either --quiet or --verbose flag, not both. Assuming --quiet.
WARNING: Color table of raster map &lt;stream&gt; not found
   0%   0%   0%   0%   0%   3%   3%   3%   3%   3%   6%   6%   6%   6%   6%   9%   9%   9%   9%  12%  12%   9%  12%  12%  12%  15%  15%  15%  15%  18%  18%  18%  18%  15%  18%  21%  21%  21%  21%  21%  24%  24%  24%  27%  24%  27%  27%  27%  24%  27%  30%  30%  30%  30%  33%  33%  33%  33%  30%  33%  36%  36%  36%  36%  36%  39%  39%  42%  39%  42%  39%  42%  42%  39%  42%  45%  45%  45%  48%  48%  45%  48%  48%  51%  45%  51%  51%  51%  48%  54%  54%  57%  54%  57%  51%  54%  57%  57%  60%  60%  60%  63%  54%  63%  57%  60%  63%  63%  66%  66%  66%  69%  66%  69%  60%  69%  63%  69%  72%  72%  72%  72%  66%  69%  75%  78%  75%  78%  75%  75%  78%  78%  72%  81%  81%  81%  81%  84%  84%  84%  84%  75%  78%  87%  87%  87%  87%  81%  90%  90%  90%  93%  93%  84%  90%  93%  93%  96%  96%  96%  99%  99%  87%  96%  99%  99% 100% 100%
  90%
 100%
 100%
  93%  96%  99% 100%
Removing raster &lt;lbasin_estripe&gt;
Removing raster &lt;lbasin_nstripe&gt;
Removing raster &lt;lbasin_rec&gt;
Removing raster &lt;lbasin_sstripe&gt;
Removing raster &lt;lbasin_wstripe&gt;
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasinTmp_1.tif&gt; created.
WARNING: MASK already exists and will be overwritten
Reading raster map &lt;lbasin_flow_clean&gt;...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Writing output raster maps...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Color table for raster map &lt;lbasin_flow_clean_grow&gt; set to
&#39;lbasin_flow_clean&#39;
WARNING: MASK already exists and will be overwritten
WARNING: Precision loss: Float32 can not preserve the DCELL precision of
         raster &lt;flow&gt;. This can be avoided by using Float64
WARNING: Forcing raster export
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;Float32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/flow_1.tif&gt; created.
WARNING: MASK already exists and will be overwritten
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Use either --quiet or --verbose flag, not both. Assuming --quiet.
WARNING: Color table of raster map &lt;stream&gt; not found
   0%   0%   0%   0%   0%   3%   3%   3%   3%   3%   6%   6%   6%   6%   6%   9%   9%   9%   9%  12%  12%  12%   9%  12%  12%  15%  15%  15%  18%  15%  18%  18%  18%  15%  21%  21%  21%  18%  21%  24%  24%  24%  21%  24%  27%  27%  27%  27%  24%  27%  30%  30%  30%  30%  33%  33%  33%  33%  30%  33%  36%  36%  36%  36%  39%  39%  39%  39%  36%  39%  42%  42%  42%  42%  45%  45%  45%  45%  42%  45%  48%  48%  48%  51%  48%  51%  51%  51%  48%  54%  51%  54%  54%  57%  54%  57%  57%  57%  54%  60%  60%  60%  57%  63%  60%  63%  63%  63%  66%  66%  60%  69%  66%  69%  66%  69%  69%  72%  72%  63%  72%  72%  75%  75%  66%  69%  75%  78%  75%  78%  78%  78%  72%  81%  81%  81%  81%  84%  75%  84%  84%  84%  78%  87%  87%  87%  87%  90%  90%  81%  90%  90%  84%  93%  93%  93%  93%  96%  96%  96%  87%  96%  90%  99%  99%  99%  99% 100% 100% 100% 100%



  93%  96%  99% 100%
Removing raster &lt;lbasin_estripe&gt;
Removing raster &lt;lbasin_nstripe&gt;
Removing raster &lt;lbasin_rec&gt;
Removing raster &lt;lbasin_sstripe&gt;
Removing raster &lt;lbasin_wstripe&gt;
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasinTmp_2.tif&gt; created.
WARNING: MASK already exists and will be overwritten
Reading raster map &lt;lbasin_flow_clean&gt;...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Writing output raster maps...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Color table for raster map &lt;lbasin_flow_clean_grow&gt; set to
&#39;lbasin_flow_clean&#39;
WARNING: MASK already exists and will be overwritten
WARNING: Precision loss: Float32 can not preserve the DCELL precision of
         raster &lt;flow&gt;. This can be avoided by using Float64
WARNING: Forcing raster export
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;Float32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/flow_2.tif&gt; created.
WARNING: MASK already exists and will be overwritten
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Use either --quiet or --verbose flag, not both. Assuming --quiet.
WARNING: Color table of raster map &lt;stream&gt; not found
   0%   0%   0%   0%   0%   3%   3%   3%   3%   3%   6%   6%   6%   6%   6%   9%   9%   9%   9%   9%  12%  12%  12%  12%  12%  15%  15%  15%  15%  18%  18%  18%  15%  18%  18%  21%  21%  21%  21%  24%  24%  24%  24%  21%  24%  27%  27%  27%  27%  30%  30%  30%  30%  27%  30%  33%  33%  33%  33%  36%  36%  36%  36%  33%  39%  39%  39%  42%  39%  42%  36%  42%  42%  39%  45%  45%  45%  48%  45%  48%  42%  48%  48%  51%  51%  54%  51%  45%  54%  51%  48%  54%  54%  57%  57%  60%  57%  60%  57%  60%  60%  51%  54%  63%  63%  66%  63%  66%  63%  66%  66%  57%  60%  69%  72%  69%  72%  69%  69%  72%  72%  75%  75%  75%  63%  66%  75%  78%  78%  78%  81%  81%  78%  81%  69%  72%  81%  84%  75%  84%  84%  87%  84%  87%  87%  87%  78%  90%  90%  90%  90%  81%  93%  93%  93%  93%  84%  96%  96%  96%  96%  99%  87%  99%  99%  99% 100%
 100%
  90% 100%
 100%
  93%  96%  99% 100%
Removing raster &lt;lbasin_estripe&gt;
Removing raster &lt;lbasin_nstripe&gt;
Removing raster &lt;lbasin_rec&gt;
Removing raster &lt;lbasin_sstripe&gt;
Removing raster &lt;lbasin_wstripe&gt;
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasinTmp_3.tif&gt; created.
WARNING: MASK already exists and will be overwritten
Reading raster map &lt;lbasin_flow_clean&gt;...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Writing output raster maps...
   0%   3%   6%   9%  12%  15%  18%  21%  24%  27%  30%  33%  36%  39%  42%  45%  48%  51%  54%  57%  60%  63%  66%  69%  72%  75%  78%  81%  84%  87%  90%  93%  96%  99% 100%
Color table for raster map &lt;lbasin_flow_clean_grow&gt; set to
&#39;lbasin_flow_clean&#39;
WARNING: MASK already exists and will be overwritten
WARNING: Precision loss: Float32 can not preserve the DCELL precision of
         raster &lt;flow&gt;. This can be avoided by using Float64
WARNING: Forcing raster export
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;Float32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/flow_3.tif&gt; created.
Cleaning up temporary files...
Done.

Goodbye from GRASS GIS

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion tile 1</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/lbasinTmp_1.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab20b&#39;</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_10_0.png" src="../_images/GRASS_grass_hydro_10_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion tile 1</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/flow_1.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4000</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4000</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_11_0.png" src="../_images/GRASS_grass_hydro_11_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion tile 1</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/lbasinTmp_2.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab20b&#39;</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_12_0.png" src="../_images/GRASS_grass_hydro_12_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion tile 2</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/flow_2.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4000</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4000</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_13_0.png" src="../_images/GRASS_grass_hydro_13_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion tile 3</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/flow_3.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4000</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4000</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_14_0.png" src="../_images/GRASS_grass_hydro_14_0.png" />
</div>
</div>
<p><strong>Merge the flow accumulation tiles</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
gdalbuildvrt     -srcnodata -9999999 -vrtnodata -9999999 geodata/dem/flow_all.vrt    geodata/dem/flow_?.tif
gdal_translate   -co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE -co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span>  geodata/dem/flow_all.vrt     geodata/dem/flow_all.tif
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0...10...20...30...40...50...60...70...80...90...100 - done.
Input file size is 5616, 8244
0...10...20...30...40...50...60...70...80...90...100 - done.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># flow accumualtion all South America</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/flow_all.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_earth&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4000</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4000</span> <span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_17_0.png" src="../_images/GRASS_grass_hydro_17_0.png" />
</div>
</div>
<p><strong>Copute stream and basin using the seamless South America Flow Accumulation</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

grass76  -f -text --tmp-location  -c  geodata/dem/flow_all.tif   <span class="s">&lt;&lt;&#39;EOF&#39;</span>

<span class="s">## import the layers</span>
<span class="s">r.external input=geodata/dem/flow_all.tif                         output=flow --o # flow accumulation</span>
<span class="s">r.external input=geodata/dem/SA_elevation_mn_GMTED2010_mn_msk.tif output=elv  --o # dem</span>
<span class="s">r.external input=geodata/dem/SA_all_dep_1km.tif                   output=dep  --o # depression</span>
<span class="s">r.external input=geodata/mask/msk_1km.tif                         output=msk  --o # land-ocean mask</span>

<span class="s">g.region  -m</span>

<span class="s">for tile in 1 2 3  ; do  # loop for each tile</span>
<span class="s">r.mask raster=msk --o # usefull to mask the flow accumulation</span>

<span class="s">wL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $2 }&#39;)</span>
<span class="s">nL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $3 }&#39;)</span>
<span class="s">eL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $4 }&#39;)</span>
<span class="s">sL=$(ogrinfo -al -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp | grep POLYGON | awk &#39;{ gsub(/[(()),]/,&quot; &quot;,$0 ); print $7 }&#39;)</span>

<span class="s">g.region w=$wL  n=$nL  s=$sL  e=$eL  res=0:00:30   --o</span>
<span class="s">g.region -m</span>

<span class="s">### maximum ram 66571M  for 2^63 -1   (2 147 483 647 cell)  / 1 000 000  * 31 M</span>
<span class="s">####  -m  Enable disk swap memory option: Operation is slow</span>
<span class="s">####  -b Beautify flat areas</span>
<span class="s">####   threshold=1  = ~1 km2 = 0.9  m2</span>

<span class="s">echo &quot;############# extract stream ##################&quot;</span>
<span class="s">r.stream.extract elevation=elv accumulation=flow depression=dep threshold=8 direction=dir_rs stream_raster=stream  memory=2000 --o --q</span>

<span class="s">echo &quot;############# delineate basin and sub-basin  ##################&quot;</span>
<span class="s">r.stream.basins -l  stream_rast=stream direction=dir_rs   basins=lbasin  memory=2000 --o --q</span>

<span class="s">r.colors -r stream --q; r.colors -r lbasin --q ; r.colors -r flow --q</span>

<span class="s">echo &quot;###### create a small zone flow binary for later use ###########&quot;</span>
<span class="s">r.mapcalc &quot; small_zone_flow =   if( !isnull(flow) &amp;&amp; isnull(lbasin) , 1 , null()) &quot; --o --q</span>

<span class="s">echo &quot;##### create a smaller box ########&quot;</span>
<span class="s">CropW=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropW&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropE=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropE&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropS=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropS&quot; | awk &#39;{  print $4 }&#39; )</span>
<span class="s">CropN=$( ogrinfo -al   -where  &quot; id  = &#39;$tile&#39; &quot; geodata/shp/tilesComp.shp  | grep &quot; CropN&quot; | awk &#39;{  print $4 }&#39; )</span>

<span class="s">nS=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; -v CropN=$CropN  &#39;{ printf (&quot;%.14f\n&quot; , $2 - CropN ) }&#39; )</span>
<span class="s">sS=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; -v CropS=$CropS  &#39;{ printf (&quot;%.14f\n&quot; , $2 + CropS ) }&#39; )</span>
<span class="s">eS=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; -v CropE=$CropE  &#39;{ printf (&quot;%.14f\n&quot; , $2 - CropE ) }&#39; )</span>
<span class="s">wS=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; -v CropW=$CropW  &#39;{ printf (&quot;%.14f\n&quot; , $2 + CropW ) }&#39; )</span>

<span class="s">g.region w=$wS  n=$nS  s=$sS  e=$eS  res=0:00:30  save=smallext --o --q # smaller region</span>
<span class="s">g.region region=smallext --o --q</span>
<span class="s">g.region  -m --q</span>

<span class="s">echo &quot;######## left stripe ########&quot;</span>
<span class="s">eST=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; &#39;{ print $2 }&#39;)</span>
<span class="s">wST=$(g.region -m  | grep ^e= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 - ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region n=$nS s=$sS     e=$eST w=$wST  res=0:00:30 --o --q</span>
<span class="s">r.mapcalc &quot; lbasin_wstripe = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext --o --q</span>

<span class="s">echo &quot;######## right stripe  ########&quot;</span>
<span class="s">wST=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">eST=$(g.region -m  | grep ^w= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 + ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region n=$nS s=$sS  e=$eST w=$wST  res=0:00:30 --o --q</span>
<span class="s">r.mapcalc &quot; lbasin_estripe    = lbasin &quot; --o --q</span>

<span class="s">g.region region=smallext --o --q</span>
<span class="s">echo &quot;######## top stripe   ########&quot;</span>
<span class="s">nST=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">sST=$(g.region -m  | grep ^n= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 - ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region e=$eS w=$wS n=$nST s=$sST res=0:00:30  --o --q</span>
<span class="s">r.mapcalc &quot; lbasin_nstripe    = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext --o --q</span>

<span class="s">echo &quot;######## bottom stripe ########&quot;</span>
<span class="s">sST=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; &#39;{ print $2   }&#39; )</span>
<span class="s">nST=$(g.region -m  | grep ^s= | awk -F &quot;=&quot; &#39;{ printf (&quot;%.14f\n&quot; , $2 + ( 1 *  0.00833333333333 )) }&#39; )</span>

<span class="s">g.region   e=$eS  w=$wS  n=$nST  s=$sST  res=0:00:30 --o --q</span>
<span class="s">r.mapcalc &quot; lbasin_sstripe    = lbasin &quot; --o --q</span>
<span class="s">g.region region=smallext   --o --q</span>

<span class="s">echo &quot;######## remove incompleate basins  ########&quot;</span>
<span class="s">    cat &lt;(r.report -n -h units=c map=lbasin_estripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_wstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_sstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin_nstripe | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39;   ) \</span>
<span class="s">        &lt;(r.report -n -h units=c map=lbasin         | awk  &#39;{ gsub (&quot;\\|&quot;,&quot; &quot; ) ; { print $1 }   } &#39; | awk  &#39;$1 ~ /^[0-9]+$/ { print $1 } &#39; ) \</span>
<span class="s">      | sort  | uniq -c | awk &#39;{ if($1==1) {print $2&quot;=&quot;$2 } else { print $2&quot;=NULL&quot;}  }&#39; &gt;  /tmp/lbasin_${tile}_reclass.txt</span>

<span class="s">r.reclass input=lbasin  output=lbasin_rec   rules=/tmp/lbasin_${tile}_reclass.txt   --o --q</span>
<span class="s">rm -f /tmp/lbasin_${tile}_reclass.txt</span>

<span class="s">r.mapcalc  &quot; lbasin_clean = lbasin_rec&quot; --o --q</span>
<span class="s">g.remove -f  type=raster name=lbasin_rec,lbasin_estripe,lbasin_wstripe,lbasin_nstripe,lbasin_sstripe  --q</span>

<span class="s">echo &quot;############  export basin sub-basin and stream  ############&quot;</span>

<span class="s">r.mask raster=lbasin_clean --o --q</span>
<span class="s">r.out.gdal --o -c -m  createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot; type=UInt32 format=GTiff nodata=0 input=lbasin  output=geodata/dem/lbasin_$tile.tif</span>
<span class="s">r.out.gdal --o -c -m  createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot; type=UInt32 format=GTiff nodata=0 input=basin   output=geodata/dem/basin_$tile.tif</span>
<span class="s">r.out.gdal --o -c -m  createopt=&quot;COMPRESS=DEFLATE,ZLEVEL=9&quot; type=UInt32 format=GTiff nodata=0 input=stream  output=geodata/dem/stream_$tile.tif</span>

<span class="s">done</span>

<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
projection=3
zone=0
n=12.7
s=-56
w=-81.4
e=-34.6
nsres=923.4698013
ewres=706.8356204
rows=8244
cols=5616
cells=46298304
projection=3
zone=0
n=-12
s=-56
w=-76.4
e=-43
nsres=924.52244935
ewres=710.89449752
rows=5280
cols=4008
cells=21162240
############# extract stream ##################
############# delineate basin and sub-basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=-14
s=-56
w=-75.8
e=-45
nsres=924.64630106
ewres=707.62000721
rows=5040
cols=3696
cells=18627840
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin sub-basin and stream  ############
projection=3
zone=0
n=1
s=-38
w=-73.9
e=-34.6
nsres=922.66504302
ewres=826.93226998
rows=4680
cols=4716
cells=22070880
############# extract stream ##################
############# delineate basin and sub-basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=-1.8
s=-35.2
w=-71.1
e=-34.6
nsres=922.59157279
ewres=840.84791606
rows=4008
cols=4380
cells=17555040
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin sub-basin and stream  ############
projection=3
zone=0
n=12.7
s=-24.5
w=-81.7
e=-41.7
nsres=921.8619211
ewres=872.86703289
rows=4464
cols=4800
cells=21427200
############# extract stream ##################
############# delineate basin and sub-basin  ##################
###### create a small zone flow binary for later use ###########
##### create a smaller box ########
projection=3
zone=0
n=12.7
s=-21.7
w=-81.4
e=-44.5
nsres=921.77907927
ewres=882.26518613
rows=4128
cols=4428
cells=18278784
######## left stripe ########
######## right stripe  ########
######## top stripe   ########
######## bottom stripe ########
######## remove incompleate basins  ########
############  export basin sub-basin and stream  ############

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Cleaning up temporary files...
Starting GRASS GIS...
Creating new GRASS GIS location &lt;tmploc&gt;...

          __________  ___   __________    _______________
         / ____/ __ \/   | / ___/ ___/   / ____/  _/ ___/
        / / __/ /_/ / /| | \__ \\_  \   / / __ / / \__ \
       / /_/ / _, _/ ___ |___/ /__/ /  / /_/ // / ___/ /
       \____/_/ |_/_/  |_/____/____/   \____/___//____/

Welcome to GRASS GIS 7.6.1
GRASS GIS homepage:                      https://grass.osgeo.org
This version running through:            Bash Shell (/bin/bash)
Help is available with the command:      g.manual -i
See the licence terms with:              g.version -c
See citation options with:               g.version -x
Start the GUI with:                      g.gui wxpython
When ready to quit enter:                exit

Reading band 1 of 1...
Link to raster map &lt;flow&gt; created.
Reading band 1 of 1...
Link to raster map &lt;elv&gt; created.
Reading band 1 of 1...
Link to raster map &lt;dep&gt; created.
Reading band 1 of 1...
Link to raster map &lt;msk&gt; created.
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Color table of raster map &lt;stream&gt; not found
   0%   0%   0%   0%   3%   3%   3%   0%   3%   3%   6%   6%   6%   6%   6%   9%   9%   9%  12%  12%  12%   9%  12%   9%  12%  15%  15%  15%  18%  18%  15%  18%  18%  15%  18%  21%  21%  21%  21%  24%  24%  24%  27%  21%  27%  27%  24%  27%  24%  27%  30%  30%  30%  33%  33%  33%  30%  33%  30%  36%  36%  33%  36%  36%  36%  39%  42%  39%  39%  42%  42%  39%  42%  39%  45%  45%  45%  48%  42%  48%  48%  45%  45%  51%  51%  51%  48%  48%  51%  54%  54%  54%  51%  57%  57%  57%  54%  54%  57%  60%  60%  60%  63%  63%  63%  57%  60%  66%  63%  66%  60%  69%  66%  69%  63%  69%  66%  72%  72%  66%  72%  69%  72%  69%  75%  75%  78%  75%  78%  72%  78%  75%  81%  81%  78%  81%  84%  75%  84%  78%  84%  81%  87%  87%  87%  84%  81%  84%  87%  90%  90%  93%  93%  90%  93%  87%  90%  93%  96%  96%  96%  99%  99%  99%  90%  96% 100% 100%  99%
 100%

  93% 100%
  96%  99% 100%
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasin_1.tif&gt; created.
ERROR: Raster map or group &lt;basin&gt; not found
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/stream_1.tif&gt; created.
WARNING: MASK already exists and will be overwritten
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Color table of raster map &lt;stream&gt; not found
WARNING: Color table of raster map &lt;flow&gt; not found
   0%   0%   0%   0%   0%   3%   3%   3%   6%   6%   3%   3%   6%   6%   6%   9%   9%   9%  12%  12%   9%   9%  12%  12%  12%  15%  15%  18%  15%  18%  18%  15%  18%  21%  15%  21%  21%  21%  18%  21%  24%  24%  24%  24%  27%  27%  27%  27%  24%  27%  30%  30%  30%  33%  33%  30%  33%  33%  30%  33%  36%  36%  36%  36%  39%  39%  39%  39%  36%  42%  42%  39%  45%  42%  42%  45%  45%  45%  42%  48%  48%  48%  51%  51%  51%  48%  51%  45%  54%  48%  57%  54%  54%  57%  54%  57%  51%  57%  60%  54%  60%  60%  63%  63%  60%  63%  63%  57%  66%  69%  66%  69%  66%  69%  60%  66%  63%  69%  72%  72%  72%  72%  75%  75%  75%  66%  69%  75%  78%  78%  78%  78%  72%  81%  81%  81%  84%  84%  81%  84%  84%  75%  78%  87%  87%  87%  87%  90%  90%  90%  90%  81%  84%  93%  96%  93%  93%  93%  96%  96%  96%  87%  90%  99% 100%  99%
 100%  99%  99%
 100% 100%

  93%  96%  99% 100%
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasin_2.tif&gt; created.
ERROR: Raster map or group &lt;basin&gt; not found
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/stream_2.tif&gt; created.
WARNING: MASK already exists and will be overwritten
All subsequent raster operations will be limited to the MASK area. Removing
or renaming raster map named &#39;MASK&#39; will restore raster operations to
normal.
WARNING: Color table of raster map &lt;stream&gt; not found
WARNING: Color table of raster map &lt;flow&gt; not found
   0%   0%   0%   0%   0%   3%   3%   3%   3%   6%   6%   6%   3%   6%   6%   9%   9%   9%  12%  12%  12%   9%  12%   9%  12%  15%  15%  15%  18%  18%  18%  15%  15%  18%  18%  21%  21%  21%  24%  24%  24%  21%  21%  24%  24%  27%  27%  30%  27%  30%  30%  27%  27%  30%  30%  33%  33%  33%  36%  36%  36%  33%  33%  36%  36%  39%  39%  39%  42%  42%  42%  39%  42%  39%  42%  45%  45%  48%  45%  48%  48%  45%  48%  45%  48%  51%  51%  51%  54%  54%  54%  51%  54%  51%  57%  57%  60%  54%  60%  57%  60%  57%  60%  63%  63%  66%  57%  66%  60%  63%  66%  63%  66%  69%  72%  69%  72%  63%  69%  66%  75%  72%  75%  69%  72%  75%  75%  78%  78%  69%  72%  78%  81%  81%  78%  81%  81%  75%  84%  84%  87%  78%  84%  87%  87%  84%  81%  87%  90%  90%  90%  93%  93%  93%  84%  90%  87%  96%  93%  96%  99%  96%  99%  90%  99%  96%  93% 100%
  99% 100%
 100%
 100%  96%
  99% 100%
WARNING: MASK already exists and will be overwritten
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/lbasin_3.tif&gt; created.
ERROR: Raster map or group &lt;basin&gt; not found
Checking GDAL data type and nodata value...
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
Using GDAL data type &lt;UInt32&gt;
Exporting raster data to GTiff format...
WARNING: Too many values, color table cut to 65535 entries
   2%   5%   8%  11%  14%  17%  20%  23%  26%  29%  32%  35%  38%  41%  44%  47%  50%  53%  56%  59%  62%  65%  68%  71%  74%  77%  80%  83%  86%  89%  92%  95%  98% 100%
r.out.gdal complete. File &lt;geodata/dem/stream_3.tif&gt; created.
Cleaning up temporary files...
Done.

Goodbye from GRASS GIS

</pre></div></div>
</div>
<p><strong>Combine the tiled basins and streams</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="k">for</span> var <span class="k">in</span> lbasin stream <span class="p">;</span> <span class="k">do</span>

gdalbuildvrt  -srcnodata <span class="m">0</span>  -vrtnodata <span class="m">0</span> geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.vrt    geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_?.tif
gdal_translate -co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE -co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span> geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.vrt geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.tif

pkstat --hist -i geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.tif <span class="p">|</span> grep -v <span class="s2">&quot; 0&quot;</span>  &gt;  geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.hist

<span class="nv">wc</span><span class="o">=</span><span class="k">$(</span>  wc -l geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.hist  <span class="p">|</span> awk <span class="s1">&#39;{ print $1 -1 }&#39;</span> <span class="k">)</span>

<span class="c1"># create color table</span>
paste -d <span class="s2">&quot; &quot;</span> &lt;<span class="o">(</span> awk <span class="s1">&#39;{ print $1 }&#39;</span> geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.hist <span class="o">)</span>  &lt;<span class="o">(</span><span class="nb">echo</span> <span class="m">0</span><span class="p">;</span> shuf -i <span class="m">1</span>-255 -n <span class="nv">$wc</span> -r<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">echo</span> <span class="m">0</span><span class="p">;</span> shuf -i <span class="m">1</span>-255 -n <span class="nv">$wc</span> -r<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">echo</span> <span class="m">0</span> <span class="p">;</span> shuf -i <span class="m">1</span>-255 -n <span class="nv">$wc</span> -r<span class="o">)</span> <span class="p">|</span> awk <span class="s1">&#39;{ if (NR==1) {print $0 , 0 } else { print $0 , 255 }}&#39;</span>    &gt;  geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all_ct.hist
<span class="c1"># apply color table to the stream and basins</span>
gdaldem color-relief -co <span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE -co <span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span> -co <span class="nv">TILED</span><span class="o">=</span>YES  -co <span class="nv">COPY_SRC_OVERVIEWS</span><span class="o">=</span>YES -alpha geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all.tif geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all_ct.hist   geodata/dem/<span class="si">${</span><span class="nv">var</span><span class="si">}</span>_all_ct.tif
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0...10...20...30...40...50...60...70...80...90...100 - done.
Input file size is 5616, 8244
0...10...20...30...40...50...60...70...80...90...100 - done.
0...10...20...30...40...50...60...70...80...90...100 - done.
0...10...20...30...40...50...60...70...80...90...100 - done.
Input file size is 5616, 8244
0...10...20...30...40...50...60...70...80...90...100 - done.
0...10...20...30...40...50...60...70...80...90...100 - done.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/lbasin_all_ct.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_22_0.png" src="../_images/GRASS_grass_hydro_22_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;geodata/dem/stream_all_ct.tif&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/GRASS_grass_hydro_23_0.png" src="../_images/GRASS_grass_hydro_23_0.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../CASESTUDY/101_SDM1_MWood_gecomp.html" class="btn btn-neutral float-right" title="SDM1 : Montane woodcreper - Gecomputation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="grass_intro.html" class="btn btn-neutral float-left" title="GRASS Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Giuseppe Amatulli.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>