

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estimation of tree height using GEDI dataset - Predictors extraction at point location &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css?v=572af1d6" />
      <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Estimation of tree height using GEDI dataset - Random Forest prediction" href="Tree_Height_03RF_pred.html" />
    <link rel="prev" title="Estimation of tree height using GEDI dataset - Data explore" href="Tree_Height_01DataExplore.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Spatial Ecology's code documentation
              <img src="../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_modelling_10-11_2022.html">GeoComp &amp; Modelling 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2023.html">GeoComp &amp; ML 2023 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2024.html">GeoComp &amp; ML 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_GEO-OPEN-HACK-2024_06_2024.html">GEO-OPEN-HACK-2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_11-12_2024.html">GeoComp 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_geoanlysis_04_2025.html">Geo Comp/Analysis 2025 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_09-11_2025.html">GeoComp &amp; ML 2025 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_Ubuntu24.04_for_Spatial_Ecology_course.html">Prepare Ubuntu 24.04 for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_Colab_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_OSGeoLive_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pyjeo_introduction1.html">Introduction to pyjeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pyjeo_introduction2.html">pyjeo: an open source image processing library in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pyjeo_pktools.html">Performing raster and vector operations in Python using pyjeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PKTOOLS/pyjeo_upscaling_surf.html">Scaling-up: batch processing on the cluster with pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/PythonEnvs.html">Python environments or how to survive to your journey in the geodata space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_data_analysis_SM.html">Python data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_geospatial_data_analysis_SM.html">Python geospatial data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html">RasterIO for dummies: a brief intro to a <em>pythonic</em> raster library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html#2.-Preparing-the-dataset-for-next-ML-exercises-via-rasterio">2. Preparing the dataset for next ML exercises via rasterio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html#3.-Beyond-the-basics">3. Beyond the basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/OGCSQL.html">Generalities about OGC Geospatial extensions for SQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_newproject.html">Start a new GRASS project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_hydro_colab.html">Using GRASS for stream-network extraction and basins delineation in Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HIGH PERFORMANCE COMPUTING</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../HPC/hpc_setting.html">Geocomputation at High Performance Computing Cluster (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HPC/hpc_setting_grass.html">Use of GRASS in HPC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASSIGNMENTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ASSIGNMENTS/assignment_fall2022_solutions.html">Assignments Fall 2022</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Estimation of tree height using GEDI dataset - Predictors extraction at point location</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Running-rio-tool-and-using-the-bash-shell-and-its-tools">Running <code class="docutils literal notranslate"><span class="pre">rio</span></code> tool and using the <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell and its tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#by-Francesco-Lovergine">by Francesco Lovergine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Running-gdallocationinfo-tool-and-using-the-bash-shell-and-its-tools">Running <code class="docutils literal notranslate"><span class="pre">gdallocationinfo</span></code> tool and using the <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell and its tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#By-Giuseppe-Amatulli">By Giuseppe Amatulli</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Python-with-rasterio">Using Python with rasterio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Script-construction,-step-by-step.-By-Francesco-Lovergine">Script construction, step by step. By Francesco Lovergine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Stend-alone-Python-script.-By-Francesco-Lovergine">Stend-alone Python script. By Francesco Lovergine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Python-with-rasterio-and-numpy">Using Python with rasterio and numpy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Script-construction,-step-by-step.-By-Hannah-Weiser">Script construction, step by step. By Hannah Weiser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Stend-alone-Python-script.-By-Hannah-Weiser">Stend-alone Python script. By Hannah Weiser</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_04SVM_pred_2022.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_04SVM_pred_2023.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_04SVM_pred_2024.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_04SVM_pred_2024.html#Exercise:-explore-the-other-parameters-offered-by-the-SVM-library-and-try-to-make-the-model-better.-Some-suggestions:">Exercise: explore the other parameters offered by the SVM library and try to make the model better. Some suggestions:</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_05Perceptron_pred_2022.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_05Perceptron_intro_2023.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_05Perceptron_intro_2024.html">Estimation of tree height using GEDI dataset - Perceptron - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_06Perceptron_pred_2023.html">Estimation of tree height using GEDI dataset - Perceptron tree prediction - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_06Perceptron_complete_2024.html">Estimation of tree height using GEDI dataset - Perceptron complete - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_05Perceptron_pred_clean_2022.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_06NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tree_Height_07FeedForward_Networks_2024.html">Estimation of tree height using GEDI dataset - Neural Network 1 - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_satelite_2022.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2022.</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_satelite_2023.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_satelite_2023.html#Using-CNNs-for-a-image-dataset">Using CNNs for a image dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="foundation_model_IIASA2024.html">Prithvi 100M model</a></li>
<li class="toctree-l1"><a class="reference internal" href="foundation_model_IIASA2024.html#Proposed-exercises">Proposed exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_Unsupervised_2024.html">Autoencoder (AE), Variational Autoencoder (VAE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_Unsupervised_2024.html#Implementing-an-Autoencoder">Implementing an Autoencoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_Unsupervised_2024.html#Autoencoding-MNIST">Autoencoding MNIST</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_Unsupervised_2024.html#Section-2">Section 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_Unsupervised_2024.html#Section-3---Generative-Models">Section 3 - Generative Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="LSTMs_tutorial.html">Using LSTM for time-series predictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_satelite_with_GPT_code_2023.html">Using GPT to implement a Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="Classification_pyjeo_sklearn_2023.html">Classification in Python using pyjeo and sklearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="GEEviaPython_2023.html">Google Earth Engine use via Python, containers and other mythical beasts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../STUDENTSPROJECTS/index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../STUDENTSPROJECTS/index.html#matera">2. 2022 MATERA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/outdoor_info.html">Shelter locations close to Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/bike_accomodation.html">Accomodation in Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/puglia_discover.html">Discover Puglia by bike!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">&lt;no title&gt;</a></li>
      <li class="breadcrumb-item active">Estimation of tree height using GEDI dataset - Predictors extraction at point location</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/CASESTUDY/Tree_Height_02Predictors_extraction.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Estimation-of-tree-height-using-GEDI-dataset---Predictors-extraction-at-point-location">
<h1>Estimation of tree height using GEDI dataset - Predictors extraction at point location<a class="headerlink" href="#Estimation-of-tree-height-using-GEDI-dataset---Predictors-extraction-at-point-location" title="Link to this heading"></a></h1>
<p>The tree_height Dataset is available following the procedure described at <a class="reference external" href="https://spatial-ecology.net/docs/build/html/CASESTUDY/Tree_Height_01DataExplore.html">https://spatial-ecology.net/docs/build/html/CASESTUDY/Tree_Height_01DataExplore.html</a></p>
<p>In order to run this notebook, please do what follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd  /media/sf_LVM_shared/my_SE_data/exercise
pip3 install rasterio
jupyter-notebook Tree_Height_02Predictors_extraction
</pre></div>
</div>
<p><em>Hint: you should never use ``pip3`` under ``sudo``, else you could break your system-wide Python environment in very creative and subtle ways.</em></p>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading"></a></h2>
<p>The main objectives of this tutorial is to show several ways how to extract pixel value at point location.</p>
<p>We will use the files stored at</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>ls<span class="w"> </span>tree_height/txt/eu_x_y_*
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tree_height/txt/eu_x_y_height_predictors_select.txt
tree_height/txt/eu_x_y_height_select.txt
tree_height/txt/eu_x_y_predictors_select.txt
tree_height/txt/eu_x_y_select.txt
</pre></div></div>
</div>
<p>In particular we will reproduce this data-table</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>-3<span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="w"> </span>#<span class="w"> </span>what<span class="w"> </span>we<span class="w"> </span>would<span class="w"> </span>get
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID X Y BLDFIE_WeigAver CECSOL_WeigAver CHELSA_bio18 CHELSA_bio4 convergence cti dev-magnitude eastness elev forestheight glad_ard_SVVI_max glad_ard_SVVI_med glad_ard_SVVI_min northness ORCDRC_WeigAver outlet_dist_dw_basin SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm treecover
1 6.050001 49.727499 1540 13 2113 5893 -10.4865598678589 -238043120 1.15841722488403 0.0690935924649239 353.983123779297 23 276.87109375 46.444091796875 347.665405273438 0.0424997806549072 9 780403 19.7989921569824 440.672210693359 85
2 6.0500017 49.922155 1491 12 1993 5912 33.2743606567383 -208915344 -1.75534081459045 0.269112348556519 267.511688232422 19 -49.5263671875 19.552734375 -130.541748046875 0.182779803872108 16 772777 20.8894119262695 457.756195068359 85
</pre></div></div>
</div>
<p>using the latitude longitude of each point</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>tree_height/txt/eu_x_y_select.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6.050001 49.727499
6.0500017 49.922155
6.0500021 48.602377
6.0500089 48.151979
6.0500102 49.58841
6.0500143 48.608456
6.0500165 48.571401
6.0500189 49.921613
6.0500201 48.822645
6.0500238 49.847522
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span>#<span class="w"> </span>quite<span class="w"> </span>a<span class="w"> </span>lots<span class="w"> </span>of<span class="w"> </span>coords!
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1267239 tree_height/txt/eu_x_y_select.txt
</pre></div></div>
</div>
<p>and the predictors</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>ls<span class="w"> </span>tree_height/geodata_raster/*.tif
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tree_height/geodata_raster/BLDFIE_WeigAver.tif
tree_height/geodata_raster/CECSOL_WeigAver.tif
tree_height/geodata_raster/CHELSA_bio18.tif
tree_height/geodata_raster/CHELSA_bio4.tif
tree_height/geodata_raster/convergence.tif
tree_height/geodata_raster/cti.tif
tree_height/geodata_raster/dev-magnitude.tif
tree_height/geodata_raster/eastness.tif
tree_height/geodata_raster/elev.tif
tree_height/geodata_raster/forestheight.tif
tree_height/geodata_raster/glad_ard_SVVI_max.tif
tree_height/geodata_raster/glad_ard_SVVI_med.tif
tree_height/geodata_raster/glad_ard_SVVI_min.tif
tree_height/geodata_raster/latitude.tif
tree_height/geodata_raster/longitude.tif
tree_height/geodata_raster/northness.tif
tree_height/geodata_raster/ORCDRC_WeigAver.tif
tree_height/geodata_raster/outlet_dist_dw_basin.tif
tree_height/geodata_raster/SBIO3_Isothermality_5_15cm.tif
tree_height/geodata_raster/SBIO4_Temperature_Seasonality_5_15cm.tif
tree_height/geodata_raster/treecover.tif
</pre></div></div>
</div>
</section>
<section id="Running-rio-tool-and-using-the-bash-shell-and-its-tools">
<h2>Running <code class="docutils literal notranslate"><span class="pre">rio</span></code> tool and using the <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell and its tools<a class="headerlink" href="#Running-rio-tool-and-using-the-bash-shell-and-its-tools" title="Link to this heading"></a></h2>
<section id="by-Francesco-Lovergine">
<h3>by Francesco Lovergine<a class="headerlink" href="#by-Francesco-Lovergine" title="Link to this heading"></a></h3>
<p>RasterIO has also a command line tool (<code class="docutils literal notranslate"><span class="pre">rio</span></code>) which can be used to perform a series of operation on rasters, which complementary in respect with the GDAL tools.If you install rasterio from distribution/kit it will reside in the ordinary system paths (note: you could find a <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> binary instead of <code class="docutils literal notranslate"><span class="pre">rio</span></code>). If you install from the PyPI repository via <code class="docutils literal notranslate"><span class="pre">pip</span></code> it will install under <code class="docutils literal notranslate"><span class="pre">~/.local/bin</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>rio<span class="w"> </span>--help
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Usage: rio [OPTIONS] COMMAND [ARGS]...

  Rasterio command line interface.

Options:
  -v, --verbose           Increase verbosity.
  -q, --quiet             Decrease verbosity.
  --aws-profile TEXT      Select a profile from the AWS credentials file
  --aws-no-sign-requests  Make requests anonymously
  --aws-requester-pays    Requester pays data transfer costs
  --version               Show the version and exit.
  --gdal-version
  --show-versions         Show dependency versions
  --help                  Show this message and exit.

Commands:
  blocks     Write dataset blocks as GeoJSON features.
  bounds     Write bounding boxes to stdout as GeoJSON.
  calc       Raster data calculator.
  clip       Clip a raster to given bounds.
  convert    Copy and convert raster dataset.
  edit-info  Edit dataset metadata.
  env        Print information about the Rasterio environment.
  gcps       Print ground control points as GeoJSON.
  info       Print information about a data file.
  insp       Open a data file and start an interpreter.
  mask       Mask in raster using features.
  merge      Merge a stack of raster datasets.
  overview   Construct overviews in an existing dataset.
  rasterize  Rasterize features.
  rm         Delete a dataset.
  sample     Sample a dataset.
  shapes     Write shapes extracted from bands or masks.
  stack      Stack a number of bands into a multiband dataset.
  transform  Transform coordinates.
  warp       Warp a raster dataset.
</pre></div></div>
</div>
<p>The goal of the next few snippets of code is creating in Python and rasterio. That can be done either by using th <code class="docutils literal notranslate"><span class="pre">rio</span></code> tool or completely by Python script.</p>
<p>First of all, the input for rio-sample submodule needs to be in list form, and that can be easily done via <code class="docutils literal notranslate"><span class="pre">sed</span></code> tool (or even <code class="docutils literal notranslate"><span class="pre">awk</span></code> if you prefer so):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/ /,/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/^/[/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/$/]/&#39;</span><span class="w"> </span>#<span class="w"> </span>why<span class="w"> </span>and<span class="w"> </span>how?
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[6.050001,49.727499]
[6.0500017,49.922155]
[6.0500021,48.602377]
[6.0500089,48.151979]
[6.0500102,49.58841]
[6.0500143,48.608456]
[6.0500165,48.571401]
[6.0500189,49.921613]
[6.0500201,48.822645]
[6.0500238,49.847522]
</pre></div></div>
</div>
<p>Once created a compatible input data file for <code class="docutils literal notranslate"><span class="pre">rio</span></code>, it can be used to sample every georaster.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/ /,/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/^/[/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/$/]/&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rio<span class="w"> </span>sample<span class="w"> </span>tree_height/geodata_raster/BLDFIE_WeigAver.tif
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1540]
[1491]
[1521]
[1526]
[1547]
[1515]
[1520]
[1490]
[1554]
[1521]
</pre></div></div>
</div>
<p>Now, in principle you could stack together the input predictors and apply later the sampling. That could be done via <code class="docutils literal notranslate"><span class="pre">gdalbuildvrt</span></code> or <code class="docutils literal notranslate"><span class="pre">rio-stack</span></code>, BUT they both work currently only for homogeneous <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, which is not our case, unfortunately.</p>
<p><em>Homework: extract data types and sizes from all those files and check rasters are different types with the same dimensions. Hint: you can do that via rio or gdal tools or pktools</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rio stack `ls tree_height/geodata_raster/*.tif|grep -Ev &#39;latitude|longitude&#39;` -o /tmp/tree_height_preds.tif</span>
<span class="c1"># gdalbuildvrt tree_height/geodata_raster/*.tif -o /tmp/predictors.vrt</span>
</pre></div>
</div>
</div>
<p>One quite simple way to get the final result is using <code class="docutils literal notranslate"><span class="pre">rio-sample</span></code> to sample separately each field, then using <code class="docutils literal notranslate"><span class="pre">paste</span></code> to join together each per-field file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># this is VERY slow on 1M of records...</span>
<span class="nb">time</span><span class="w"> </span><span class="o">(</span>
<span class="nv">FILES</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;{if (NR==1) print $4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19,$20,$21,$22}&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="k">)</span>
<span class="k">for</span><span class="w"> </span>n<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$FILES</span>
<span class="k">do</span>
<span class="w">    </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/ /,/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/^/[/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/$/]/&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>rio<span class="w"> </span>sample<span class="w"> </span>tree_height/geodata_raster/<span class="nv">$n</span>.tif<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[]&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/<span class="nv">$n</span>
<span class="k">done</span>

seq<span class="w"> </span><span class="k">$(</span>wc<span class="w"> </span>-l<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="p">|</span>cut<span class="w"> </span>-d<span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="k">)</span><span class="w"> </span>&gt;/tmp/ids
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;ID X Y&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$FILES</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w">  </span>tree_height/txt/eu_x_y_predictors_select_rio.txt
paste<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>/tmp/ids<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span><span class="se">\</span>
<span class="k">$(for</span><span class="w"> </span>n<span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;{if (NR==1) print $4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19,$20,$21,$22}&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>ls<span class="w"> </span>/tmp/<span class="nv">$n</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">done)</span><span class="w"> </span><span class="se">\</span>
&gt;&gt;<span class="w"> </span>tree_height/txt/eu_x_y_predictors_select_rio.txt
<span class="o">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

real    20m51.133s
user    18m36.829s
sys     2m39.808s
</pre></div></div>
</div>
<p>Running time</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>real    20m51.133s
user    18m36.829s
sys     2m39.808s
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>-3<span class="w">  </span>tree_height/txt/eu_x_y_predictors_select_rio.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID X Y BLDFIE_WeigAver CECSOL_WeigAver CHELSA_bio18 CHELSA_bio4 convergence cti dev-magnitude eastness elev forestheight glad_ard_SVVI_max glad_ard_SVVI_med glad_ard_SVVI_min northness ORCDRC_WeigAver outlet_dist_dw_basin SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm treecover
1 6.050001 49.727499 1540 13 2113 5893 -10.486559867858887 -238043120 1.1584172248840332 0.06909359246492386 353.9831237792969 23 276.87109375 46.444091796875 347.6654052734375 0.04249978065490723 9 780403 19.798992156982422 440.6722106933594 85
2 6.0500017 49.922155 1491 12 1993 5912 33.27436065673828 -208915344 -1.755340814590454 0.26911234855651855 267.5116882324219 19 -49.5263671875 19.552734375 -130.541748046875 0.18277980387210846 16 772777 20.88941192626953 457.7561950683594 85
</pre></div></div>
</div>
</section>
</section>
<section id="Running-gdallocationinfo-tool-and-using-the-bash-shell-and-its-tools">
<h2>Running <code class="docutils literal notranslate"><span class="pre">gdallocationinfo</span></code> tool and using the <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell and its tools<a class="headerlink" href="#Running-gdallocationinfo-tool-and-using-the-bash-shell-and-its-tools" title="Link to this heading"></a></h2>
<section id="By-Giuseppe-Amatulli">
<h3>By Giuseppe Amatulli<a class="headerlink" href="#By-Giuseppe-Amatulli" title="Link to this heading"></a></h3>
<p>We are going to use gdallocationinfo to extract information in each raster predictors.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: gdallocationinfo [--help-general] [-xml] [-lifonly] [-valonly]
                    [-b band]* [-overview overview_level]
                    [-l_srs srs_def] [-geoloc] [-wgs84]
                    [-oo NAME=VALUE]* srcfile x y
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="nb">time</span><span class="w"> </span><span class="o">(</span>
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;{if (NR==1) print $1=&quot;&quot;, $2=&quot;&quot;, $3=&quot;&quot;, $0}&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="k">)</span><span class="p">;</span><span class="w">  </span><span class="k">do</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span>&gt;<span class="w"> </span>tree_height/txt/<span class="nv">$file</span>.txt
gdallocationinfo<span class="w"> </span>-valonly<span class="w"> </span>-geoloc<span class="w"> </span>-wgs84<span class="w"> </span>tree_height/geodata_raster/<span class="nv">$file</span>.tif<span class="w"> </span>&lt;<span class="w"> </span>tree_height/txt/eu_x_y_select.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>tree_height/txt/<span class="nv">$file</span>.txt
<span class="k">done</span>

paste<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&lt;<span class="o">(</span>awk<span class="w"> </span><span class="s1">&#39;{ print $1,$2,$3}&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="k">$(for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;{if (NR==1)  print $1=&quot;&quot;, $2=&quot;&quot;, $3=&quot;&quot;, $0}&#39;</span><span class="w"> </span>tree_height/txt/eu_x_y_predictors_select.txt<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>ls<span class="w"> </span>tree_height/txt/<span class="nv">$file</span>.txt<span class="p">;</span><span class="w"> </span><span class="k">done)</span><span class="w"> </span><span class="se">\</span>
&gt;<span class="w"> </span>tree_height/txt/eu_x_y_predictors_select_gdal.txt
<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

real    1m50.404s
user    1m24.222s
sys     0m12.117s
</pre></div></div>
</div>
<p>Running time</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>real    1m50.404s
user    1m24.222s
sys     0m12.117s
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>-3<span class="w"> </span>tree_height/txt/eu_x_y_predictors_select_gdal.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID X Y BLDFIE_WeigAver CECSOL_WeigAver CHELSA_bio18 CHELSA_bio4 convergence cti dev-magnitude eastness elev forestheight glad_ard_SVVI_max glad_ard_SVVI_med glad_ard_SVVI_min northness ORCDRC_WeigAver outlet_dist_dw_basin SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm treecover
1 6.050001 49.727499 1540 13 2113 5893 -10.4865598678589 -238043120 1.15841722488403 0.0690935924649239 353.983123779297 23 276.87109375 46.444091796875 347.665405273438 0.0424997806549072 9 780403 19.7989921569824 440.672210693359 85
2 6.0500017 49.922155 1491 12 1993 5912 33.2743606567383 -208915344 -1.75534081459045 0.269112348556519 267.511688232422 19 -49.5263671875 19.552734375 -130.541748046875 0.182779803872108 16 772777 20.8894119262695 457.756195068359 85
</pre></div></div>
</div>
<p>Of course, the same result can be achieved with direct read/write via rasterio packagein one full Python script.</p>
</section>
</section>
<section id="Using-Python-with-rasterio">
<h2>Using Python with rasterio<a class="headerlink" href="#Using-Python-with-rasterio" title="Link to this heading"></a></h2>
<section id="Script-construction,-step-by-step.-By-Francesco-Lovergine">
<h3>Script construction, step by step. By Francesco Lovergine<a class="headerlink" href="#Script-construction,-step-by-step.-By-Francesco-Lovergine" title="Link to this heading"></a></h3>
<p>Due to the size of the dataset it is mandatory increasing the memory available for the VM and possibly add on demand swap space (i.e. virtual memory on disk), for instance via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt install swapspace
</pre></div>
</div>
<p>Of course, consider that eventually it could require a lot of temporary storage taken under <code class="docutils literal notranslate"><span class="pre">/var/lib/swapspace</span></code> which could be freed after use.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;tree_height/geodata_raster/[!l]*.tif&#39;</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;open DatasetReader name=&#39;tree_height/geodata_raster/BLDFIE_WeigAver.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CECSOL_WeigAver.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CHELSA_bio18.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CHELSA_bio4.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/ORCDRC_WeigAver.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/SBIO3_Isothermality_5_15cm.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/SBIO4_Temperature_Seasonality_5_15cm.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/convergence.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/cti.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/dev-magnitude.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/eastness.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/elev.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/forestheight.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_max.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_med.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_min.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/northness.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/outlet_dist_dw_basin.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/treecover.tif&#39; mode=&#39;r&#39;&gt;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
19
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;BLDFIE_WeigAver.tif&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="n">name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;BLDFIE_WeigAver&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">field_name</span> <span class="o">=</span>   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">name</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">field_name</span>
<span class="n">header</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;BLDFIE_WeigAver CECSOL_WeigAver CHELSA_bio18 CHELSA_bio4 ORCDRC_WeigAver SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm convergence cti dev-magnitude eastness elev forestheight glad_ard_SVVI_max glad_ard_SVVI_med glad_ard_SVVI_min northness outlet_dist_dw_basin treecover&#39;
</pre></div></div>
</div>
<p>Starting from those files now open in rasterio, it is possible to read the band and store them in a list</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">band</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1523,  1523, 65535, ..., 65535, 65535, 65535],
       [65535, 65535, 65535, ..., 65535, 65535, 65535],
       [65535, 65535, 65535, ..., 65535, 65535, 65535],
       ...,
       [ 1514,  1514,  1514, ...,  1455,  1455,  1455],
       [65535, 65535, 65535, ...,  1457,  1457,  1457],
       [65535, 65535, 65535, ...,  1458,  1458,  1458]], dtype=uint16)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([[ 1523,  1523, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        ...,
        [ 1514,  1514,  1514, ...,  1455,  1455,  1455],
        [65535, 65535, 65535, ...,  1457,  1457,  1457],
        [65535, 65535, 65535, ...,  1458,  1458,  1458]], dtype=uint16),
 array([[   11,    11, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        ...,
        [   16,    16,    16, ...,    20,    20,    20],
        [65535, 65535, 65535, ...,    19,    19,    19],
        [65535, 65535, 65535, ...,    19,    19,    19]], dtype=uint16),
 array([[ 2024,  2024, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        ...,
        [ 2401,  2401,  2401, ...,  4405,  4405,  4405],
        [65535, 65535, 65535, ...,  4406,  4406,  4406],
        [65535, 65535, 65535, ...,  4408,  4408,  4408]], dtype=uint16),
 array([[ 5879,  5879, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        ...,
        [ 6272,  6272,  6272, ...,  6348,  6348,  6348],
        [65535, 65535, 65535, ...,  6348,  6348,  6348],
        [65535, 65535, 65535, ...,  6349,  6349,  6349]], dtype=uint16),
 array([[   12,    12, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        [65535, 65535, 65535, ..., 65535, 65535, 65535],
        ...,
        [    9,     9,     9, ...,    23,    23,    23],
        [65535, 65535, 65535, ...,    22,    22,    22],
        [65535, 65535, 65535, ...,    21,    21,    21]], dtype=uint16),
 array([[   22.9   ,    22.9   , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        [-9999.    , -9999.    , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        [-9999.    , -9999.    , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        ...,
        [   21.3825,    21.3825,    21.3825, ...,    24.24  ,    24.24  ,
            24.24  ],
        [-9999.    , -9999.    , -9999.    , ...,    24.264 ,    24.264 ,
            24.264 ],
        [-9999.    , -9999.    , -9999.    , ...,    24.288 ,    24.288 ,
            24.288 ]], dtype=float32),
 array([[  470.5   ,   470.5   , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        [-9999.    , -9999.    , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        [-9999.    , -9999.    , -9999.    , ..., -9999.    , -9999.    ,
         -9999.    ],
        ...,
        [  514.73  ,   514.73  ,   514.73  , ...,   491.1825,   491.1825,
           491.1825],
        [-9999.    , -9999.    , -9999.    , ...,   491.0895,   491.0895,
           491.0895],
        [-9999.    , -9999.    , -9999.    , ...,   490.9965,   490.9965,
           490.9965]], dtype=float32),
 array([[-3.0291458e+01, -3.0291458e+01, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        ...,
        [-5.1806598e+00, -5.1806598e+00, -5.7902360e+00, ...,
          4.0210270e+01,  4.8858276e+01,  4.8858276e+01],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          4.1173668e+01,  5.1179237e+01,  5.1179237e+01],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          3.4467628e+01,  4.4355145e+01,  4.4355145e+01]], dtype=float32),
 array([[ -266332416,  -266332416, -2147483648, ..., -2147483648,
         -2147483648, -2147483648],
        [-2147483648, -2147483648, -2147483648, ..., -2147483648,
         -2147483648, -2147483648],
        [-2147483648, -2147483648, -2147483648, ..., -2147483648,
         -2147483648, -2147483648],
        ...,
        [ -330251232,  -330251232,  -330806208, ...,   -72420176,
           -38702784,   -38702784],
        [-2147483648, -2147483648, -2147483648, ...,   -97209304,
           -71794584,   -71794584],
        [-2147483648, -2147483648, -2147483648, ...,  -112299568,
           -99132240,   -99132240]], dtype=int32),
 array([[ 6.7067027e-01,  6.7067027e-01, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        ...,
        [ 5.0633794e-01,  5.0633794e-01,  5.0400752e-01, ...,
          1.6250600e+00,  1.6136067e+00,  1.6136067e+00],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          1.6310033e+00,  1.6191456e+00,  1.6191456e+00],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          1.6421642e+00,  1.6330340e+00,  1.6330340e+00]], dtype=float32),
 array([[-6.9691122e-02, -6.9691122e-02, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
         -9.9990000e+03, -9.9990000e+03, -9.9990000e+03],
        ...,
        [-1.5847646e-02, -1.5847646e-02, -7.8007574e-03, ...,
          1.3672341e-02,  1.2951906e-02,  1.2951906e-02],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          1.4678583e-02,  1.4141800e-02,  1.4141800e-02],
        [-9.9990000e+03, -9.9990000e+03, -9.9990000e+03, ...,
          1.3527840e-02,  1.3261721e-02,  1.3261721e-02]], dtype=float32),
 array([[  379.93466,   379.93466, -9999.     , ..., -9999.     ,
         -9999.     , -9999.     ],
        [-9999.     , -9999.     , -9999.     , ..., -9999.     ,
         -9999.     , -9999.     ],
        [-9999.     , -9999.     , -9999.     , ..., -9999.     ,
         -9999.     , -9999.     ],
        ...,
        [  259.5505 ,   259.5505 ,   260.30533, ...,   737.22675,
           736.4584 ,   736.4584 ],
        [-9999.     , -9999.     , -9999.     , ...,   737.5121 ,
           736.75574,   736.75574],
        [-9999.     , -9999.     , -9999.     , ...,   738.052  ,
           737.48334,   737.48334]], dtype=float32),
 array([[  0,   0, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [  4,   4,   3, ...,  27,  29,  29],
        [255, 255, 255, ...,  24,  25,  28],
        [255, 255, 255, ...,  22,  26,  27]], dtype=uint8),
 array([[ 1492.6785  ,  1306.2141  , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        ...,
        [  406.16797 ,   512.14136 ,   852.699   , ...,    13.673584,
            16.567871,  -119.38574 ],
        [-9999.      , -9999.      , -9999.      , ...,    53.41284 ,
           106.63818 ,  -103.65137 ],
        [-9999.      , -9999.      , -9999.      , ...,  -225.1709  ,
            59.3938  ,   -91.39722 ]], dtype=float32),
 array([[ 1085.7559  ,  1035.9121  , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        ...,
        [  370.3777  ,   485.29468 ,   596.9763  , ...,  -115.798096,
           -88.07202 ,   -88.33276 ],
        [-9999.      , -9999.      , -9999.      , ...,   -47.25415 ,
           -46.921387,  -104.95679 ],
        [-9999.      , -9999.      , -9999.      , ...,  -243.46167 ,
           -13.637451,  -121.86597 ]], dtype=float32),
 array([[  959.5752  ,   688.7239  , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        [-9999.      , -9999.      , -9999.      , ..., -9999.      ,
         -9999.      , -9999.      ],
        ...,
        [  311.42188 ,   464.50146 ,   542.05835 , ...,  -282.40723 ,
          -237.9851  ,  -215.59985 ],
        [-9999.      , -9999.      , -9999.      , ...,  -162.25928 ,
          -190.5232  ,  -179.57202 ],
        [-9999.      , -9999.      , -9999.      , ...,  -221.65869 ,
           -44.732178,  -285.79663 ]], dtype=float32),
 array([[-7.71632195e-02, -7.71632195e-02, -9.99900000e+03, ...,
         -9.99900000e+03, -9.99900000e+03, -9.99900000e+03],
        [-9.99900000e+03, -9.99900000e+03, -9.99900000e+03, ...,
         -9.99900000e+03, -9.99900000e+03, -9.99900000e+03],
        [-9.99900000e+03, -9.99900000e+03, -9.99900000e+03, ...,
         -9.99900000e+03, -9.99900000e+03, -9.99900000e+03],
        ...,
        [ 1.26748577e-01,  1.26748577e-01,  1.23799555e-01, ...,
          5.50076319e-03,  5.47871692e-03,  5.47871692e-03],
        [-9.99900000e+03, -9.99900000e+03, -9.99900000e+03, ...,
          6.67779474e-03,  6.95462432e-03,  6.95462432e-03],
        [-9.99900000e+03, -9.99900000e+03, -9.99900000e+03, ...,
          6.94931159e-03,  7.58498861e-03,  7.58498861e-03]], dtype=float32),
 array([[ 790129,  790129,   -9999, ...,   -9999,   -9999,   -9999],
        [  -9999,   -9999,   -9999, ...,   -9999,   -9999,   -9999],
        [  -9999,   -9999,   -9999, ...,   -9999,   -9999,   -9999],
        ...,
        [ 769627,  769627,  769634, ..., 2915172, 2915151, 2915151],
        [  -9999,   -9999,   -9999, ..., 2915209, 2915168, 2915168],
        [  -9999,   -9999,   -9999, ..., 2915389, 2915195, 2915195]],
       dtype=int32),
 array([[ 37,  37, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [ 29,  27,  27, ...,  95,  87,  94],
        [255, 255, 255, ...,  98,  92,  85],
        [255, 255, 255, ...,  72,  72,  85]], dtype=uint8)]
</pre></div></div>
</div>
<p>Now let’s have a trial for concatenating raster values</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tree_height/txt/eu_x_y_select.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">long</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
            <span class="n">band</span> <span class="o">=</span> <span class="n">bands</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="n">b</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># just for the very first rows and check</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 6.050001 49.727499 1540 13 2113 5893 9 19.798992156982422 440.6722106933594 -10.486559867858887 -238043120 1.1584172248840332 0.06909359246492386 353.9831237792969 23 276.87109375 46.444091796875 347.6654052734375 0.04249978065490723 780403 85
2 6.0500017 49.922155 1491 12 1993 5912 16 20.88941192626953 457.7561950683594 33.27436065673828 -208915344 -1.755340814590454 0.26911234855651855 267.5116882324219 19 -49.5263671875 19.552734375 -130.541748046875 0.18277980387210846 772777 85
3 6.0500021 48.602377 1521 17 2124 5983 14 20.695877075195312 481.87969970703125 0.045293472707271576 -137479792 1.9087798595428467 -0.01605454459786415 389.75115966796875 21 93.25732421875 50.74365234375 384.5224609375 0.0362534299492836 898820 62
4 6.0500089 48.151979 1526 16 2569 6130 15 19.375 479.4102783203125 -33.654273986816406 -267223072 0.9657867550849915 0.06776714324951172 380.20770263671875 27 542.4013671875 202.26416015625 386.15673828125 0.0051393029280006886 831824 85
5 6.0500102 49.58841 1547 14 2108 5923 17 18.77750015258789 457.88006591796875 27.493824005126953 -107809368 -0.1626242697238922 0.014064788818359375 308.04278564453125 25 136.04833984375 146.835205078125 198.12744140625 0.02884702757000923 796962 85
6 6.0500143 48.608456 1515 19 2124 6010 14 19.398880004882812 474.3313293457031 -1.6020394563674927 17384282 1.44797945022583 -0.01891239918768406 364.527099609375 18 221.33984375 247.38720703125 480.387939453125 0.042747415602207184 897945 62
7 6.0500165 48.571401 1520 19 2169 6147 11 20.17045021057129 476.4145202636719 27.856502532958984 -66516432 -1.0739555358886719 0.0022801030427217484 254.67959594726562 19 125.25048828125 87.865234375 160.69677734375 0.037254270166158676 908426 96
8 6.0500189 49.921613 1490 12 1995 5912 15 20.8559627532959 457.1954040527344 22.10213851928711 -297770784 -1.402632713317871 0.30976489186286926 294.9277648925781 26 -86.7294921875 -145.584228515625 -190.06298828125 0.22243468463420868 772784 86
9 6.0500201 48.822645 1554 18 1973 6138 8 21.81229019165039 496.2311096191406 18.496583938598633 -25336536 -0.8000159859657288 0.0103699816390872 240.49375915527344 22 -51.470703125 -245.88671875 172.07470703125 0.004428229294717312 839132 64
10 6.0500238 49.847522 1521 15 2187 5886 13 21.137710571289062 466.9766845703125 -5.660452842712402 -278652608 1.4779508113861084 -0.06871972978115082 376.671142578125 12 277.29736328125 273.141845703125 -138.89599609375 0.09881718456745148 768873 70
</pre></div></div>
</div>
<p>The first 10 rows seem correct in respect with the previous file, now it is only need to dump the rows to a file, with an appropriate header.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%timeit</span> -r 1 -n 1
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tree_height/txt/eu_x_y_predictors_select_new.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ID X Y&#39;</span> <span class="o">+</span> <span class="n">header</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tree_height/txt/eu_x_y_select.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">long</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
                <span class="n">band</span> <span class="o">=</span> <span class="n">bands</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">100000</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># that&#39;s to get a fast partial result...</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2min 10s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)
</pre></div></div>
</div>
<p>You can notice that the output is extremely slow. Efficiency can be eventually increased by changing the buffering size from the default one.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>head<span class="w"> </span>-3<span class="w"> </span>tree_height/txt/eu_x_y_predictors_select_new.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID X Y BLDFIE_WeigAver CECSOL_WeigAver CHELSA_bio18 CHELSA_bio4 ORCDRC_WeigAver SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm convergence cti dev-magnitude eastness elev forestheight glad_ard_SVVI_max glad_ard_SVVI_med glad_ard_SVVI_min northness outlet_dist_dw_basin treecover
1 6.050001 49.727499 1540 13 2113 5893 9 19.798992156982422 440.6722106933594 -10.486559867858887 -238043120 1.1584172248840332 0.06909359246492386 353.9831237792969 23 276.87109375 46.444091796875 347.6654052734375 0.04249978065490723 780403 85
2 6.0500017 49.922155 1491 12 1993 5912 16 20.88941192626953 457.7561950683594 33.27436065673828 -208915344 -1.755340814590454 0.26911234855651855 267.5116882324219 19 -49.5263671875 19.552734375 -130.541748046875 0.18277980387210846 772777 85
</pre></div></div>
</div>
</section>
<section id="Stend-alone-Python-script.-By-Francesco-Lovergine">
<h3>Stend-alone Python script. By Francesco Lovergine<a class="headerlink" href="#Stend-alone-Python-script.-By-Francesco-Lovergine" title="Link to this heading"></a></h3>
<p>Running the script for the whole content of 1.2M of records take quite a full time, you can run it yourself or use the resulting file stored in the staging area of the VM and clone via git.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env python3
#
# This is the whole script written in a proper way to work even in bash.
# You can copy&amp;paste this block in a text `whatever.py` file, then
# chmod a+x whatever.py
# and run it as ./whatever.py
#

import csv
import glob
import rasterio
import os.path

files = []
for filename in glob.glob(&#39;tree_height/geodata_raster/[!l]*.tif&#39;):
    ds = rasterio.open(filename, mode=&#39;r&#39;)
    files.append(ds)

(name, ext) = os.path.splitext(os.path.basename(files[0].name))
header = &#39;&#39;
for ds in files:
    field_name = os.path.splitext(os.path.basename(ds.name))[0]
    header += &#39; &#39;+field_name

print(&#39;Reading raster files...&#39;)

bands = []
for ds in files:
    bands.append(ds.read(1))

print(&#39;Writing samples&#39;)

with open(&#39;tree_height/txt/eu_x_y_predictors_select_new.txt&#39;, &#39;w&#39;) as out:
    print(&#39;ID X Y&#39; + header, file=out)
    with open(&#39;tree_height/txt/eu_x_y_select.txt&#39;) as csvfile:
        coords = csv.reader(csvfile, delimiter=&#39; &#39;)
        i = 1
        for (long, lat) in coords:
            print(&#39;{} {} {} &#39;.format(i, long, lat),end=&#39;&#39;, file=out)
            for j, ds in enumerate(files):
                idx = ds.index(float(long), float(lat))
                band = bands[j]
                val = band[idx]
                print(&#39;{} &#39;.format(val), end=&#39;&#39;, file=out)
            print(&quot;&quot;, file=out)
            if not i % 10: print(&#39;Record {} ...&#39;.format(i))
            i+=1
    csvfile.close()
out.close()

print(&#39;Finished&#39;)

exit(0)
</pre></div>
</div>
<p>This script can be run by</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span><span class="nb">time</span><span class="w"> </span>python3<span class="w"> </span>/media/sf_LVM_shared/my_SE_data/exercise/Tree_Height_02Predictors_extraction_python1.py
</pre></div>
</div>
</div>
</section>
</section>
<section id="Using-Python-with-rasterio-and-numpy">
<h2>Using Python with rasterio and numpy<a class="headerlink" href="#Using-Python-with-rasterio-and-numpy" title="Link to this heading"></a></h2>
<section id="Script-construction,-step-by-step.-By-Hannah-Weiser">
<h3>Script construction, step by step. By Hannah Weiser<a class="headerlink" href="#Script-construction,-step-by-step.-By-Hannah-Weiser" title="Link to this heading"></a></h3>
<p>Imports</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<p>Create a list of (opened) raster datasets and of the corresponding field names</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;tree_height/geodata_raster/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;[!l]*.tif&#39;</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">fieldnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fieldnames</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;northness&#39;,
 &#39;forestheight&#39;,
 &#39;elev&#39;,
 &#39;CHELSA_bio4&#39;,
 &#39;SBIO3_Isothermality_5_15cm&#39;,
 &#39;SBIO4_Temperature_Seasonality_5_15cm&#39;,
 &#39;dev-magnitude&#39;,
 &#39;BLDFIE_WeigAver&#39;,
 &#39;CHELSA_bio18&#39;,
 &#39;glad_ard_SVVI_min&#39;,
 &#39;eastness&#39;,
 &#39;ORCDRC_WeigAver&#39;,
 &#39;cti&#39;,
 &#39;treecover&#39;,
 &#39;outlet_dist_dw_basin&#39;,
 &#39;glad_ard_SVVI_med&#39;,
 &#39;convergence&#39;,
 &#39;glad_ard_SVVI_max&#39;,
 &#39;CECSOL_WeigAver&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;open DatasetReader name=&#39;tree_height/geodata_raster/northness.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/forestheight.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/elev.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CHELSA_bio4.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/SBIO3_Isothermality_5_15cm.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/SBIO4_Temperature_Seasonality_5_15cm.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/dev-magnitude.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/BLDFIE_WeigAver.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CHELSA_bio18.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_min.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/eastness.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/ORCDRC_WeigAver.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/cti.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/treecover.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/outlet_dist_dw_basin.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_med.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/convergence.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/glad_ard_SVVI_max.tif&#39; mode=&#39;r&#39;&gt;,
 &lt;open DatasetReader name=&#39;tree_height/geodata_raster/CECSOL_WeigAver.tif&#39; mode=&#39;r&#39;&gt;]
</pre></div></div>
</div>
<p>Read the coordinates to a numpy array</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;tree_height/txt/eu_x_y_select.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 6.050001 , 49.727499 ],
       [ 6.0500017, 49.922155 ],
       [ 6.0500021, 48.602377 ],
       ...,
       [ 9.9499985, 49.227932 ],
       [ 9.9499988, 49.936763 ],
       [ 9.9499996, 49.48964  ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1267239, 2)
</pre></div></div>
</div>
<p>Create a dictionary with an array of pixel values at the coordinates for each field (i.e. values sampled from each raster)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raster_val_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
    <span class="c1"># transform coordinates to raster row and column indices</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rowcol</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">rowcols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)))</span>
    <span class="c1"># read band of raster</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># get values by indexing band with row and column indices</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">band</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rowcols</span><span class="p">])</span>
    <span class="c1"># add value array to dictionary</span>
    <span class="n">raster_val_dict</span><span class="p">[</span><span class="n">fieldnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vals</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raster_val_dict</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;northness&#39;: array([ 0.04249978,  0.1827798 ,  0.03625343, ..., -0.06422238,
        -0.00754081,  0.10954276], dtype=float32),
 &#39;forestheight&#39;: array([23, 19, 21, ..., 23, 27, 23], dtype=uint8),
 &#39;elev&#39;: array([353.98312, 267.5117 , 389.75116, ..., 422.33276, 306.65903,
        349.73883], dtype=float32),
 &#39;CHELSA_bio4&#39;: array([5893, 5912, 5983, ..., 6622, 6495, 6588], dtype=uint16),
 &#39;SBIO3_Isothermality_5_15cm&#39;: array([19.798992, 20.889412, 20.695877, ..., 18.91893 , 17.010637,
        17.769867], dtype=float32),
 &#39;SBIO4_Temperature_Seasonality_5_15cm&#39;: array([440.6722 , 457.7562 , 481.8797 , ..., 490.463  , 457.73627,
        489.45746], dtype=float32),
 &#39;dev-magnitude&#39;: array([ 1.1584172 , -1.7553408 ,  1.9087799 , ...,  0.28438434,
        -1.0900238 ,  0.52376586], dtype=float32),
 &#39;BLDFIE_WeigAver&#39;: array([1540, 1491, 1521, ..., 1523, 1533, 1517], dtype=uint16),
 &#39;CHELSA_bio18&#39;: array([2113, 1993, 2124, ..., 2283, 2103, 1926], dtype=uint16),
 &#39;glad_ard_SVVI_min&#39;: array([ 347.6654 , -130.54175,  384.52246, ...,  220.32666,  -10.63208,
         263.45093], dtype=float32),
 &#39;eastness&#39;: array([ 0.06909359,  0.26911235, -0.01605454, ..., -0.03627645,
         0.02672861, -0.00700016], dtype=float32),
 &#39;ORCDRC_WeigAver&#39;: array([ 9, 16, 14, ..., 11,  6,  8], dtype=uint16),
 &#39;cti&#39;: array([-238043120, -208915344, -137479792, ..., -212329056,  140822048,
        -227026464], dtype=int32),
 &#39;treecover&#39;: array([85, 85, 62, ..., 75, 85, 97], dtype=uint8),
 &#39;outlet_dist_dw_basin&#39;: array([780403, 772777, 898820, ..., 867238, 862879, 812856], dtype=int32),
 &#39;glad_ard_SVVI_med&#39;: array([ 46.44409 ,  19.552734,  50.743652, ..., 123.39404 , 104.30469 ,
        133.24927 ], dtype=float32),
 &#39;convergence&#39;: array([-10.48656   ,  33.27436   ,   0.04529347, ..., -14.551437  ,
         16.743006  ,  -9.116502  ], dtype=float32),
 &#39;glad_ard_SVVI_max&#39;: array([276.8711  , -49.526367,  93.257324, ..., 377.35132 , 209.16504 ,
         27.061035], dtype=float32),
 &#39;CECSOL_WeigAver&#39;: array([13, 12, 17, ..., 16, 11, 15], dtype=uint16)}
</pre></div></div>
</div>
<p>Create the header of the output file</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get keys from dictionary</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">raster_val_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">keys</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;northness&#39;, &#39;forestheight&#39;, &#39;elev&#39;, &#39;CHELSA_bio4&#39;, &#39;SBIO3_Isothermality_5_15cm&#39;, &#39;SBIO4_Temperature_Seasonality_5_15cm&#39;, &#39;dev-magnitude&#39;, &#39;BLDFIE_WeigAver&#39;, &#39;CHELSA_bio18&#39;, &#39;glad_ard_SVVI_min&#39;, &#39;eastness&#39;, &#39;ORCDRC_WeigAver&#39;, &#39;cti&#39;, &#39;treecover&#39;, &#39;outlet_dist_dw_basin&#39;, &#39;glad_ard_SVVI_med&#39;, &#39;convergence&#39;, &#39;glad_ard_SVVI_max&#39;, &#39;CECSOL_WeigAver&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add keys (=field names) to string which starts with &quot;ID, Longitude and Latitude&quot;</span>
<span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ID Longitude Latitude </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">header</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;ID Longitude Latitude northness forestheight elev CHELSA_bio4 SBIO3_Isothermality_5_15cm SBIO4_Temperature_Seasonality_5_15cm dev-magnitude BLDFIE_WeigAver CHELSA_bio18 glad_ard_SVVI_min eastness ORCDRC_WeigAver cti treecover outlet_dist_dw_basin glad_ard_SVVI_med convergence glad_ard_SVVI_max CECSOL_WeigAver&#39;
</pre></div></div>
</div>
<p>Create a 2D array with the indixes, coordinates and corresponding raster values for each sampled point</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all arrays from dictionary as list</span>
<span class="n">all_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raster_val_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="c1"># get index, x-coordinate and y-coordinate as list and add the value arrays to that list</span>
<span class="n">all_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">all_vals</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># stack all arrays to a 2D array</span>
<span class="n">all_vals_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">all_vals</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">all_vals_arr</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1267239, 22)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># have a look at the first three rows</span>
<span class="n">all_vals_arr</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1.00000000e+00,  6.05000100e+00,  4.97274990e+01,
         4.24997807e-02,  2.30000000e+01,  3.53983124e+02,
         5.89300000e+03,  1.97989922e+01,  4.40672211e+02,
         1.15841722e+00,  1.54000000e+03,  2.11300000e+03,
         3.47665405e+02,  6.90935925e-02,  9.00000000e+00,
        -2.38043120e+08,  8.50000000e+01,  7.80403000e+05,
         4.64440918e+01, -1.04865599e+01,  2.76871094e+02,
         1.30000000e+01],
       [ 2.00000000e+00,  6.05000170e+00,  4.99221550e+01,
         1.82779804e-01,  1.90000000e+01,  2.67511688e+02,
         5.91200000e+03,  2.08894119e+01,  4.57756195e+02,
        -1.75534081e+00,  1.49100000e+03,  1.99300000e+03,
        -1.30541748e+02,  2.69112349e-01,  1.60000000e+01,
        -2.08915344e+08,  8.50000000e+01,  7.72777000e+05,
         1.95527344e+01,  3.32743607e+01, -4.95263672e+01,
         1.20000000e+01],
       [ 3.00000000e+00,  6.05000210e+00,  4.86023770e+01,
         3.62534299e-02,  2.10000000e+01,  3.89751160e+02,
         5.98300000e+03,  2.06958771e+01,  4.81879700e+02,
         1.90877986e+00,  1.52100000e+03,  2.12400000e+03,
         3.84522461e+02, -1.60545446e-02,  1.40000000e+01,
        -1.37479792e+08,  6.20000000e+01,  8.98820000e+05,
         5.07436523e+01,  4.52934727e-02,  9.32573242e+01,
         1.70000000e+01]])
</pre></div></div>
</div>
<p>Write the array to a txt-file</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the format of each column</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.5f</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%u</span><span class="s1"> </span><span class="si">%.6f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%i</span><span class="s1">&#39;</span>
<span class="c1"># save</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;tree_height/txt/eu_x_y_predictors_select_python2.txt&#39;</span><span class="p">,</span> <span class="n">all_vals_arr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># depending on how we process the data, we could also use np.save() to save the array to a binary format</span>
</pre></div>
</div>
</div>
</section>
<section id="Stend-alone-Python-script.-By-Hannah-Weiser">
<h3>Stend-alone Python script. By Hannah Weiser<a class="headerlink" href="#Stend-alone-Python-script.-By-Hannah-Weiser" title="Link to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env python
# coding: utf-8

&quot;&quot;&quot;
Modification of the RasterIO Final Script for Preparing the Dataset for the Next ML Exercise

Hannah Weiser, 2023-04-22
&quot;&quot;&quot;

# Imports
from pathlib import Path
import rasterio as rio
import numpy as np
import time

start = time.time()
print(&quot;Start processing ...&quot;)

# Create a list of (opened) raster datasets and of the corresponding field names
datasets = []
fieldnames = []
for filename in Path(&#39;tree_height/geodata_raster/&#39;).glob(&#39;[!l]*.tif&#39;):
    ds = rio.open(filename, mode=&#39;r&#39;)
    datasets.append(ds)
    fieldnames.append(filename.stem)

# Read the coordinates to a numpy array
coords = np.genfromtxt(&#39;tree_height/txt/eu_x_y_select.txt&#39;, delimiter=&#39; &#39;)

# Create a dictionary with an array of pixel values at the coordinates for each field (i.e. values sampled from each raster)
raster_val_dict = {}
for i, ds in enumerate(datasets):
    # transform coordinates to raster row and column indices
    rows, cols = rio.transform.rowcol(ds.transform, coords[:, 0], coords[:, 1])
    rowcols = np.array(list(zip(rows, cols)))
    # read band of raster
    band = ds.read(1)
    # get values by indexing band with row and column indices
    vals = np.array([band[row, col] for row, col in rowcols])
    # add value array to dictionary
    raster_val_dict[fieldnames[i]] = vals
    ds.close()

# get keys from dictionary
keys = raster_val_dict.keys()
# add keys (=field names) to string which starts with &quot;ID, Longitude and Latitude&quot;
header = f&quot;ID X Y {&#39; &#39;.join(keys)}&quot;


# Create a 2D array with the indixes, coordinates and corresponding raster values for each sampled point

# get all arrays from dictionary as list
all_vals = list(raster_val_dict.values())
# get index, x-coordinate and y-coordinate as list and add the value arrays to that list
all_vals = [np.arange(1, coords.shape[0]+1), coords[:, 0], coords[:, 1]] + all_vals

# stack all arrays to a 2D array
all_vals_arr = np.hstack([all_vals]).T

end_operation = time.time()
print(f&quot;Done in {end_operation-start:.1f} sec., Writing output file...&quot;)

# Write the array to a txt-file

# define the format of each column
fmt = &#39;%u %.6f %.6f %u %u %u %u %.6f %i %.8f %.8f %.5f %u %.6f %.6f %.6f %.8f %u %u %.6f %.4f %i&#39;
# save
np.savetxt(&#39;tree_height/txt/eu_x_y_predictors_select_python2.txt&#39;, all_vals_arr, fmt=fmt, delimiter=&quot; &quot;, header=header, comments=&#39;&#39;)

# depending on how we process the data later on, we could also use np.save() to save the array to a binary format

end = time.time()

print(f&quot;Done. Writing took {end-end_operation:.1f} sec. Full script took {end-start:.1f}&quot;)
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span><span class="nb">time</span><span class="w"> </span>python3<span class="w"> </span>/media/sf_LVM_shared/my_SE_data/exercise/Tree_Height_02Predictors_extraction_python2.py
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Start processing ...
Done in 101.4 sec., Writing output file...
Done. Writing took 9.7 sec. Full script took 111.2

real    1m51.826s
user    1m21.891s
sys     0m14.028s
</pre></div></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>real    1m51.826s
user    1m21.891s
sys 0m14.028s
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Tree_Height_01DataExplore.html" class="btn btn-neutral float-left" title="Estimation of tree height using GEDI dataset - Data explore" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tree_Height_03RF_pred.html" class="btn btn-neutral float-right" title="Estimation of tree height using GEDI dataset - Random Forest prediction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>