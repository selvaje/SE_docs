

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performing raster and vector operations in Python using pyjeo &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css?v=572af1d6" />
      <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scaling-up: batch processing on the cluster with pyjeo" href="pyjeo_upscaling_surf.html" />
    <link rel="prev" title="pyjeo: an open source image processing library in Python" href="pyjeo_introduction2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Spatial Ecology's code documentation
              <img src="../_static/SE_compact.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">COURSE TRAINERS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSETRAINERS/trainers.html">Spatial Ecology course trainers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COURSES AROUND THE WORLD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_wcsu_02-04_2021.html">Western Connecticut State University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_stock_uni_04-05_2021.html">Stockholm University 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2022.html">GeoComp &amp; ML 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_modelling_10-11_2022.html">GeoComp &amp; Modelling 2022 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2023.html">GeoComp &amp; ML 2023 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_04-05_2024.html">GeoComp &amp; ML 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_GEO-OPEN-HACK-2024_06_2024.html">GEO-OPEN-HACK-2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_11-12_2024.html">GeoComp 2024 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_geoanlysis_04_2025.html">Geo Comp/Analysis 2025 course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COURSESAROUNDTHEWORLD/course_geocomp_ml_09-11_2025.html">GeoComp &amp; ML 2025 course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LINUX VIRTUAL MACHINE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_Ubuntu24.04_for_Spatial_Ecology_course.html">Prepare Ubuntu 24.04 for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_Colab_for_Spatial_Ecology_course.html">Prepare Colab for Spatial Ecology courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VIRTUALMACHINE/Setting_OSGeoLive_for_Spatial_Ecology_course.html">Prepare OSGeoLive for Spatial Ecology courses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BASH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashintro_osgeo.html">Linux Operation System as a base for Spatial Ecology Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashinter_osgeo.html">Manipulate text files in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BASH/bashxargs_osgeo.html">Multi-core bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AWK/awk.html">AWK Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GDAL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/gdal_osgeo.html">Use GDAL/OGR for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/gdal_colab.html">Use GDAL/OGR for raster/vector operations - colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PKTOOLS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pktools_osgeo.html">Use PKTOOLS for raster/vector operations - osgeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="pktools_colab.html">Use PKTOOLS for raster/vector operations - colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyjeo_introduction1.html">Introduction to pyjeo</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyjeo_introduction2.html">pyjeo: an open source image processing library in Python</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performing raster and vector operations in Python using pyjeo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Creating-masks">Creating masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Applying-masks">Applying masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Exercise:-check-if-pktools-and-pyjeo-results-are-equal">Exercise: check if pktools and pyjeo results are equal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Composite-images">Composite images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Exercise">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-tiling-mechanism">Using tiling mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Filter-images">Filter images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Images-statistics">Images statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Images-reclassification">Images reclassification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Zonal-statistic-(polygon-extraction)">Zonal statistic (polygon extraction)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyjeo_upscaling_surf.html">Scaling-up: batch processing on the cluster with pyjeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">R</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../R/R_Intro.html">R Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/PythonEnvs.html">Python environments or how to survive to your journey in the geodata space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Geo_Python.html">Python &amp; GeoComputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_data_analysis_SM.html">Python data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/Python_geospatial_data_analysis_SM.html">Python geospatial data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html">RasterIO for dummies: a brief intro to a <em>pythonic</em> raster library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html#2.-Preparing-the-dataset-for-next-ML-exercises-via-rasterio">2. Preparing the dataset for next ML exercises via rasterio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/RasterIO_Intro.html#3.-Beyond-the-basics">3. Beyond the basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/OGCSQL.html">Generalities about OGC Geospatial extensions for SQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GRASS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_intro.html">GRASS Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_newproject.html">Start a new GRASS project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_hydro.html">Using GRASS for stream-network extraction and basins delineation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/grass_hydro_colab.html">Using GRASS for stream-network extraction and basins delineation in Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GRASS/SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HIGH PERFORMANCE COMPUTING</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../HPC/hpc_setting.html">Geocomputation at High Performance Computing Cluster (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HPC/hpc_setting_grass.html">Use of GRASS in HPC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASSIGNMENTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ASSIGNMENTS/assignment_fall2022_solutions.html">Assignments Fall 2022</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CASE STUDY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/SDM1_MWood_gecomp.html">SDM1 : Montane woodcreper - Gecomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/SDM1_MWood_Rmodel.html">SDM1 : Montane woodcreper - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/SDM1_MWood_gecomp4GRASS.html">SDM1 : Montane woodcreper - Gecomputation for the Random Forest model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/SDM1_MWood_GRASSmodel.html">SDM1 : Montane woodcreper - Random Forest Model using GRASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/SDM2_Vath_Rmodel.html">SDM2 : Varied Thrush - Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/manipulate_GSIM.html">Manipulate GSIM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Data_type_GTiff.html">Data type in GTiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/temporal_interpolation.html">Temporal interpolation of landsat images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/DTW.html">Dynamic Time Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/pred_NP.html">Estimating nitrogen and phosphorus concentrations in streams and rivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN-day1.html">Estimating nitrogen concentrations in streams and rivers using NN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN-day2.html">Autoencoder (AE), Variational Autoencoder (VAE) and Generative Adversarial Network (GAN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN-day3.html">LSTM Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_01DataExplore.html">Estimation of tree height using GEDI dataset - Data explore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_02Predictors_extraction.html">Estimation of tree height using GEDI dataset - Predictors extraction at point location</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_03RF_pred.html">Estimation of tree height using GEDI dataset - Random Forest prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_04SVM_pred_2022.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_04SVM_pred_2023.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_04SVM_pred_2024.html">Estimation of tree height using GEDI dataset - Support Vector Machine for Regression (SVR) - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_04SVM_pred_2024.html#Exercise:-explore-the-other-parameters-offered-by-the-SVM-library-and-try-to-make-the-model-better.-Some-suggestions:">Exercise: explore the other parameters offered by the SVM library and try to make the model better. Some suggestions:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_05Perceptron_pred_2022.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_05Perceptron_intro_2023.html">Estimation of tree height using GEDI dataset - Perceptron 1 - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_05Perceptron_intro_2024.html">Estimation of tree height using GEDI dataset - Perceptron - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_06Perceptron_pred_2023.html">Estimation of tree height using GEDI dataset - Perceptron tree prediction - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_06Perceptron_complete_2024.html">Estimation of tree height using GEDI dataset - Perceptron complete - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_05Perceptron_pred_clean_2022.html">Estimation of tree height using GEDI dataset - Clean Data - Perceptron 2 - 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_06NeuralNets_pred.html">Estimation of tree height using GEDI dataset - Neural Network 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Tree_Height_07FeedForward_Networks_2024.html">Estimation of tree height using GEDI dataset - Neural Network 1 - 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NNs_pt3_SHAP.html">Neural Nets (pt.3), Interpretability and Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/CNN_satelite_2022.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2022.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/CNN_satelite_2023.html">Using Multi-layer Perceptron and Convolutional Neural Networks for Satellite image classification - 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/CNN_satelite_2023.html#Using-CNNs-for-a-image-dataset">Using CNNs for a image dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/foundation_model_IIASA2024.html">Prithvi 100M model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/foundation_model_IIASA2024.html#Proposed-exercises">Proposed exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN_Unsupervised_2024.html">Autoencoder (AE), Variational Autoencoder (VAE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN_Unsupervised_2024.html#Implementing-an-Autoencoder">Implementing an Autoencoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN_Unsupervised_2024.html#Autoencoding-MNIST">Autoencoding MNIST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN_Unsupervised_2024.html#Section-2">Section 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/NN_Unsupervised_2024.html#Section-3---Generative-Models">Section 3 - Generative Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/LSTMs_tutorial.html">Using LSTM for time-series predictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/CNN_satelite_with_GPT_code_2023.html">Using GPT to implement a Convolutional Neural Networks for Satellite image classification.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/Classification_pyjeo_sklearn_2023.html">Classification in Python using pyjeo and sklearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CASESTUDY/GEEviaPython_2023.html">Google Earth Engine use via Python, containers and other mythical beasts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Students Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../STUDENTSPROJECTS/index.html">1. 2021 SWEDEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../STUDENTSPROJECTS/index.html#matera">2. 2022 MATERA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OUTDOOR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/outdoor_orientering.html">Do not get lost in the wilderness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/outdoor_info.html">Shelter locations close to Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/bike_accomodation.html">Accomodation in Gioia del Colle (BA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OUTDOOR/puglia_discover.html">Discover Puglia by bike!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TALKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TALKS/intelligent_modelling.html">Intelligent modelling in time and space: combine GeoComputation and Machine Learning for  environmental application.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ADMIN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/00_pktools_gdrive_install.html">Install pktools on the gdrive and be able to use from any Colab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/video.html">Video tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADMIN/Compiling_OTB.html">Compiling OTB from source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spatial Ecology's code documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">&lt;no title&gt;</a></li>
      <li class="breadcrumb-item active">Performing raster and vector operations in Python using pyjeo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/PKTOOLS/pyjeo_pktools.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Performing-raster-and-vector-operations-in-Python-using-pyjeo">
<h1>Performing raster and vector operations in Python using pyjeo<a class="headerlink" href="#Performing-raster-and-vector-operations-in-Python-using-pyjeo" title="Link to this heading"></a></h1>
<p><strong>Material provided by Dr. Pieter Kempeneers</strong></p>
<p><a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/">pyjeo</a> is the follow up of <a class="reference external" href="http://pktools.nongnu.org/html/index.html">PKTOOLS</a>, a suite of utilities written in C++ for image processing with a focus on remote sensing applications. It is distributed under a General Public License (GPLv3) as a Python package.</p>
<p>The examples in this notebook replicate the exercises on <a class="reference external" href="http://spatial-ecology.net/docs/build/html/PKTOOLS/pktools_osgeo.html">pktools</a> in order to appreciate the difference and still analogy for those that are familiar with pktools.</p>
<p>In a nutshell, the main differences between pyjeo and pktools from a user’s perspective are:</p>
<ul class="simple">
<li><p>pyjeo is a Python package should be run in a <strong>Python environment</strong>, whereas pktools applications are run from the command line (e.g., in a bash shell)</p></li>
<li><p>pyjeo runs with images entirely <strong>in memory</strong>, whereas pktools runs most applications line per line. This makes pyjeo considerably faster, but with a larger memory footprint. However, there are some methods implemented in pyjeo to reduce the memory footprint by tiling the image</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[1]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pathlib</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">import</span> Path
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">numpy</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">np</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pandas</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pd</span>
<span class="ansi-green-fg">      4</span> get_ipython().run_line_magic(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">matplotlib</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">inline</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;numpy&#39;
</pre></div></div>
</div>
<section id="Creating-masks">
<h2>Creating masks<a class="headerlink" href="#Creating-masks" title="Link to this heading"></a></h2>
<p><strong>pktools</strong> We create three masks using different threshold values with <a class="reference external" href="http://pktools.nongnu.org/html/md_pkgetmask.html">pkgetmask</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkgetmask<span class="w">  </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-min<span class="w">  </span><span class="m">1</span><span class="w">  </span>-max<span class="w">  </span><span class="m">2</span><span class="w"> </span>-data<span class="w"> </span><span class="m">1</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-ot<span class="w"> </span>Byte<span class="w">  </span>-i<span class="w">  </span>geodata/vegetation/ETmean08-11.tif<span class="w">  </span>-o<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhA.tif
pkgetmask<span class="w">  </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-min<span class="w">  </span><span class="m">5</span><span class="w">  </span>-max<span class="w">  </span><span class="m">8</span><span class="w"> </span>-data<span class="w"> </span><span class="m">1</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-ot<span class="w"> </span>Byte<span class="w">  </span>-i<span class="w">  </span>geodata/vegetation/ETmean08-11.tif<span class="w">  </span>-o<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhB.tif
pkgetmask<span class="w">  </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-min<span class="w">  </span><span class="m">0</span><span class="w">  </span>-max<span class="w">  </span><span class="m">10</span><span class="w"> </span>-data<span class="w"> </span><span class="m">0</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">1</span><span class="w"> </span>-ot<span class="w"> </span>Byte<span class="w">  </span>-i<span class="w">  </span>geodata/vegetation/ETmean08-11.tif<span class="w">  </span>-o<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhC.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 1: 164531 Aborted                 (core dumped) pkgetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 1 -max 2 -data 1 -nodata 0 -ot Byte -i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_trhA.tif
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 2: 164579 Aborted                 (core dumped) pkgetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 5 -max 8 -data 1 -nodata 0 -ot Byte -i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_trhB.tif
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 3: 164593 Aborted                 (core dumped) pkgetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 0 -max 10 -data 0 -nodata 1 -ot Byte -i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_trhC.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[2]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  1  -max  2 -data 1 -nodata 0 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhA.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  5  -max  8 -data 1 -nodata 0 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhB.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  0  -max  10 -data 0 -nodata 1 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhC.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  1  -max  2 -data 1 -nodata 0 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhA.tif\npkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  5  -max  8 -data 1 -nodata 0 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhB.tif\npkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min  0  -max  10 -data 0 -nodata 1 -ot Byte  -i  geodata/vegetation/ETmean08-11.tif  -o geodata/vegetation/ETmean08-11_01_trhC.tif\n&#39;&#39; returned non-zero exit status 134.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>With pyjeo we create the masks in memory in a “pythonic” way using <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html#get-jim-items">get items</a> without the need to write temporary files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyjeo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pj</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[3]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pyjeo</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pj</span>

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;pyjeo&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/vegetation/ETmean08-11.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

<span class="c1">#get mask</span>
<span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">jim</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jim</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">jim</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jim</span><span class="o">&lt;=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mask3</span> <span class="o">=</span> <span class="p">(</span><span class="n">jim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">jim</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[4]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fn = Path(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/ETmean08-11.tif</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      4</span> <span style="color: rgb(95,135,135)">#get mask</span>
<span class="ansi-green-fg">      5</span> mask1 = (jim&gt;=<span class="ansi-green-fg">1</span>) &amp; (jim&lt;=<span class="ansi-green-fg">2</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Applying-masks">
<h2>Applying masks<a class="headerlink" href="#Applying-masks" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Use the prepared mask and apply to the image with <a class="reference external" href="http://pktools.nongnu.org/html/md_pksetmask.html">pksetmask</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pksetmask<span class="w"> </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhA.tif<span class="w">  </span>-msknodata<span class="w"> </span><span class="m">1</span><span class="w"> </span>-nodata<span class="w">  </span>-9<span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhB.tif<span class="w">  </span>-msknodata<span class="w"> </span><span class="m">1</span><span class="w"> </span>-nodata<span class="w">  </span>-5<span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>geodata/vegetation/ETmean08-11_01_trhC.tif<span class="w">  </span>-msknodata<span class="w"> </span><span class="m">1</span><span class="w"> </span>-nodata<span class="w"> </span>-10<span class="w"> </span><span class="se">\</span>
-i<span class="w"> </span>geodata/vegetation/ETmean08-11.tif<span class="w"> </span>-o<span class="w"> </span>geodata/vegetation/ETmean08-11_01_msk.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 5: 164609 Aborted                 (core dumped) pksetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -m geodata/vegetation/ETmean08-11_01_trhA.tif -msknodata 1 -nodata -9 -m geodata/vegetation/ETmean08-11_01_trhB.tif -msknodata 1 -nodata -5 -m geodata/vegetation/ETmean08-11_01_trhC.tif -msknodata 1 -nodata -10 -i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_msk.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[5]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pksetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-m geodata/vegetation/ETmean08-11_01_trhA.tif  -msknodata 1 -nodata  -9 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-m geodata/vegetation/ETmean08-11_01_trhB.tif  -msknodata 1 -nodata  -5 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-m geodata/vegetation/ETmean08-11_01_trhC.tif  -msknodata 1 -nodata -10 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_msk.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pksetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 \\\n-m geodata/vegetation/ETmean08-11_01_trhA.tif  -msknodata 1 -nodata  -9 \\\n-m geodata/vegetation/ETmean08-11_01_trhB.tif  -msknodata 1 -nodata  -5 \\\n-m geodata/vegetation/ETmean08-11_01_trhC.tif  -msknodata 1 -nodata -10 \\\n-i geodata/vegetation/ETmean08-11.tif -o geodata/vegetation/ETmean08-11_01_msk.tif\n&#39;&#39; returned non-zero exit status 134.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can apply the mask in a “pythonic” way using <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html#set-jim-items">set items</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
<span class="n">jim</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
<span class="n">jim</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[6]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>[mask1] = -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">      2</span> jim[mask2] = -<span class="ansi-green-fg">5</span>
<span class="ansi-green-fg">      3</span> jim[mask3] = -<span class="ansi-green-fg">10</span>

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<p>However, we can even skip the intermediate step of creating the mask:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

<span class="n">jim</span><span class="p">[(</span><span class="n">jim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">jim</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">jim</span><span class="p">[(</span><span class="n">jim</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jim</span><span class="o">&lt;=</span><span class="mi">8</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
<span class="n">jim</span><span class="p">[(</span><span class="n">jim</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jim</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      3</span> jim[(jim&lt;<span class="ansi-green-fg">0</span>) | (jim&gt;<span class="ansi-green-fg">10</span>)] = -<span class="ansi-green-fg">10</span>
<span class="ansi-green-fg">      4</span> jim[(jim&gt;=<span class="ansi-green-fg">5</span>) &amp; (jim&lt;=<span class="ansi-green-fg">8</span>)] = -<span class="ansi-green-fg">5</span>

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>The result can then be written on disk if needed:</p>
</section>
<section id="Exercise:-check-if-pktools-and-pyjeo-results-are-equal">
<h2>Exercise: check if pktools and pyjeo results are equal<a class="headerlink" href="#Exercise:-check-if-pktools-and-pyjeo-results-are-equal" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim0</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="s1">&#39;geodata/vegetation/ETmean08-11_01_msk.tif&#39;</span><span class="p">)</span>
<span class="n">jim0</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">isEqual</span><span class="p">(</span><span class="n">jim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[8]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> jim0 = <span class="ansi-yellow-bg">pj</span>.Jim(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/ETmean08-11_01_msk.tif</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">      2</span> jim0.properties.isEqual(jim)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">isEqual</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="s1">&#39;geodata/vegetation/ETmean08-11_01_msk.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[9]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.properties.isEqual(pj.Jim(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/ETmean08-11_01_msk.tif</span><span class="ansi-yellow-fg">&#39;</span>))

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;geodata/vegetation/ETmean08-11_01_msk_pyjeo.tif&#39;</span><span class="p">,</span> <span class="n">co</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;ZLEVEL=9&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.io.write(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/ETmean08-11_01_msk_pyjeo.tif</span><span class="ansi-yellow-fg">&#39;</span>, co = [<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">COMPRESS=DEFLATE</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">ZLEVEL=9</span><span class="ansi-yellow-fg">&#39;</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Composite-images">
<h2>Composite images<a class="headerlink" href="#Composite-images" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Create a mask to apply during the composite</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkgetmask<span class="w">  </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-min<span class="w"> </span><span class="m">0</span><span class="w"> </span>-max<span class="w"> </span><span class="m">25</span><span class="w"> </span>-data<span class="w"> </span><span class="m">0</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">1</span><span class="w"> </span>-ot<span class="w"> </span>Byte<span class="w"> </span>-i<span class="w"> </span>geodata/LST/LST_MOYDmax_month1.tif<span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_month1-msk.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 1: 164657 Aborted                 (core dumped) pkgetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 0 -max 25 -data 0 -nodata 1 -ot Byte -i geodata/LST/LST_MOYDmax_month1.tif -o geodata/LST/LST_MOYDmax_month1-msk.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[11]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 0 -max 25 -data 0 -nodata 1 -ot Byte -i geodata/LST/LST_MOYDmax_month1.tif -o geodata/LST/LST_MOYDmax_month1-msk.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pkgetmask  -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 0 -max 25 -data 0 -nodata 1 -ot Byte -i geodata/LST/LST_MOYDmax_month1.tif -o geodata/LST/LST_MOYDmax_month1-msk.tif\n&#39;&#39; returned non-zero exit status 134.
</pre></div></div>
</div>
<p>Calculate mean and standard deviation with several images with <a class="reference external" href="http://pktools.nongnu.org/html/md_pkcomposite.html">pkcomposite</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkcomposite<span class="w"> </span><span class="k">$(for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>geodata/LST/LST_MOYDmax_month??.tif<span class="w"> </span>geodata/LST/LST_MOYDmax_month?.tif<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span><span class="k">done)</span><span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>geodata/LST/LST_MOYDmax_month1-msk.tif<span class="w"> </span>-msknodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-cr<span class="w"> </span>mean<span class="w">   </span>-dstnodata<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
-co<span class="w">  </span><span class="nv">COMPRESS</span><span class="o">=</span>LZW<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_monthMean.tif

pkcomposite<span class="w"> </span><span class="k">$(for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>geodata/LST/LST_MOYDmax_month?.tif<span class="w"> </span>geodata/LST/LST_MOYDmax_month??.tif<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">$file</span><span class="p">;</span><span class="w"> </span><span class="k">done)</span><span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>geodata/LST/LST_MOYDmax_month1-msk.tif<span class="w"> </span>-msknodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-cr<span class="w"> </span>stdev<span class="w">   </span>-dstnodata<span class="w"> </span>-1<span class="w"> </span><span class="se">\</span>
-co<span class="w">  </span><span class="nv">COMPRESS</span><span class="o">=</span>LZW<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_monthStdev.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
FileOpenError geodata/LST/LST_MOYDmax_month??.tif
FileOpenError geodata/LST/LST_MOYDmax_month?.tif
ERROR 1: Attempt to create -2147483648x-2147483648 dataset is illegal,sizes must be larger than zero.
Warning: could not write geotransform information in geodata/LST/LST_MOYDmax_monthMean.tif
Warning: could not write projection information in geodata/LST/LST_MOYDmax_monthMean.tif
bash: line 3: 164674 Segmentation fault      (core dumped) pkcomposite $(for file in geodata/LST/LST_MOYDmax_month??.tif geodata/LST/LST_MOYDmax_month?.tif;
do
    echo -i $file;
done) -m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr mean -dstnodata 0 -co COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthMean.tif
FileOpenError geodata/LST/LST_MOYDmax_month?.tif
FileOpenError geodata/LST/LST_MOYDmax_month??.tif
ERROR 1: Attempt to create -2147483648x-2147483648 dataset is illegal,sizes must be larger than zero.
Warning: could not write geotransform information in geodata/LST/LST_MOYDmax_monthStdev.tif
Warning: could not write projection information in geodata/LST/LST_MOYDmax_monthStdev.tif
bash: line 7: 164722 Segmentation fault      (core dumped) pkcomposite $(for file in geodata/LST/LST_MOYDmax_month?.tif geodata/LST/LST_MOYDmax_month??.tif;
do
    echo -i $file;
done) -m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr stdev -dstnodata -1 -co COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthStdev.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[12]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pkcomposite $(for file in geodata/LST/LST_MOYDmax_month??.tif geodata/LST/LST_MOYDmax_month?.tif; do echo -i $file; done) </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr mean   -dstnodata 0 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-co  COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthMean.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkcomposite $(for file in geodata/LST/LST_MOYDmax_month?.tif geodata/LST/LST_MOYDmax_month??.tif; do echo -i $file; done) </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr stdev   -dstnodata -1 </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\\</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">-co  COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthStdev.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pkcomposite $(for file in geodata/LST/LST_MOYDmax_month??.tif geodata/LST/LST_MOYDmax_month?.tif; do echo -i $file; done) \\\n-m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr mean   -dstnodata 0 \\\n-co  COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthMean.tif\n\npkcomposite $(for file in geodata/LST/LST_MOYDmax_month?.tif geodata/LST/LST_MOYDmax_month??.tif; do echo -i $file; done) \\\n-m geodata/LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr stdev   -dstnodata -1 \\\n-co  COMPRESS=LZW -co ZLEVEL=9 -o geodata/LST/LST_MOYDmax_monthStdev.tif\n&#39;&#39; returned non-zero exit status 139.
</pre></div></div>
</div>
<p>An alternative way is to use <a class="reference external" href="http://pktools.nongnu.org/html/pkstatprofile.html">pkstatprofile</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="c1"># Create a multiband vrt</span>
gdalbuildvrt<span class="w"> </span>-overwrite<span class="w"> </span>-separate<span class="w"> </span>geodata/LST/LST_MOYDmax_month.vrt<span class="w"> </span>geodata/LST/LST_MOYDmax_month?.tif<span class="w"> </span>geodata/LST/LST_MOYDmax_month??.tif
<span class="c1"># Calculate mean and standard deviation</span>
pkstatprofile<span class="w"> </span>-co<span class="w">  </span><span class="nv">COMPRESS</span><span class="o">=</span>LZW<span class="w"> </span>-nodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-f<span class="w"> </span>mean<span class="w"> </span>-f<span class="w"> </span>stdev<span class="w">  </span>-i<span class="w"> </span>geodata/LST/LST_MOYDmax_month.vrt<span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_month_mean_stdev.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0...10...20...30...40...50
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning 1: Can&#39;t open geodata/LST/LST_MOYDmax_month?.tif. Skipping it
Warning 1: Can&#39;t open geodata/LST/LST_MOYDmax_month??.tif. Skipping it
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...60...70...80...90...100 - done.
FileOpenError
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[13]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg"># Create a multiband vrt</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">gdalbuildvrt -overwrite -separate geodata/LST/LST_MOYDmax_month.vrt geodata/LST/LST_MOYDmax_month?.tif geodata/LST/LST_MOYDmax_month??.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg"># Calculate mean and standard deviation</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkstatprofile -co  COMPRESS=LZW -nodata 0 -f mean -f stdev  -i geodata/LST/LST_MOYDmax_month.vrt -o geodata/LST/LST_MOYDmax_month_mean_stdev.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;# Create a multiband vrt\ngdalbuildvrt -overwrite -separate geodata/LST/LST_MOYDmax_month.vrt geodata/LST/LST_MOYDmax_month?.tif geodata/LST/LST_MOYDmax_month??.tif\n# Calculate mean and standard deviation\npkstatprofile -co  COMPRESS=LZW -nodata 0 -f mean -f stdev  -i geodata/LST/LST_MOYDmax_month.vrt -o geodata/LST/LST_MOYDmax_month_mean_stdev.tif\n&#39;&#39; returned non-zero exit status 1.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can can composite images using <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html?highlight=reduceplane#geometry._Geometry.reducePlane">reducePlane</a></p>
<p>First we create a Jim object for all monthly GeoTIFF files containing LST data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># iterate over files in</span>
<span class="c1"># that directory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="n">files1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/LST/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;LST_MOYDmax_month?.tif&#39;</span><span class="p">))</span>
<span class="n">files2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/LST/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;LST_MOYDmax_month??.tif&#39;</span><span class="p">))</span>

<span class="c1">#create single band multi-plane image</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">()</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">()</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files1</span> <span class="o">+</span> <span class="n">files2</span><span class="p">:</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;LST_MOYDmax_month&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2019-&#39;</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="s1">&#39;-01&#39;</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;plane&#39;</span><span class="p">,</span> <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">setDimension</span><span class="p">([</span><span class="s1">&#39;LST&#39;</span><span class="p">],</span> <span class="s1">&#39;band&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[14]</span><span class="ansi-green-fg">, line 8</span>
<span class="ansi-green-fg">      5</span> files2 = <span style="color: rgb(0,135,0)">sorted</span>(Path(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/LST/</span><span class="ansi-yellow-fg">&#39;</span>).glob(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">LST_MOYDmax_month??.tif</span><span class="ansi-yellow-fg">&#39;</span>))
<span class="ansi-green-fg">      7</span> <span style="color: rgb(95,135,135)">#create single band multi-plane image</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">8</span> mask = <span class="ansi-yellow-bg">pj</span>.Jim()
<span class="ansi-green-fg">      9</span> jim = pj.Jim()
<span class="ansi-green-fg">     10</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> file <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> files1 + files2:

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[15]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.properties.getDimension()

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Exercise">
<h2>Exercise<a class="headerlink" href="#Exercise" title="Link to this heading"></a></h2>
<p>use the Xarray representation of Jim to display details on the dimension and variables of the jim object</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[16]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.xr()

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<p>We then create a mask based on the first month (plane is 0) and calculate the mean composite</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;crop&quot;</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">cropPlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set mask&quot;</span><span class="p">)</span>
<span class="n">jim</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reduce plane&quot;</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
crop
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[17]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">crop</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> mask = <span class="ansi-yellow-bg">pj</span>.geometry.cropPlane(jim, <span class="ansi-green-fg">0</span>)
<span class="ansi-green-fg">      3</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">mask</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> mask = (mask &gt;= <span class="ansi-green-fg">0</span>) &amp; (mask &lt;= <span class="ansi-green-fg">25</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="id1">
<h2>Exercise<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>The reducePlane operation takes a long time to process. The reason is the nodata value that complicates the calculation considerably. Create a new composite <code class="docutils literal notranslate"><span class="pre">mean_alldata</span></code> that does take into account all pixel values (without considering nodata values). Notice how the execution time is reduced…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_alldata</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[18]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> mean_alldata = <span class="ansi-yellow-bg">pj</span>.geometry.reducePlane(jim, rule = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p><strong>Bridging pyjeo to Numpy</strong></p>
<p>Pyjeo has been designed to allow for <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/2_tutorial.html#bridging-jim-to-third-party-packages">bridging</a> Jim raster image objects to third party libraries such as Numpy.</p>
<p>We will re-use the mask Jim object to store the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">mask</span><span class="o">.</span><span class="n">pixops</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;GDT_Float32&#39;</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackBand</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[19]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">numpy</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">np</span>
<span class="ansi-green-fg">      3</span> mask.pixops.convert(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">GDT_Float32</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">      4</span> jim.np()[jim.np()==<span class="ansi-green-fg">0</span>] = np.nan

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;numpy&#39;
</pre></div></div>
</div>
<p>We can avoid NaN in the resulting image by replacing it with 0</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">nan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">nan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[20]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> mask.np()[:] = <span class="ansi-yellow-bg">np</span>.nan_to_num(np.nanmean(jim.np(), axis=<span class="ansi-green-fg">0</span>), nan=<span class="ansi-green-fg">0</span>)
<span class="ansi-green-fg">      2</span> mask.np(<span class="ansi-green-fg">1</span>)[:] = np.nan_to_num(np.nanstd(jim.np(), axis=<span class="ansi-green-fg">0</span>), nan=<span class="ansi-green-fg">0</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;np&#39; is not defined
</pre></div></div>
</div>
<p>Even better is to avoid duplication of data to reduce memory footprint</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackBand</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[21]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> mask.np()[:] = <span class="ansi-yellow-bg">np</span>.nan_to_num(np.nanmean(jim.np(), axis=<span class="ansi-green-fg">0</span>), copy = <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>, nan=<span class="ansi-green-fg">0</span>)
<span class="ansi-green-fg">      2</span> mask.geometry.stackBand(mask)
<span class="ansi-green-fg">      3</span> mask.np(<span class="ansi-green-fg">1</span>)[:] = np.nan_to_num(np.nanstd(jim.np(), axis=<span class="ansi-green-fg">0</span>), copy = <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>, nan=<span class="ansi-green-fg">0</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;np&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>  <span class="c1"># left side</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>  <span class="c1"># middle</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>  <span class="c1"># right side</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">()[</span><span class="mi">0</span><span class="p">,:,:])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">()[:,:])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">np</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[22]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">plt</span>.gray()  <span style="color: rgb(95,135,135)"># show the filtered result in grayscale</span>
<span class="ansi-green-fg">      2</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">20</span>,<span class="ansi-green-fg">20</span>))
<span class="ansi-green-fg">      3</span> ax1 = fig.add_subplot(<span class="ansi-green-fg">131</span>)  <span style="color: rgb(95,135,135)"># left side</span>

<span class="ansi-red-fg">NameError</span>: name &#39;plt&#39; is not defined
</pre></div></div>
</div>
<p><strong>Bridging pyjeo to Xarray</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[23]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.xr()

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrmean</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[24]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> xrmean = <span class="ansi-yellow-bg">jim</span>.xr().where(jim.xr()!=<span class="ansi-green-fg">0</span>).mean(dim = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">time</span><span class="ansi-yellow-fg">&#39;</span>, skipna=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrstd</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[25]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> xrstd = <span class="ansi-yellow-bg">jim</span>.xr().where(jim.xr()!=<span class="ansi-green-fg">0</span>).std(dim = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">time</span><span class="ansi-yellow-fg">&#39;</span>, skipna=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">LST</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[26]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.xr().isel(time = <span class="ansi-green-fg">0</span>).LST.plot(cmap=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">gray</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrmean</span><span class="o">.</span><span class="n">LST</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[27]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">xrmean</span>.LST.plot(cmap=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">gray</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;xrmean&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrstd</span><span class="o">.</span><span class="n">LST</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[28]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">xrstd</span>.LST.plot(cmap=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">gray</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;xrstd&#39; is not defined
</pre></div></div>
</div>
<div class="line-block">
<div class="line">Xarray supports many operations on time series. For instance, we can alculate the seasonal median of LST.</div>
<div class="line">Hint: check this website on <a class="reference external" href="https://docs.digitalearthafrica.org/en/latest/sandbox/notebooks/Frequently_used_code/Working_with_time.html">Digital Earth Africa</a></div>
</div>
<p>Xarray has implemented convenient wrappers for plotting. Plot the 12 months of LST via Xarray representation of Jim</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="o">.</span><span class="n">xr</span><span class="p">()</span><span class="o">.</span><span class="n">LST</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[29]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>.xr().LST.plot(col=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">time</span><span class="ansi-yellow-fg">&#39;</span>, col_wrap=<span class="ansi-green-fg">6</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="id2">
<h2>Exercise<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>Xarray has implemented convenient wrappers for plotting. Plot the four seasons in four different colums (see same website on <a class="reference external" href="https://docs.digitalearthafrica.org/en/latest/sandbox/notebooks/Frequently_used_code/Working_with_time.html">Digital Earth Africa</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_seasonal</span><span class="o">.</span><span class="n">LST</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[30]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">ds_seasonal</span>.LST.plot(col=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">season</span><span class="ansi-yellow-fg">&#39;</span>, col_wrap=<span class="ansi-green-fg">4</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;ds_seasonal&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_seasonal</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[31]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">ds_seasonal</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_seasonal&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Using-tiling-mechanism">
<h2>Using tiling mechanism<a class="headerlink" href="#Using-tiling-mechanism" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tiletotal</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reduceTile</span><span class="p">(</span><span class="n">tileindex</span><span class="p">):</span>
    <span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files1</span> <span class="o">+</span> <span class="n">files2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;LST_MOYDmax_month&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2019-&#39;</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="s1">&#39;-01&#39;</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">jim</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">stackPlane</span><span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">tileindex</span> <span class="o">=</span> <span class="n">tileindex</span><span class="p">,</span> <span class="n">tiletotal</span> <span class="o">=</span> <span class="n">tiletotal</span><span class="p">,</span> <span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span><span class="p">))</span>
        <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;plane&#39;</span><span class="p">,</span> <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">setDimension</span><span class="p">([</span><span class="s1">&#39;LST&#39;</span><span class="p">],</span> <span class="s1">&#39;band&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;crop&quot;</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">cropPlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set mask&quot;</span><span class="p">)</span>
    <span class="n">jim</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">reducePlane</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">nodata</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">))</span>

<span class="k">for</span> <span class="n">tileindex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">tileindex</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reduceTile</span><span class="p">(</span><span class="n">tileindex</span><span class="p">)</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[33]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">plt</span>.gray()  <span style="color: rgb(95,135,135)"># show the filtered result in grayscale</span>
<span class="ansi-green-fg">      2</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">20</span>,<span class="ansi-green-fg">20</span>))
<span class="ansi-green-fg">      3</span> ax = []

<span class="ansi-red-fg">NameError</span>: name &#39;plt&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Filter-images">
<h2>Filter images<a class="headerlink" href="#Filter-images" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Aggregating and filtering images using <a class="reference external" href="http://pktools.nongnu.org/html/pkfilter.html">pkfilter</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="c1"># mean aggregation</span>
pkfilter<span class="w"> </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-ot<span class="w"> </span>Float32<span class="w"> </span>-dx<span class="w"> </span><span class="m">10</span><span class="w"> </span>-dy<span class="w"> </span><span class="m">10</span><span class="w"> </span>-f<span class="w"> </span>mean<span class="w"> </span>-d<span class="w"> </span><span class="m">10</span><span class="w"> </span>-i<span class="w"> </span>geodata/LST/LST_MOYDmax_monthMean.tif<span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_monthMean_aggreate10mean.tif
<span class="c1"># mean circular moving window</span>
pkfilter<span class="w"> </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-nodata<span class="w"> </span><span class="m">0</span><span class="w"> </span>-ot<span class="w"> </span>Float32<span class="w"> </span>-dx<span class="w"> </span><span class="m">11</span><span class="w"> </span>-dy<span class="w"> </span><span class="m">11</span><span class="w"> </span>-f<span class="w"> </span>mean<span class="w"> </span>-circ<span class="w">  </span>-i<span class="w"> </span>geodata/LST/LST_MOYDmax_monthMean.tif<span class="w"> </span>-o<span class="w"> </span>geodata/LST/LST_MOYDmax_monthMean_circular11mean.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 2: 164761 Aborted                 (core dumped) pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 10 -dy 10 -f mean -d 10 -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_aggreate10mean.tif
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 4: 164808 Aborted                 (core dumped) pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 11 -dy 11 -f mean -circ -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_circular11mean.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[34]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg"># mean aggregation </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 10 -dy 10 -f mean -d 10 -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_aggreate10mean.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg"># mean circular moving window</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 11 -dy 11 -f mean -circ  -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_circular11mean.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;# mean aggregation \npkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 10 -dy 10 -f mean -d 10 -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_aggreate10mean.tif\n# mean circular moving window\npkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 11 -dy 11 -f mean -circ  -i geodata/LST/LST_MOYDmax_monthMean.tif -o geodata/LST/LST_MOYDmax_monthMean_circular11mean.tif\n&#39;&#39; returned non-zero exit status 134.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can can use <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html?highlight=filter2d#ngbops._NgbOps.filter2d">filter</a> method, but more functions are available via bridging pyjeo to third party libraries such as <a href="#id3"><span class="problematic" id="id4">`scipy &lt;&gt;`__</span></a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyjeo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pj</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/LST/LST_MOYDmax_monthMean.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">taps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">ngbops</span><span class="o">.</span><span class="n">firfilter2d</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">taps</span><span class="o">=</span><span class="n">taps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">(),</span> <span class="n">mean</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">())</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">[::</span><span class="mi">10</span><span class="p">,::</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfCol</span><span class="p">(),</span> <span class="n">mean</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">nrOfRow</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[35]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pyjeo</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pj</span>
<span class="ansi-green-fg">      2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pathlib</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">import</span> Path
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">scipy</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">import</span> ndimage

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;pyjeo&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>  <span class="c1"># left side</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>  <span class="c1"># right side</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[36]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">plt</span>.gray()  <span style="color: rgb(95,135,135)"># show the filtered result in grayscale</span>
<span class="ansi-green-fg">      2</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">20</span>,<span class="ansi-green-fg">20</span>))
<span class="ansi-green-fg">      3</span> ax1 = fig.add_subplot(<span class="ansi-green-fg">121</span>)  <span style="color: rgb(95,135,135)"># left side</span>

<span class="ansi-red-fg">NameError</span>: name &#39;plt&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">unit_circle</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dists</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">unit_circle</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[37]</span><span class="ansi-green-fg">, line 5</span>
<span class="ansi-green-fg">      3</span>     dists = np.sqrt(A[:,<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>] + A)
<span class="ansi-green-fg">      4</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> (dists&lt;=r).astype(<span style="color: rgb(0,135,0)">int</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">5</span> <span class="ansi-yellow-bg">unit_circle</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">10</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[37]</span><span class="ansi-green-fg">, line 2</span>, in <span class="ansi-cyan-fg">unit_circle</span><span class="ansi-blue-fg">(r)</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">unit_circle</span>(r):
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span>     A = <span class="ansi-yellow-bg">np</span>.arange(-r,r+<span class="ansi-green-fg">1</span>)**<span class="ansi-green-fg">2</span>
<span class="ansi-green-fg">      3</span>     dists = np.sqrt(A[:,<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>] + A)
<span class="ansi-green-fg">      4</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> (dists&lt;=r).astype(<span style="color: rgb(0,135,0)">int</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;np&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">ngbops</span><span class="o">.</span><span class="n">firfilter2d</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">taps</span><span class="o">=</span><span class="n">unit_circle</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[38]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> mean = <span class="ansi-yellow-bg">pj</span>.ngbops.firfilter2d(jim, taps=unit_circle(<span class="ansi-green-fg">10</span>), norm=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>, pad=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">symmetric</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>  <span class="c1"># show the filtered result in grayscale</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>  <span class="c1"># left side</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>  <span class="c1"># right side</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[39]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">plt</span>.gray()  <span style="color: rgb(95,135,135)"># show the filtered result in grayscale</span>
<span class="ansi-green-fg">      2</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">20</span>,<span class="ansi-green-fg">20</span>))
<span class="ansi-green-fg">      3</span> ax1 = fig.add_subplot(<span class="ansi-green-fg">121</span>)  <span style="color: rgb(95,135,135)"># left side</span>

<span class="ansi-red-fg">NameError</span>: name &#39;plt&#39; is not defined
</pre></div></div>
</div>
<p>More functions are available via bridging pyjeo to third party libraries such as Multidimensional image processing from <a class="reference external" href="https://docs.scipy.org/doc/scipy/tutorial/ndimage.html">scipy</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim_filtered</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">jim</span><span class="p">)</span>
<span class="n">jim_filtered</span><span class="o">.</span><span class="n">np</span><span class="p">()[:]</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">(),</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">())</span>
<span class="k">assert</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">isEqual</span><span class="p">(</span><span class="n">jim_filtered</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[40]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> jim_filtered = <span class="ansi-yellow-bg">pj</span>.Jim(jim)
<span class="ansi-green-fg">      2</span> jim_filtered.np()[:] = ndimage.gaussian_filter(jim.np(), sigma = <span class="ansi-green-fg">2</span>)
<span class="ansi-green-fg">      3</span> ndimage.gaussian_filter(jim.np(), sigma = <span class="ansi-green-fg">2</span>, output=jim.np())

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Images-statistics">
<h2>Images statistics<a class="headerlink" href="#Images-statistics" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Aggregating and filtering images using <a class="reference external" href="http://pktools.nongnu.org/html/pkstat.html">pkstat</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkstat<span class="w"> </span>-hist<span class="w">  </span>-src_min<span class="w"> </span><span class="m">0</span><span class="w">  </span>-i<span class="w"> </span>geodata/temperature/ug_bio_3.tif<span class="w"> </span>&gt;<span class="w"> </span>geodata/temperature/ug_bio_3.hist
head<span class="w"> </span>geodata/temperature/ug_bio_3.hist
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
bash: line 1: geodata/temperature/ug_bio_3.hist: No such file or directory
head: cannot open &#39;geodata/temperature/ug_bio_3.hist&#39; for reading: No such file or directory
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[41]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pkstat -hist  -src_min 0  -i geodata/temperature/ug_bio_3.tif &gt; geodata/temperature/ug_bio_3.hist</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">head geodata/temperature/ug_bio_3.hist</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pkstat -hist  -src_min 0  -i geodata/temperature/ug_bio_3.tif &gt; geodata/temperature/ug_bio_3.hist\nhead geodata/temperature/ug_bio_3.hist\n&#39;&#39; returned non-zero exit status 1.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkstat<span class="w"> </span>-hist<span class="w">  </span>-nbin<span class="w">  </span><span class="m">20</span><span class="w"> </span>-src_min<span class="w"> </span><span class="m">0</span><span class="w">  </span>-i<span class="w"> </span>geodata/vegetation/GPPstdev08-11.tif
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FileOpenError
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can can use <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html?highlight=getstats#stats._Stats.getStats">getStats</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/temperature/ug_bio_3.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">(</span><span class="s1">&#39;histogram&#39;</span><span class="p">,</span> <span class="n">src_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[43]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fn = Path(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/temperature/ug_bio_3.tif</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      3</span> stats = jim.stats.getStats(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">histogram</span><span class="ansi-yellow-fg">&#39;</span>, src_min = <span class="ansi-green-fg">0</span>)
<span class="ansi-green-fg">      4</span> <span style="color: rgb(0,135,0)">print</span>(stats[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">bin</span><span class="ansi-yellow-fg">&#39;</span>][<span class="ansi-green-fg">0</span>:<span class="ansi-green-fg">10</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;geodata/vegetation/GPPstdev08-11.tif&#39;</span><span class="p">)</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">(</span><span class="s1">&#39;histogram&#39;</span><span class="p">,</span> <span class="n">src_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nbin</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[44]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fn = Path(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/GPPstdev08-11.tif</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      3</span> stats = jim.stats.getStats(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">histogram</span><span class="ansi-yellow-fg">&#39;</span>, src_min = <span class="ansi-green-fg">0</span>, nbin = <span class="ansi-green-fg">20</span>)
<span class="ansi-green-fg">      4</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> index, <span style="color: rgb(0,135,0)">bin</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">enumerate</span>(stats[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">bin</span><span class="ansi-yellow-fg">&#39;</span>]):

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">],</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;pixel value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;abs frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of pixel values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[45]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> fig = <span class="ansi-yellow-bg">plt</span>.figure(figsize = (<span class="ansi-green-fg">10</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">      2</span> plt.bar(stats[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">bin</span><span class="ansi-yellow-fg">&#39;</span>],stats[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">histogram</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      3</span> plt.xlabel(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">pixel value</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;plt&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Images-reclassification">
<h2>Images reclassification<a class="headerlink" href="#Images-reclassification" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Aggregating and filtering images using <a class="reference external" href="http://pktools.nongnu.org/html/pkreclass.html">pkreclass</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
pkstat<span class="w"> </span>-hist<span class="w"> </span>-i<span class="w"> </span>geodata/temperature/ug_bio_3.tif<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot; 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ if ($1&lt;75) {print $1, 0} else {print $1 , 1}}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>geodata/temperature/reclass_ug_bio_3.txt
pkreclass<span class="w"> </span>-co<span class="w"> </span><span class="nv">COMPRESS</span><span class="o">=</span>DEFLATE<span class="w"> </span>-co<span class="w"> </span><span class="nv">ZLEVEL</span><span class="o">=</span><span class="m">9</span><span class="w"> </span>-code<span class="w"> </span>geodata/temperature/reclass_ug_bio_3.txt<span class="w"> </span>-i<span class="w"> </span>geodata/temperature/ug_bio_3.tif<span class="w">  </span>-o<span class="w"> </span>geodata/temperature/reclass_ug_bio_3.tif
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
bash: line 1: geodata/temperature/reclass_ug_bio_3.txt: No such file or directory
terminate called after throwing an instance of &#39;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&#39;
bash: line 2: 164845 Aborted                 (core dumped) pkreclass -co COMPRESS=DEFLATE -co ZLEVEL=9 -code geodata/temperature/reclass_ug_bio_3.txt -i geodata/temperature/ug_bio_3.tif -o geodata/temperature/reclass_ug_bio_3.tif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[46]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">pkstat -hist -i geodata/temperature/ug_bio_3.tif | grep -v </span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg"> 0</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg"> | awk </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">{</span><span class="ansi-yellow-fg ansi-yellow-bg"> if ($1&lt;75) </span><span class="ansi-yellow-fg ansi-yellow-bg">{</span><span class="ansi-yellow-fg ansi-yellow-bg">print $1, 0} else </span><span class="ansi-yellow-fg ansi-yellow-bg">{</span><span class="ansi-yellow-fg ansi-yellow-bg">print $1 , 1}}</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg"> &gt; geodata/temperature/reclass_ug_bio_3.txt</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkreclass -co COMPRESS=DEFLATE -co ZLEVEL=9 -code geodata/temperature/reclass_ug_bio_3.txt -i geodata/temperature/ug_bio_3.tif  -o geodata/temperature/reclass_ug_bio_3.tif</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;pkstat -hist -i geodata/temperature/ug_bio_3.tif | grep -v &#34; 0&#34; | awk \&#39;{ if ($1&lt;75) {print $1, 0} else {print $1 , 1}}\&#39; &gt; geodata/temperature/reclass_ug_bio_3.txt\npkreclass -co COMPRESS=DEFLATE -co ZLEVEL=9 -code geodata/temperature/reclass_ug_bio_3.txt -i geodata/temperature/ug_bio_3.tif  -o geodata/temperature/reclass_ug_bio_3.tif\n&#39;&#39; returned non-zero exit status 134.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can can use <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html?highlight=reclass#classify._Classify.reclass">reclass</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;geodata/temperature/ug_bio_3.tif&#39;</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getDataType</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">(</span><span class="s1">&#39;histogram&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>

<span class="k">if</span> <span class="o">-</span><span class="mi">9999</span> <span class="ow">in</span> <span class="n">jim</span><span class="o">.</span><span class="n">np</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;value -9999 is found&quot;</span><span class="p">)</span>
<span class="n">classes0</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">75</span><span class="p">]</span>
<span class="n">classes1</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">][</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">]</span>
<span class="n">reclasses0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">classes0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">reclasses1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">classes1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classes0</span> <span class="o">+</span> <span class="n">classes1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reclasses0</span> <span class="o">+</span> <span class="n">reclasses1</span><span class="p">)</span>

<span class="n">reclass</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">reclass</span><span class="p">(</span><span class="n">jim</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="n">classes0</span> <span class="o">+</span> <span class="n">classes1</span><span class="p">,</span> <span class="n">reclasses</span> <span class="o">=</span> <span class="n">reclasses0</span> <span class="o">+</span> <span class="n">reclasses1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[47]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fn = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/temperature/ug_bio_3.tif</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      3</span> <span style="color: rgb(0,135,0)">print</span>(jim.properties.getDataType())
<span class="ansi-green-fg">      4</span> <span style="color: rgb(0,135,0)">print</span>(jim.stats.getStats())

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>However, we can do it much simpler:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jim</span><span class="p">[</span><span class="n">jim</span> <span class="o">&lt;</span> <span class="mi">75</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">jim</span><span class="p">[</span><span class="n">jim</span> <span class="o">&gt;=</span> <span class="mi">75</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reclass</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">isEqual</span><span class="p">(</span><span class="n">jim</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[48]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">jim</span>[jim &lt; <span class="ansi-green-fg">75</span>] = <span class="ansi-green-fg">0</span>
<span class="ansi-green-fg">      2</span> jim[jim &gt;= <span class="ansi-green-fg">75</span>] = <span class="ansi-green-fg">1</span>
<span class="ansi-green-fg">      3</span> <span style="color: rgb(0,135,0)">print</span>(reclass.properties.isEqual(jim))

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Zonal-statistic-(polygon-extraction)">
<h2>Zonal statistic (polygon extraction)<a class="headerlink" href="#Zonal-statistic-(polygon-extraction)" title="Link to this heading"></a></h2>
<p><strong>pktools</strong></p>
<p>Aggregating and filtering images using <a class="reference external" href="http://pktools.nongnu.org/html/pkextractogr.html">extractogr</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
rm<span class="w"> </span>-f<span class="w"> </span>geodata/shp/polygons_stat.*
pkextractogr<span class="w"> </span>-srcnodata<span class="w"> </span>-339999995214436424907732413799364296704<span class="w">   </span>-r<span class="w"> </span>mean<span class="w"> </span>-r<span class="w"> </span>stdev<span class="w"> </span>-r<span class="w"> </span>min<span class="w"> </span>-i<span class="w"> </span>geodata/vegetation/GPPmean08-11.tif<span class="w"> </span>-s<span class="w"> </span>geodata/shp/polygons.sqlite<span class="w"> </span>-o<span class="w"> </span>geodata/shp/polygons_stat.sqlite
pkextractogr<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="w"> </span>-srcnodata<span class="w"> </span>-339999995214436424907732413799364296704<span class="w">   </span>-r<span class="w"> </span>mean<span class="w"> </span>-r<span class="w"> </span>stdev<span class="w"> </span>-r<span class="w"> </span>min<span class="w"> </span>-i<span class="w"> </span>geodata/vegetation/GPPmean08-11.tif<span class="w"> </span>-s<span class="w"> </span>geodata/shp/polygons.sqlite<span class="w"> </span>-o<span class="w"> </span>geodata/shp/polygons_stat.shp

<span class="c1"># we can also create a csv that can be manipulate later on with awk</span>
rm<span class="w">  </span>-f<span class="w"> </span>geodata/shp/polygons_stat.csv
pkextractogr<span class="w"> </span>-f<span class="w"> </span>CSV<span class="w"> </span>-srcnodata<span class="w"> </span>-339999995214436424907732413799364296704<span class="w">   </span>-r<span class="w"> </span>mean<span class="w"> </span>-r<span class="w"> </span>stdev<span class="w"> </span>-r<span class="w"> </span>min<span class="w"> </span>-i<span class="w"> </span>geodata/vegetation/GPPmean08-11.tif<span class="w"> </span>-s<span class="w"> </span>geodata/shp/polygons.sqlite<span class="w"> </span>-o<span class="w"> </span>geodata/shp/polygons_stat.csv
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FileOpenError
FileOpenError
FileOpenError
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[49]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">rm -f geodata/shp/polygons_stat.*</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkextractogr -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.sqlite</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkextractogr -f </span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">ESRI Shapefile</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg"> -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.shp</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg"># we can also create a csv that can be manipulate later on with awk</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">rm  -f geodata/shp/polygons_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkextractogr -f CSV -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;rm -f geodata/shp/polygons_stat.*\npkextractogr -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.sqlite\npkextractogr -f &#34;ESRI Shapefile&#34; -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.shp\n\n# we can also create a csv that can be manipulate later on with awk\nrm  -f geodata/shp/polygons_stat.csv\npkextractogr -f CSV -srcnodata -339999995214436424907732413799364296704   -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/polygons.sqlite -o geodata/shp/polygons_stat.csv\n&#39;&#39; returned non-zero exit status 1.
</pre></div></div>
</div>
<p><strong>Zonal statistic (point extraction)</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper_timer</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elapsed time: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">wrapper_timer</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="c1"># at point location</span>
rm<span class="w"> </span>-f<span class="w"> </span>geodata/shp/point_stat.csv
pkextractogr<span class="w"> </span>-f<span class="w"> </span>CSV<span class="w"> </span>-srcnodata<span class="w"> </span>-339999995214436424907732413799364296704<span class="w"> </span>-r<span class="w"> </span>mean<span class="w"> </span>-r<span class="w"> </span>stdev<span class="w"> </span>-r<span class="w"> </span>min<span class="w"> </span>-i<span class="w"> </span>geodata/vegetation/GPPmean08-11.tif<span class="w"> </span>-s<span class="w"> </span>geodata/shp/presence.shp<span class="w"> </span>-o<span class="w"> </span>geodata/shp/point_stat.csv
<span class="c1"># at point location + 1 pixel around</span>
rm<span class="w"> </span>-f<span class="w"> </span>geodata/shp/point-buf_stat.csv
pkextractogr<span class="w"> </span>-f<span class="w"> </span>CSV<span class="w"> </span>-buf<span class="w"> </span><span class="m">2</span><span class="w"> </span>-srcnodata<span class="w"> </span>-339999995214436424907732413799364296704<span class="w"> </span>-r<span class="w"> </span>mean<span class="w"> </span>-r<span class="w"> </span>stdev<span class="w"> </span>-r<span class="w"> </span>min<span class="w"> </span>-i<span class="w"> </span>geodata/vegetation/GPPmean08-11.tif<span class="w"> </span>-s<span class="w"> </span>geodata/shp/presence.shp<span class="w"> </span>-o<span class="w"> </span>geodata/shp/point-buf_stat.csv
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FileOpenError
FileOpenError
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CalledProcessError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[51]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">get_ipython</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run_cell_magic</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">bash</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg"># at point location</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">rm -f geodata/shp/point_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkextractogr -f CSV -srcnodata -339999995214436424907732413799364296704 -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/presence.shp -o geodata/shp/point_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg"># at point location + 1 pixel around </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">rm -f geodata/shp/point-buf_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">pkextractogr -f CSV -buf 2 -srcnodata -339999995214436424907732413799364296704 -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/presence.shp -o geodata/shp/point-buf_stat.csv</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/interactiveshell.py:2565</span>, in <span class="ansi-cyan-fg">InteractiveShell.run_cell_magic</span><span class="ansi-blue-fg">(self, magic_name, line, cell)</span>
<span class="ansi-green-fg">   2563</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>.builtin_trap:
<span class="ansi-green-fg">   2564</span>     args = (magic_arg_s, cell)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2565</span>     result = <span class="ansi-yellow-bg">fn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2567</span> <span style="color: rgb(95,135,135)"># The code below prevents the output from being displayed</span>
<span class="ansi-green-fg">   2568</span> <span style="color: rgb(95,135,135)"># when using magics with decorator @output_can_be_silenced</span>
<span class="ansi-green-fg">   2569</span> <span style="color: rgb(95,135,135)"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="ansi-green-fg">   2570</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">getattr</span>(fn, magic.MAGIC_OUTPUT_CAN_BE_SILENCED, <span class="ansi-bold" style="color: rgb(0,135,0)">False</span>):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:160</span>, in <span class="ansi-cyan-fg">ScriptMagics._make_script_magic.&lt;locals&gt;.named_script_magic</span><span class="ansi-blue-fg">(line, cell)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    159</span>     line = script
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">160</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">shebang</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">line</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cell</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/.local/share/pipx/venvs/jupyter-sphinx/lib/python3.12/site-packages/IPython/core/magics/script.py:348</span>, in <span class="ansi-cyan-fg">ScriptMagics.shebang</span><span class="ansi-blue-fg">(self, line, cell)</span>
<span class="ansi-green-fg">    343</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> args.raise_error <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> p.returncode != <span class="ansi-green-fg">0</span>:
<span class="ansi-green-fg">    344</span>     <span style="color: rgb(95,135,135)"># If we get here and p.returncode is still None, we must have</span>
<span class="ansi-green-fg">    345</span>     <span style="color: rgb(95,135,135)"># killed it but not yet seen its return code. We don&#39;t wait for it,</span>
<span class="ansi-green-fg">    346</span>     <span style="color: rgb(95,135,135)"># in case it&#39;s stuck in uninterruptible sleep. -9 = SIGKILL</span>
<span class="ansi-green-fg">    347</span>     rc = p.returncode <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> -<span class="ansi-green-fg">9</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">348</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> CalledProcessError(rc, cell)

<span class="ansi-red-fg">CalledProcessError</span>: Command &#39;b&#39;# at point location\nrm -f geodata/shp/point_stat.csv\npkextractogr -f CSV -srcnodata -339999995214436424907732413799364296704 -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/presence.shp -o geodata/shp/point_stat.csv\n# at point location + 1 pixel around \nrm -f geodata/shp/point-buf_stat.csv\npkextractogr -f CSV -buf 2 -srcnodata -339999995214436424907732413799364296704 -r mean -r stdev -r min -i geodata/vegetation/GPPmean08-11.tif -s geodata/shp/presence.shp -o geodata/shp/point-buf_stat.csv\n&#39;&#39; returned non-zero exit status 1.
</pre></div></div>
</div>
<p><strong>pyjeo</strong></p>
<p>In pyjeo, we can can use <a class="reference external" href="https://jeodpp.jrc.ec.europa.eu/services/processing/pyjeohelp/3_reference.html#geometry._GeometryVect.extract">extract</a></p>
<p>output in SQLite format</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;geodata/vegetation/GPPmean08-11.tif&#39;</span>
<span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;geodata/shp/polygons.sqlite&#39;</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">Jim</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">jim</span><span class="p">[</span><span class="n">jim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jim</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getStats</span><span class="p">())</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;geodata/shp/temp.sqlite&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted1</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[52]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fn = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/vegetation/GPPmean08-11.tif</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">      2</span> vfn = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/shp/polygons.sqlite</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> jim = <span class="ansi-yellow-bg">pj</span>.Jim(fn)
<span class="ansi-green-fg">      4</span> jim[jim&lt;<span class="ansi-green-fg">0</span>]=-<span class="ansi-green-fg">1</span>
<span class="ansi-green-fg">      5</span> <span style="color: rgb(0,135,0)">print</span>(jim.stats.getStats())

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>output in ESRI Shapefile format</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;geodata/shp/temp.shp&#39;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">extracted2</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;geodata/shp/temp.shp&#39;</span><span class="p">,</span> <span class="n">oformat</span><span class="o">=</span><span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[53]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> output = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/shp/temp.shp</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">      2</span> Path(output).unlink(missing_ok = <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> extracted2 = <span class="ansi-yellow-bg">pj</span>.geometry.extract(v, jim, rule=[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">stdev</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#39;</span>], output=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/shp/temp.shp</span><span class="ansi-yellow-fg">&#39;</span>, oformat=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">ESRI Shapefile</span><span class="ansi-yellow-fg">&#39;</span>, srcnodata = -<span class="ansi-green-fg">1</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>calculate in memory and get result in dictionary</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extracted3</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;allpoints&#39;</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;temp1&#39;</span><span class="p">,</span> <span class="n">oformat</span><span class="o">=</span><span class="s1">&#39;Memory&#39;</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[54]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> extracted3 = <span class="ansi-yellow-bg">pj</span>.geometry.extract(v, jim, rule=[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">allpoints</span><span class="ansi-yellow-fg">&#39;</span>], output=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">temp1</span><span class="ansi-yellow-fg">&#39;</span>, oformat=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">Memory</span><span class="ansi-yellow-fg">&#39;</span>, srcnodata = -<span class="ansi-green-fg">1</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>In pandas format</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted3</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[55]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">pd</span>.DataFrame(extracted3.dict())

<span class="ansi-red-fg">NameError</span>: name &#39;pd&#39; is not defined
</pre></div></div>
</div>
<p>Extract point data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vfn</span> <span class="o">=</span> <span class="s1">&#39;geodata/shp/presence.shp&#39;</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">JimVect</span><span class="p">(</span><span class="n">vfn</span><span class="p">)</span>
<span class="n">extracted4</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="n">oformat</span><span class="o">=</span><span class="s1">&#39;Memory&#39;</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[56]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> vfn = <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geodata/shp/presence.shp</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> v = <span class="ansi-yellow-bg">pj</span>.JimVect(vfn)
<span class="ansi-green-fg">      3</span> extracted4 = pj.geometry.extract(v, jim, rule=[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>], output=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">point</span><span class="ansi-yellow-fg">&#39;</span>, oformat=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">Memory</span><span class="ansi-yellow-fg">&#39;</span>, srcnodata = -<span class="ansi-green-fg">1</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;pj&#39; is not defined
</pre></div></div>
</div>
<p>Extract points with buffer to calculate mean and standard deviation and minimum</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buffer</span> <span class="o">=</span> <span class="n">jim</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getDeltaX</span><span class="p">()</span><span class="o">*</span><span class="mi">1</span>
<span class="n">extracted5</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">jim</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stdev&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;point_buf&#39;</span><span class="p">,</span> <span class="n">oformat</span><span class="o">=</span><span class="s1">&#39;Memory&#39;</span><span class="p">,</span> <span class="n">srcnodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted5</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[57]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> buffer = <span class="ansi-yellow-bg">jim</span>.properties.getDeltaX()*<span class="ansi-green-fg">1</span>
<span class="ansi-green-fg">      2</span> extracted5 = pj.geometry.extract(v, jim, rule=[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">stdev</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#39;</span>], output=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">point_buf</span><span class="ansi-yellow-fg">&#39;</span>, oformat=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">Memory</span><span class="ansi-yellow-fg">&#39;</span>, srcnodata = -<span class="ansi-green-fg">1</span>, buffer = buffer)
<span class="ansi-green-fg">      3</span> pd.DataFrame(extracted5.dict())

<span class="ansi-red-fg">NameError</span>: name &#39;jim&#39; is not defined
</pre></div></div>
</div>
<p><strong>Remove all the output</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
rm<span class="w"> </span>-f<span class="w">  </span>geodata/vegetation/GPPcv08-11.tif<span class="w"> </span>geodata/LST/*_crop.tif<span class="w"> </span>geodata/vegetation/ETmean08-11_crop_trh.tif<span class="w"> </span>geodata/vegetation/ETmean08-11_crop_trh.txt<span class="w"> </span>vegetation/ETmean08-11_crop.txt<span class="w"> </span>geodata/vegetation/ETmosaic.vrt<span class="w"> </span>geodata/vegetation/ETmosaic.tif<span class="w"> </span>geodata/vegetation/stack_??.tifgeodata/vegetation/stack.vrtgeodata/vegetation/tiles.*geodata/vegetation/ETmean08-11_crop_proximity.tifgeodata/vegetation/ETmean08-11_crop_buffer.tif<span class="w"> </span>geodata/dem/slope.tifgeodata/dem/aspect.tif<span class="w"> </span>geodata/dem/tri.tifgeodata/dem/tpi.tifgeodata/dem/roughness.tifgeodata/vegetation/ETmean08-11_01_trh?.tifgeodata/LST/LST_MOYDmax_month1-msk.tifgeodata/LST/LST_MOYDmax_monthStdev.tifgeodata/LST/LST_MOYDmax_monthMean.tifgeodata/LST/LST_MOYDmax_month_mean_stdev.tifgeodata/LST/LST_MOYDmax_month.vrtgeodata/LST/LST_MOYDmax_monthMean_aggreate10mean.tifgeodata/LST/LST_MOYDmax_monthMean_circular11mean.tif<span class="w"> </span>geodata/temperature/reclass_ug_bio_3.tifgeodata/temperature/reclass_ug_bio_3.txtgeodata/shp/polygons_stat.csvgeodata/shp/point-buf_stat.csvgeodata/shp/point_stat.csvgeodata/shp/polygons_stat.*geodata/shp/TM_LARGE_BORDERS.shp.*<span class="w"> </span>geodata/shp/TM_UGANDA_BORDERS-0.3.*<span class="w"> </span>geodata/vegetation/ETmean08-11_crop.txt<span class="w"> </span>geodata/vegetation/ETmean08-11_01_msk_pyjeo.tif<span class="w"> </span>geodata/shp/temp.*
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pyjeo_introduction2.html" class="btn btn-neutral float-left" title="pyjeo: an open source image processing library in Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pyjeo_upscaling_surf.html" class="btn btn-neutral float-right" title="Scaling-up: batch processing on the cluster with pyjeo" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Giuseppe Amatulli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>