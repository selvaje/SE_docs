

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Use GDAL/OGR and PKTOOLS for raster/vector operations &mdash; Spatial Ecology&#39;s code documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Spatial Ecology's code documentation
          

          
            
            <img src="../_static/SE_compact.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">GEO DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GEODATA/geomorpho90m/geomorpho90m.html">Geomorpho90m: technical documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">WEB SEMINARS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html">Raster/Vector Processing using GDAL/OGR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#image-processing-using-pktools">Image Processing using Pktools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#introduction-to-grass-gis">Introduction to GRASS GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WEBSEMINAR/webseminar.html#geocomputation-with-high-performance-computing">GeoComputation with High Performance Computing</a></li>
</ul>
<p class="caption"><span class="caption-text">GDAL/OGR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GDAL/01_gdal.html">Use GDAL/OGR for raster/vector operations</a></li>
</ul>
<p class="caption"><span class="caption-text">PYTHON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/01_Python_Intro.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PYTHON/02_Geo_Python.html">Python &amp; GeoComputation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spatial Ecology's code documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Use GDAL/OGR and PKTOOLS for raster/vector operations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/PKTOOLS/gdal_pktools.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="use-gdal-ogr-and-pktools-for-raster-vector-operations">
<h1>Use GDAL/OGR and PKTOOLS for raster/vector operations<a class="headerlink" href="#use-gdal-ogr-and-pktools-for-raster-vector-operations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gdal-commands">
<h2>GDAL commands<a class="headerlink" href="#gdal-commands" title="Permalink to this headline">¶</a></h2>
<p><strong>Explore the files</strong></p>
<p>Change directory and list all the files with the extension .tif</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd \$HOME/ost4sem/exercise/geodata_SDM 
ls *\*.tif
</pre></div>
</div>
<p>Retrive the characteristic of the one tif file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdalinfo</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Visualize the image</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openev</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Reply to the following questions:<br />What is the pixel size?<br />How do you get min and max pixel values?\</p>
<p><strong>Understand data type</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                       <span class="n">Ranges</span> <span class="n">of</span> <span class="n">GDAL</span> <span class="n">data</span> <span class="n">types</span>        <span class="n">Image</span>    \
</pre></div>
</div>
<p>+———————–+——————–+————-+—————+——-+
| GDAL data type     |   minimum                           |  maximum |  Size |
+================+=======================+</p>
<p>+———————–+———————————-+————–+——–+</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                          <span class="n">Size</span>     \
 <span class="n">Byte</span>                   <span class="mi">0</span>          <span class="mi">255</span>        <span class="mi">39</span><span class="n">M</span>    \
 <span class="n">UInt16</span>                 <span class="mi">0</span>       <span class="mi">65</span><span class="p">,</span><span class="mi">535</span>        <span class="mi">78</span><span class="n">M</span>    \
 <span class="n">Int16</span><span class="p">,</span> <span class="n">CInt16</span>            <span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">768</span>       <span class="mi">32</span><span class="p">,</span><span class="mi">767</span>        <span class="mi">78</span><span class="n">M</span>    \
 <span class="n">UInt32</span>                 <span class="mi">0</span>    <span class="mi">4</span><span class="p">,</span><span class="mi">294</span><span class="p">,</span><span class="mi">967</span><span class="p">,</span><span class="mi">295</span>        <span class="mi">155</span><span class="n">M</span>      \
 <span class="n">Int32</span><span class="p">,</span> <span class="n">CInt32</span>     <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">483</span><span class="p">,</span><span class="mi">648</span>    <span class="mi">2</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">483</span><span class="p">,</span><span class="mi">647</span>        <span class="mi">155</span><span class="n">M</span>    \
 <span class="n">Float32</span><span class="p">,</span> <span class="n">CFloat32</span>      <span class="o">-</span><span class="mf">3.4E38</span>           <span class="mf">3.4E38</span>        <span class="mi">155</span><span class="n">M</span>    \
 <span class="n">Float64</span><span class="p">,</span> <span class="n">CFloat64</span>    <span class="o">-</span><span class="mf">1.79E308</span>         <span class="mf">1.79E308</span>        <span class="mi">309</span><span class="n">M</span>    
</pre></div>
</div>
<p><strong>Understand NoData Value</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdalinfo</span> <span class="o">-</span><span class="n">mm</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
<span class="n">gdal_edit</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a_nodata</span> <span class="o">-</span><span class="mi">9999</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
<span class="n">gdalinfo</span> <span class="o">-</span><span class="n">mm</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
<span class="n">gdal_edit</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a_nodata</span> <span class="o">-</span><span class="mf">339999995214436424907732413799364296704.000</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
</pre></div>
</div>
<p><strong>Calculate minimum and maximum values for all the images</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for file in vegetation/*.tif ; do
gdalinfo -mm $file | grep Computed
done
</pre></div>
</div>
<p>Exercise:</p>
<p>Use one of the gdal commands and try to clip the
vegetation/ETmean08-11.tif image using a square box (numbers are in
degree):\\ xmin : 32\\ xmax : 34\\ ymin : 1\\ ymax : 3\\ \\</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">gdal</span><span class="o">............................</span>  <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop</span><span class="o">.</span><span class="n">tif</span>    
</pre></div>
</div>
<p><strong>Create a Coefficient of variation</strong></p>
<p>GPPmean08-11.tif temporal mean of Gross Primary Productivity<br />GPPstdev08-11.tif temporal standard deviation of Gross Primary Productivity\</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal_calc</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">Float32</span> <span class="o">--</span><span class="n">overwrite</span> <span class="o">-</span><span class="n">A</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">GPPstdev08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="o">-</span><span class="n">B</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">GPPmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="o">--</span><span class="n">calc</span><span class="o">=</span><span class="s2">&quot;( A.astype(float) / ( B.astype(float) + 0.000000001 ) )&quot;</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">vegetation</span><span class="o">/</span><span class="n">GPPcv08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>
</pre></div>
</div>
<p><strong>Change pixel resolution</strong></p>
<ol class="simple">
<li><p>looping trough the images</p></li>
</ol>
<p>for file in LST/LST_MOYDmax_month?.tif LST/LST_MOYDmax_month??.tif;
do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> filename=$(basename $file .tif )    \
 gdalwarp -overwrite -te 29 -1 35.0000000048 4.000000004 -tr 0.008333333340000 0.008333333340000 -co COMPRESS=DEFLATE -co ZLEVEL=9 $file LST/${filename}_crop.tif     
</pre></div>
</div>
<p>done</p>
<p><strong>Get value at one pixel/line image-location</strong></p>
<ol class="simple">
<li><p>looping trough the images</p></li>
</ol>
<p>for file in LST/LST_MOYDmax_month?.tif LST/LST_MOYDmax_month??.tif;
do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  gdallocationinfo -valonly $file  20 20      
</pre></div>
</div>
<p>done</p>
<p><strong>Get value at lat/long image-location</strong></p>
<ol class="simple">
<li><p>looping trough the images</p></li>
</ol>
<p>for file in LST/LST_MOYDmax_month?.tif LST/LST_MOYDmax_month??.tif;
do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  gdallocationinfo -valonly -geoloc $file  33 2      
</pre></div>
</div>
<p>done</p>
<p><strong>Get value at multiple lat/long image-location</strong></p>
<ol class="simple">
<li><p>create the lat long file</p></li>
</ol>
<p>echo 32.5 2.5 &gt; LST/x_y.txt echo 31.1 2.1 &gt;&gt; LST/x_y.txt</p>
<ol class="simple">
<li><p>looping trough the images</p></li>
</ol>
<p>for file in LST/LST_MOYDmax_month?.tif LST/LST_MOYDmax_month??.tif;
do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  gdallocationinfo -valonly -geoloc $file &lt; LST/x_y.txt      \
  echo &quot;&quot;    
</pre></div>
</div>
<p>done</p>
<p><strong>From Image to text and from txt to image</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal_translate</span> <span class="o">-</span><span class="n">of</span> <span class="n">XYZ</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop</span><span class="o">.</span><span class="n">tif</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop</span><span class="o">.</span><span class="n">txt</span>    
<span class="n">awk</span> <span class="s1">&#39;{if ($3&gt;2 &amp;&amp; $3&lt;4) {print $1,$2,50 } else </span><span class="si">{print}</span><span class="s1">}&#39;</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_trh</span><span class="o">.</span><span class="n">txt</span>    
<span class="n">gdal_translate</span> <span class="o">-</span><span class="n">ot</span> <span class="n">Byte</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_trh</span><span class="o">.</span><span class="n">txt</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_trh</span><span class="o">.</span><span class="n">tif</span>    
</pre></div>
</div>
<p><strong>The use of VRT to stack images and tiling</strong></p>
<ol class="simple">
<li><p>stack the tif</p></li>
</ol>
<p>gdalbuildvrt -overwrite -separate vegetation/stack.vrt
vegetation/ETmean08-11.tif vegetation/ETstdev08-11.tif gdalinfo
vegetation/stack.vrt</p>
<ol class="simple">
<li><p>split in tiles</p></li>
</ol>
<p>gdal_translate -srcwin 0 0 360 300 vegetation/stack.vrt
vegetation/stack_UL.tif gdal_translate -srcwin 0 300 360 300
vegetation/stack.vrt vegetation/stack_UR.tif gdal_translate -srcwin
360 0 360 300 vegetation/stack.vrt vegetation/stack_LL.tif
gdal_translate -srcwin 360 300 360 300 vegetation/stack.vrt
vegetation/stack_LR.tif</p>
<ol class="simple">
<li><p>recompose the image</p></li>
</ol>
<p>gdalbuildvrt -overwrite vegetation/ETmosaic.vrt vegetation/stack_UL.tif
vegetation/stack_UR.tif vegetation/stack_LL.tif
vegetation/stack_LR.tif gdal_translate -co COMPRESS=DEFLATE -co
ZLEVEL=9 vegetation/ETmosaic.vrt vegetation/ETmosaic.tif</p>
<p><strong>Create shp border tiles</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>rm -f vegetation/tiles.*
gdaltindex vegetation/tiles.shp vegetation/stack_??.tif
</pre></div>
</div>
<p><strong>Surface distance/buffer</strong></p>
<p>Continues distance surface</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal_proximity</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">values</span> <span class="mi">0</span> <span class="o">-</span><span class="n">distunits</span> <span class="n">PIXEL</span> <span class="o">-</span><span class="n">ot</span> <span class="n">UInt32</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_trh</span><span class="o">.</span><span class="n">tif</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_proximity</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Fix buffer surface</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal_proximity</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">fixed</span><span class="o">-</span><span class="n">buf</span><span class="o">-</span><span class="n">val</span> <span class="mi">4</span> <span class="o">-</span><span class="n">maxdist</span> <span class="mi">4</span> <span class="o">-</span><span class="n">nodata</span> <span class="mi">10</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">values</span> <span class="mi">0</span> <span class="o">-</span><span class="n">distunits</span> <span class="n">PIXEL</span> <span class="o">-</span><span class="n">ot</span> <span class="n">Byte</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_trh</span><span class="o">.</span><span class="n">tif</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11</span><span class="n">_crop_buffer</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p><strong>Topography variables</strong></p>
<ol class="simple">
<li><p>calculate slope</p></li>
</ol>
<p>gdaldem slope -s 111120 -co COMPRESS=DEFLATE -co ZLEVEL=9
dem/GMTED2010.tif dem/slope.tif</p>
<ol class="simple">
<li><p>calculate apect</p></li>
</ol>
<p>gdaldem aspect -zero_for_flat -co COMPRESS=DEFLATE -co ZLEVEL=9
dem/GMTED2010.tif dem/aspect.tif</p>
<ol class="simple">
<li><p>calculate Terrain Ruggedness Index TRI</p></li>
</ol>
<p>gdaldem TRI -co COMPRESS=DEFLATE -co ZLEVEL=9 dem/GMTED2010.tif
dem/tri.tif</p>
<ol class="simple">
<li><p>calculate Topographic Position Index TPI</p></li>
</ol>
<p>gdaldem TPI -co COMPRESS=DEFLATE -co ZLEVEL=9 dem/GMTED2010.tif
dem/tpi.tif</p>
<ol class="simple">
<li><p>calculate Roughness</p></li>
</ol>
<p>gdaldem roughness -co COMPRESS=DEFLATE -co ZLEVEL=9 dem/GMTED2010.tif
dem/roughness.tif</p>
<p>##**OGR Commands</p>
<p><strong>Select a polygon and create a new shape file</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">ogrinfo</span> <span class="o">-</span><span class="n">al</span> <span class="o">-</span><span class="n">geom</span><span class="o">=</span><span class="n">NO</span> <span class="n">shp</span><span class="o">/</span><span class="n">TM_WORLD_BORDERS</span><span class="o">.</span><span class="n">shp</span>
</pre></div>
</div>
<ol class="simple">
<li><p>base on an attribute</p></li>
</ol>
<p>rm -f shp/TM_UGANDA_BORDERS-0.3.* ogr2ogr -overwrite -f “ESRI
Shapefile” -where “NAME = ‘Uganda’” shp/TM_UGANDA_BORDERS-0.3.shp
shp/TM_WORLD_BORDERS.shp</p>
<ol class="simple">
<li><p>base on dimension of the polygons</p></li>
</ol>
<p>rm -f shp/TM_LARGE_BORDERS.* ogr2ogr -overwrite -f “ESRI Shapefile”
-sql “SELECT * FROM TM_WORLD_BORDERS WHERE OGR_GEOM_AREA &gt; 100 “
shp/TM_LARGE_BORDERS.shp shp/TM_WORLD_BORDERS.shp</p>
<p><strong>Add attribute and calculate a new value</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">shp</span><span class="o">/</span><span class="n">TM_WORLD_BORDERS_Area100</span><span class="o">.</span><span class="n">shp</span> <span class="n">ogr2ogr</span>
</pre></div>
</div>
<p>shp/TM_WORLD_BORDERS_Area100.shp shp/TM_WORLD_BORDERS.shp</p>
<p>ogrinfo -sql “ALTER TABLE TM_WORLD_BORDERS_Area100 ADD COLUMN
Area100 real(12,0)” shp/TM_WORLD_BORDERS_Area100.shp</p>
<p>ogrinfo -dialect SQLite -sql “UPDATE TM_WORLD_BORDERS_Area100 set
Area100 = AREA + 10 “ shp/TM_WORLD_BORDERS_Area100.shp</p>
<p>more example at <a class="reference external" href="http://www.gdal.org/ogr_sql.html">http://www.gdal.org/ogr_sql.html</a></p>
<div class="section" id="pktools-commands">
<h3>PKTOOLS Commands<a class="headerlink" href="#pktools-commands" title="Permalink to this headline">¶</a></h3>
<p><strong>Create a mask</strong></p>
<p>The same operation that we have done before
gdal_translate -of XYZ vegetation/ETmean08-11_crop.tif vegetation/ETmean08-11_crop.txt<br />awk ‘{if ($3&gt;2 &amp;&amp; $3&lt;4) {print $1,$2,50 } else {print}}’ vegetation/ETmean08-11_crop.txt &gt; vegetation/ETmean08-11_crop_trh.txt<br />gdal_translate -ot Byte vegetation/ETmean08-11_crop_trh.txt vegetation/ETmean08-11_crop_trh.tif</p>
<p>can be done more efficient using pkgetmask. We can create 3 masks using
different thresholds values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkgetmask</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="nb">min</span> <span class="mi">1</span> <span class="o">-</span><span class="nb">max</span> <span class="mi">2</span> <span class="o">-</span><span class="n">data</span> <span class="mi">1</span> <span class="o">-</span><span class="n">nodata</span> <span class="mi">0</span> <span class="o">-</span><span class="n">ot</span> <span class="n">Byte</span> <span class="o">-</span><span class="n">i</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="o">-</span><span class="n">o</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11_01</span><span class="n">_trhA</span><span class="o">.</span><span class="n">tif</span>    
<span class="n">pkgetmask</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="nb">min</span> <span class="mi">5</span> <span class="o">-</span><span class="nb">max</span> <span class="mi">8</span> <span class="o">-</span><span class="n">data</span> <span class="mi">1</span> <span class="o">-</span><span class="n">nodata</span> <span class="mi">0</span> <span class="o">-</span><span class="n">ot</span> <span class="n">Byte</span> <span class="o">-</span><span class="n">i</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="o">-</span><span class="n">o</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11_01</span><span class="n">_trhB</span><span class="o">.</span><span class="n">tif</span>    
<span class="n">pkgetmask</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="nb">min</span> <span class="mi">0</span> <span class="o">-</span><span class="nb">max</span> <span class="mi">10</span> <span class="o">-</span><span class="n">data</span> <span class="mi">0</span> <span class="o">-</span><span class="n">nodata</span> <span class="mi">1</span> <span class="o">-</span><span class="n">ot</span> <span class="n">Byte</span> <span class="o">-</span><span class="n">i</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span> <span class="o">-</span><span class="n">o</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">ETmean08</span><span class="o">-</span><span class="mi">11_01</span><span class="n">_trhC</span><span class="o">.</span><span class="n">tif</span>    
</pre></div>
</div>
<p><strong>Set a mask to other image</strong></p>
<p>Use the prepared mask and apply to the image.
pksetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 \<br />-m vegetation/ETmean08-11_01_trhA.tif -msknodata 1 -nodata -9 \<br />-m vegetation/ETmean08-11_01_trhB.tif -msknodata 1 -nodata -5 \<br />-m vegetation/ETmean08-11_01_trhC.tif -msknodata 1 -nodata -10 \<br />-i vegetation/ETmean08-11.tif -o vegetation/ETmean08-11_01_msk.tif</p>
<p><strong>Composite images</strong></p>
<ol class="simple">
<li><p>create a mask to apply during the composite</p></li>
</ol>
<p>pkgetmask -co COMPRESS=DEFLATE -co ZLEVEL=9 -min 0 -max 25 -data 0
-nodata 1 -ot Byte -i LST/LST_MOYDmax_month1.tif -o
LST/LST_MOYDmax_month1-msk.tif</p>
<ol class="simple">
<li><p>Calculate mean and standard deviation with several images</p></li>
</ol>
<p>pkcomposite $(for file in LST/LST_MOYDmax_month??.tif
LST/LST_MOYDmax_month?.tif ; do echo -i $file ; done ) -m
LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr mean -dstnodata 0 -co
COMPRESS=LZW -co ZLEVEL=9 -o LST/LST_MOYDmax_monthMean.tif pkcomposite
$(for file in LST/LST_MOYDmax_month??.tif
LST/LST_MOYDmax_month?.tif ; do echo -i $file ; done ) -m
LST/LST_MOYDmax_month1-msk.tif -msknodata 0 -cr stdev -dstnodata -1
-co COMPRESS=LZW -co ZLEVEL=9 -o LST/LST_MOYDmax_monthStdev.tif
Pkcomposite is very flexible, it can deal with different
extents, resolutions, and can be used in combination with gdal comand to
make composite of modis immages (see <a class="reference external" href="wiki:modiswget"> Download MODIS Land Surface
Temperature (*.hdf) from Nasa ftp </a>)</p>
<p>An alternative way is to use pkstatprofile</p>
<ol class="simple">
<li><p>Create a multiband vrt</p></li>
</ol>
<p>gdalbuildvrt -overwrite -separate LST/LST_MOYDmax_month.vrt
LST/LST_MOYDmax_month?.tif LST/LST_MOYDmax_month??.tif</p>
<ol class="simple">
<li><p>Calculate mean and standard deviation</p></li>
</ol>
<p>pkstatprofile -co COMPRESS=LZW -nodata 0 -f mean -f stdev -i
LST/LST_MOYDmax_month.vrt -o LST/LST_MOYDmax_month_mean_stdev.tif</p>
<p><strong>Filter/Aggregate images</strong></p>
<ol class="simple">
<li><p>mean aggregation</p></li>
</ol>
<p>pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 10
-dy 10 -f mean -d 10 -i LST/LST_MOYDmax_monthMean.tif -o
LST/LST_MOYDmax_monthMean_aggreate10mean.tif</p>
<ol class="simple">
<li><p>mean circular moving window</p></li>
</ol>
<p>pkfilter -co COMPRESS=DEFLATE -co ZLEVEL=9 -nodata 0 -ot Float32 -dx 11
-dy 11 -f mean -c -i LST/LST_MOYDmax_monthMean.tif -o
LST/LST_MOYDmax_monthMean_circular11mean.tif</p>
<p><strong>Images statistic and histogram</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkstat</span> <span class="o">-</span><span class="n">hist</span> <span class="o">-</span><span class="n">nbin</span> <span class="mi">100</span> <span class="o">-</span><span class="n">src_min</span> <span class="mi">0</span> <span class="o">-</span><span class="n">i</span> <span class="n">vegetation</span><span class="o">/</span><span class="n">GPPstdev08</span><span class="o">-</span><span class="mf">11.</span><span class="n">tif</span>    
<span class="n">pkstat</span> <span class="o">-</span><span class="n">hist</span> <span class="o">-</span><span class="n">src_min</span> <span class="mi">0</span> <span class="o">-</span><span class="n">i</span> <span class="n">temperature</span><span class="o">/</span><span class="n">ug_bio_3</span><span class="o">.</span><span class="n">tif</span>    
</pre></div>
</div>
<p><strong>Images reclassification</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkstat</span> <span class="o">-</span><span class="n">hist</span> <span class="o">-</span><span class="n">i</span> <span class="n">temperature</span><span class="o">/</span><span class="n">ug_bio_3</span><span class="o">.</span><span class="n">tif</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot; 0&quot;</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{ if ($1&lt;75) { print $1 , 0 } else { print $1 , 1 } }&#39;</span> <span class="o">&gt;</span> <span class="n">temperature</span><span class="o">/</span><span class="n">reclass_ug_bio_3</span><span class="o">.</span><span class="n">txt</span>    
<span class="n">pkreclass</span> <span class="o">-</span><span class="n">co</span> <span class="n">COMPRESS</span><span class="o">=</span><span class="n">DEFLATE</span> <span class="o">-</span><span class="n">co</span> <span class="n">ZLEVEL</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">code</span> <span class="n">temperature</span><span class="o">/</span><span class="n">reclass_ug_bio_3</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">i</span> <span class="n">temperature</span><span class="o">/</span><span class="n">ug_bio_3</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span><span class="n">o</span> <span class="n">temperature</span><span class="o">/</span><span class="n">reclass_ug_bio_3</span><span class="o">.</span><span class="n">tif</span>    
</pre></div>
</div>
<p>**Zonal statistic (polygon extraction)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">shp</span><span class="o">/</span><span class="n">polygons_stat</span><span class="o">.</span>\<span class="o">*</span> <span class="n">pkextractogr</span> <span class="o">-</span><span class="n">srcnodata</span>
</pre></div>
</div>
<p>-339999995214436424907732413799364296704 -r mean -r stdev -r min -i
vegetation/GPPmean08-11.tif -s shp/polygons.sqlite -o
shp/polygons_stat.sqlite</p>
<p>pkextractogr -f “ESRI Shapefile” -srcnodata
-339999995214436424907732413799364296704 -r mean -r stdev -r min -i
vegetation/GPPmean08-11.tif -s shp/polygons.sqlite -o
shp/polygons_stat.shp</p>
<ol class="simple">
<li><p>we can also create a csv that can be manipulate later on with awk</p></li>
</ol>
<p>rm -f shp/polygons_stat.csv pkextractogr -f CSV -srcnodata
-339999995214436424907732413799364296704 -r mean -r stdev -r min -i
vegetation/GPPmean08-11.tif -s shp/polygons.sqlite -o
shp/polygons_stat.csv</p>
<p><strong>Zonal statistic (point extraction)</strong></p>
<ol class="simple">
<li><p>at point location</p></li>
</ol>
<p>rm shp/point_stat.csv pkextractogr -f CSV -srcnodata
-339999995214436424907732413799364296704 -r mean -r stdev -r min -i
vegetation/GPPmean08-11.tif -s shp/presence.shp -o shp/point_stat.csv</p>
<ol class="simple">
<li><p>at point location + 1 pixel around</p></li>
</ol>
<p>rm shp/point-buf_stat.csv pkextractogr -f CSV -buf 2 -srcnodata
-339999995214436424907732413799364296704 -r mean -r stdev -r min -i
vegetation/GPPmean08-11.tif -s shp/presence.shp -o
shp/point-buf_stat.csv</p>
<p>Remove all the output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>rm -f vegetation/GPPcv08-11.tif LST/*_crop.tif vegetation/ETmean08-11_crop_trh.tif vegetation/ETmean08-11_crop_trh.txt vegetation/ETmean08-11_crop.txt vegetation/ETmosaic.vrt vegetation/ETmosaic.tif vegetation/stack_UL.tif vegetation/stack_UR.tif vegetation/stack_LL.tif vegetation/stack_LR.tif vegetation/stack.vrt vegetation/tiles.* vegetation/ETmean08-11_crop_proximity.tif vegetation/ETmean08-11_crop_buffer.tif dem/slope.tif dem/aspect.tif dem/tri.tif dem/tpi.tif dem/roughness.tif vegetation/ETmean08-11_01_trh?.tif LST/LST_MOYDmax_month1-msk.tif LST/LST_MOYDmax_monthStdev.tif LST/LST_MOYDmax_monthMean.tif LST/LST_MOYDmax_month_mean_stdev.tif LST/LST_MOYDmax_month.vrt LST/LST_MOYDmax_monthMean_aggreate10mean.tif LST/LST_MOYDmax_monthMean_circular11mean.tif temperature/reclass_ug_bio_3.tif temperature/reclass_ug_bio_3.txt shp/polygons_stat.csv shp/polygons_stat.* shp/TM_WORLD_BORDERS_Area100.*    
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Giuseppe Amatulli

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>